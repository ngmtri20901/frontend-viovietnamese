module.exports=[934313,a=>{"use strict";a.s(["StartExerciseButton",()=>b]);let b=(0,a.i(211857).registerClientReference)(function(){throw Error("Attempted to call StartExerciseButton() from the server but StartExerciseButton is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/app/(app)/learn/[topicSlug]/[lessonSlug]/StartExerciseButton.tsx <module evaluation>","StartExerciseButton")},172090,a=>{"use strict";a.s(["StartExerciseButton",()=>b]);let b=(0,a.i(211857).registerClientReference)(function(){throw Error("Attempted to call StartExerciseButton() from the server but StartExerciseButton is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/app/(app)/learn/[topicSlug]/[lessonSlug]/StartExerciseButton.tsx","StartExerciseButton")},215839,a=>{"use strict";a.i(934313);var b=a.i(172090);a.n(b)},48534,a=>{"use strict";a.s(["default",()=>w,"revalidate",()=>v],48534);var b=a.i(907997),c=a.i(297647),d=a.i(142238),e=a.i(644133),f=a.i(334135),g=a.i(701269);let h=(0,g.default)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),i=(0,g.default)("award",[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]]);var j=a.i(730375);let k=(0,g.default)("play",[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]]);var l=a.i(301508),m=a.i(330215);a.i(664445);var n=a.i(156382),n=n,o=a.i(296280),p=a.i(856608),q=a.i(556919),r=a.i(445631);a.i(570396);var s=a.i(673727),t=a.i(215839),u=a.i(78769);let v=1;async function w({params:a}){let{topicSlug:g,lessonSlug:v}=await a,w=await (0,d.createClient)(),{data:{user:x}}=await w.auth.getUser(),{data:y}=await w.from("topics").select("topic_id, english_title, slug").eq("slug",g).single();if(!y)return(0,b.jsx)("div",{className:"min-h-screen grid place-items-center",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("h1",{className:"text-xl font-semibold mb-4",children:"Topic not found"}),(0,b.jsx)(c.default,{href:"/learn",children:(0,b.jsx)(f.Button,{children:"Back to Learn"})})]})});let{data:z}=await w.from("lessons").select("id, lesson_name, slug, status, duration_minutes, coins_reward").eq("topic_id",y.topic_id).eq("slug",v).eq("status","published").single();z||(0,s.notFound)();let A=!1;if(x){let{data:a}=await w.from("user_lesson_progress").select("status").eq("user_id",x.id).eq("lesson_id",z.id).maybeSingle();A=a?.status==="passed"}let{data:B}=await w.from("practice_sets").select("id").eq("lesson_id",z.id).eq("is_active",!0).eq("status","ACTIVE").order("sequence_order",{ascending:!0}).limit(1).maybeSingle(),{data:C}=await w.from("lesson_materials").select("id, side, type, title, explanation, data, media_url, order_index").eq("lesson_id",z.id).order("side",{ascending:!0}).order("order_index",{ascending:!0}),D=C??[],E=D.filter(a=>"main"===a.side).sort((a,b)=>a.order_index-b.order_index),F=D.filter(a=>"sidebar"===a.side).sort((a,b)=>a.order_index-b.order_index),G=a=>a?w.storage.from("lesson-materials").getPublicUrl(a).data.publicUrl??null:null,H=E.find(a=>"storybook"===a.type)??E.find(a=>"dialogue"===a.type)??E.find(a=>"image"===a.type)??E.find(a=>"video"===a.type)??null,I=H?{...H,explanation:function(a){if(!a)return null;if("string"==typeof a)try{return JSON.parse(a)}catch{return a}return"object"==typeof a?a:null}(H.explanation)}:null,J=I?.media_url?/^https?:\/\//i.test(I.media_url)?I.media_url:G(I.media_url):null,K=(Array.isArray(I?.data?.hightlight_words)?I.data.hightlight_words:void 0)??(Array.isArray(I?.data?.highlight_words)?I.data.highlight_words:void 0)??[];I?.type==="dialogue"&&Array.isArray(I.data?.lines)&&I.data.lines.map(a=>({...a,audioUrl:a.audio?G(a.audio):null,_hl:Array.isArray(a.highlight_words)?a.highlight_words:K}));let L=F.map(a=>"grammar"===a.type&&a.media_url?{...a,mediaResolved:G(a.media_url)}:"examples"===a.type&&Array.isArray(a.data?.pairs)?{...a,pairsResolved:a.data.pairs.map(a=>({...a,audioUrl:a.audio?G(a.audio):null}))}:a),M=I?.type==="storybook"&&function(a){if(!a)return!1;try{let b=new URL(a).hostname.toLowerCase();return"gemini.google.com"===b||"g.co"===b||b.endsWith(".google.com")}catch{return!1}}(J??void 0),N=new Set;if(x){let{data:a}=await w.from("saved_flashcards").select("flashcard_id").eq("UserID",x.id).eq("topic_id",y.topic_id).eq("lesson_id",z.id).eq("flashcard_type","CUSTOM");a&&a.length>0&&(N=new Set(a.map(a=>a.flashcard_id)))}let O=F.filter(a=>"vocabulary"===a.type).flatMap(a=>Array.isArray(a.data?.items)?a.data.items.map(a=>{let b=(0,u.generateVocabKey)(y.topic_id,z.id,a.vi),c=N.has(b);return{vi:a.vi,en:a.en,ipa:a.ipa,audio:a.audio,pos:a.pos,vocabKey:b,isSaved:c}}):[]);return(0,b.jsxs)("div",{className:"max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-8",children:[(0,b.jsxs)("section",{className:"md:col-span-2 space-y-6",children:[(0,b.jsxs)(e.Card,{children:[(0,b.jsx)(e.CardHeader,{children:(0,b.jsxs)(e.CardTitle,{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{children:I?.title??"Lesson Content"}),(0,b.jsx)("span",{className:"text-sm font-normal text-gray-500",children:I?.type?.toUpperCase()})]})}),(0,b.jsxs)(e.CardContent,{className:"space-y-4",children:[!I&&(0,b.jsx)("p",{className:"text-gray-600",children:"No main content yet."}),I?.type==="storybook"&&J&&(0,b.jsxs)("div",{className:"space-y-3",children:[M?(0,b.jsxs)("div",{className:"rounded-lg border p-4 bg-card space-y-3",children:[(0,b.jsx)("p",{className:"text-sm text-gray-700",children:"This storybook is hosted on a site that doesn’t allow direct embedding. Please open it in a new window to view the full experience."}),(0,b.jsx)(o.default,{url:J}),(0,b.jsx)("p",{className:"text-xs text-gray-500",children:" Alternatively, you can open it in a new tab."})]}):(0,b.jsx)("div",{className:"rounded-lg overflow-hidden border",children:(0,b.jsx)("iframe",{src:J,className:"w-full h-[75vh]",allow:"clipboard-read; clipboard-write",referrerPolicy:"no-referrer",loading:"lazy",title:I.title??"Storybook"})}),(0,b.jsxs)("p",{className:"text-sm text-gray-600",children:["You can"," ",(0,b.jsx)("a",{href:J,target:"_blank",rel:"noopener noreferrer",className:"text-[#067BC2] underline",children:"open it in a new tab"}),"."]}),(I.explanation?.summary||I.explanation?.grammar_focus||I.explanation?.notes)&&(0,b.jsxs)("div",{className:"mt-6 rounded-lg border border-sky-200 bg-sky-50 p-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"flex h-8 w-8 shrink-0 items-center justify-center rounded-full bg-sky-200",children:(0,b.jsx)(l.Lightbulb,{className:"h-5 w-5 text-sky-700"})}),(0,b.jsx)("h4",{className:"text-lg font-bold text-sky-800",children:"Explanation"})]}),(0,b.jsxs)("div",{className:"mt-3 space-y-4 text-sm",children:[I.explanation.summary&&(0,b.jsx)("div",{children:(0,b.jsx)("p",{className:"mt-1 text-slate-700",children:I.explanation.summary})}),Array.isArray(I.explanation.grammar_focus)&&I.explanation.grammar_focus.length>0&&(0,b.jsxs)("div",{children:[(0,b.jsx)("h5",{className:"font-semibold text-slate-800",children:"Grammar Focus"}),(0,b.jsx)("ul",{className:"mt-2 space-y-2",children:I.explanation.grammar_focus.map((a,c)=>(0,b.jsxs)("li",{className:"flex items-start gap-2",children:[(0,b.jsx)(m.Check,{className:"h-4 w-4 mt-1 shrink-0 text-violet-500"}),(0,b.jsx)("span",{className:"text-slate-700",children:a})]},c))})]}),Array.isArray(I.explanation.notes)&&I.explanation.notes.length>0&&(0,b.jsxs)("div",{children:[(0,b.jsx)("h5",{className:"font-semibold text-slate-800",children:"Notes"}),(0,b.jsx)("ul",{className:"mt-2 space-y-2",children:I.explanation.notes.map((a,c)=>(0,b.jsxs)("li",{className:"flex items-start gap-2",children:[(0,b.jsx)(m.Check,{className:"h-4 w-4 mt-1 shrink-0 text-amber-500"}),(0,b.jsx)("span",{className:"text-slate-700",children:a})]},c))})]})]})]})]}),I?.type==="dialogue"&&(0,b.jsx)("div",{className:"space-y-4",children:(()=>{let a=I.data?.sprite?.src??void 0,c=a?G(a):J,d=(Array.isArray(I.data?.lines)?I.data.lines:[]).map(a=>({speaker:a.speaker,vi:a.vi,en:a.en,start:Number(a.start??0),end:Number(a.end??0),highlight_words:Array.isArray(a.highlight_words)?a.highlight_words:void 0,audioUrl:a.audio?G(a.audio):null})),e=Array.isArray(I.data?.highlight_words)?I.data.highlight_words:[];return(0,b.jsxs)(b.Fragment,{children:[I.data?.scene&&(0,b.jsx)("h3",{className:"text-lg font-semibold",children:I.data.scene}),(0,b.jsx)(n.default,{title:void 0,spriteUrl:c||void 0,lines:d,defaultHighlight:e}),I?.explanation&&(I.explanation.summary||I.explanation.grammar_focus||I.explanation.notes)&&(0,b.jsxs)("div",{className:"mt-6 rounded-lg border border-sky-200 bg-sky-50 p-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"flex h-8 w-8 shrink-0 items-center justify-center rounded-full bg-sky-200",children:(0,b.jsx)(l.Lightbulb,{className:"h-5 w-5 text-sky-700"})}),(0,b.jsx)("h4",{className:"text-lg font-bold text-sky-800",children:"Explanation"})]}),(0,b.jsxs)("div",{className:"mt-3 space-y-4 text-sm",children:[I.explanation?.summary&&(0,b.jsx)("div",{children:(0,b.jsx)("p",{className:"mt-1 text-slate-700",children:I.explanation.summary})}),Array.isArray(I.explanation?.grammar_focus)&&I.explanation.grammar_focus.length>0&&(0,b.jsxs)("div",{children:[(0,b.jsx)("h5",{className:"font-semibold text-slate-800",children:"Grammar Focus"}),(0,b.jsx)("ul",{className:"mt-2 space-y-2",children:I.explanation.grammar_focus.map((a,c)=>(0,b.jsxs)("li",{className:"flex items-start gap-2",children:[(0,b.jsx)(m.Check,{className:"h-4 w-4 mt-1 shrink-0 text-violet-500"}),(0,b.jsx)("span",{className:"text-slate-700",children:a})]},c))})]}),Array.isArray(I.explanation?.notes)&&I.explanation.notes.length>0&&(0,b.jsxs)("div",{children:[(0,b.jsx)("h5",{className:"font-semibold text-slate-800",children:"Notes"}),(0,b.jsx)("ul",{className:"mt-2 space-y-2",children:I.explanation.notes.map((a,c)=>(0,b.jsxs)("li",{className:"flex items-start gap-2",children:[(0,b.jsx)(m.Check,{className:"h-4 w-4 mt-1 shrink-0 text-amber-500"}),(0,b.jsx)("span",{className:"text-slate-700",children:a})]},c))})]})]})]})]})})()}),I?.type==="image"&&J&&(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("img",{src:J,alt:I.title??"Image",className:"w-full h-auto rounded border"}),(()=>{let a=function(a){if(!a)return null;if("string"==typeof a)return a;if("object"==typeof a){let b=[];return a.summary&&b.push(a.summary),a.grammar_focus&&b.push(`Grammar Focus: ${a.grammar_focus}`),b.join("\n\n")}return null}(I.explanation);return a&&(0,b.jsxs)("div",{className:"rounded-lg bg-blue-50 p-4",children:[(0,b.jsx)("h4",{className:"font-semibold mb-2",children:"Explanation"}),(0,b.jsx)("p",{className:"text-gray-700 whitespace-pre-line",children:a})]})})()]}),I?.type==="video"&&J&&(0,b.jsx)("div",{className:"space-y-4",children:(0,b.jsx)("video",{className:"w-full rounded-lg border",controls:!0,preload:"metadata",src:J})})]})]}),(0,b.jsxs)(e.Card,{children:[(0,b.jsx)(e.CardHeader,{children:(0,b.jsxs)(e.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(k,{className:"h-5 w-5 text-[#067BC2]"}),"Practice Exercise"]})}),(0,b.jsx)(e.CardContent,{children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("p",{className:"text-gray-600 mb-4",children:"Complete this exercise to test your knowledge and practice what you've learned."}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 text-sm",children:[(0,b.jsx)(h,{className:"h-4 w-4 text-gray-500"}),(0,b.jsxs)("span",{children:["Estimated time: ~",z.duration_minutes??15," minutes"]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3 text-sm",children:[(0,b.jsx)(i,{className:"h-4 w-4 text-amber-500"}),(0,b.jsxs)("span",{children:["Reward: ",z.coins_reward??50," coins"]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3 text-sm",children:[(0,b.jsx)(j.BookOpen,{className:"h-4 w-4 text-blue-500"}),(0,b.jsx)("span",{children:"Questions: 10–15 questions"})]})]}),B?(0,b.jsx)(t.StartExerciseButton,{topicSlug:y.slug,lessonSlug:z.slug,practiceSetId:B.id,isReview:A}):(0,b.jsx)(f.Button,{disabled:!0,className:"w-full mt-6",children:"No Exercise Available"})]})})]})]}),(0,b.jsxs)("aside",{className:"space-y-6",children:[(()=>{let a=L.filter(a=>"grammar"===a.type).flatMap(a=>a.data?.points??[]);return a.length>0?(0,b.jsx)(p.default,{grammarPoints:a}):null})(),O.length>0?(0,b.jsx)(r.default,{vocabulary:O,topicId:y.topic_id,lessonId:z.id}):null,(()=>{let a=function(a){let b=[...a];for(let a=b.length-1;a>0;a--){let c=Math.floor(Math.random()*(a+1));[b[a],b[c]]=[b[c],b[a]]}return b}(L.filter(a=>"examples"===a.type).flatMap(a=>(a.pairsResolved??a.data?.pairs??[]).map(a=>({vi:a.vi,en:a.en,audioUrl:a.audioUrl,audioPath:a.audio_path}))));return a.length>0?(0,b.jsx)(q.default,{examples:a}):null})()]})]})}}];

//# sourceMappingURL=app_%28app%29_learn_%5BtopicSlug%5D_%5BlessonSlug%5D_bafc7cc6._.js.map