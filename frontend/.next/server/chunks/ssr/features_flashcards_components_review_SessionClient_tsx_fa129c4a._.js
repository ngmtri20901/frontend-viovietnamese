module.exports=[187338,a=>{"use strict";a.s(["default",()=>B],187338);var b=a.i(187924),c=a.i(572131),d=a.i(50944),e=a.i(255895),f=a.i(771441),g=a.i(6912),h=a.i(214549),i=a.i(557116),j=a.i(172252),k=a.i(823292),l=a.i(164593),m=a.i(675751),n=a.i(419499),o=a.i(242641),p=a.i(883706);let q=(0,p.default)("trophy",[["path",{d:"M10 14.66v1.626a2 2 0 0 1-.976 1.696A5 5 0 0 0 7 21.978",key:"1n3hpd"}],["path",{d:"M14 14.66v1.626a2 2 0 0 0 .976 1.696A5 5 0 0 1 17 21.978",key:"rfe1zi"}],["path",{d:"M18 9h1.5a1 1 0 0 0 0-5H18",key:"7xy6bh"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M6 9a6 6 0 0 0 12 0V3a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1z",key:"1mhfuq"}],["path",{d:"M6 9H4.5a1 1 0 0 1 0-5H6",key:"tex48p"}]]);var r=a.i(50429),s=a.i(641710),t=a.i(872089),u=a.i(724669),v=a.i(669520);let w=(0,p.default)("chart-column",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);var x=a.i(943108),y=a.i(786520),z=a.i(238246);function A({isOpen:a,onClose:f,sessionData:g}){var j;let k=(0,d.useRouter)(),[l,p]=(0,c.useState)(null),[A,B]=(0,c.useState)(0),[C,D]=(0,c.useState)(!1),[E,F]=(0,c.useState)(0);(0,c.useEffect)(()=>{a&&(G(),H(),I())},[a]);let G=async()=>{try{let{data:{user:a}}=await e.supabase.auth.getUser();if(!a)return;let{data:b}=await e.supabase.from("user_profiles").select("subscription_type, streak_days").eq("id",a.id).single();b&&(p(b),F(b.streak_days))}catch(a){console.error("Error fetching user data:",a)}},H=async()=>{try{let{data:{user:a}}=await e.supabase.auth.getUser();if(!a)return;let b=new Date().toISOString().split("T")[0],{count:c}=await e.supabase.from("review_sessions").select("*",{count:"exact"}).eq("user_id",a.id).eq("status","completed").gte("started_at",`${b}T00:00:00.000Z`).lt("started_at",`${b}T23:59:59.999Z`);B(c||0)}catch(a){console.error("Error fetching today's sessions:",a)}},I=async()=>{try{let{data:{user:a}}=await e.supabase.auth.getUser();if(!a)return;let b=new Date().toISOString().split("T")[0],c=new Date;c.setDate(c.getDate()-1);let d=c.toISOString().split("T")[0],{count:f}=await e.supabase.from("review_sessions").select("*",{count:"exact"}).eq("user_id",a.id).eq("status","completed").gte("started_at",`${b}T00:00:00.000Z`).lt("started_at",`${b}T23:59:59.999Z`);if(1===f){let{data:c}=await e.supabase.from("user_profiles").select("streak_days, last_login").eq("id",a.id).single();if(c){let f=c.streak_days||0,g=c.last_login?new Date(c.last_login).toISOString().split("T")[0]:null;g===d?(f+=1,D(!0)):g!==b&&(f=1,D(null!==g)),await e.supabase.from("user_profiles").update({streak_days:f,last_login:new Date().toISOString()}).eq("id",a.id),F(f)}}}catch(a){console.error("Error checking streak update:",a)}};return(0,b.jsx)(m.Dialog,{open:a,onOpenChange:()=>{f(),k.push("/flashcards/review")},children:(0,b.jsxs)(m.DialogContent,{className:"sm:max-w-md",children:[(0,b.jsx)(m.DialogHeader,{children:(0,b.jsxs)(m.DialogTitle,{className:"text-center text-2xl font-bold flex items-center justify-center gap-2",children:[(0,b.jsx)(q,{className:"h-6 w-6 text-yellow-500"}),"Session Complete!"]})}),(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsx)(i.Card,{children:(0,b.jsxs)(i.CardContent,{className:"p-4 text-center",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:g.totalCards}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Cards Reviewed"})]})}),(0,b.jsx)(i.Card,{children:(0,b.jsxs)(i.CardContent,{className:"p-4 text-center",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-green-600",children:g.correctAnswers}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Correct Answers"})]})})]}),(0,b.jsx)(i.Card,{children:(0,b.jsxs)(i.CardContent,{className:"p-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(r.Target,{className:"h-5 w-5 text-muted-foreground"}),(0,b.jsx)("span",{className:"font-medium",children:"Accuracy Rate"})]}),(0,b.jsxs)(n.Badge,{variant:(j=g.accuracyRate)>=80?"default":j>=60?"secondary":"destructive",children:[g.accuracyRate.toFixed(0),"%"]})]}),(0,b.jsx)(o.Progress,{value:g.accuracyRate,className:"h-2"})]})}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsx)(i.Card,{children:(0,b.jsxs)(i.CardContent,{className:"p-4 text-center",children:[(0,b.jsxs)("div",{className:"flex items-center justify-center gap-2 mb-2",children:[(0,b.jsx)(s.Clock,{className:"h-4 w-4 text-muted-foreground"}),(0,b.jsx)("span",{className:"text-sm font-medium",children:"Time Spent"})]}),(0,b.jsx)("div",{className:"text-lg font-bold",children:(a=>{let b=Math.floor(a/60),c=a%60;return b>0?`${b}m ${c}s`:`${c}s`})(g.timeSpent)})]})}),(0,b.jsx)(i.Card,{children:(0,b.jsxs)(i.CardContent,{className:"p-4 text-center",children:[(0,b.jsxs)("div",{className:"flex items-center justify-center gap-2 mb-2",children:[(0,b.jsx)(t.Coins,{className:"h-4 w-4 text-yellow-500"}),(0,b.jsx)("span",{className:"text-sm font-medium",children:"Coins Earned"})]}),(0,b.jsx)("div",{className:"text-lg font-bold text-yellow-600",children:g.coinsEarned})]})})]}),C&&(0,b.jsx)(i.Card,{className:"bg-gradient-to-r from-orange-50 to-red-50 dark:from-orange-950/20 dark:to-red-950/20 border-orange-200 dark:border-orange-800",children:(0,b.jsxs)(i.CardContent,{className:"p-4 text-center",children:[(0,b.jsxs)("div",{className:"flex items-center justify-center gap-2 mb-2",children:[(0,b.jsx)(u.TrendingUp,{className:"h-5 w-5 text-orange-600"}),(0,b.jsx)("span",{className:"font-medium text-orange-800 dark:text-orange-200",children:"Streak Updated!"})]}),(0,b.jsxs)("p",{className:"text-orange-700 dark:text-orange-300",children:["Your learning streak is now ",E," days!"]})]})}),l?.subscription_type==="FREE"&&A>=3&&(0,b.jsx)(i.Card,{className:"bg-gradient-to-r from-amber-50 to-orange-50 dark:from-amber-950/20 dark:to-orange-950/20 border-amber-200 dark:border-amber-800",children:(0,b.jsxs)(i.CardContent,{className:"p-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,b.jsx)(x.Lock,{className:"h-4 w-4 text-amber-600"}),(0,b.jsx)("span",{className:"font-medium text-amber-800 dark:text-amber-200",children:"Daily Limit Reached"})]}),(0,b.jsxs)("p",{className:"text-sm text-amber-700 dark:text-amber-300 mb-3",children:["You've completed ",A,"/",3," free review sessions today. Upgrade to Plus for unlimited review!"]}),(0,b.jsx)(h.Button,{asChild:!0,size:"sm",className:"w-full",children:(0,b.jsxs)(z.default,{href:"/plans",children:[(0,b.jsx)(y.Crown,{className:"w-4 h-4 mr-2"}),"Upgrade to Plus"]})})]})}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)(h.Button,{onClick:()=>{f(),k.push("/flashcards/review")},className:"w-full",disabled:l?.subscription_type==="FREE"&&A>=3,children:[(0,b.jsx)(v.RefreshCw,{className:"w-4 h-4 mr-2"}),"Start New Review Session"]}),(0,b.jsxs)(h.Button,{onClick:()=>{f(),k.push("/flashcards/statistics")},variant:"outline",className:"w-full",children:[(0,b.jsx)(w,{className:"w-4 h-4 mr-2"}),"View Detailed Statistics"]})]}),(0,b.jsx)("div",{className:"text-center p-4 bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-950/20 dark:to-indigo-950/20 rounded-lg",children:(0,b.jsx)("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:g.accuracyRate>=80?"ðŸŽ‰ Excellent work! You're mastering Vietnamese vocabulary!":g.accuracyRate>=60?"ðŸ‘ Good progress! Keep practicing to improve further!":"ðŸ’ª Every review makes you stronger! Keep going!"})})]})]})})}function B(){let m=(0,d.useRouter)(),n=(0,d.useSearchParams)(),o=n?.get("id")||"",[p,q]=(0,c.useState)(!0),[r,s]=(0,c.useState)([]),[t,u]=(0,c.useState)(null),[v,w]=(0,c.useState)(null),[x,y]=(0,c.useState)(!1),[z,B]=(0,c.useState)(!1),[C,D]=(0,c.useState)(!1),[E,F]=(0,c.useState)({totalCards:0,correctAnswers:0,accuracyRate:0,coinsEarned:0,timeSpent:0});(0,c.useEffect)(()=>{l.authSessionManager.setReviewSession(!0);try{document.cookie="sidebar:state=false; path=/; max-age=3600";let a=a=>{("b"===a.key||"B"===a.key)&&(a.ctrlKey||a.metaKey)&&(a.preventDefault(),a.stopPropagation())};return window.addEventListener("keydown",a,{capture:!0}),()=>{window.removeEventListener("keydown",a,{capture:!0}),l.authSessionManager.setReviewSession(!1)}}catch{return()=>l.authSessionManager.setReviewSession(!1)}},[]),(0,c.useEffect)(()=>{(async()=>{try{if(!o){k.toast.error("Missing session id"),m.push("/flashcards/review");return}let{data:{user:b},error:c}=await e.supabase.auth.getUser();if(c||!b){k.toast.error("Please log in to continue"),m.push("/auth/login");return}w(b.id);let{data:d,error:f}=await e.supabase.from("review_sessions").select("*").eq("id",o).maybeSingle();if(f||!d){k.toast.error("Session not found"),m.push("/flashcards/review");return}u(d);let{data:g,error:h}=await e.supabase.from("review_session_cards").select("flashcard_id, card_order").eq("session_id",o).order("card_order",{ascending:!0});if(h)throw h;let i=(g||[]).map(a=>a.flashcard_id);if(!i.length){k.toast.error("No cards in this session"),m.push("/flashcards/review");return}let{flashcardAPI:j}=await a.A(156232),l=await j.getFlashcardsByIds(i);s(l)}catch(a){console.error(a),k.toast.error("Failed to load review session")}finally{q(!1)}})()},[m,o]);let{currentCard:G,currentCardIndex:H,isFlipped:I,timer:J,isTimerActive:K,cardResults:L,savedCards:M,handleCardResult:N,handleSaveCard:O,handleFlipCard:P,resetSession:Q,getProgressStats:R}=(0,g.useFlashcardReview)({cards:r,enableTimer:!0});(0,c.useEffect)(()=>{r.length>0&&L.length===r.length&&(async()=>{try{let a=R();if(await e.supabase.from("review_sessions").update({status:"completed",completed_cards:a.total,correct_answers:a.correct,total_time_seconds:null,completed_at:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",o),v){let b=new Date().toISOString().slice(0,10),{data:c}=await e.supabase.from("review_session_cards").select("time_spent_seconds").eq("session_id",o),d=(c||[]).reduce((a,b)=>a+(b?.time_spent_seconds||0),0),f=Math.max(0,Math.round(d/60)),{data:g}=await e.supabase.from("flashcard_statistics").select("*").eq("user_id",v).eq("date",b).maybeSingle(),h=a.total,i=a.correct,j=a.total;if(g){let a=(g.flashcards_reviewed||0)+h,b=(g.correct_answers||0)+i,c=(g.total_questions||0)+j,d=(g.time_spent_minutes||0)+f;await e.supabase.from("flashcard_statistics").update({flashcards_reviewed:a,correct_answers:b,total_questions:c,accuracy_rate:c>0?b/c*100:0,time_spent_minutes:d,updated_at:new Date().toISOString()}).eq("id",g.id)}else await e.supabase.from("flashcard_statistics").insert({user_id:v,date:b,flashcards_reviewed:h,correct_answers:i,total_questions:j,accuracy_rate:j>0?i/j*100:0,time_spent_minutes:f});F({totalCards:a.total,correctAnswers:a.correct,accuracyRate:a.accuracy,coinsEarned:0,timeSpent:Math.max(0,(c||[]).reduce((a,b)=>a+(b?.time_spent_seconds||0),0))}),B(!0),D(!0)}k.toast.success("Session completed!")}catch(a){console.error(a)}})()},[L.length,r.length,R,o,v]);let S=(0,c.useCallback)(async(a,b,c)=>{if(!v||!o)return;await e.supabase.from("review_session_cards").update({result:b,time_spent_seconds:Math.max(1,Math.round(c/1e3)),reviewed_at:new Date().toISOString()}).eq("session_id",o).eq("flashcard_id",a);let{data:d}=await e.supabase.from("flashcard_srs_records").select("*").eq("user_id",v).eq("flashcard_id",a).limit(1),f=new Date;if(d&&d.length>0){let a=d[0],c="correct"===b,g=Math.max(1.3,Number(a.ease_factor||2.5)+(c?.1:-.2)),h=c?Number(a.repetition_number||0)+1:0,i=1;i=h<=1?1:2===h?6:Math.round((a.interval_days||6)*g);let j=new Date(f);j.setDate(j.getDate()+i),await e.supabase.from("flashcard_srs_records").update({ease_factor:g,repetition_number:h,interval_days:i,due_date:j.toISOString().slice(0,10),total_reviews:(a.total_reviews||0)+1,correct_reviews:(a.correct_reviews||0)+ +!!c,last_reviewed:f.toISOString(),updated_at:f.toISOString()}).eq("id",a.id)}else{let c="correct"===b,d=new Date(f);d.setDate(d.getDate()+1),await e.supabase.from("flashcard_srs_records").insert({user_id:v,flashcard_id:a,ease_factor:c?2.6:2.3,repetition_number:+!!c,interval_days:1,due_date:d.toISOString().slice(0,10),total_reviews:1,correct_reviews:+!!c,last_reviewed:f.toISOString(),updated_at:f.toISOString()})}},[o,v]),T=(0,c.useCallback)(a=>{if(x||z)return;let b=r[H];H===r.length-1&&y(!0),N(a),b?.id&&setTimeout(()=>{let c=L[L.length-1],d=c&&c.cardId===b.id?c.timeSpent:0;S(b.id,a,d).catch(()=>{})},50)},[H,r,N,S,L,x,z]),U=(0,c.useCallback)(async()=>{try{let a=R();await e.supabase.from("review_sessions").update({status:"abandoned",completed_cards:a.total,correct_answers:a.correct,updated_at:new Date().toISOString()}).eq("id",o),k.toast.success("Session exited"),m.push("/flashcards/review")}catch(a){console.error(a),m.push("/flashcards/review")}},[R,m,o]);if(p)return null;if(!r.length)return(0,b.jsxs)(i.Card,{children:[(0,b.jsx)(i.CardHeader,{children:(0,b.jsx)(i.CardTitle,{children:"No cards loaded"})}),(0,b.jsx)(i.CardContent,{children:(0,b.jsx)(h.Button,{onClick:()=>m.push("/flashcards/review"),children:"Back"})})]});let V=R();return(0,b.jsxs)("div",{className:"container mx-auto py-6 px-4 max-w-4xl",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,b.jsx)("h1",{className:"text-2xl font-bold",children:"Focused Review Session"}),(0,b.jsx)("div",{className:"flex gap-2",children:(0,b.jsx)(h.Button,{variant:"outline",onClick:U,children:"Quit"})})]}),(0,b.jsx)(f.ReviewSession,{practiceCards:r,currentCard:G,currentCardIndex:H,isFlipped:I,timer:J,isTimerActive:K,cardResults:L,progressStats:V,savedCards:M,onCardResult:T,onSaveCard:z||x?()=>{}:O,onFlipCard:z||x?()=>{}:P,onRefreshCards:()=>m.refresh(),onGetFreshCards:()=>m.refresh(),getAnimationDuration:()=>300,isLoading:x||z}),(0,b.jsx)(j.Separator,{className:"my-6"}),(0,b.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Session ID: ",o]}),(0,b.jsx)(A,{isOpen:C,onClose:()=>{D(!1),m.push("/flashcards/review")},sessionData:E})]})}}];

//# sourceMappingURL=features_flashcards_components_review_SessionClient_tsx_fa129c4a._.js.map