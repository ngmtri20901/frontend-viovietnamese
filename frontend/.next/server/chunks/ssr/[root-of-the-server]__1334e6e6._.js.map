{"version":3,"sources":["turbopack:///[project]/features/flashcards/utils/vocab-key.ts","turbopack:///[project]/.next-internal/server/app/(app)/flashcards/saved/page/actions.js (server actions loader)","turbopack:///[project]/features/flashcards/actions/delete.ts","turbopack:///[project]/features/flashcards/actions/unsave.ts","turbopack:///[project]/features/flashcards/components/saved/SavedFlashcardsContainer.tsx/__nextjs-internal-proxy.mjs","turbopack:///[project]/app/(app)/flashcards/saved/page.tsx","turbopack:///[project]/features/flashcards/data/saved-flashcards-loader.ts","turbopack:///[project]/shared/lib/supabase/client.ts","turbopack:///[project]/features/flashcards/services/flashcardSyncService.ts"],"sourcesContent":["/**\r\n * Utility functions for generating and parsing deterministic vocabulary keys\r\n * Format: t{topicId}-l{lessonId}-{slugified_vietnamese}\r\n */\r\n\r\n/**\r\n * Generates a deterministic vocabulary key from topic, lesson, and Vietnamese text\r\n * @param topicId - Topic ID (bigint)\r\n * @param lessonId - Lesson ID (bigint)\r\n * @param vietnameseText - Vietnamese text to slugify\r\n * @returns Deterministic key in format: t{topicId}-l{lessonId}-{slugified}\r\n */\r\nexport function generateVocabKey(\r\n  topicId: number,\r\n  lessonId: number,\r\n  vietnameseText: string\r\n): string {\r\n  const slugified = vietnameseText\r\n    .toLowerCase()\r\n    .trim()\r\n    .replace(/\\s+/g, '_')\r\n    .replace(/[^\\w\\-_]/g, '')\r\n    .replace(/_+/g, '_') // Replace multiple underscores with single\r\n    .replace(/^_|_$/g, ''); // Remove leading/trailing underscores\r\n\r\n  return `t${topicId}-l${lessonId}-${slugified}`;\r\n}\r\n\r\n/**\r\n * Parses a vocabulary key to extract topic ID, lesson ID, and slug\r\n * @param key - Vocabulary key in format: t{topicId}-l{lessonId}-{slug}\r\n * @returns Parsed components or null if invalid format\r\n */\r\nexport function parseVocabKey(\r\n  key: string\r\n): { topicId: number; lessonId: number; slug: string } | null {\r\n  const match = key.match(/^t(\\d+)-l(\\d+)-(.+)$/);\r\n  if (!match) return null;\r\n\r\n  return {\r\n    topicId: parseInt(match[1], 10),\r\n    lessonId: parseInt(match[2], 10),\r\n    slug: match[3],\r\n  };\r\n}\r\n\r\n/**\r\n * Checks if a string is a valid vocabulary key format\r\n * @param key - String to validate\r\n * @returns True if key matches vocabulary key format\r\n */\r\nexport function isValidVocabKey(key: string): boolean {\r\n  return /^t\\d+-l\\d+-[\\w\\-_]+$/.test(key);\r\n}\r\n\r\n","export {saveVocabularyFromLesson as '40b7874b5beee18e2e913212052e9efd3061f9459a'} from 'ACTIONS_MODULE0'\nexport {unsaveVocabularyFromLesson as '40a12d3392f5f7e3fd35f464eebcfef7da83f3293b'} from 'ACTIONS_MODULE1'\nexport {deleteCustomFlashcard as '406d84cb44c4981a664e2476a59d980e60874605ab'} from 'ACTIONS_MODULE2'\nexport {unsaveAppFlashcard as '40986aecbd86e0e666ca6f9c7e3044898795a258da'} from 'ACTIONS_MODULE3'\n","'use server'\n\nimport { createClient, isSupabaseConfigured } from '@/shared/lib/supabase/server'\nimport { revalidatePath } from 'next/cache'\n\n/**\n * Server action to delete a custom flashcard\n * Deletes from both custom_flashcards and saved_flashcards tables\n */\nexport async function deleteCustomFlashcard(\n  customFlashcardId: string\n): Promise<{ success: boolean; error?: string }> {\n  try {\n    console.log('üóëÔ∏è [Server Action] deleteCustomFlashcard called:', customFlashcardId)\n\n    // Early return if Supabase is not configured\n    if (!isSupabaseConfigured) {\n      return {\n        success: false,\n        error: 'Supabase is not configured'\n      }\n    }\n\n    // Get server-side Supabase client with fresh session\n    const supabase = await createClient()\n\n    // Verify user is authenticated\n    const { data: { user }, error: userError } = await supabase.auth.getUser()\n\n    console.log('üë§ [Server Action] User authentication:', {\n      authenticated: !!user,\n      userId: user?.id\n    })\n\n    if (userError || !user) {\n      return {\n        success: false,\n        error: 'Not authenticated - please log in first'\n      }\n    }\n\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const supabaseAny = supabase as any\n\n    // Step 1: Delete from saved_flashcards table first\n    // Column name is UserID (capital U, capital ID) in saved_flashcards\n    console.log('üóëÔ∏è [Server Action] Deleting from saved_flashcards...')\n    const { error: savedDeleteError } = await supabaseAny\n      .from('saved_flashcards')\n      .delete()\n      .eq('flashcard_id', `custom_${customFlashcardId}`)\n      .eq('UserID', user.id)\n      .eq('flashcard_type', 'CUSTOM')\n\n    if (savedDeleteError) {\n      console.error('‚ùå [Server Action] Error deleting from saved_flashcards:', savedDeleteError)\n      // Continue anyway - the record might not exist in saved_flashcards\n    } else {\n      console.log('‚úÖ [Server Action] Deleted from saved_flashcards')\n    }\n\n    // Step 2: Delete from custom_flashcards table\n    // Column name is user_id (lowercase) in custom_flashcards\n    console.log('üóëÔ∏è [Server Action] Deleting from custom_flashcards...')\n    const { error: customDeleteError } = await supabaseAny\n      .from('custom_flashcards')\n      .delete()\n      .eq('id', customFlashcardId)\n      .eq('user_id', user.id)\n\n    if (customDeleteError) {\n      console.error('‚ùå [Server Action] Error deleting from custom_flashcards:', customDeleteError)\n      return {\n        success: false,\n        error: customDeleteError.message || 'Failed to delete flashcard'\n      }\n    }\n\n    console.log('‚úÖ [Server Action] Successfully deleted custom flashcard')\n\n    // Revalidate the saved flashcards page\n    revalidatePath('/flashcards/saved')\n\n    return {\n      success: true\n    }\n  } catch (error) {\n    console.error('‚ùå [Server Action] Error deleting flashcard:', error)\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Failed to delete flashcard'\n    }\n  }\n}\n","'use server'\n\nimport { createClient, isSupabaseConfigured } from '@/shared/lib/supabase/server'\nimport { revalidatePath } from 'next/cache'\n\n/**\n * Server action to unsave an APP flashcard\n * Only deletes from saved_flashcards table\n */\nexport async function unsaveAppFlashcard(\n  savedFlashcardId: string\n): Promise<{ success: boolean; error?: string }> {\n  try {\n    console.log('üóëÔ∏è [Server Action] unsaveAppFlashcard called:', savedFlashcardId)\n\n    // Early return if Supabase is not configured\n    if (!isSupabaseConfigured) {\n      return {\n        success: false,\n        error: 'Supabase is not configured'\n      }\n    }\n\n    // Get server-side Supabase client with fresh session\n    const supabase = await createClient()\n\n    // Verify user is authenticated\n    const { data: { user }, error: userError } = await supabase.auth.getUser()\n\n    console.log('üë§ [Server Action] User authentication:', {\n      authenticated: !!user,\n      userId: user?.id\n    })\n\n    if (userError || !user) {\n      return {\n        success: false,\n        error: 'Not authenticated - please log in first'\n      }\n    }\n\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const supabaseAny = supabase as any\n\n    // Delete from saved_flashcards table\n    // Column name is UserID (capital U, capital ID)\n    console.log('üóëÔ∏è [Server Action] Deleting from saved_flashcards...')\n    const { error: deleteError } = await supabaseAny\n      .from('saved_flashcards')\n      .delete()\n      .eq('id', savedFlashcardId)\n      .eq('UserID', user.id)\n\n    if (deleteError) {\n      console.error('‚ùå [Server Action] Error unsaving flashcard:', deleteError)\n      return {\n        success: false,\n        error: deleteError.message || 'Failed to unsave flashcard'\n      }\n    }\n\n    console.log('‚úÖ [Server Action] Successfully unsaved APP flashcard')\n\n    // Revalidate the saved flashcards page\n    revalidatePath('/flashcards/saved')\n\n    return {\n      success: true\n    }\n  } catch (error) {\n    console.error('‚ùå [Server Action] Error unsaving flashcard:', error)\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Failed to unsave flashcard'\n    }\n  }\n}\n","// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/features/flashcards/components/saved/SavedFlashcardsContainer.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/features/flashcards/components/saved/SavedFlashcardsContainer.tsx\",\n    \"default\",\n);\n","import { Suspense } from 'react'\r\nimport { redirect } from 'next/navigation'\r\nimport { loadSavedFlashcardsData } from '@/features/flashcards/data/saved-flashcards-loader'\r\nimport SavedFlashcardsContainer from '@/features/flashcards/components/saved/SavedFlashcardsContainer'\r\nexport const dynamic = 'force-dynamic'\r\nexport default async function SavedFlashcardsPage() {\r\n  // Fetch data on the server\r\n  const data = await loadSavedFlashcardsData()\r\n\r\n  // Redirect to login if not authenticated\r\n  if (!data) {\r\n    redirect('/auth/login')\r\n  }\r\n\r\n  return (\r\n    <Suspense fallback={\r\n      <div className=\"container mx-auto p-6 space-y-6\">\r\n        {/* Breadcrumb Navigation Skeleton */}\r\n        <div className=\"flex items-center space-x-2 text-sm mb-4\">\r\n          <div className=\"h-4 bg-gray-200 dark:bg-gray-700 rounded w-16 animate-pulse\"></div>\r\n          <div className=\"h-4 bg-gray-200 dark:bg-gray-700 rounded w-4 animate-pulse\"></div>\r\n          <div className=\"h-4 bg-gray-200 dark:bg-gray-700 rounded w-20 animate-pulse\"></div>\r\n        </div>\r\n\r\n        {/* Header Skeleton */}\r\n        <div className=\"flex items-center justify-between\">\r\n          <div className=\"flex items-center gap-4\">\r\n            <div className=\"h-8 w-8 bg-gray-200 dark:bg-gray-700 rounded animate-pulse\"></div>\r\n            <div>\r\n              <div className=\"h-8 bg-gray-200 dark:bg-gray-700 rounded w-48 mb-2 animate-pulse\"></div>\r\n              <div className=\"h-4 bg-gray-200 dark:bg-gray-700 rounded w-64 animate-pulse\"></div>\r\n            </div>\r\n          </div>\r\n          <div className=\"flex items-center gap-3\">\r\n            <div className=\"h-10 bg-gray-200 dark:bg-gray-700 rounded w-24 animate-pulse\"></div>\r\n            <div className=\"h-10 bg-blue-200 dark:bg-blue-800 rounded w-32 animate-pulse\"></div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Dashboard Summary Skeleton */}\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n          <div className=\"h-24 bg-gray-200 dark:bg-gray-700 rounded animate-pulse\"></div>\r\n          <div className=\"h-24 bg-gray-200 dark:bg-gray-700 rounded animate-pulse\"></div>\r\n        </div>\r\n\r\n        {/* Filters Skeleton */}\r\n        <div className=\"h-20 bg-gray-200 dark:bg-gray-700 rounded animate-pulse\"></div>\r\n\r\n        {/* Tabs Skeleton */}\r\n        <div className=\"h-12 bg-gray-200 dark:bg-gray-700 rounded mb-6 animate-pulse\"></div>\r\n\r\n        {/* Flashcards Grid Skeleton */}\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4\">\r\n          {Array.from({ length: 8 }).map((_, i) => (\r\n            <div key={i} className=\"h-48 bg-gray-200 dark:bg-gray-700 rounded animate-pulse\"></div>\r\n          ))}\r\n        </div>\r\n      </div>\r\n    }>\r\n      <SavedFlashcardsContainer initialData={data} />\r\n    </Suspense>\r\n  )\r\n} ","/**\n * Server-side data loader for Saved Flashcards page\n * Fetches all initial data needed for the page on the server\n */\n\nimport { createClient } from '@/shared/lib/supabase/server'\nimport { checkSyncStatus } from '@/features/flashcards/services/flashcardSyncService'\nimport { isValidVocabKey } from '@/features/flashcards/utils/vocab-key'\n\ninterface SavedFlashcard {\n  id: string\n  UserID: string\n  flashcard_id: string\n  flashcard_type: 'APP' | 'CUSTOM'\n  topic?: string | null\n  saved_at: string\n  is_favorite: boolean\n  review_count: number\n  last_reviewed?: string | null\n  tags: string[]\n  notes?: string | null\n}\n\ninterface AppFlashcardDetail {\n  id: string\n  vietnamese?: string\n  english?: string[]\n  image_url?: string\n  type?: string\n  word_type?: string\n  audio_url?: string\n  pronunciation?: string\n}\n\ninterface CustomFlashcardDetail {\n  id: string\n  vocab_key?: string | null\n  vietnamese_text: string\n  english_text: string\n  image_url?: string | null\n  topic?: string | null\n  ipa_pronunciation?: string | null\n  audio_url?: string | null\n  source_type?: string | null\n}\n\nexport interface SavedFlashcardDetails {\n  id: string\n  flashcard_id: string\n  flashcard_type: 'APP' | 'CUSTOM'\n  topic?: string | null\n  saved_at: string\n  is_favorite: boolean\n  review_count: number\n  last_reviewed?: string | null\n  tags: string[]\n  notes?: string | null\n  // App flashcard data\n  vietnamese?: string\n  english?: string[]\n  image_url?: string\n  word_type?: string\n  audio_url?: string | null\n  pronunciation?: string\n  // Custom flashcard data\n  vietnamese_text?: string\n  english_text?: string\n  ipa_pronunciation?: string | null\n  source_type?: string | null\n}\n\ninterface FlashcardTopic {\n  id: string\n  name: string\n  description?: string | null\n  icon?: string | null\n  sort_order?: number | null\n}\n\ninterface UserStats {\n  appFlashcards: number\n  customFlashcards: number\n  subscription_type: 'FREE' | 'PLUS' | 'UNLIMITED'\n}\n\ninterface SyncStatus {\n  needsSync: boolean\n  unsyncedCount: number\n}\n\nexport interface SavedFlashcardsData {\n  savedFlashcards: SavedFlashcardDetails[]\n  userStats: UserStats\n  topics: FlashcardTopic[]\n  syncStatus: SyncStatus | null\n  userId: string\n}\n\n/**\n * Fetch APP flashcard details from FastAPI\n */\nasync function getAppFlashcardDetails(flashcardIds: string[]): Promise<AppFlashcardDetail[]> {\n  if (flashcardIds.length === 0) return []\n\n  try {\n    console.log('üåê [Server] Fetching APP flashcard details from FastAPI for', flashcardIds.length, 'flashcards')\n\n    const API_BASE_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8000'\n    const response = await fetch(`${API_BASE_URL}/api/v1/flashcards/by-ids`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify(flashcardIds), // Send array directly, not { ids: ... }\n      // Add timeout for server\n      signal: AbortSignal.timeout(8000),\n    })\n\n    if (!response.ok) {\n      throw new Error(`FastAPI request failed: ${response.statusText}`)\n    }\n\n    const data = await response.json()\n    console.log('‚úÖ [Server] Successfully fetched APP flashcard details:', Array.isArray(data) ? data.length : 'not array')\n\n    // Ensure we return an array\n    if (!Array.isArray(data)) {\n      console.warn('‚ö†Ô∏è [Server] API response is not an array, wrapping:', data)\n      return [data].filter(Boolean)\n    }\n\n    return data\n  } catch (error) {\n    console.error('‚ùå [Server] Error fetching APP flashcard details:', error)\n    return [] // Return empty array to continue with placeholder data\n  }\n}\n\n/**\n * Fetch custom flashcard details from Supabase by UUID\n */\nasync function getCustomFlashcardDetails(\n  supabase: Awaited<ReturnType<typeof createClient>>,\n  userId: string,\n  flashcardIds: string[]\n): Promise<CustomFlashcardDetail[]> {\n  if (flashcardIds.length === 0) return []\n\n  try {\n    // Build query step by step to avoid TypeScript issues\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const supabaseAny = supabase as any\n    const { data, error } = await supabaseAny\n      .from('custom_flashcards')\n      .select('id, vocab_key, vietnamese_text, english_text, image_url, topic, ipa_pronunciation, audio_url, source_type')\n      .eq('user_id', userId)\n      .eq('status', 'ACTIVE')\n      .in('id', flashcardIds)\n\n    if (error) throw error\n    return data || []\n  } catch (error) {\n    console.error('‚ùå [Server] Error fetching custom flashcard details by ID:', error)\n    return []\n  }\n}\n\n/**\n * Fetch custom flashcard details from Supabase by vocab_key\n */\nasync function getCustomFlashcardDetailsByVocabKey(\n  supabase: Awaited<ReturnType<typeof createClient>>,\n  userId: string,\n  vocabKeys: string[]\n): Promise<CustomFlashcardDetail[]> {\n  if (vocabKeys.length === 0) return []\n\n  try {\n    // Build query step by step to avoid TypeScript issues\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const supabaseAny = supabase as any\n    const { data, error } = await supabaseAny\n      .from('custom_flashcards')\n      .select('id, vocab_key, vietnamese_text, english_text, image_url, topic, ipa_pronunciation, audio_url, source_type')\n      .eq('user_id', userId)\n      .eq('status', 'ACTIVE')\n      .in('vocab_key', vocabKeys)\n\n    if (error) throw error\n    return data || []\n  } catch (error) {\n    console.error('‚ùå [Server] Error fetching custom flashcard details by vocab_key:', error)\n    return []\n  }\n}\n\n/**\n * Fetch user statistics\n */\nasync function getUserStats(\n  supabase: Awaited<ReturnType<typeof createClient>>,\n  userId: string\n): Promise<UserStats> {\n  try {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const supabaseAny = supabase as any\n    \n    // Fetch flashcard counts\n    const { data, error } = await supabaseAny\n      .from('saved_flashcards')\n      .select('flashcard_type')\n      .eq('UserID', userId)\n\n    if (error) throw error\n\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const appFlashcards = (data || []).filter((card: any) => card.flashcard_type === 'APP').length\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const customFlashcards = (data || []).filter((card: any) => card.flashcard_type === 'CUSTOM').length\n\n    // Fetch subscription type from user_profiles\n    const { data: profileData, error: profileError } = await supabaseAny\n      .from('user_profiles')\n      .select('subscription_type')\n      .eq('id', userId)\n      .single()\n\n    if (profileError) {\n      console.warn('‚ö†Ô∏è [Server] Could not fetch subscription type:', profileError)\n    }\n\n    const subscription_type = profileData?.subscription_type || 'FREE'\n\n    return {\n      appFlashcards,\n      customFlashcards,\n      subscription_type: subscription_type as 'FREE' | 'PLUS' | 'UNLIMITED',\n    }\n  } catch (error) {\n    console.error('‚ùå [Server] Error fetching user stats:', error)\n    return {\n      appFlashcards: 0,\n      customFlashcards: 0,\n      subscription_type: 'FREE',\n    }\n  }\n}\n\n/**\n * Fetch topics from custom flashcards\n */\nasync function getTopics(\n  supabase: Awaited<ReturnType<typeof createClient>>,\n  userId: string\n): Promise<FlashcardTopic[]> {\n  try {\n    console.log('üîç [Server] Fetching topics for user:', userId)\n\n    // Get unique topics from custom_flashcards for this user\n    // Note: custom_flashcards uses 'user_id' (lowercase), not 'UserID'\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const supabaseAny = supabase as any\n    const { data, error } = await supabaseAny\n      .from('custom_flashcards')\n      .select('topic')\n      .eq('user_id', userId)\n      .eq('status', 'ACTIVE')\n      .not('topic', 'is', null)\n\n    if (error) {\n      console.error('‚ùå [Server] Supabase error fetching topics:', error)\n      throw error\n    }\n\n    console.log('üìä [Server] Topics data from Supabase:', data)\n\n    if (!data || data.length === 0) {\n      console.log('‚ÑπÔ∏è [Server] No topics found for user')\n      return []\n    }\n\n    // Extract unique topics and format them\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const uniqueTopics = [...new Set(data.map((item: any) => item.topic).filter(Boolean))] as string[]\n    console.log('‚úÖ [Server] Unique topics extracted:', uniqueTopics)\n\n    return uniqueTopics.map((topic: string, index: number) => ({\n      id: topic,\n      name: topic,\n      description: null,\n      icon: null,\n      sort_order: index,\n    }))\n  } catch (error) {\n    console.error('‚ùå [Server] Error fetching topics:', error)\n    return []\n  }\n}\n\n/**\n * Fetch saved flashcards with all details\n */\nasync function getSavedFlashcardsWithDetails(\n  supabase: Awaited<ReturnType<typeof createClient>>,\n  userId: string\n): Promise<SavedFlashcardDetails[]> {\n  try {\n    // Step 1: Get all saved flashcards from Supabase\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const supabaseAny = supabase as any\n    const { data: savedCards, error } = await supabaseAny\n      .from('saved_flashcards')\n      .select('*')\n      .eq('UserID', userId)\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      .order('saved_at', { ascending: false } as any)\n      .limit(100) // Initial load limit\n\n    if (error) throw error\n    if (!savedCards || savedCards.length === 0) return []\n\n    console.log('üìä [Server] Fetched saved flashcards:', savedCards.length)\n\n    // Step 2: Separate APP and CUSTOM flashcard IDs\n    const appFlashcardIds = savedCards\n      .filter((card: SavedFlashcard) => card.flashcard_type === 'APP')\n      .map((card: SavedFlashcard) => card.flashcard_id)\n\n    // Handle CUSTOM flashcards: support both vocab_key format and old custom_{uuid} format\n    const customFlashcardIds: string[] = []\n    const customVocabKeys: string[] = []\n    \n    savedCards\n      .filter((card: SavedFlashcard) => card.flashcard_type === 'CUSTOM')\n      .forEach((card: SavedFlashcard) => {\n        const flashcardId = card.flashcard_id\n        \n        // Check if it's a vocab_key format (t{id}-l{id}-{slug})\n        if (isValidVocabKey(flashcardId)) {\n          customVocabKeys.push(flashcardId)\n        } else {\n          // Old format: custom_{uuid} - extract UUID\n          const uuid = flashcardId.replace('custom_', '')\n          if (uuid) {\n            customFlashcardIds.push(uuid)\n          }\n        }\n      })\n\n    console.log('üîç [Server] APP flashcard IDs:', appFlashcardIds.length)\n    console.log('üîç [Server] CUSTOM flashcard IDs (UUID):', customFlashcardIds.length)\n    console.log('üîç [Server] CUSTOM flashcard IDs (vocab_key):', customVocabKeys.length)\n\n    // Step 3: Fetch details in parallel\n    // For vocab_key format, query by vocab_key; for UUID format, query by id\n    const [appFlashcardDetails, customFlashcardDetailsById, customFlashcardDetailsByVocabKey] = await Promise.all([\n      getAppFlashcardDetails(appFlashcardIds),\n      customFlashcardIds.length > 0 ? getCustomFlashcardDetails(supabase, userId, customFlashcardIds) : Promise.resolve([]),\n      customVocabKeys.length > 0 ? getCustomFlashcardDetailsByVocabKey(supabase, userId, customVocabKeys) : Promise.resolve([]),\n    ])\n    \n    // Combine both custom flashcard details\n    const customFlashcardDetails = [...customFlashcardDetailsById, ...customFlashcardDetailsByVocabKey]\n\n    // Step 4: Merge saved flashcards with their details\n    const savedFlashcardsWithDetails: SavedFlashcardDetails[] = savedCards.map((savedCard: SavedFlashcard) => {\n      if (savedCard.flashcard_type === 'APP') {\n        const detail = appFlashcardDetails.find(d => d.id === savedCard.flashcard_id)\n\n        return {\n          ...savedCard,\n          vietnamese: detail?.vietnamese || `App Card ${savedCard.flashcard_id?.slice(-4) || 'N/A'}`,\n          english: Array.isArray(detail?.english)\n            ? detail.english\n            : (detail?.english ? [detail.english] : ['No translation available']),\n          image_url: detail?.image_url || '/placeholder.svg',\n          word_type: detail?.type || detail?.word_type || 'word',\n          audio_url: detail?.audio_url || undefined,\n          pronunciation: detail?.pronunciation || undefined,\n        }\n      } else {\n        // CUSTOM flashcard - handle both vocab_key and UUID formats\n        const flashcardId = savedCard.flashcard_id\n        let customDetail: CustomFlashcardDetail | undefined\n        \n        if (isValidVocabKey(flashcardId)) {\n          // Lookup by vocab_key\n          customDetail = customFlashcardDetails.find(d => d.vocab_key === flashcardId)\n        } else {\n          // Old format: lookup by UUID (remove 'custom_' prefix)\n          const cleanCustomId = flashcardId.replace('custom_', '')\n          customDetail = customFlashcardDetails.find(d => d.id === cleanCustomId)\n        }\n\n        // Handle image URLs for custom flashcards\n        let imageUrl = '/placeholder.svg'\n        if (customDetail?.image_url) {\n          if (customDetail.image_url.startsWith('http')) {\n            imageUrl = customDetail.image_url\n          } else {\n            const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL\n            const bucketName = 'images'\n            const cleanPath = customDetail.image_url.startsWith('/')\n              ? customDetail.image_url.slice(1)\n              : customDetail.image_url\n\n            imageUrl = `${supabaseUrl}/storage/v1/object/public/${bucketName}/${cleanPath}`\n          }\n        }\n\n        // Generate fallback ID for display\n        const fallbackId = customDetail?.id || flashcardId.slice(-4)\n\n        return {\n          ...savedCard,\n          vietnamese_text: customDetail?.vietnamese_text || `Custom Card ${fallbackId}`,\n          english_text: customDetail?.english_text || 'No translation available',\n          image_url: imageUrl,\n          topic: customDetail?.topic || savedCard.topic,\n          ipa_pronunciation: customDetail?.ipa_pronunciation || null,\n          source_type: customDetail?.source_type || 'user',\n          audio_url: customDetail?.audio_url || null,\n        }\n      }\n    })\n\n    console.log('‚úÖ [Server] Processed saved flashcards with details:', savedFlashcardsWithDetails.length)\n    return savedFlashcardsWithDetails\n  } catch (error) {\n    console.error('‚ùå [Server] Error fetching saved flashcards:', error)\n    throw error\n  }\n}\n\n/**\n * Main loader function - fetches all data needed for Saved Flashcards page\n */\nexport async function loadSavedFlashcardsData(): Promise<SavedFlashcardsData | null> {\n  try {\n    console.log('üöÄ [Server] Starting loadSavedFlashcardsData...')\n\n    const supabase = await createClient()\n    const { data: { user }, error: authError } = await supabase.auth.getUser()\n\n    if (authError || !user) {\n      console.error('‚ùå [Server] User not authenticated:', authError)\n      return null\n    }\n\n    console.log('üë§ [Server] User authenticated:', user.id)\n\n    // Fetch all data in parallel\n    const [savedFlashcards, userStats, topics, syncStatus] = await Promise.all([\n      getSavedFlashcardsWithDetails(supabase, user.id),\n      getUserStats(supabase, user.id),\n      getTopics(supabase, user.id),\n      checkSyncStatus(user.id).catch(err => {\n        console.error('‚ùå [Server] Error checking sync status:', err)\n        return null\n      }),\n    ])\n\n    console.log('‚úÖ [Server] All data fetched successfully')\n    console.log('üìä [Server] Stats:', {\n      flashcards: savedFlashcards.length,\n      appCards: userStats.appFlashcards,\n      customCards: userStats.customFlashcards,\n      topics: topics.length,\n      syncNeeded: syncStatus?.needsSync,\n    })\n\n    return {\n      savedFlashcards,\n      userStats,\n      topics,\n      syncStatus,\n      userId: user.id,\n    }\n  } catch (error) {\n    console.error('‚ùå [Server] Error in loadSavedFlashcardsData:', error)\n    throw error\n  }\n}\n","import { createBrowserClient } from \"@supabase/ssr\"\r\n\r\n// Check if Supabase environment variables are available\r\nexport const isSupabaseConfigured =\r\n  typeof process.env.NEXT_PUBLIC_SUPABASE_URL === \"string\" &&\r\n  process.env.NEXT_PUBLIC_SUPABASE_URL.length > 0 &&\r\n  typeof process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY === \"string\" &&\r\n  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY.length > 0\r\n\r\n// Create a dummy client for when Supabase is not configured\r\nconst createDummyClient = () => ({\r\n  auth: {\r\n    getUser: () => Promise.resolve({ data: { user: null }, error: null }),\r\n    getSession: () => Promise.resolve({ data: { session: null }, error: null }),\r\n    signOut: () => Promise.resolve({ error: null }),\r\n    signInWithPassword: () => Promise.resolve({ data: { user: null, session: null }, error: { message: \"Supabase not configured\" } }),\r\n    signUp: () => Promise.resolve({ data: { user: null, session: null }, error: { message: \"Supabase not configured\" } }),\r\n    signInWithOAuth: () => Promise.resolve({ data: { provider: \"\", url: \"\" }, error: { message: \"Supabase not configured\" } }),\r\n    resetPasswordForEmail: () => Promise.resolve({ error: { message: \"Supabase not configured\" } }),\r\n    exchangeCodeForSession: () => Promise.resolve({ error: { message: \"Supabase not configured\" } }),\r\n  },\r\n  rpc: (fnName: string, params?: any) => Promise.resolve({ \r\n    data: null, \r\n    error: { message: \"Supabase not configured\" } \r\n  }),\r\n  from: (table: string) => ({\r\n    select: (columns?: string) => ({\r\n      eq: (column: string, value: any) => ({\r\n        eq: (column2: string, value2: any) => ({\r\n          eq: (column3: string, value3: any) => ({\r\n            single: () => Promise.resolve({ data: null, error: null }),\r\n          }),\r\n          single: () => Promise.resolve({ data: null, error: null }),\r\n        }),\r\n        single: () => Promise.resolve({ data: null, error: null }),\r\n      }),\r\n      order: (column: string, options?: { ascending?: boolean }) => ({\r\n        order: (column2: string, options2?: { ascending?: boolean }) => Promise.resolve({ data: null, error: null }),\r\n      }),\r\n      single: () => Promise.resolve({ data: null, error: null }),\r\n    }),\r\n    insert: (values: any) => ({\r\n      select: () => ({\r\n        single: () => Promise.resolve({ data: null, error: null })\r\n      })\r\n    }),\r\n    update: () => ({\r\n      eq: () => Promise.resolve({ data: null, error: null, count: 0 }),\r\n    }),\r\n    delete: () => Promise.resolve({ data: null, error: null }),\r\n  }),\r\n  storage: {\r\n    from: (bucket: string) => ({\r\n      getPublicUrl: (path: string) => ({\r\n        data: { publicUrl: null }\r\n      }),\r\n      upload: (path: string, file: File, options?: any) => \r\n        Promise.resolve({ data: null, error: { message: \"Supabase not configured\" } }),\r\n      remove: (paths: string[]) => \r\n        Promise.resolve({ data: null, error: { message: \"Supabase not configured\" } }),\r\n      list: (path?: string, options?: any) => \r\n        Promise.resolve({ data: null, error: { message: \"Supabase not configured\" } })\r\n    })\r\n  }\r\n})\r\n\r\n// Create a function to create the Supabase client for Client Components\r\nexport function createClient() {\r\n  if (!isSupabaseConfigured) {\r\n    console.warn(\"Supabase environment variables are not set. Using dummy client.\")\r\n    return createDummyClient()\r\n  }\r\n\r\n  return createBrowserClient(\r\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\r\n    {\r\n      auth: {\r\n        persistSession: true,\r\n        // DISABLED: Prevent auto refresh to avoid disrupting review sessions\r\n        autoRefreshToken: true,\r\n        detectSessionInUrl: true,\r\n        // Add session refresh handling for better control\r\n        flowType: 'pkce'\r\n      },\r\n      // Add global configuration for better stability\r\n      global: {\r\n        headers: {\r\n          'X-Client-Info': 'vietnamese-learning-app'\r\n        }\r\n      }\r\n    }\r\n  )\r\n}\r\n\r\n// Export a singleton instance for backward compatibility\r\nexport const supabase = createClient()","/**\r\n * Flashcard sync utilities\r\n * Handles syncing custom flashcards to saved_flashcards table\r\n */\r\n\r\nimport { createClient } from '@/shared/lib/supabase/client'\r\n\r\nexport interface SyncStatus {\r\n  needsSync: boolean\r\n  unsyncedCount: number\r\n}\r\n\r\nexport interface SyncResult {\r\n  success: boolean\r\n  synced: number\r\n  error?: string\r\n}\r\n\r\n/**\r\n * Check if custom flashcards need to be synced to saved_flashcards\r\n */\r\nexport async function checkSyncStatus(userId: string): Promise<SyncStatus> {\r\n  const supabase = createClient()\r\n\r\n  // Get all custom flashcards for the user\r\n  const { data: customFlashcards, error: customError } = await supabase\r\n    .from('custom_flashcards')\r\n    .select('id')\r\n    .eq('user_id', userId)\r\n    .eq('status', 'ACTIVE')\r\n\r\n  if (customError) {\r\n    console.error('Error fetching custom flashcards:', customError)\r\n    return { needsSync: false, unsyncedCount: 0 }\r\n  }\r\n\r\n  const customIds = (customFlashcards || []).map(cf => `custom_${cf.id}`)\r\n\r\n  if (customIds.length === 0) {\r\n    return { needsSync: false, unsyncedCount: 0 }\r\n  }\r\n\r\n    // Get existing saved flashcards of type CUSTOM\r\n    const { data: savedCustom, error: savedError } = await supabase\r\n      .from('saved_flashcards')\r\n      .select('flashcard_id')\r\n      .eq('UserID', userId)  // Column name is UserID\r\n      .eq('flashcard_type', 'CUSTOM')\r\n      .in('flashcard_id', customIds)\r\n\r\n  if (savedError) {\r\n    console.error('Error fetching saved custom flashcards:', savedError)\r\n    return { needsSync: false, unsyncedCount: 0 }\r\n  }\r\n\r\n  const savedIds = new Set((savedCustom || []).map(sf => sf.flashcard_id))\r\n  const unsyncedIds = customIds.filter(id => !savedIds.has(id))\r\n\r\n  return {\r\n    needsSync: unsyncedIds.length > 0,\r\n    unsyncedCount: unsyncedIds.length\r\n  }\r\n}\r\n\r\n/**\r\n * Sync custom flashcards to saved_flashcards table\r\n */\r\nexport async function syncCustomFlashcardsToSaved(userId: string): Promise<SyncResult> {\r\n  try {\r\n    const supabase = createClient()\r\n\r\n    // Get all custom flashcards for the user\r\n    const { data: customFlashcards, error: customError } = await supabase\r\n      .from('custom_flashcards')\r\n      .select('id, topic')\r\n      .eq('user_id', userId)\r\n      .eq('status', 'ACTIVE')\r\n\r\n    if (customError) {\r\n      throw customError\r\n    }\r\n\r\n    if (!customFlashcards || customFlashcards.length === 0) {\r\n      return { success: true, synced: 0 }\r\n    }\r\n\r\n    // Get existing saved flashcards of type CUSTOM\r\n    const { data: savedCustom, error: savedError } = await supabase\r\n      .from('saved_flashcards')\r\n      .select('flashcard_id')\r\n      .eq('UserID', userId)  // Column name is UserID\r\n      .eq('flashcard_type', 'CUSTOM')\r\n\r\n    if (savedError) {\r\n      throw savedError\r\n    }\r\n\r\n    const savedIds = new Set((savedCustom || []).map(sf => sf.flashcard_id))\r\n\r\n    // Find unsynced flashcards\r\n    const toSync = customFlashcards.filter(\r\n      cf => !savedIds.has(`custom_${cf.id}`)\r\n    )\r\n\r\n    if (toSync.length === 0) {\r\n      return { success: true, synced: 0 }\r\n    }\r\n\r\n    // Insert unsynced flashcards\r\n    const insertData = toSync.map(cf => ({\r\n      UserID: userId,  // Column name is UserID\r\n      flashcard_id: `custom_${cf.id}`,\r\n      flashcard_type: 'CUSTOM' as const,\r\n      topic: cf.topic || null,\r\n      saved_at: new Date().toISOString(),\r\n      is_favorite: false,\r\n      review_count: 0,\r\n      tags: []\r\n    }))\r\n\r\n    const { error: insertError } = await supabase\r\n      .from('saved_flashcards')\r\n      .insert(insertData)\r\n\r\n    if (insertError) {\r\n      throw insertError\r\n    }\r\n\r\n    return {\r\n      success: true,\r\n      synced: toSync.length\r\n    }\r\n  } catch (error) {\r\n    console.error('Error syncing custom flashcards:', error)\r\n    return {\r\n      success: false,\r\n      synced: 0,\r\n      error: error instanceof Error ? error.message : 'Unknown error'\r\n    }\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":"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","ignoreList":[4]}