module.exports=[271750,a=>{"use strict";a.s(["default",()=>_],271750);var b=a.i(187924),c=a.i(572131),d=a.i(238246),e=a.i(50944),f=a.i(214549),g=a.i(557116),h=a.i(172252),i=a.i(746402),j=a.i(211885),k=a.i(975009),l=a.i(823292),m=a.i(953722),n=a.i(915618),o=a.i(587532),p=a.i(883706);let q=(0,p.default)("funnel",[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]]),r=(0,p.default)("grid-3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]),s=(0,p.default)("list",[["path",{d:"M3 5h.01",key:"18ugdj"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 19h.01",key:"noohij"}],["path",{d:"M8 5h13",key:"1pao27"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 19h13",key:"m83p4d"}]]);var t=a.i(821374),u=a.i(786520),v=a.i(808406),w=a.i(571987),x=a.i(419499);let y=(0,p.default)("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);var z=a.i(641710),A=a.i(212439);let B=(0,p.default)("bookmark-x",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2Z",key:"169p4p"}],["path",{d:"m14.5 7.5-5 5",key:"3lb6iw"}],["path",{d:"m9.5 7.5 5 5",key:"ko136h"}]]);var C=a.i(781560),D=a.i(934754),E=a.i(164542);function F(a,b){return(0,E.formatDistance)(a,(0,D.constructNow)(a),b)}var G=a.i(945682),H=a.i(346271),I=a.i(255895);let J=(0,c.memo)(function({flashcards:a,viewMode:d,onUnsave:e,onToggleFavorite:h}){let[i,j]=(0,c.useState)(null),[k,m]=(0,c.useState)(new Set);(0,c.useEffect)(()=>{},[]);let n=async a=>{let b=a.vietnamese||a.vietnamese_text||"";if(!b)return void l.toast.error("No text available for audio playback");j(a.id);try{if("APP"===a.flashcard_type){if(!a.flashcard_id)throw Error("Missing flashcard ID for APP flashcard");a.audio_url?await G.audioManager.playPronunciation(a.audio_url):l.toast.info("No audio available for this flashcard")}else{if("lesson"===a.source_type&&a.audio_url){let{data:b}=(0,I.createClient)().storage.from("lesson-materials").getPublicUrl(a.audio_url);if(b?.publicUrl){let a=new Audio(b.publicUrl);await a.play(),a.onended=()=>{j(null)},a.onerror=()=>{j(null),l.toast.error("Failed to play audio")};return}}await o(a.id,b)}}catch(b){console.error("ğŸ’¥ Audio playback failed:",b);let a=b instanceof Error?b.message:"An unknown error occurred";l.toast.error(`Failed to play audio: ${a}`)}finally{j(null)}},o=async(a,b)=>{let c=`audio:custom:${a}`,d=null,e=!1;try{let b=localStorage.getItem(c);if(b){let f=JSON.parse(b);f.expiry&&f.base64&&f.expiry>Date.now()&&"string"==typeof f.base64&&f.base64.length>0?(d=f,console.log("âœ… Using cached audio from localStorage for custom flashcard:",a)):(localStorage.removeItem(c),console.log("ğŸ—‘ï¸ Invalid/expired audio cache removed for custom flashcard:",a),e=!0)}else e=!0}catch(a){console.warn("âš ï¸ Error reading from localStorage:",a);try{localStorage.removeItem(c)}catch(a){console.warn("âš ï¸ Could not clean up localStorage:",a)}e=!0}if(e||!d){console.log("ğŸ”Š Generating new audio via API route for custom flashcard:",a),console.log("ğŸ“ Vietnamese text to convert:",b),console.log("ğŸŒ Making request to TTS API route...");let e=await fetch("/api/flashcards/tts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:b})});if(console.log("ğŸ“¥ Response status:",e.status,e.statusText),!e.ok)throw console.error("âŒ TTS API error:",await e.json().catch(()=>({}))),Error(`Failed to synthesize audio. Status: ${e.status}`);let f=await e.json();if(console.log("ğŸ“Š TTS API response received"),!f.audioContent)throw console.error("âŒ No audioContent in response:",f),Error("No audio content in API response");let g=Date.now()+6048e5;d={base64:f.audioContent,expiry:g};try{localStorage.setItem(c,JSON.stringify(d)),console.log("ğŸ’¾ Audio data cached in localStorage for custom flashcard:",a)}catch(a){console.warn("âš ï¸ Failed to cache audio in localStorage:",a)}}if(d?.base64){let f=0;for(;f<2;){let g=null;try{let c;if(console.log(`ğŸµ Attempting to play audio (attempt ${f+1}/2) for custom flashcard:`,a),!d.base64||"string"!=typeof d.base64)throw Error("Invalid base64 audio data");try{c=atob(d.base64)}catch(a){throw Error(`Failed to decode base64 audio data: ${a}`)}let e=Array(c.length);for(let a=0;a<c.length;a++)e[a]=c.charCodeAt(a);let h=new Uint8Array(e),i=new Blob([h],{type:"audio/mpeg"});if(console.log("ğŸ’¾ Blob created, size:",i.size,"bytes, type:",i.type),0===i.size)throw Error("Created blob is empty");g=URL.createObjectURL(i),console.log("ğŸ”— Audio URL created:",g.substring(0,50)+"...");let j=new Audio(g);await new Promise((a,c)=>{let d=!1,e=null,f=()=>{!d&&(d=!0,e&&clearTimeout(e),g&&URL.revokeObjectURL(g))},h=()=>{d||(f(),a())},i=a=>{d||(f(),c(a))};j.addEventListener("loadstart",()=>console.log("ğŸ”„ Audio loading started")),j.addEventListener("canplay",()=>console.log("âœ… Audio can start playing")),j.addEventListener("error",a=>{console.error("âŒ Audio element error event:",a),console.error("âŒ Audio error details:",{error:j.error,networkState:j.networkState,readyState:j.readyState,src:j.src.substring(0,50)+"..."}),i(Error(`Audio loading failed: ${j.error?.message||"Media element error"}`))}),j.addEventListener("ended",()=>{console.log("ğŸ Audio playback completed successfully"),h()}),e=setTimeout(()=>{console.log("â° Audio playback timeout - assuming success"),h()},15e3),j.play().then(()=>{console.log("ğŸµ Successfully started playing audio for custom flashcard:",b)}).catch(a=>{console.error("âŒ Audio play() method failed:",a),i(Error(`Audio play failed: ${a.message||"Play method error"}`))})}),console.log("âœ… Audio playback completed successfully");return}catch(h){if(console.error(`âŒ Audio playback error (attempt ${f+1}):`,h),g){try{URL.revokeObjectURL(g)}catch(a){console.warn("âš ï¸ Could not revoke blob URL:",a)}g=null}if(++f>=2){if(!e&&d){console.log("ğŸ”„ Cached audio failed, attempting to regenerate...");try{localStorage.removeItem(c)}catch(a){console.warn("âš ï¸ Could not remove cache:",a)}return await o(a,b)}throw Error(`Audio playback failed after 2 attempts: ${h instanceof Error?h.message:"Unknown error"}`)}await new Promise(a=>setTimeout(a,800))}}}else throw Error("Could not generate or retrieve audio data")},p=a=>{let b=a.vietnamese||a.vietnamese_text||"Unknown",c="CUSTOM"===a.flashcard_type?"delete":"unsave";e(a.id,b,c)},q=a=>{m(b=>{let c=new Set(b);return c.has(a)?c.delete(a):c.add(a),c})},r=a=>{if(!a)return[];if(Array.isArray(a))return a.filter(a=>"string"==typeof a&&a.trim());if("string"==typeof a){let b=a.trim();if(!b)return[];let c=b.match(/[A-Z][a-z]*/g);return c&&c.length>1?c:b.includes(",")?b.split(",").map(a=>a.trim()).filter(a=>a):b.includes(";")?b.split(";").map(a=>a.trim()).filter(a=>a):b.includes("/")?b.split("/").map(a=>a.trim()).filter(a=>a):b.includes(" ")?b.split(" ").map(a=>a.trim()).filter(a=>a):[b]}if("number"==typeof a)return[a.toString()];try{let b=String(a).trim();return b?[b]:[]}catch{return[]}};return"grid"===d?(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:a.map(a=>{let c=a.vietnamese||a.vietnamese_text||"",d=a.english?.join(", ")||a.english_text||"",e=a.image_url||"/placeholder.svg",j="CUSTOM"===a.flashcard_type,l=k.has(a.id);return(0,b.jsx)("div",{style:{perspective:"1000px",minHeight:"450px"},children:(0,b.jsxs)(H.motion.div,{style:{position:"relative",transformStyle:"preserve-3d",width:"100%",height:"100%",minHeight:"450px"},transition:{duration:.6},animate:{rotateY:180*!!l},children:[(0,b.jsx)(H.motion.div,{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden"},children:(0,b.jsx)(g.Card,{className:"group hover:shadow-lg transition-all duration-200 cursor-pointer",style:{width:"100%",height:"100%"},onClick:()=>q(a.id),children:(0,b.jsxs)(g.CardContent,{className:"p-4 h-full flex flex-col",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,b.jsx)(x.Badge,{variant:"APP"===a.flashcard_type?"default":"secondary",className:"text-xs",children:"APP"===a.flashcard_type?"App":"My Card"}),(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",onClick:b=>{b.stopPropagation(),h(a.id)},className:"p-1 h-auto opacity-60 hover:opacity-100",children:a.is_favorite?(0,b.jsx)(t.Star,{className:"h-3 w-3 fill-yellow-400 text-yellow-400"}):(0,b.jsx)(t.Star,{className:"h-3 w-3"})}),(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",onClick:b=>{b.stopPropagation(),p(a)},className:"p-1 h-auto opacity-60 hover:opacity-100 hover:text-red-600",title:j?"Delete flashcard":"Unsave flashcard",children:j?(0,b.jsx)(C.Trash2,{className:"h-3 w-3"}):(0,b.jsx)(B,{className:"h-3 w-3"})})]})]}),(0,b.jsx)("div",{className:"aspect-square rounded-lg overflow-hidden mb-3 bg-gray-100",children:(0,b.jsx)(w.default,{src:e,alt:c,width:300,height:300,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-200",loading:"lazy"})}),(0,b.jsxs)("div",{className:"space-y-2 flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("h3",{className:"font-semibold text-gray-900 truncate",children:c}),"APP"===a.flashcard_type&&a.pronunciation&&(0,b.jsxs)("p",{className:"text-xs text-gray-500 font-mono mt-0.5 truncate",children:["/",a.pronunciation,"/"]}),"CUSTOM"===a.flashcard_type&&a.ipa_pronunciation&&(0,b.jsxs)("p",{className:"text-xs text-gray-500 font-mono mt-0.5 truncate",children:["/",a.ipa_pronunciation,"/"]})]}),(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",onClick:b=>{b.stopPropagation(),n(a)},disabled:i===a.id,className:`p-1 h-auto opacity-60 hover:opacity-100 ${i===a.id?"animate-pulse text-blue-500":""}`,title:"Play pronunciation",children:(0,b.jsx)(A.Volume2,{className:"h-3 w-3"})})]}),a.topic&&(0,b.jsx)(x.Badge,{variant:"outline",className:"text-xs",children:a.topic}),(()=>{let c=r(a.word_type);return 0===c.length?null:1===c.length?(0,b.jsx)(x.Badge,{variant:"outline",className:"text-xs",children:c[0]}):(0,b.jsx)("div",{className:"flex flex-wrap gap-1",children:c.map((a,c)=>(0,b.jsx)(x.Badge,{variant:"outline",className:"text-xs",children:a},c))})})()]}),(0,b.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500 mt-3 pt-3 border-t",children:[(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(z.Clock,{className:"h-3 w-3"}),a.review_count," reviews"]}),(0,b.jsxs)("div",{className:"flex items-center gap-1",suppressHydrationWarning:!0,children:[(0,b.jsx)(y,{className:"h-3 w-3"}),F(new Date(a.saved_at),{addSuffix:!0})]})]})]})})}),(0,b.jsx)(H.motion.div,{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden",transform:"rotateY(180deg)"},children:(0,b.jsx)(g.Card,{className:"group hover:shadow-lg transition-all duration-200 cursor-pointer",style:{width:"100%",height:"100%"},onClick:()=>q(a.id),children:(0,b.jsxs)(g.CardContent,{className:"p-4 h-full flex flex-col",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,b.jsx)(x.Badge,{variant:"APP"===a.flashcard_type?"default":"secondary",className:"text-xs",children:"APP"===a.flashcard_type?"App":"My Card"}),(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",onClick:b=>{b.stopPropagation(),h(a.id)},className:"p-1 h-auto opacity-60 hover:opacity-100",children:a.is_favorite?(0,b.jsx)(t.Star,{className:"h-3 w-3 fill-yellow-400 text-yellow-400"}):(0,b.jsx)(t.Star,{className:"h-3 w-3"})}),(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",onClick:b=>{b.stopPropagation(),p(a)},className:"p-1 h-auto opacity-60 hover:opacity-100 hover:text-red-600",title:j?"Delete flashcard":"Unsave flashcard",children:j?(0,b.jsx)(C.Trash2,{className:"h-3 w-3"}):(0,b.jsx)(B,{className:"h-3 w-3"})})]})]}),(0,b.jsx)("div",{className:"space-y-2 flex-1 flex items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("p",{className:"text-lg font-semibold text-gray-900 mb-4",children:d}),a.topic&&(0,b.jsx)(x.Badge,{variant:"outline",className:"text-xs mb-2",children:a.topic})]})}),(0,b.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500 mt-3 pt-3 border-t",children:[(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(z.Clock,{className:"h-3 w-3"}),a.review_count," reviews"]}),(0,b.jsxs)("div",{className:"flex items-center gap-1",suppressHydrationWarning:!0,children:[(0,b.jsx)(y,{className:"h-3 w-3"}),F(new Date(a.saved_at),{addSuffix:!0})]})]})]})})})]})},a.id)})}):(0,b.jsx)("div",{className:"space-y-3",children:a.map(a=>{let c=a.vietnamese||a.vietnamese_text||"",d=a.english?.join(", ")||a.english_text||"",e=a.image_url||"/placeholder.svg",j="CUSTOM"===a.flashcard_type,l=k.has(a.id);return(0,b.jsx)("div",{style:{perspective:"1000px",minHeight:"150px"},children:(0,b.jsxs)(H.motion.div,{style:{position:"relative",transformStyle:"preserve-3d",width:"100%",height:"100%",minHeight:"150px"},transition:{duration:.6},animate:{rotateX:180*!!l},children:[(0,b.jsx)(H.motion.div,{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden"},children:(0,b.jsx)(g.Card,{className:"group hover:shadow-md transition-all duration-200 cursor-pointer",style:{width:"100%",height:"100%"},onClick:()=>q(a.id),children:(0,b.jsx)(g.CardContent,{className:"p-4",children:(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)("div",{className:"w-16 h-16 rounded-lg overflow-hidden bg-gray-100 flex-shrink-0",children:(0,b.jsx)(w.default,{src:e,alt:c,width:64,height:64,className:"w-full h-full object-cover",loading:"lazy"})}),(0,b.jsx)("div",{className:"flex-1 min-w-0",children:(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 mb-1",children:[(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("h3",{className:"font-semibold text-lg text-gray-900 truncate",children:c}),"APP"===a.flashcard_type&&a.pronunciation&&(0,b.jsxs)("p",{className:"text-xs text-gray-500 font-mono mt-0.5 truncate",children:["/",a.pronunciation,"/"]}),"CUSTOM"===a.flashcard_type&&a.ipa_pronunciation&&(0,b.jsxs)("p",{className:"text-xs text-gray-500 font-mono mt-0.5 truncate",children:["/",a.ipa_pronunciation,"/"]})]}),(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",onClick:b=>{b.stopPropagation(),n(a)},disabled:i===a.id,className:`p-1 h-auto opacity-60 hover:opacity-100 ${i===a.id?"animate-pulse text-blue-500":""}`,title:"Play pronunciation",children:(0,b.jsx)(A.Volume2,{className:"h-4 w-4"})})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,b.jsx)(x.Badge,{variant:"APP"===a.flashcard_type?"default":"secondary",className:"text-xs",children:"APP"===a.flashcard_type?"App Card":"My Card"}),a.topic&&(0,b.jsx)(x.Badge,{variant:"outline",className:"text-xs",children:a.topic}),(()=>{let c=r(a.word_type);return 0===c.length?null:1===c.length?(0,b.jsx)(x.Badge,{variant:"outline",className:"text-xs",children:c[0]}):(0,b.jsx)("div",{className:"flex flex-wrap gap-1",children:c.map((a,c)=>(0,b.jsx)(x.Badge,{variant:"outline",className:"text-xs",children:a},c))})})()]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)("div",{className:"text-right text-sm text-gray-500 mr-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(z.Clock,{className:"h-3 w-3"}),a.review_count," reviews"]}),(0,b.jsxs)("div",{className:"flex items-center gap-1 mt-1",suppressHydrationWarning:!0,children:[(0,b.jsx)(y,{className:"h-3 w-3"}),F(new Date(a.saved_at),{addSuffix:!0})]})]}),(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",onClick:b=>{b.stopPropagation(),h(a.id)},className:"p-2",children:a.is_favorite?(0,b.jsx)(t.Star,{className:"h-4 w-4 fill-yellow-400 text-yellow-400"}):(0,b.jsx)(t.Star,{className:"h-4 w-4"})}),(0,b.jsx)(f.Button,{variant:"destructive",size:"sm",onClick:b=>{b.stopPropagation(),p(a)},className:"px-3",children:j?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(C.Trash2,{className:"h-4 w-4 mr-1"}),"Delete"]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(B,{className:"h-4 w-4 mr-1"}),"Unsave"]})})]})]})})]})})})}),(0,b.jsx)(H.motion.div,{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden",transform:"rotateX(180deg)"},children:(0,b.jsx)(g.Card,{className:"group hover:shadow-md transition-all duration-200 cursor-pointer",style:{width:"100%",height:"100%"},onClick:()=>q(a.id),children:(0,b.jsx)(g.CardContent,{className:"p-4",children:(0,b.jsx)("div",{className:"flex items-center gap-4",children:(0,b.jsx)("div",{className:"flex-1 min-w-0",children:(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsx)("div",{className:"flex-1 min-w-0",children:(0,b.jsxs)("div",{className:"text-center py-8",children:[(0,b.jsx)("p",{className:"text-xl font-semibold text-gray-900 mb-4",children:d}),a.topic&&(0,b.jsx)(x.Badge,{variant:"outline",className:"text-xs",children:a.topic})]})}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)("div",{className:"text-right text-sm text-gray-500 mr-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(z.Clock,{className:"h-3 w-3"}),a.review_count," reviews"]}),(0,b.jsxs)("div",{className:"flex items-center gap-1 mt-1",suppressHydrationWarning:!0,children:[(0,b.jsx)(y,{className:"h-3 w-3"}),F(new Date(a.saved_at),{addSuffix:!0})]})]}),(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",onClick:b=>{b.stopPropagation(),h(a.id)},className:"p-2",children:a.is_favorite?(0,b.jsx)(t.Star,{className:"h-4 w-4 fill-yellow-400 text-yellow-400"}):(0,b.jsx)(t.Star,{className:"h-4 w-4"})}),(0,b.jsx)(f.Button,{variant:"destructive",size:"sm",onClick:b=>{b.stopPropagation(),p(a)},className:"px-3",children:j?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(C.Trash2,{className:"h-4 w-4 mr-1"}),"Delete"]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(B,{className:"h-4 w-4 mr-1"}),"Unsave"]})})]})]})})})})})})]})},a.id)})})});var K=a.i(675751),L=a.i(429535),M=a.i(73570);function N({isOpen:a,onClose:d,onConfirm:e,flashcardText:g,actionType:h="unsave"}){let[i,j]=(0,c.useState)(!1),k="delete"===h,l=k?`"${g}" will be permanently deleted. This action cannot be undone.`:`"${g}" will be removed from your saved flashcards.`,m=k?(0,b.jsx)(C.Trash2,{className:"h-5 w-5 text-red-600"}):(0,b.jsx)(M.AlertTriangle,{className:"h-5 w-5 text-amber-600"});return(0,b.jsx)(K.Dialog,{open:a,onOpenChange:d,children:(0,b.jsxs)(K.DialogContent,{className:"sm:max-w-md",children:[(0,b.jsx)(K.DialogHeader,{children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:`h-10 w-10 ${k?"bg-red-100":"bg-amber-100"} rounded-full flex items-center justify-center`,children:m}),(0,b.jsxs)("div",{children:[(0,b.jsx)(K.DialogTitle,{className:"text-lg font-semibold",children:k?"Do you want to delete your custom flashcard?":"Do you want to unsave this flashcard?"}),(0,b.jsx)(K.DialogDescription,{className:"mt-1",children:l})]})]})}),(0,b.jsxs)("div",{className:"flex items-center space-x-2 mt-4",children:[(0,b.jsx)(L.Checkbox,{id:"dontShowAgain",checked:i,onCheckedChange:a=>j(a)}),(0,b.jsx)("label",{htmlFor:"dontShowAgain",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Don't show this again"})]}),(0,b.jsxs)(K.DialogFooter,{className:"flex gap-2 mt-6",children:[(0,b.jsx)(f.Button,{variant:"outline",onClick:()=>{d()},className:"flex-1",children:"No, Cancel"}),(0,b.jsx)(f.Button,{variant:"destructive",onClick:()=>{i&&sessionStorage.setItem("delete"===h?"hideDeleteModal":"hideUnsaveModal","true"),e(),d()},className:"flex-1",children:k?"Yes, Delete":"Yes, Unsave"})]})]})})}var O=a.i(935112),P=a.i(242641),Q=a.i(633508),R=a.i(787654);function S({flashcardText:a,duration:d,onUndo:e,onComplete:g,onDismiss:h}){let[i,j]=(0,c.useState)(0),[k,l]=(0,c.useState)(!0),m=(0,c.useRef)(null),n=(0,c.useRef)(null);(0,c.useEffect)(()=>{if(!k)return;m.current=performance.now();let a=b=>{if(!m.current)return;let c=(b-m.current)/1e3/d*100;if(c>=100){j(100),l(!1),g();return}j(c),n.current=requestAnimationFrame(a)};return n.current=requestAnimationFrame(a),()=>{n.current&&cancelAnimationFrame(n.current)}},[k,d,g]);let o=Math.max(0,d-i/100*d),p=(0,b.jsxs)("div",{className:"fixed bottom-6 right-6 z-50 pointer-events-auto bg-white border border-gray-200 rounded-lg shadow-lg p-4 min-w-[320px] max-w-md animate-in slide-in-from-bottom-5 fade-in duration-300",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"text-sm font-medium text-gray-900",children:a}),(0,b.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:o>0?(0,b.jsxs)(b.Fragment,{children:["Auto-deleting in ",Math.ceil(o)," second",1!==Math.ceil(o)?"s":""]}):"Deleted"})]}),h&&(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",onClick:h,className:"p-1 h-auto",children:(0,b.jsx)(Q.X,{className:"h-4 w-4"})})]}),o>0&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(P.Progress,{value:i,className:"h-1 mb-3"}),(0,b.jsx)("div",{className:"flex justify-end",children:(0,b.jsxs)(f.Button,{variant:"outline",size:"sm",onClick:()=>{l(!1),e()},className:"text-xs px-3 py-1",children:[(0,b.jsx)(R.RotateCcw,{className:"h-3 w-3 mr-1"}),"Undo"]})})]})]});return(0,O.createPortal)(p,document.body)}async function T(a){try{let b=(0,I.createClient)(),{data:c,error:d}=await b.from("custom_flashcards").select("id, topic").eq("user_id",a).eq("status","ACTIVE");if(d)throw d;if(!c||0===c.length)return{success:!0,synced:0};let{data:e,error:f}=await b.from("saved_flashcards").select("flashcard_id").eq("UserID",a).eq("flashcard_type","CUSTOM");if(f)throw f;let g=new Set((e||[]).map(a=>a.flashcard_id)),h=c.filter(a=>!g.has(`custom_${a.id}`));if(0===h.length)return{success:!0,synced:0};let i=h.map(b=>({UserID:a,flashcard_id:`custom_${b.id}`,flashcard_type:"CUSTOM",topic:b.topic||null,saved_at:new Date().toISOString(),is_favorite:!1,review_count:0,tags:[]})),{error:j}=await b.from("saved_flashcards").insert(i);if(j)throw j;return{success:!0,synced:h.length}}catch(a){return console.error("Error syncing custom flashcards:",a),{success:!1,synced:0,error:a instanceof Error?a.message:"Unknown error"}}}var U=a.i(405050),V=(0,U.createServerReference)("406d84cb44c4981a664e2476a59d980e60874605ab",U.callServer,void 0,U.findSourceMapURL,"deleteCustomFlashcard"),W=(0,U.createServerReference)("40986aecbd86e0e666ca6f9c7e3044898795a258da",U.callServer,void 0,U.findSourceMapURL,"unsaveAppFlashcard"),X=a.i(601876);let Y={APP_FLASHCARDS:25,CUSTOM_FLASHCARDS:10},Z={APP_FLASHCARDS:100,CUSTOM_FLASHCARDS:25},$={APP_FLASHCARDS:999999,CUSTOM_FLASHCARDS:999999};function _({initialData:a}){let p=(0,e.useRouter)(),[w,x]=(0,c.useState)(a.savedFlashcards),[y]=(0,c.useState)(a.topics),[z,A]=(0,c.useState)(a.syncStatus),[B,C]=(0,c.useState)("grid"),[D,E]=(0,c.useState)(""),[F,G]=(0,c.useState)("all"),[H,K]=(0,c.useState)("date_desc"),[L,M]=(0,c.useState)("all"),[O,P]=(0,c.useState)(!1),[Q,R]=(0,c.useState)(null),[U,_]=(0,c.useState)(!1),[aa,ab]=(0,c.useState)(null);(0,c.useEffect)(()=>{console.log("ğŸ”„ [SavedFlashcards] Component mounted, checking for updates..."),p.refresh()},[p]),(0,c.useEffect)(()=>{let b=(0,I.createClient)();if(!b||"function"!=typeof b.channel)return void console.log("âš ï¸ [SavedFlashcards] Real-time subscriptions not available (Supabase not configured)");console.log("ğŸ”„ [SavedFlashcards] Setting up real-time subscriptions for user:",a.userId);let c=b.channel("custom_flashcards_changes").on("postgres_changes",{event:"INSERT",schema:"public",table:"custom_flashcards",filter:`user_id=eq.${a.userId}`},a=>{console.log("âœ¨ [SavedFlashcards] New custom flashcard detected:",a),l.toast.success("New flashcard added! Refreshing..."),p.refresh()}).subscribe(),d=b.channel("saved_flashcards_changes").on("postgres_changes",{event:"INSERT",schema:"public",table:"saved_flashcards",filter:`UserID=eq.${a.userId}`},a=>{console.log("âœ¨ [SavedFlashcards] New saved flashcard detected:",a),a.new?.flashcard_type==="CUSTOM"&&(l.toast.success("Flashcard synced! Refreshing..."),p.refresh())}).subscribe();return console.log("âœ… [SavedFlashcards] Real-time subscriptions active"),()=>{console.log("ğŸ§¹ [SavedFlashcards] Cleaning up real-time subscriptions"),"function"==typeof b.removeChannel&&(b.removeChannel(c),b.removeChannel(d))}},[a.userId,p]);let ac=(a,b,c)=>{let d=w.find(b=>b.id===a);if(!d)return void console.error("âŒ Flashcard not found:",a);console.log("ğŸ—‘ï¸ Starting unsave countdown:",{flashcardId:a,flashcard:d,actionType:c}),x(b=>b.filter(b=>b.id!==a));let e=setTimeout(async()=>{console.log("â° Countdown complete, executing deletion:",c);try{if("delete"===c){let a=d.flashcard_id.replace("custom_","");console.log("ğŸ—‘ï¸ [Client] Calling deleteCustomFlashcard server action:",{savedFlashcardId:d.id,customFlashcardId:a,fullFlashcardId:d.flashcard_id});let b=await V(a);if(!b.success)throw Error(b.error||"Failed to delete flashcard");console.log("âœ… [Client] Custom flashcard successfully deleted"),l.toast.success("Custom flashcard deleted successfully"),p.refresh()}else{console.log("ğŸ—‘ï¸ [Client] Calling unsaveAppFlashcard server action:",{savedFlashcardId:d.id,flashcardType:d.flashcard_type});let a=await W(d.id);if(!a.success)throw Error(a.error||"Failed to unsave flashcard");console.log("âœ… [Client] Flashcard successfully unsaved"),l.toast.success("Flashcard removed from your collection"),p.refresh()}}catch(b){console.error(`âŒ [Client] Failed to ${c} flashcard:`,b),x(a=>[...a,d]);let a=b instanceof Error?b.message:"An error occurred";l.toast.error(`Failed to ${c} flashcard: ${a}`)}_(!1),ab(null)},5e3);ab({flashcardId:a,originalFlashcard:d,timeoutId:e}),_(!0)},ad=async b=>{let c=w.find(a=>a.id===b);if(!c)return;let d=!c.is_favorite;console.log("â­ Toggling favorite:",{flashcardId:b,currentStatus:c.is_favorite,newStatus:d}),x(a=>a.map(a=>a.id===b?{...a,is_favorite:d}:a));try{let b=(0,I.createClient)(),{error:e}=await b.from("saved_flashcards").update({is_favorite:d}).eq("id",c.id).eq("UserID",a.userId);if(e)throw console.error("âŒ Favorite update error:",e),e;console.log("âœ… Favorite status updated successfully"),p.refresh()}catch(a){console.error("âŒ Failed to toggle favorite:",a),x(a=>a.map(a=>a.id===b?{...a,is_favorite:c.is_favorite}:a)),l.toast.error("Failed to update favorite status. Please try again.")}},ae=async()=>{if(z?.needsSync&&0!==z.unsyncedCount)try{console.log(`ğŸ”„ Syncing ${z.unsyncedCount} unsynced flashcards...`);let b=await T(a.userId);b.success&&b.synced>0?(l.toast.success(`Synchronized ${b.synced} custom flashcard${b.synced>1?"s":""} to your collection`),p.refresh()):b.success&&0===b.synced&&console.log("âœ… All custom flashcards are already synchronized")}catch(a){console.error("âŒ Error during sync:",a),l.toast.error("Failed to sync flashcards")}},af=(0,c.useMemo)(()=>w.filter(a=>{let b=a.vietnamese||a.vietnamese_text||"",c=a.english?.join(" ")||a.english_text||"",d=""===D.trim()||(0,X.searchVietnamese)(b,D)||c.toLowerCase().includes(D.toLowerCase()),e="all"===F||a.topic===F,f="all"===L||"app"===L&&"APP"===a.flashcard_type||"custom"===L&&"CUSTOM"===a.flashcard_type||"favorites"===L&&a.is_favorite;return d&&e&&f}),[w,D,F,L]),ag=(0,c.useMemo)(()=>[...af].sort((a,b)=>{switch(H){case"date_desc":return new Date(b.saved_at).getTime()-new Date(a.saved_at).getTime();case"date_asc":return new Date(a.saved_at).getTime()-new Date(b.saved_at).getTime();case"alpha_asc":let c=a.vietnamese||a.vietnamese_text||"",d=b.vietnamese||b.vietnamese_text||"";return c.localeCompare(d);case"alpha_desc":let e=a.vietnamese||a.vietnamese_text||"";return(b.vietnamese||b.vietnamese_text||"").localeCompare(e);default:return 0}}),[af,H]),ah=(0,c.useMemo)(()=>w.filter(a=>"APP"===a.flashcard_type),[w]),ai=(0,c.useMemo)(()=>w.filter(a=>"CUSTOM"===a.flashcard_type),[w]),aj=(0,c.useMemo)(()=>w.filter(a=>a.is_favorite),[w]),ak="UNLIMITED"===a.userStats.subscription_type?$:"PLUS"===a.userStats.subscription_type?Z:Y,al=a.userStats.appFlashcards>=.8*ak.APP_FLASHCARDS||a.userStats.customFlashcards>=.8*ak.CUSTOM_FLASHCARDS;return(0,b.jsxs)("div",{className:"container mx-auto p-6 space-y-6",children:[(0,b.jsx)("div",{className:"flex items-center justify-between",children:(0,b.jsx)("div",{className:"flex items-center gap-4",children:(0,b.jsxs)("div",{children:[(0,b.jsxs)("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-2",children:[(0,b.jsx)(m.BookOpen,{className:"h-8 w-8 text-blue-600"}),"My Flashcards"]}),(0,b.jsx)("p",{className:"text-gray-600 mt-1",children:"Manage and review your saved flashcards"})]})})}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsx)(g.Card,{children:(0,b.jsx)(g.CardContent,{className:"p-4",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"App Flashcards"}),(0,b.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:[a.userStats.appFlashcards,"/",999999===ak.APP_FLASHCARDS?"âˆ":ak.APP_FLASHCARDS]})]}),(0,b.jsx)("div",{className:"h-12 w-12 bg-blue-100 rounded-lg flex items-center justify-center",children:(0,b.jsx)(m.BookOpen,{className:"h-6 w-6 text-blue-600"})})]})})}),(0,b.jsx)(g.Card,{children:(0,b.jsx)(g.CardContent,{className:"p-4",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"My Flashcards"}),(0,b.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:[a.userStats.customFlashcards,"/",999999===ak.CUSTOM_FLASHCARDS?"âˆ":ak.CUSTOM_FLASHCARDS]})]}),(0,b.jsx)("div",{className:"h-12 w-12 bg-green-100 rounded-lg flex items-center justify-center",children:(0,b.jsx)(n.Plus,{className:"h-6 w-6 text-green-600"})})]})})})]}),"FREE"===a.userStats.subscription_type&&al&&(0,b.jsx)(g.Card,{className:"border-amber-200 bg-gradient-to-r from-amber-50 to-orange-50",children:(0,b.jsx)(g.CardContent,{className:"p-4",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(u.Crown,{className:"h-8 w-8 text-amber-600"}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("h3",{className:"font-semibold text-gray-900 flex items-center gap-2",children:[(0,b.jsx)(v.Sparkles,{className:"h-4 w-4 text-amber-600"}),"Upgrade to Plus"]}),(0,b.jsx)("p",{className:"text-sm text-gray-700",children:"You're approaching your save limit. Unlock unlimited flashcards!"})]})]}),(0,b.jsx)(d.default,{href:"/pricing",children:(0,b.jsx)(f.Button,{variant:"default",className:"bg-gradient-to-r from-amber-500 to-orange-600 text-white hover:from-amber-600 hover:to-orange-700",children:"View Plans"})})]})})}),z&&z.needsSync&&z.unsyncedCount>0&&(0,b.jsx)(g.Card,{className:"border-blue-200 bg-blue-50",children:(0,b.jsx)(g.CardContent,{className:"p-4",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("div",{children:(0,b.jsxs)("p",{className:"text-sm font-medium text-blue-900",children:[z.unsyncedCount," custom flashcard",z.unsyncedCount>1?"s":""," need syncing"]})}),(0,b.jsx)(f.Button,{onClick:ae,size:"sm",variant:"outline",children:"Sync Now"})]})})}),(0,b.jsx)(h.Separator,{}),(0,b.jsx)(g.Card,{children:(0,b.jsx)(g.CardContent,{className:"p-4",children:(0,b.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,b.jsxs)("div",{className:"flex-1 relative",children:[(0,b.jsx)(o.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,b.jsx)(k.Input,{placeholder:"Search flashcards...",value:D,onChange:a=>E(a.target.value),className:"pl-10"})]}),(0,b.jsx)("div",{className:"w-full md:w-48",children:(0,b.jsxs)(j.Select,{value:F,onValueChange:G,children:[(0,b.jsx)(j.SelectTrigger,{className:"w-full",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(q,{className:"h-4 w-4"}),(0,b.jsx)(j.SelectValue,{placeholder:"All Topics"})]})}),(0,b.jsxs)(j.SelectContent,{children:[(0,b.jsx)(j.SelectItem,{value:"all",children:"All Topics"}),y.map(a=>(0,b.jsx)(j.SelectItem,{value:a.name,children:a.name},a.id))]})]})}),(0,b.jsx)("div",{className:"w-full md:w-56",children:(0,b.jsxs)(j.Select,{value:H,onValueChange:K,children:[(0,b.jsx)(j.SelectTrigger,{className:"w-full",children:(0,b.jsx)(j.SelectValue,{placeholder:"Date Added (Newest)"})}),(0,b.jsxs)(j.SelectContent,{children:[(0,b.jsx)(j.SelectItem,{value:"date_desc",children:"Date Added (Newest)"}),(0,b.jsx)(j.SelectItem,{value:"date_asc",children:"Date Added (Oldest)"}),(0,b.jsx)(j.SelectItem,{value:"alpha_asc",children:"Alphabetical (A-Z)"}),(0,b.jsx)(j.SelectItem,{value:"alpha_desc",children:"Alphabetical (Z-A)"})]})]})}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(f.Button,{variant:"list"===B?"default":"outline",size:"icon",onClick:()=>C("list"),children:(0,b.jsx)(s,{className:"h-4 w-4"})}),(0,b.jsx)(f.Button,{variant:"grid"===B?"default":"outline",size:"icon",onClick:()=>C("grid"),children:(0,b.jsx)(r,{className:"h-4 w-4"})})]})]})})}),(0,b.jsxs)(i.Tabs,{value:L,onValueChange:M,className:"w-full",children:[(0,b.jsxs)(i.TabsList,{className:"grid w-full grid-cols-4",children:[(0,b.jsxs)(i.TabsTrigger,{value:"all",children:["All (",w.length,")"]}),(0,b.jsxs)(i.TabsTrigger,{value:"app",children:["App Cards (",ah.length,")"]}),(0,b.jsxs)(i.TabsTrigger,{value:"custom",children:["My Cards (",ai.length,")"]}),(0,b.jsxs)(i.TabsTrigger,{value:"favorites",children:[(0,b.jsx)(t.Star,{className:"h-4 w-4 mr-1 fill-current"})," Favorites (",aj.length,")"]})]}),(0,b.jsx)(i.TabsContent,{value:L,className:"mt-6",children:0===ag.length?(0,b.jsx)(g.Card,{children:(0,b.jsxs)(g.CardContent,{className:"p-12 text-center",children:[(0,b.jsx)(m.BookOpen,{className:"h-16 w-16 mx-auto text-gray-400 mb-4"}),(0,b.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No flashcards to display"}),(0,b.jsxs)("p",{className:"text-gray-600 mb-4",children:["Total in state: ",w.length,", Filtered: ",af.length]}),(0,b.jsx)(d.default,{href:"/flashcards/create",children:(0,b.jsxs)(f.Button,{children:[(0,b.jsx)(n.Plus,{className:"h-4 w-4 mr-2"}),"Create Your First Flashcard"]})})]})}):(0,b.jsx)(J,{flashcards:ag,viewMode:B,onUnsave:(a,b,c)=>{ac(a,b,c)},onToggleFavorite:a=>{ad(a)}})})]}),(0,b.jsx)(N,{isOpen:O,onClose:()=>P(!1),onConfirm:()=>{Q&&ac(Q.flashcardId,Q.flashcardText,Q.actionType),P(!1),R(null)},flashcardText:Q?.flashcardText||"",actionType:Q?.actionType||"unsave"}),U&&aa&&(0,b.jsx)(S,{flashcardText:aa.originalFlashcard.vietnamese||aa.originalFlashcard.vietnamese_text||"",onUndo:()=>{aa&&(clearTimeout(aa.timeoutId),x(a=>[...a,aa.originalFlashcard]),_(!1),ab(null),l.toast.success("Flashcard restored!"))},onComplete:()=>{_(!1),ab(null),l.toast.success("Flashcard removed from your collection")},onDismiss:()=>{_(!1)},duration:5})]})}}];

//# sourceMappingURL=features_flashcards_components_saved_SavedFlashcardsContainer_tsx_5021e5d0._.js.map