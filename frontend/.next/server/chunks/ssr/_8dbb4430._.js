module.exports=[236338,(a,b,c)=>{"use strict";var d=Object.defineProperty,e=Object.getOwnPropertyDescriptor,f=Object.getOwnPropertyNames,g=Object.prototype.hasOwnProperty,h={};((a,b)=>{for(var c in b)d(a,c,{get:b[c],enumerable:!0})})(h,{SYMBOL_FOR_REQ_CONTEXT:()=>i,getContext:()=>j}),b.exports=((a,b,c,h)=>{if(b&&"object"==typeof b||"function"==typeof b)for(let i of f(b))g.call(a,i)||i===c||d(a,i,{get:()=>b[i],enumerable:!(h=e(b,i))||h.enumerable});return a})(d({},"__esModule",{value:!0}),h);let i=Symbol.for("@vercel/request-context");function j(){let a=globalThis;return a[i]?.get?.()??{}}},817547,(a,b,c)=>{"use strict";Object.create;var d=Object.defineProperty,e=Object.getOwnPropertyDescriptor,f=Object.getOwnPropertyNames;Object.getPrototypeOf;var g=Object.prototype.hasOwnProperty,h={};((a,b)=>{for(var c in b)d(a,c,{get:b[c],enumerable:!0})})(h,{getVercelOidcToken:()=>k,getVercelOidcTokenSync:()=>l}),b.exports=((a,b,c,h)=>{if(b&&"object"==typeof b||"function"==typeof b)for(let i of f(b))g.call(a,i)||i===c||d(a,i,{get:()=>b[i],enumerable:!(h=e(b,i))||h.enumerable});return a})(d({},"__esModule",{value:!0}),h);var i=a.r(236338),j=a.r(580949);async function k(){let b,c="";try{c=l()}catch(a){b=a}try{let[{getTokenPayload:b,isExpired:d},{refreshToken:e}]=await Promise.all([await a.A(682672),await a.A(966249)]);(!c||d(b(c)))&&(await e(),c=l())}catch(a){throw b?.message&&a instanceof Error&&(a.message=`${b.message}
${a.message}`),new j.VercelOidcTokenError("Failed to refresh OIDC token",a)}return c}function l(){let a=(0,i.getContext)().headers?.["x-vercel-oidc-token"]??process.env.VERCEL_OIDC_TOKEN;if(!a)throw Error("The 'x-vercel-oidc-token' header is missing from the request. Do you have the OIDC option enabled in the Vercel project settings?");return a}},784628,(a,b,c)=>{"use strict";var d=Object.defineProperty,e=Object.getOwnPropertyDescriptor,f=Object.getOwnPropertyNames,g=Object.prototype.hasOwnProperty,h={};((a,b)=>{for(var c in b)d(a,c,{get:b[c],enumerable:!0})})(h,{getContext:()=>j.getContext,getVercelOidcToken:()=>i.getVercelOidcToken,getVercelOidcTokenSync:()=>i.getVercelOidcTokenSync}),b.exports=((a,b,c,h)=>{if(b&&"object"==typeof b||"function"==typeof b)for(let i of f(b))g.call(a,i)||i===c||d(a,i,{get:()=>b[i],enumerable:!(h=e(b,i))||h.enumerable});return a})(d({},"__esModule",{value:!0}),h);var i=a.r(817547),j=a.r(236338)},92064,219636,a=>{"use strict";let b;a.s(["getSuggestions",()=>aa],92064);var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X=a.i(137936);a.i(155781);var Y=a.i(800717);a.i(118558);var Z=a.i(142238),$=a.i(527298);(0,Y.cache)(()=>(0,Z.createClient)());var _=a.i(713095);async function aa({documentId:a}){return await (0,$.getSuggestionsByDocumentId)({documentId:a})??[]}(0,_.ensureServerEntryExports)([aa]),(0,X.registerServerReference)(aa,"40a3d36627abd5814739c7249a840c4c1f52a42d51",null),a.s(["deleteChatSession",()=>id,"deleteTrailingMessages",()=>ia,"saveChatModelAsCookie",()=>h7,"updateChatTitle",()=>ic],219636);var ab="vercel.ai.error",ac=Symbol.for(ab),ad=class a extends Error{constructor({name:a,message:b,cause:d}){super(b),this[c]=!0,this.name=a,this.cause=d}static isInstance(b){return a.hasMarker(b,ab)}static hasMarker(a,b){let c=Symbol.for(b);return null!=a&&"object"==typeof a&&c in a&&"boolean"==typeof a[c]&&!0===a[c]}};c=ac;var ae=ad,af="AI_APICallError",ag=`vercel.ai.error.${af}`,ah=Symbol.for(ag),ai=class extends ae{constructor({message:a,url:b,requestBodyValues:c,statusCode:e,responseHeaders:f,responseBody:g,cause:h,isRetryable:i=null!=e&&(408===e||409===e||429===e||e>=500),data:j}){super({name:af,message:a,cause:h}),this[d]=!0,this.url=b,this.requestBodyValues=c,this.statusCode=e,this.responseHeaders=f,this.responseBody=g,this.isRetryable=i,this.data=j}static isInstance(a){return ae.hasMarker(a,ag)}};d=ah;var aj="AI_EmptyResponseBodyError",ak=`vercel.ai.error.${aj}`,al=Symbol.for(ak),am=class extends ae{constructor({message:a="Empty response body"}={}){super({name:aj,message:a}),this[e]=!0}static isInstance(a){return ae.hasMarker(a,ak)}};function an(a){return null==a?"unknown error":"string"==typeof a?a:a instanceof Error?a.message:JSON.stringify(a)}e=al;var ao="AI_InvalidArgumentError",ap=`vercel.ai.error.${ao}`,aq=Symbol.for(ap),ar=class extends ae{constructor({message:a,cause:b,argument:c}){super({name:ao,message:a,cause:b}),this[f]=!0,this.argument=c}static isInstance(a){return ae.hasMarker(a,ap)}};f=aq;var as="AI_InvalidPromptError",at=`vercel.ai.error.${as}`,au=Symbol.for(at),av=class extends ae{constructor({prompt:a,message:b,cause:c}){super({name:as,message:`Invalid prompt: ${b}`,cause:c}),this[g]=!0,this.prompt=a}static isInstance(a){return ae.hasMarker(a,at)}};g=au,Symbol.for("vercel.ai.error.AI_InvalidResponseDataError");var aw="AI_JSONParseError",ax=`vercel.ai.error.${aw}`,ay=Symbol.for(ax),az=class extends ae{constructor({text:a,cause:b}){super({name:aw,message:`JSON parsing failed: Text: ${a}.
Error message: ${an(b)}`,cause:b}),this[h]=!0,this.text=a}static isInstance(a){return ae.hasMarker(a,ax)}};h=ay,Symbol.for("vercel.ai.error.AI_LoadAPIKeyError"),Symbol.for("vercel.ai.error.AI_LoadSettingError"),Symbol.for("vercel.ai.error.AI_NoContentGeneratedError");var aA="AI_NoSuchModelError",aB=`vercel.ai.error.${aA}`,aC=Symbol.for(aB),aD=class extends ae{constructor({errorName:a=aA,modelId:b,modelType:c,message:d=`No such ${c}: ${b}`}){super({name:a,message:d}),this[i]=!0,this.modelId=b,this.modelType=c}static isInstance(a){return ae.hasMarker(a,aB)}};i=aC,Symbol.for("vercel.ai.error.AI_TooManyEmbeddingValuesForCallError");var aE="AI_TypeValidationError",aF=`vercel.ai.error.${aE}`,aG=Symbol.for(aF),aH=class a extends ae{constructor({value:a,cause:b}){super({name:aE,message:`Type validation failed: Value: ${JSON.stringify(a)}.
Error message: ${an(b)}`,cause:b}),this[j]=!0,this.value=a}static isInstance(a){return ae.hasMarker(a,aF)}static wrap({value:b,cause:c}){return a.isInstance(c)&&c.value===b?c:new a({value:b,cause:c})}};j=aG;var aI="AI_UnsupportedFunctionalityError",aJ=`vercel.ai.error.${aI}`,aK=Symbol.for(aJ),aL=class extends ae{constructor({functionality:a,message:b=`'${a}' functionality not supported.`}){super({name:aI,message:b}),this[k]=!0,this.functionality=a}static isInstance(a){return ae.hasMarker(a,aJ)}};function aM(a){return null===a||"string"==typeof a||"number"==typeof a||"boolean"==typeof a||(Array.isArray(a)?a.every(aM):"object"==typeof a&&Object.entries(a).every(([a,b])=>"string"==typeof a&&aM(b)))}function aN(a){return Array.isArray(a)&&a.every(aM)}function aO(a){return null!=a&&"object"==typeof a&&Object.entries(a).every(([a,b])=>"string"==typeof a&&aM(b))}k=aK;class aP extends Error{constructor(a,b){super(a),this.name="ParseError",this.type=b.type,this.field=b.field,this.value=b.value,this.line=b.line}}function aQ(a){}class aR extends TransformStream{constructor({onError:a,onRetry:b,onComment:c}={}){let d;super({start(e){d=function(a){if("function"==typeof a)throw TypeError("`callbacks` must be an object, got a function instead. Did you mean `{onEvent: fn}`?");let{onEvent:b=aQ,onError:c=aQ,onRetry:d=aQ,onComment:e}=a,f="",g=!0,h,i="",j="";function k(a){if(""===a)return void(i.length>0&&b({id:h,event:j||void 0,data:i.endsWith(`
`)?i.slice(0,-1):i}),h=void 0,i="",j="");if(a.startsWith(":")){e&&e(a.slice(a.startsWith(": ")?2:1));return}let c=a.indexOf(":");if(-1!==c){let b=a.slice(0,c),d=" "===a[c+1]?2:1;l(b,a.slice(c+d),a);return}l(a,"",a)}function l(a,b,e){switch(a){case"event":j=b;break;case"data":i=`${i}${b}
`;break;case"id":h=b.includes("\0")?void 0:b;break;case"retry":/^\d+$/.test(b)?d(parseInt(b,10)):c(new aP(`Invalid \`retry\` value: "${b}"`,{type:"invalid-retry",value:b,line:e}));break;default:c(new aP(`Unknown field "${a.length>20?`${a.slice(0,20)}\u2026`:a}"`,{type:"unknown-field",field:a,value:b,line:e}))}}return{feed:function(a){let b=g?a.replace(/^\xEF\xBB\xBF/,""):a,[c,d]=function(a){let b=[],c="",d=0;for(;d<a.length;){let e=a.indexOf("\r",d),f=a.indexOf(`
`,d),g=-1;if(-1!==e&&-1!==f?g=Math.min(e,f):-1!==e?g=e===a.length-1?-1:e:-1!==f&&(g=f),-1===g){c=a.slice(d);break}{let c=a.slice(d,g);b.push(c),"\r"===a[(d=g+1)-1]&&a[d]===`
`&&d++}}return[b,c]}(`${f}${b}`);for(let a of c)k(a);f=d,g=!1},reset:function(a={}){f&&a.consume&&k(f),g=!0,h=void 0,i="",j="",f=""}}}({onEvent:a=>{e.enqueue(a)},onError(b){"terminate"===a?e.error(b):"function"==typeof a&&a(b)},onRetry:b,onComment:c})},transform(a){d.feed(a)}})}}a.s(["default",()=>aT],353804),a.i(222157);var aS=a.i(954757);let aT=aS;var aU=a.i(373590);a.s([],991791),a.s(["getErrorMap",()=>a1,"setErrorMap",()=>a0],219115),a.s(["ZodError",()=>aZ,"ZodIssueCode",()=>aX,"quotelessJson",()=>aY],540366),a.s(["ZodParsedType",()=>aV,"getParsedType",()=>aW,"objectUtil",()=>m,"util",()=>l],580598),function(a){a.assertEqual=a=>{},a.assertIs=function(a){},a.assertNever=function(a){throw Error()},a.arrayToEnum=a=>{let b={};for(let c of a)b[c]=c;return b},a.getValidEnumValues=b=>{let c=a.objectKeys(b).filter(a=>"number"!=typeof b[b[a]]),d={};for(let a of c)d[a]=b[a];return a.objectValues(d)},a.objectValues=b=>a.objectKeys(b).map(function(a){return b[a]}),a.objectKeys="function"==typeof Object.keys?a=>Object.keys(a):a=>{let b=[];for(let c in a)Object.prototype.hasOwnProperty.call(a,c)&&b.push(c);return b},a.find=(a,b)=>{for(let c of a)if(b(c))return c},a.isInteger="function"==typeof Number.isInteger?a=>Number.isInteger(a):a=>"number"==typeof a&&Number.isFinite(a)&&Math.floor(a)===a,a.joinValues=function(a,b=" | "){return a.map(a=>"string"==typeof a?`'${a}'`:a).join(b)},a.jsonStringifyReplacer=(a,b)=>"bigint"==typeof b?b.toString():b}(l||(l={})),(m||(m={})).mergeShapes=(a,b)=>({...a,...b});let aV=l.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),aW=a=>{switch(typeof a){case"undefined":return aV.undefined;case"string":return aV.string;case"number":return Number.isNaN(a)?aV.nan:aV.number;case"boolean":return aV.boolean;case"function":return aV.function;case"bigint":return aV.bigint;case"symbol":return aV.symbol;case"object":if(Array.isArray(a))return aV.array;if(null===a)return aV.null;if(a.then&&"function"==typeof a.then&&a.catch&&"function"==typeof a.catch)return aV.promise;if("undefined"!=typeof Map&&a instanceof Map)return aV.map;if("undefined"!=typeof Set&&a instanceof Set)return aV.set;if("undefined"!=typeof Date&&a instanceof Date)return aV.date;return aV.object;default:return aV.unknown}},aX=l.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),aY=a=>JSON.stringify(a,null,2).replace(/"([^"]+)":/g,"$1:");class aZ extends Error{get errors(){return this.issues}constructor(a){super(),this.issues=[],this.addIssue=a=>{this.issues=[...this.issues,a]},this.addIssues=(a=[])=>{this.issues=[...this.issues,...a]};let b=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,b):this.__proto__=b,this.name="ZodError",this.issues=a}format(a){let b=a||function(a){return a.message},c={_errors:[]},d=a=>{for(let e of a.issues)if("invalid_union"===e.code)e.unionErrors.map(d);else if("invalid_return_type"===e.code)d(e.returnTypeError);else if("invalid_arguments"===e.code)d(e.argumentsError);else if(0===e.path.length)c._errors.push(b(e));else{let a=c,d=0;for(;d<e.path.length;){let c=e.path[d];d===e.path.length-1?(a[c]=a[c]||{_errors:[]},a[c]._errors.push(b(e))):a[c]=a[c]||{_errors:[]},a=a[c],d++}}};return d(this),c}static assert(a){if(!(a instanceof aZ))throw Error(`Not a ZodError: ${a}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,l.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(a=a=>a.message){let b=Object.create(null),c=[];for(let d of this.issues)if(d.path.length>0){let c=d.path[0];b[c]=b[c]||[],b[c].push(a(d))}else c.push(a(d));return{formErrors:c,fieldErrors:b}}get formErrors(){return this.flatten()}}aZ.create=a=>new aZ(a);let a$=(a,b)=>{let c;switch(a.code){case aX.invalid_type:c=a.received===aV.undefined?"Required":`Expected ${a.expected}, received ${a.received}`;break;case aX.invalid_literal:c=`Invalid literal value, expected ${JSON.stringify(a.expected,l.jsonStringifyReplacer)}`;break;case aX.unrecognized_keys:c=`Unrecognized key(s) in object: ${l.joinValues(a.keys,", ")}`;break;case aX.invalid_union:c="Invalid input";break;case aX.invalid_union_discriminator:c=`Invalid discriminator value. Expected ${l.joinValues(a.options)}`;break;case aX.invalid_enum_value:c=`Invalid enum value. Expected ${l.joinValues(a.options)}, received '${a.received}'`;break;case aX.invalid_arguments:c="Invalid function arguments";break;case aX.invalid_return_type:c="Invalid function return type";break;case aX.invalid_date:c="Invalid date";break;case aX.invalid_string:"object"==typeof a.validation?"includes"in a.validation?(c=`Invalid input: must include "${a.validation.includes}"`,"number"==typeof a.validation.position&&(c=`${c} at one or more positions greater than or equal to ${a.validation.position}`)):"startsWith"in a.validation?c=`Invalid input: must start with "${a.validation.startsWith}"`:"endsWith"in a.validation?c=`Invalid input: must end with "${a.validation.endsWith}"`:l.assertNever(a.validation):c="regex"!==a.validation?`Invalid ${a.validation}`:"Invalid";break;case aX.too_small:c="array"===a.type?`Array must contain ${a.exact?"exactly":a.inclusive?"at least":"more than"} ${a.minimum} element(s)`:"string"===a.type?`String must contain ${a.exact?"exactly":a.inclusive?"at least":"over"} ${a.minimum} character(s)`:"number"===a.type||"bigint"===a.type?`Number must be ${a.exact?"exactly equal to ":a.inclusive?"greater than or equal to ":"greater than "}${a.minimum}`:"date"===a.type?`Date must be ${a.exact?"exactly equal to ":a.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(a.minimum))}`:"Invalid input";break;case aX.too_big:c="array"===a.type?`Array must contain ${a.exact?"exactly":a.inclusive?"at most":"less than"} ${a.maximum} element(s)`:"string"===a.type?`String must contain ${a.exact?"exactly":a.inclusive?"at most":"under"} ${a.maximum} character(s)`:"number"===a.type?`Number must be ${a.exact?"exactly":a.inclusive?"less than or equal to":"less than"} ${a.maximum}`:"bigint"===a.type?`BigInt must be ${a.exact?"exactly":a.inclusive?"less than or equal to":"less than"} ${a.maximum}`:"date"===a.type?`Date must be ${a.exact?"exactly":a.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(a.maximum))}`:"Invalid input";break;case aX.custom:c="Invalid input";break;case aX.invalid_intersection_types:c="Intersection results could not be merged";break;case aX.not_multiple_of:c=`Number must be a multiple of ${a.multipleOf}`;break;case aX.not_finite:c="Number must be finite";break;default:c=b.defaultError,l.assertNever(a)}return{message:c}},a_=a$;function a0(a){a_=a}function a1(){return a_}a.s(["DIRTY",()=>a7,"EMPTY_PATH",()=>a3,"INVALID",()=>a6,"OK",()=>a8,"ParseStatus",()=>a5,"addIssueToContext",()=>a4,"isAborted",()=>a9,"isAsync",()=>bc,"isDirty",()=>ba,"isValid",()=>bb,"makeIssue",()=>a2],714810);let a2=a=>{let{data:b,path:c,errorMaps:d,issueData:e}=a,f=[...c,...e.path||[]],g={...e,path:f};if(void 0!==e.message)return{...e,path:f,message:e.message};let h="";for(let a of d.filter(a=>!!a).slice().reverse())h=a(g,{data:b,defaultError:h}).message;return{...e,path:f,message:h}},a3=[];function a4(a,b){let c=a_,d=a2({issueData:b,data:a.data,path:a.path,errorMaps:[a.common.contextualErrorMap,a.schemaErrorMap,c,c===a$?void 0:a$].filter(a=>!!a)});a.common.issues.push(d)}class a5{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(a,b){let c=[];for(let d of b){if("aborted"===d.status)return a6;"dirty"===d.status&&a.dirty(),c.push(d.value)}return{status:a.value,value:c}}static async mergeObjectAsync(a,b){let c=[];for(let a of b){let b=await a.key,d=await a.value;c.push({key:b,value:d})}return a5.mergeObjectSync(a,c)}static mergeObjectSync(a,b){let c={};for(let d of b){let{key:b,value:e}=d;if("aborted"===b.status||"aborted"===e.status)return a6;"dirty"===b.status&&a.dirty(),"dirty"===e.status&&a.dirty(),"__proto__"!==b.value&&(void 0!==e.value||d.alwaysSet)&&(c[b.value]=e.value)}return{status:a.value,value:c}}}let a6=Object.freeze({status:"aborted"}),a7=a=>({status:"dirty",value:a}),a8=a=>({status:"valid",value:a}),a9=a=>"aborted"===a.status,ba=a=>"dirty"===a.status,bb=a=>"valid"===a.status,bc=a=>"undefined"!=typeof Promise&&a instanceof Promise;a.s([],797100),a.s(["BRAND",()=>b6,"NEVER",()=>cQ,"Schema",()=>bg,"ZodAny",()=>bH,"ZodArray",()=>bL,"ZodBigInt",()=>bB,"ZodBoolean",()=>bC,"ZodBranded",()=>b7,"ZodCatch",()=>b4,"ZodDate",()=>bD,"ZodDefault",()=>b3,"ZodDiscriminatedUnion",()=>bP,"ZodEffects",()=>b0,"ZodEnum",()=>bZ,"ZodFirstPartyTypeKind",()=>o,"ZodFunction",()=>bV,"ZodIntersection",()=>bQ,"ZodLazy",()=>bW,"ZodLiteral",()=>bX,"ZodMap",()=>bT,"ZodNaN",()=>b5,"ZodNativeEnum",()=>b$,"ZodNever",()=>bJ,"ZodNull",()=>bG,"ZodNullable",()=>b2,"ZodNumber",()=>bA,"ZodObject",()=>bM,"ZodOptional",()=>b1,"ZodPipeline",()=>b8,"ZodPromise",()=>b_,"ZodReadonly",()=>b9,"ZodRecord",()=>bS,"ZodSchema",()=>bg,"ZodSet",()=>bU,"ZodString",()=>bz,"ZodSymbol",()=>bE,"ZodTransformer",()=>b0,"ZodTuple",()=>bR,"ZodType",()=>bg,"ZodUndefined",()=>bF,"ZodUnion",()=>bN,"ZodUnknown",()=>bI,"ZodVoid",()=>bK,"any",()=>cn,"array",()=>cr,"bigint",()=>ch,"boolean",()=>ci,"coerce",()=>cP,"custom",()=>cb,"date",()=>cj,"datetimeRegex",()=>by,"discriminatedUnion",()=>cv,"effect",()=>cH,"enum",()=>cE,"function",()=>cB,"instanceof",()=>cd,"intersection",()=>cw,"late",()=>cc,"lazy",()=>cC,"literal",()=>cD,"map",()=>cz,"nan",()=>cg,"nativeEnum",()=>cF,"never",()=>cp,"null",()=>cm,"nullable",()=>cJ,"number",()=>cf,"object",()=>cs,"oboolean",()=>cO,"onumber",()=>cN,"optional",()=>cI,"ostring",()=>cM,"pipeline",()=>cL,"preprocess",()=>cK,"promise",()=>cG,"record",()=>cy,"set",()=>cA,"strictObject",()=>ct,"string",()=>ce,"symbol",()=>ck,"transformer",()=>cH,"tuple",()=>cx,"undefined",()=>cl,"union",()=>cu,"unknown",()=>co,"void",()=>cq],590455),function(a){a.errToObj=a=>"string"==typeof a?{message:a}:a||{},a.toString=a=>"string"==typeof a?a:a?.message}(n||(n={}));class bd{constructor(a,b,c,d){this._cachedPath=[],this.parent=a,this.data=b,this._path=c,this._key=d}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}let be=(a,b)=>{if(bb(b))return{success:!0,data:b.value};if(!a.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let b=new aZ(a.common.issues);return this._error=b,this._error}}};function bf(a){if(!a)return{};let{errorMap:b,invalid_type_error:c,required_error:d,description:e}=a;if(b&&(c||d))throw Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return b?{errorMap:b,description:e}:{errorMap:(b,e)=>{let{message:f}=a;return"invalid_enum_value"===b.code?{message:f??e.defaultError}:void 0===e.data?{message:f??d??e.defaultError}:"invalid_type"!==b.code?{message:e.defaultError}:{message:f??c??e.defaultError}},description:e}}class bg{get description(){return this._def.description}_getType(a){return aW(a.data)}_getOrReturnCtx(a,b){return b||{common:a.parent.common,data:a.data,parsedType:aW(a.data),schemaErrorMap:this._def.errorMap,path:a.path,parent:a.parent}}_processInputParams(a){return{status:new a5,ctx:{common:a.parent.common,data:a.data,parsedType:aW(a.data),schemaErrorMap:this._def.errorMap,path:a.path,parent:a.parent}}}_parseSync(a){let b=this._parse(a);if(bc(b))throw Error("Synchronous parse encountered promise.");return b}_parseAsync(a){return Promise.resolve(this._parse(a))}parse(a,b){let c=this.safeParse(a,b);if(c.success)return c.data;throw c.error}safeParse(a,b){let c={common:{issues:[],async:b?.async??!1,contextualErrorMap:b?.errorMap},path:b?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:a,parsedType:aW(a)},d=this._parseSync({data:a,path:c.path,parent:c});return be(c,d)}"~validate"(a){let b={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:a,parsedType:aW(a)};if(!this["~standard"].async)try{let c=this._parseSync({data:a,path:[],parent:b});return bb(c)?{value:c.value}:{issues:b.common.issues}}catch(a){a?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),b.common={issues:[],async:!0}}return this._parseAsync({data:a,path:[],parent:b}).then(a=>bb(a)?{value:a.value}:{issues:b.common.issues})}async parseAsync(a,b){let c=await this.safeParseAsync(a,b);if(c.success)return c.data;throw c.error}async safeParseAsync(a,b){let c={common:{issues:[],contextualErrorMap:b?.errorMap,async:!0},path:b?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:a,parsedType:aW(a)},d=this._parse({data:a,path:c.path,parent:c});return be(c,await (bc(d)?d:Promise.resolve(d)))}refine(a,b){return this._refinement((c,d)=>{let e=a(c),f=()=>d.addIssue({code:aX.custom,..."string"==typeof b||void 0===b?{message:b}:"function"==typeof b?b(c):b});return"undefined"!=typeof Promise&&e instanceof Promise?e.then(a=>!!a||(f(),!1)):!!e||(f(),!1)})}refinement(a,b){return this._refinement((c,d)=>!!a(c)||(d.addIssue("function"==typeof b?b(c,d):b),!1))}_refinement(a){return new b0({schema:this,typeName:o.ZodEffects,effect:{type:"refinement",refinement:a}})}superRefine(a){return this._refinement(a)}constructor(a){this.spa=this.safeParseAsync,this._def=a,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:a=>this["~validate"](a)}}optional(){return b1.create(this,this._def)}nullable(){return b2.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return bL.create(this)}promise(){return b_.create(this,this._def)}or(a){return bN.create([this,a],this._def)}and(a){return bQ.create(this,a,this._def)}transform(a){return new b0({...bf(this._def),schema:this,typeName:o.ZodEffects,effect:{type:"transform",transform:a}})}default(a){return new b3({...bf(this._def),innerType:this,defaultValue:"function"==typeof a?a:()=>a,typeName:o.ZodDefault})}brand(){return new b7({typeName:o.ZodBranded,type:this,...bf(this._def)})}catch(a){return new b4({...bf(this._def),innerType:this,catchValue:"function"==typeof a?a:()=>a,typeName:o.ZodCatch})}describe(a){return new this.constructor({...this._def,description:a})}pipe(a){return b8.create(this,a)}readonly(){return b9.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}let bh=/^c[^\s-]{8,}$/i,bi=/^[0-9a-z]+$/,bj=/^[0-9A-HJKMNP-TV-Z]{26}$/i,bk=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,bl=/^[a-z0-9_-]{21}$/i,bm=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,bn=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,bo=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,bp=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,bq=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,br=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,bs=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,bt=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,bu=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,bv="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",bw=RegExp(`^${bv}$`);function bx(a){let b="[0-5]\\d";a.precision?b=`${b}\\.\\d{${a.precision}}`:null==a.precision&&(b=`${b}(\\.\\d+)?`);let c=a.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${b})${c}`}function by(a){let b=`${bv}T${bx(a)}`,c=[];return c.push(a.local?"Z?":"Z"),a.offset&&c.push("([+-]\\d{2}:?\\d{2})"),b=`${b}(${c.join("|")})`,RegExp(`^${b}$`)}class bz extends bg{_parse(a){var c,d,e,f;let g;if(this._def.coerce&&(a.data=String(a.data)),this._getType(a)!==aV.string){let b=this._getOrReturnCtx(a);return a4(b,{code:aX.invalid_type,expected:aV.string,received:b.parsedType}),a6}let h=new a5;for(let i of this._def.checks)if("min"===i.kind)a.data.length<i.value&&(a4(g=this._getOrReturnCtx(a,g),{code:aX.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),h.dirty());else if("max"===i.kind)a.data.length>i.value&&(a4(g=this._getOrReturnCtx(a,g),{code:aX.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),h.dirty());else if("length"===i.kind){let b=a.data.length>i.value,c=a.data.length<i.value;(b||c)&&(g=this._getOrReturnCtx(a,g),b?a4(g,{code:aX.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):c&&a4(g,{code:aX.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),h.dirty())}else if("email"===i.kind)bo.test(a.data)||(a4(g=this._getOrReturnCtx(a,g),{validation:"email",code:aX.invalid_string,message:i.message}),h.dirty());else if("emoji"===i.kind)b||(b=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),b.test(a.data)||(a4(g=this._getOrReturnCtx(a,g),{validation:"emoji",code:aX.invalid_string,message:i.message}),h.dirty());else if("uuid"===i.kind)bk.test(a.data)||(a4(g=this._getOrReturnCtx(a,g),{validation:"uuid",code:aX.invalid_string,message:i.message}),h.dirty());else if("nanoid"===i.kind)bl.test(a.data)||(a4(g=this._getOrReturnCtx(a,g),{validation:"nanoid",code:aX.invalid_string,message:i.message}),h.dirty());else if("cuid"===i.kind)bh.test(a.data)||(a4(g=this._getOrReturnCtx(a,g),{validation:"cuid",code:aX.invalid_string,message:i.message}),h.dirty());else if("cuid2"===i.kind)bi.test(a.data)||(a4(g=this._getOrReturnCtx(a,g),{validation:"cuid2",code:aX.invalid_string,message:i.message}),h.dirty());else if("ulid"===i.kind)bj.test(a.data)||(a4(g=this._getOrReturnCtx(a,g),{validation:"ulid",code:aX.invalid_string,message:i.message}),h.dirty());else if("url"===i.kind)try{new URL(a.data)}catch{a4(g=this._getOrReturnCtx(a,g),{validation:"url",code:aX.invalid_string,message:i.message}),h.dirty()}else"regex"===i.kind?(i.regex.lastIndex=0,i.regex.test(a.data)||(a4(g=this._getOrReturnCtx(a,g),{validation:"regex",code:aX.invalid_string,message:i.message}),h.dirty())):"trim"===i.kind?a.data=a.data.trim():"includes"===i.kind?a.data.includes(i.value,i.position)||(a4(g=this._getOrReturnCtx(a,g),{code:aX.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),h.dirty()):"toLowerCase"===i.kind?a.data=a.data.toLowerCase():"toUpperCase"===i.kind?a.data=a.data.toUpperCase():"startsWith"===i.kind?a.data.startsWith(i.value)||(a4(g=this._getOrReturnCtx(a,g),{code:aX.invalid_string,validation:{startsWith:i.value},message:i.message}),h.dirty()):"endsWith"===i.kind?a.data.endsWith(i.value)||(a4(g=this._getOrReturnCtx(a,g),{code:aX.invalid_string,validation:{endsWith:i.value},message:i.message}),h.dirty()):"datetime"===i.kind?by(i).test(a.data)||(a4(g=this._getOrReturnCtx(a,g),{code:aX.invalid_string,validation:"datetime",message:i.message}),h.dirty()):"date"===i.kind?bw.test(a.data)||(a4(g=this._getOrReturnCtx(a,g),{code:aX.invalid_string,validation:"date",message:i.message}),h.dirty()):"time"===i.kind?RegExp(`^${bx(i)}$`).test(a.data)||(a4(g=this._getOrReturnCtx(a,g),{code:aX.invalid_string,validation:"time",message:i.message}),h.dirty()):"duration"===i.kind?bn.test(a.data)||(a4(g=this._getOrReturnCtx(a,g),{validation:"duration",code:aX.invalid_string,message:i.message}),h.dirty()):"ip"===i.kind?(c=a.data,!(("v4"===(d=i.version)||!d)&&bp.test(c)||("v6"===d||!d)&&br.test(c))&&1&&(a4(g=this._getOrReturnCtx(a,g),{validation:"ip",code:aX.invalid_string,message:i.message}),h.dirty())):"jwt"===i.kind?!function(a,b){if(!bm.test(a))return!1;try{let[c]=a.split(".");if(!c)return!1;let d=c.replace(/-/g,"+").replace(/_/g,"/").padEnd(c.length+(4-c.length%4)%4,"="),e=JSON.parse(atob(d));if("object"!=typeof e||null===e||"typ"in e&&e?.typ!=="JWT"||!e.alg||b&&e.alg!==b)return!1;return!0}catch{return!1}}(a.data,i.alg)&&(a4(g=this._getOrReturnCtx(a,g),{validation:"jwt",code:aX.invalid_string,message:i.message}),h.dirty()):"cidr"===i.kind?(e=a.data,!(("v4"===(f=i.version)||!f)&&bq.test(e)||("v6"===f||!f)&&bs.test(e))&&1&&(a4(g=this._getOrReturnCtx(a,g),{validation:"cidr",code:aX.invalid_string,message:i.message}),h.dirty())):"base64"===i.kind?bt.test(a.data)||(a4(g=this._getOrReturnCtx(a,g),{validation:"base64",code:aX.invalid_string,message:i.message}),h.dirty()):"base64url"===i.kind?bu.test(a.data)||(a4(g=this._getOrReturnCtx(a,g),{validation:"base64url",code:aX.invalid_string,message:i.message}),h.dirty()):l.assertNever(i);return{status:h.value,value:a.data}}_regex(a,b,c){return this.refinement(b=>a.test(b),{validation:b,code:aX.invalid_string,...n.errToObj(c)})}_addCheck(a){return new bz({...this._def,checks:[...this._def.checks,a]})}email(a){return this._addCheck({kind:"email",...n.errToObj(a)})}url(a){return this._addCheck({kind:"url",...n.errToObj(a)})}emoji(a){return this._addCheck({kind:"emoji",...n.errToObj(a)})}uuid(a){return this._addCheck({kind:"uuid",...n.errToObj(a)})}nanoid(a){return this._addCheck({kind:"nanoid",...n.errToObj(a)})}cuid(a){return this._addCheck({kind:"cuid",...n.errToObj(a)})}cuid2(a){return this._addCheck({kind:"cuid2",...n.errToObj(a)})}ulid(a){return this._addCheck({kind:"ulid",...n.errToObj(a)})}base64(a){return this._addCheck({kind:"base64",...n.errToObj(a)})}base64url(a){return this._addCheck({kind:"base64url",...n.errToObj(a)})}jwt(a){return this._addCheck({kind:"jwt",...n.errToObj(a)})}ip(a){return this._addCheck({kind:"ip",...n.errToObj(a)})}cidr(a){return this._addCheck({kind:"cidr",...n.errToObj(a)})}datetime(a){return"string"==typeof a?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:a}):this._addCheck({kind:"datetime",precision:void 0===a?.precision?null:a?.precision,offset:a?.offset??!1,local:a?.local??!1,...n.errToObj(a?.message)})}date(a){return this._addCheck({kind:"date",message:a})}time(a){return"string"==typeof a?this._addCheck({kind:"time",precision:null,message:a}):this._addCheck({kind:"time",precision:void 0===a?.precision?null:a?.precision,...n.errToObj(a?.message)})}duration(a){return this._addCheck({kind:"duration",...n.errToObj(a)})}regex(a,b){return this._addCheck({kind:"regex",regex:a,...n.errToObj(b)})}includes(a,b){return this._addCheck({kind:"includes",value:a,position:b?.position,...n.errToObj(b?.message)})}startsWith(a,b){return this._addCheck({kind:"startsWith",value:a,...n.errToObj(b)})}endsWith(a,b){return this._addCheck({kind:"endsWith",value:a,...n.errToObj(b)})}min(a,b){return this._addCheck({kind:"min",value:a,...n.errToObj(b)})}max(a,b){return this._addCheck({kind:"max",value:a,...n.errToObj(b)})}length(a,b){return this._addCheck({kind:"length",value:a,...n.errToObj(b)})}nonempty(a){return this.min(1,n.errToObj(a))}trim(){return new bz({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new bz({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new bz({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(a=>"datetime"===a.kind)}get isDate(){return!!this._def.checks.find(a=>"date"===a.kind)}get isTime(){return!!this._def.checks.find(a=>"time"===a.kind)}get isDuration(){return!!this._def.checks.find(a=>"duration"===a.kind)}get isEmail(){return!!this._def.checks.find(a=>"email"===a.kind)}get isURL(){return!!this._def.checks.find(a=>"url"===a.kind)}get isEmoji(){return!!this._def.checks.find(a=>"emoji"===a.kind)}get isUUID(){return!!this._def.checks.find(a=>"uuid"===a.kind)}get isNANOID(){return!!this._def.checks.find(a=>"nanoid"===a.kind)}get isCUID(){return!!this._def.checks.find(a=>"cuid"===a.kind)}get isCUID2(){return!!this._def.checks.find(a=>"cuid2"===a.kind)}get isULID(){return!!this._def.checks.find(a=>"ulid"===a.kind)}get isIP(){return!!this._def.checks.find(a=>"ip"===a.kind)}get isCIDR(){return!!this._def.checks.find(a=>"cidr"===a.kind)}get isBase64(){return!!this._def.checks.find(a=>"base64"===a.kind)}get isBase64url(){return!!this._def.checks.find(a=>"base64url"===a.kind)}get minLength(){let a=null;for(let b of this._def.checks)"min"===b.kind&&(null===a||b.value>a)&&(a=b.value);return a}get maxLength(){let a=null;for(let b of this._def.checks)"max"===b.kind&&(null===a||b.value<a)&&(a=b.value);return a}}bz.create=a=>new bz({checks:[],typeName:o.ZodString,coerce:a?.coerce??!1,...bf(a)});class bA extends bg{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(a){let b;if(this._def.coerce&&(a.data=Number(a.data)),this._getType(a)!==aV.number){let b=this._getOrReturnCtx(a);return a4(b,{code:aX.invalid_type,expected:aV.number,received:b.parsedType}),a6}let c=new a5;for(let d of this._def.checks)"int"===d.kind?l.isInteger(a.data)||(a4(b=this._getOrReturnCtx(a,b),{code:aX.invalid_type,expected:"integer",received:"float",message:d.message}),c.dirty()):"min"===d.kind?(d.inclusive?a.data<d.value:a.data<=d.value)&&(a4(b=this._getOrReturnCtx(a,b),{code:aX.too_small,minimum:d.value,type:"number",inclusive:d.inclusive,exact:!1,message:d.message}),c.dirty()):"max"===d.kind?(d.inclusive?a.data>d.value:a.data>=d.value)&&(a4(b=this._getOrReturnCtx(a,b),{code:aX.too_big,maximum:d.value,type:"number",inclusive:d.inclusive,exact:!1,message:d.message}),c.dirty()):"multipleOf"===d.kind?0!==function(a,b){let c=(a.toString().split(".")[1]||"").length,d=(b.toString().split(".")[1]||"").length,e=c>d?c:d;return Number.parseInt(a.toFixed(e).replace(".",""))%Number.parseInt(b.toFixed(e).replace(".",""))/10**e}(a.data,d.value)&&(a4(b=this._getOrReturnCtx(a,b),{code:aX.not_multiple_of,multipleOf:d.value,message:d.message}),c.dirty()):"finite"===d.kind?Number.isFinite(a.data)||(a4(b=this._getOrReturnCtx(a,b),{code:aX.not_finite,message:d.message}),c.dirty()):l.assertNever(d);return{status:c.value,value:a.data}}gte(a,b){return this.setLimit("min",a,!0,n.toString(b))}gt(a,b){return this.setLimit("min",a,!1,n.toString(b))}lte(a,b){return this.setLimit("max",a,!0,n.toString(b))}lt(a,b){return this.setLimit("max",a,!1,n.toString(b))}setLimit(a,b,c,d){return new bA({...this._def,checks:[...this._def.checks,{kind:a,value:b,inclusive:c,message:n.toString(d)}]})}_addCheck(a){return new bA({...this._def,checks:[...this._def.checks,a]})}int(a){return this._addCheck({kind:"int",message:n.toString(a)})}positive(a){return this._addCheck({kind:"min",value:0,inclusive:!1,message:n.toString(a)})}negative(a){return this._addCheck({kind:"max",value:0,inclusive:!1,message:n.toString(a)})}nonpositive(a){return this._addCheck({kind:"max",value:0,inclusive:!0,message:n.toString(a)})}nonnegative(a){return this._addCheck({kind:"min",value:0,inclusive:!0,message:n.toString(a)})}multipleOf(a,b){return this._addCheck({kind:"multipleOf",value:a,message:n.toString(b)})}finite(a){return this._addCheck({kind:"finite",message:n.toString(a)})}safe(a){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:n.toString(a)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:n.toString(a)})}get minValue(){let a=null;for(let b of this._def.checks)"min"===b.kind&&(null===a||b.value>a)&&(a=b.value);return a}get maxValue(){let a=null;for(let b of this._def.checks)"max"===b.kind&&(null===a||b.value<a)&&(a=b.value);return a}get isInt(){return!!this._def.checks.find(a=>"int"===a.kind||"multipleOf"===a.kind&&l.isInteger(a.value))}get isFinite(){let a=null,b=null;for(let c of this._def.checks)if("finite"===c.kind||"int"===c.kind||"multipleOf"===c.kind)return!0;else"min"===c.kind?(null===b||c.value>b)&&(b=c.value):"max"===c.kind&&(null===a||c.value<a)&&(a=c.value);return Number.isFinite(b)&&Number.isFinite(a)}}bA.create=a=>new bA({checks:[],typeName:o.ZodNumber,coerce:a?.coerce||!1,...bf(a)});class bB extends bg{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(a){let b;if(this._def.coerce)try{a.data=BigInt(a.data)}catch{return this._getInvalidInput(a)}if(this._getType(a)!==aV.bigint)return this._getInvalidInput(a);let c=new a5;for(let d of this._def.checks)"min"===d.kind?(d.inclusive?a.data<d.value:a.data<=d.value)&&(a4(b=this._getOrReturnCtx(a,b),{code:aX.too_small,type:"bigint",minimum:d.value,inclusive:d.inclusive,message:d.message}),c.dirty()):"max"===d.kind?(d.inclusive?a.data>d.value:a.data>=d.value)&&(a4(b=this._getOrReturnCtx(a,b),{code:aX.too_big,type:"bigint",maximum:d.value,inclusive:d.inclusive,message:d.message}),c.dirty()):"multipleOf"===d.kind?a.data%d.value!==BigInt(0)&&(a4(b=this._getOrReturnCtx(a,b),{code:aX.not_multiple_of,multipleOf:d.value,message:d.message}),c.dirty()):l.assertNever(d);return{status:c.value,value:a.data}}_getInvalidInput(a){let b=this._getOrReturnCtx(a);return a4(b,{code:aX.invalid_type,expected:aV.bigint,received:b.parsedType}),a6}gte(a,b){return this.setLimit("min",a,!0,n.toString(b))}gt(a,b){return this.setLimit("min",a,!1,n.toString(b))}lte(a,b){return this.setLimit("max",a,!0,n.toString(b))}lt(a,b){return this.setLimit("max",a,!1,n.toString(b))}setLimit(a,b,c,d){return new bB({...this._def,checks:[...this._def.checks,{kind:a,value:b,inclusive:c,message:n.toString(d)}]})}_addCheck(a){return new bB({...this._def,checks:[...this._def.checks,a]})}positive(a){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:n.toString(a)})}negative(a){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:n.toString(a)})}nonpositive(a){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:n.toString(a)})}nonnegative(a){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:n.toString(a)})}multipleOf(a,b){return this._addCheck({kind:"multipleOf",value:a,message:n.toString(b)})}get minValue(){let a=null;for(let b of this._def.checks)"min"===b.kind&&(null===a||b.value>a)&&(a=b.value);return a}get maxValue(){let a=null;for(let b of this._def.checks)"max"===b.kind&&(null===a||b.value<a)&&(a=b.value);return a}}bB.create=a=>new bB({checks:[],typeName:o.ZodBigInt,coerce:a?.coerce??!1,...bf(a)});class bC extends bg{_parse(a){if(this._def.coerce&&(a.data=!!a.data),this._getType(a)!==aV.boolean){let b=this._getOrReturnCtx(a);return a4(b,{code:aX.invalid_type,expected:aV.boolean,received:b.parsedType}),a6}return a8(a.data)}}bC.create=a=>new bC({typeName:o.ZodBoolean,coerce:a?.coerce||!1,...bf(a)});class bD extends bg{_parse(a){let b;if(this._def.coerce&&(a.data=new Date(a.data)),this._getType(a)!==aV.date){let b=this._getOrReturnCtx(a);return a4(b,{code:aX.invalid_type,expected:aV.date,received:b.parsedType}),a6}if(Number.isNaN(a.data.getTime()))return a4(this._getOrReturnCtx(a),{code:aX.invalid_date}),a6;let c=new a5;for(let d of this._def.checks)"min"===d.kind?a.data.getTime()<d.value&&(a4(b=this._getOrReturnCtx(a,b),{code:aX.too_small,message:d.message,inclusive:!0,exact:!1,minimum:d.value,type:"date"}),c.dirty()):"max"===d.kind?a.data.getTime()>d.value&&(a4(b=this._getOrReturnCtx(a,b),{code:aX.too_big,message:d.message,inclusive:!0,exact:!1,maximum:d.value,type:"date"}),c.dirty()):l.assertNever(d);return{status:c.value,value:new Date(a.data.getTime())}}_addCheck(a){return new bD({...this._def,checks:[...this._def.checks,a]})}min(a,b){return this._addCheck({kind:"min",value:a.getTime(),message:n.toString(b)})}max(a,b){return this._addCheck({kind:"max",value:a.getTime(),message:n.toString(b)})}get minDate(){let a=null;for(let b of this._def.checks)"min"===b.kind&&(null===a||b.value>a)&&(a=b.value);return null!=a?new Date(a):null}get maxDate(){let a=null;for(let b of this._def.checks)"max"===b.kind&&(null===a||b.value<a)&&(a=b.value);return null!=a?new Date(a):null}}bD.create=a=>new bD({checks:[],coerce:a?.coerce||!1,typeName:o.ZodDate,...bf(a)});class bE extends bg{_parse(a){if(this._getType(a)!==aV.symbol){let b=this._getOrReturnCtx(a);return a4(b,{code:aX.invalid_type,expected:aV.symbol,received:b.parsedType}),a6}return a8(a.data)}}bE.create=a=>new bE({typeName:o.ZodSymbol,...bf(a)});class bF extends bg{_parse(a){if(this._getType(a)!==aV.undefined){let b=this._getOrReturnCtx(a);return a4(b,{code:aX.invalid_type,expected:aV.undefined,received:b.parsedType}),a6}return a8(a.data)}}bF.create=a=>new bF({typeName:o.ZodUndefined,...bf(a)});class bG extends bg{_parse(a){if(this._getType(a)!==aV.null){let b=this._getOrReturnCtx(a);return a4(b,{code:aX.invalid_type,expected:aV.null,received:b.parsedType}),a6}return a8(a.data)}}bG.create=a=>new bG({typeName:o.ZodNull,...bf(a)});class bH extends bg{constructor(){super(...arguments),this._any=!0}_parse(a){return a8(a.data)}}bH.create=a=>new bH({typeName:o.ZodAny,...bf(a)});class bI extends bg{constructor(){super(...arguments),this._unknown=!0}_parse(a){return a8(a.data)}}bI.create=a=>new bI({typeName:o.ZodUnknown,...bf(a)});class bJ extends bg{_parse(a){let b=this._getOrReturnCtx(a);return a4(b,{code:aX.invalid_type,expected:aV.never,received:b.parsedType}),a6}}bJ.create=a=>new bJ({typeName:o.ZodNever,...bf(a)});class bK extends bg{_parse(a){if(this._getType(a)!==aV.undefined){let b=this._getOrReturnCtx(a);return a4(b,{code:aX.invalid_type,expected:aV.void,received:b.parsedType}),a6}return a8(a.data)}}bK.create=a=>new bK({typeName:o.ZodVoid,...bf(a)});class bL extends bg{_parse(a){let{ctx:b,status:c}=this._processInputParams(a),d=this._def;if(b.parsedType!==aV.array)return a4(b,{code:aX.invalid_type,expected:aV.array,received:b.parsedType}),a6;if(null!==d.exactLength){let a=b.data.length>d.exactLength.value,e=b.data.length<d.exactLength.value;(a||e)&&(a4(b,{code:a?aX.too_big:aX.too_small,minimum:e?d.exactLength.value:void 0,maximum:a?d.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:d.exactLength.message}),c.dirty())}if(null!==d.minLength&&b.data.length<d.minLength.value&&(a4(b,{code:aX.too_small,minimum:d.minLength.value,type:"array",inclusive:!0,exact:!1,message:d.minLength.message}),c.dirty()),null!==d.maxLength&&b.data.length>d.maxLength.value&&(a4(b,{code:aX.too_big,maximum:d.maxLength.value,type:"array",inclusive:!0,exact:!1,message:d.maxLength.message}),c.dirty()),b.common.async)return Promise.all([...b.data].map((a,c)=>d.type._parseAsync(new bd(b,a,b.path,c)))).then(a=>a5.mergeArray(c,a));let e=[...b.data].map((a,c)=>d.type._parseSync(new bd(b,a,b.path,c)));return a5.mergeArray(c,e)}get element(){return this._def.type}min(a,b){return new bL({...this._def,minLength:{value:a,message:n.toString(b)}})}max(a,b){return new bL({...this._def,maxLength:{value:a,message:n.toString(b)}})}length(a,b){return new bL({...this._def,exactLength:{value:a,message:n.toString(b)}})}nonempty(a){return this.min(1,a)}}bL.create=(a,b)=>new bL({type:a,minLength:null,maxLength:null,exactLength:null,typeName:o.ZodArray,...bf(b)});class bM extends bg{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;let a=this._def.shape(),b=l.objectKeys(a);return this._cached={shape:a,keys:b},this._cached}_parse(a){if(this._getType(a)!==aV.object){let b=this._getOrReturnCtx(a);return a4(b,{code:aX.invalid_type,expected:aV.object,received:b.parsedType}),a6}let{status:b,ctx:c}=this._processInputParams(a),{shape:d,keys:e}=this._getCached(),f=[];if(!(this._def.catchall instanceof bJ&&"strip"===this._def.unknownKeys))for(let a in c.data)e.includes(a)||f.push(a);let g=[];for(let a of e){let b=d[a],e=c.data[a];g.push({key:{status:"valid",value:a},value:b._parse(new bd(c,e,c.path,a)),alwaysSet:a in c.data})}if(this._def.catchall instanceof bJ){let a=this._def.unknownKeys;if("passthrough"===a)for(let a of f)g.push({key:{status:"valid",value:a},value:{status:"valid",value:c.data[a]}});else if("strict"===a)f.length>0&&(a4(c,{code:aX.unrecognized_keys,keys:f}),b.dirty());else if("strip"===a);else throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let a=this._def.catchall;for(let b of f){let d=c.data[b];g.push({key:{status:"valid",value:b},value:a._parse(new bd(c,d,c.path,b)),alwaysSet:b in c.data})}}return c.common.async?Promise.resolve().then(async()=>{let a=[];for(let b of g){let c=await b.key,d=await b.value;a.push({key:c,value:d,alwaysSet:b.alwaysSet})}return a}).then(a=>a5.mergeObjectSync(b,a)):a5.mergeObjectSync(b,g)}get shape(){return this._def.shape()}strict(a){return n.errToObj,new bM({...this._def,unknownKeys:"strict",...void 0!==a?{errorMap:(b,c)=>{let d=this._def.errorMap?.(b,c).message??c.defaultError;return"unrecognized_keys"===b.code?{message:n.errToObj(a).message??d}:{message:d}}}:{}})}strip(){return new bM({...this._def,unknownKeys:"strip"})}passthrough(){return new bM({...this._def,unknownKeys:"passthrough"})}extend(a){return new bM({...this._def,shape:()=>({...this._def.shape(),...a})})}merge(a){return new bM({unknownKeys:a._def.unknownKeys,catchall:a._def.catchall,shape:()=>({...this._def.shape(),...a._def.shape()}),typeName:o.ZodObject})}setKey(a,b){return this.augment({[a]:b})}catchall(a){return new bM({...this._def,catchall:a})}pick(a){let b={};for(let c of l.objectKeys(a))a[c]&&this.shape[c]&&(b[c]=this.shape[c]);return new bM({...this._def,shape:()=>b})}omit(a){let b={};for(let c of l.objectKeys(this.shape))a[c]||(b[c]=this.shape[c]);return new bM({...this._def,shape:()=>b})}deepPartial(){return function a(b){if(b instanceof bM){let c={};for(let d in b.shape){let e=b.shape[d];c[d]=b1.create(a(e))}return new bM({...b._def,shape:()=>c})}if(b instanceof bL)return new bL({...b._def,type:a(b.element)});if(b instanceof b1)return b1.create(a(b.unwrap()));if(b instanceof b2)return b2.create(a(b.unwrap()));if(b instanceof bR)return bR.create(b.items.map(b=>a(b)));else return b}(this)}partial(a){let b={};for(let c of l.objectKeys(this.shape)){let d=this.shape[c];a&&!a[c]?b[c]=d:b[c]=d.optional()}return new bM({...this._def,shape:()=>b})}required(a){let b={};for(let c of l.objectKeys(this.shape))if(a&&!a[c])b[c]=this.shape[c];else{let a=this.shape[c];for(;a instanceof b1;)a=a._def.innerType;b[c]=a}return new bM({...this._def,shape:()=>b})}keyof(){return bY(l.objectKeys(this.shape))}}bM.create=(a,b)=>new bM({shape:()=>a,unknownKeys:"strip",catchall:bJ.create(),typeName:o.ZodObject,...bf(b)}),bM.strictCreate=(a,b)=>new bM({shape:()=>a,unknownKeys:"strict",catchall:bJ.create(),typeName:o.ZodObject,...bf(b)}),bM.lazycreate=(a,b)=>new bM({shape:a,unknownKeys:"strip",catchall:bJ.create(),typeName:o.ZodObject,...bf(b)});class bN extends bg{_parse(a){let{ctx:b}=this._processInputParams(a),c=this._def.options;if(b.common.async)return Promise.all(c.map(async a=>{let c={...b,common:{...b.common,issues:[]},parent:null};return{result:await a._parseAsync({data:b.data,path:b.path,parent:c}),ctx:c}})).then(function(a){for(let b of a)if("valid"===b.result.status)return b.result;for(let c of a)if("dirty"===c.result.status)return b.common.issues.push(...c.ctx.common.issues),c.result;let c=a.map(a=>new aZ(a.ctx.common.issues));return a4(b,{code:aX.invalid_union,unionErrors:c}),a6});{let a,d=[];for(let e of c){let c={...b,common:{...b.common,issues:[]},parent:null},f=e._parseSync({data:b.data,path:b.path,parent:c});if("valid"===f.status)return f;"dirty"!==f.status||a||(a={result:f,ctx:c}),c.common.issues.length&&d.push(c.common.issues)}if(a)return b.common.issues.push(...a.ctx.common.issues),a.result;let e=d.map(a=>new aZ(a));return a4(b,{code:aX.invalid_union,unionErrors:e}),a6}}get options(){return this._def.options}}bN.create=(a,b)=>new bN({options:a,typeName:o.ZodUnion,...bf(b)});let bO=a=>{if(a instanceof bW)return bO(a.schema);if(a instanceof b0)return bO(a.innerType());if(a instanceof bX)return[a.value];if(a instanceof bZ)return a.options;if(a instanceof b$)return l.objectValues(a.enum);else if(a instanceof b3)return bO(a._def.innerType);else if(a instanceof bF)return[void 0];else if(a instanceof bG)return[null];else if(a instanceof b1)return[void 0,...bO(a.unwrap())];else if(a instanceof b2)return[null,...bO(a.unwrap())];else if(a instanceof b7)return bO(a.unwrap());else if(a instanceof b9)return bO(a.unwrap());else if(a instanceof b4)return bO(a._def.innerType);else return[]};class bP extends bg{_parse(a){let{ctx:b}=this._processInputParams(a);if(b.parsedType!==aV.object)return a4(b,{code:aX.invalid_type,expected:aV.object,received:b.parsedType}),a6;let c=this.discriminator,d=b.data[c],e=this.optionsMap.get(d);return e?b.common.async?e._parseAsync({data:b.data,path:b.path,parent:b}):e._parseSync({data:b.data,path:b.path,parent:b}):(a4(b,{code:aX.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[c]}),a6)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(a,b,c){let d=new Map;for(let c of b){let b=bO(c.shape[a]);if(!b.length)throw Error(`A discriminator value for key \`${a}\` could not be extracted from all schema options`);for(let e of b){if(d.has(e))throw Error(`Discriminator property ${String(a)} has duplicate value ${String(e)}`);d.set(e,c)}}return new bP({typeName:o.ZodDiscriminatedUnion,discriminator:a,options:b,optionsMap:d,...bf(c)})}}class bQ extends bg{_parse(a){let{status:b,ctx:c}=this._processInputParams(a),d=(a,d)=>{if(a9(a)||a9(d))return a6;let e=function a(b,c){let d=aW(b),e=aW(c);if(b===c)return{valid:!0,data:b};if(d===aV.object&&e===aV.object){let d=l.objectKeys(c),e=l.objectKeys(b).filter(a=>-1!==d.indexOf(a)),f={...b,...c};for(let d of e){let e=a(b[d],c[d]);if(!e.valid)return{valid:!1};f[d]=e.data}return{valid:!0,data:f}}if(d===aV.array&&e===aV.array){if(b.length!==c.length)return{valid:!1};let d=[];for(let e=0;e<b.length;e++){let f=a(b[e],c[e]);if(!f.valid)return{valid:!1};d.push(f.data)}return{valid:!0,data:d}}if(d===aV.date&&e===aV.date&&+b==+c)return{valid:!0,data:b};return{valid:!1}}(a.value,d.value);return e.valid?((ba(a)||ba(d))&&b.dirty(),{status:b.value,value:e.data}):(a4(c,{code:aX.invalid_intersection_types}),a6)};return c.common.async?Promise.all([this._def.left._parseAsync({data:c.data,path:c.path,parent:c}),this._def.right._parseAsync({data:c.data,path:c.path,parent:c})]).then(([a,b])=>d(a,b)):d(this._def.left._parseSync({data:c.data,path:c.path,parent:c}),this._def.right._parseSync({data:c.data,path:c.path,parent:c}))}}bQ.create=(a,b,c)=>new bQ({left:a,right:b,typeName:o.ZodIntersection,...bf(c)});class bR extends bg{_parse(a){let{status:b,ctx:c}=this._processInputParams(a);if(c.parsedType!==aV.array)return a4(c,{code:aX.invalid_type,expected:aV.array,received:c.parsedType}),a6;if(c.data.length<this._def.items.length)return a4(c,{code:aX.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),a6;!this._def.rest&&c.data.length>this._def.items.length&&(a4(c,{code:aX.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),b.dirty());let d=[...c.data].map((a,b)=>{let d=this._def.items[b]||this._def.rest;return d?d._parse(new bd(c,a,c.path,b)):null}).filter(a=>!!a);return c.common.async?Promise.all(d).then(a=>a5.mergeArray(b,a)):a5.mergeArray(b,d)}get items(){return this._def.items}rest(a){return new bR({...this._def,rest:a})}}bR.create=(a,b)=>{if(!Array.isArray(a))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new bR({items:a,typeName:o.ZodTuple,rest:null,...bf(b)})};class bS extends bg{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(a){let{status:b,ctx:c}=this._processInputParams(a);if(c.parsedType!==aV.object)return a4(c,{code:aX.invalid_type,expected:aV.object,received:c.parsedType}),a6;let d=[],e=this._def.keyType,f=this._def.valueType;for(let a in c.data)d.push({key:e._parse(new bd(c,a,c.path,a)),value:f._parse(new bd(c,c.data[a],c.path,a)),alwaysSet:a in c.data});return c.common.async?a5.mergeObjectAsync(b,d):a5.mergeObjectSync(b,d)}get element(){return this._def.valueType}static create(a,b,c){return new bS(b instanceof bg?{keyType:a,valueType:b,typeName:o.ZodRecord,...bf(c)}:{keyType:bz.create(),valueType:a,typeName:o.ZodRecord,...bf(b)})}}class bT extends bg{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(a){let{status:b,ctx:c}=this._processInputParams(a);if(c.parsedType!==aV.map)return a4(c,{code:aX.invalid_type,expected:aV.map,received:c.parsedType}),a6;let d=this._def.keyType,e=this._def.valueType,f=[...c.data.entries()].map(([a,b],f)=>({key:d._parse(new bd(c,a,c.path,[f,"key"])),value:e._parse(new bd(c,b,c.path,[f,"value"]))}));if(c.common.async){let a=new Map;return Promise.resolve().then(async()=>{for(let c of f){let d=await c.key,e=await c.value;if("aborted"===d.status||"aborted"===e.status)return a6;("dirty"===d.status||"dirty"===e.status)&&b.dirty(),a.set(d.value,e.value)}return{status:b.value,value:a}})}{let a=new Map;for(let c of f){let d=c.key,e=c.value;if("aborted"===d.status||"aborted"===e.status)return a6;("dirty"===d.status||"dirty"===e.status)&&b.dirty(),a.set(d.value,e.value)}return{status:b.value,value:a}}}}bT.create=(a,b,c)=>new bT({valueType:b,keyType:a,typeName:o.ZodMap,...bf(c)});class bU extends bg{_parse(a){let{status:b,ctx:c}=this._processInputParams(a);if(c.parsedType!==aV.set)return a4(c,{code:aX.invalid_type,expected:aV.set,received:c.parsedType}),a6;let d=this._def;null!==d.minSize&&c.data.size<d.minSize.value&&(a4(c,{code:aX.too_small,minimum:d.minSize.value,type:"set",inclusive:!0,exact:!1,message:d.minSize.message}),b.dirty()),null!==d.maxSize&&c.data.size>d.maxSize.value&&(a4(c,{code:aX.too_big,maximum:d.maxSize.value,type:"set",inclusive:!0,exact:!1,message:d.maxSize.message}),b.dirty());let e=this._def.valueType;function f(a){let c=new Set;for(let d of a){if("aborted"===d.status)return a6;"dirty"===d.status&&b.dirty(),c.add(d.value)}return{status:b.value,value:c}}let g=[...c.data.values()].map((a,b)=>e._parse(new bd(c,a,c.path,b)));return c.common.async?Promise.all(g).then(a=>f(a)):f(g)}min(a,b){return new bU({...this._def,minSize:{value:a,message:n.toString(b)}})}max(a,b){return new bU({...this._def,maxSize:{value:a,message:n.toString(b)}})}size(a,b){return this.min(a,b).max(a,b)}nonempty(a){return this.min(1,a)}}bU.create=(a,b)=>new bU({valueType:a,minSize:null,maxSize:null,typeName:o.ZodSet,...bf(b)});class bV extends bg{constructor(){super(...arguments),this.validate=this.implement}_parse(a){let{ctx:b}=this._processInputParams(a);if(b.parsedType!==aV.function)return a4(b,{code:aX.invalid_type,expected:aV.function,received:b.parsedType}),a6;function c(a,c){return a2({data:a,path:b.path,errorMaps:[b.common.contextualErrorMap,b.schemaErrorMap,a_,a$].filter(a=>!!a),issueData:{code:aX.invalid_arguments,argumentsError:c}})}function d(a,c){return a2({data:a,path:b.path,errorMaps:[b.common.contextualErrorMap,b.schemaErrorMap,a_,a$].filter(a=>!!a),issueData:{code:aX.invalid_return_type,returnTypeError:c}})}let e={errorMap:b.common.contextualErrorMap},f=b.data;if(this._def.returns instanceof b_){let a=this;return a8(async function(...b){let g=new aZ([]),h=await a._def.args.parseAsync(b,e).catch(a=>{throw g.addIssue(c(b,a)),g}),i=await Reflect.apply(f,this,h);return await a._def.returns._def.type.parseAsync(i,e).catch(a=>{throw g.addIssue(d(i,a)),g})})}{let a=this;return a8(function(...b){let g=a._def.args.safeParse(b,e);if(!g.success)throw new aZ([c(b,g.error)]);let h=Reflect.apply(f,this,g.data),i=a._def.returns.safeParse(h,e);if(!i.success)throw new aZ([d(h,i.error)]);return i.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...a){return new bV({...this._def,args:bR.create(a).rest(bI.create())})}returns(a){return new bV({...this._def,returns:a})}implement(a){return this.parse(a)}strictImplement(a){return this.parse(a)}static create(a,b,c){return new bV({args:a||bR.create([]).rest(bI.create()),returns:b||bI.create(),typeName:o.ZodFunction,...bf(c)})}}class bW extends bg{get schema(){return this._def.getter()}_parse(a){let{ctx:b}=this._processInputParams(a);return this._def.getter()._parse({data:b.data,path:b.path,parent:b})}}bW.create=(a,b)=>new bW({getter:a,typeName:o.ZodLazy,...bf(b)});class bX extends bg{_parse(a){if(a.data!==this._def.value){let b=this._getOrReturnCtx(a);return a4(b,{received:b.data,code:aX.invalid_literal,expected:this._def.value}),a6}return{status:"valid",value:a.data}}get value(){return this._def.value}}function bY(a,b){return new bZ({values:a,typeName:o.ZodEnum,...bf(b)})}bX.create=(a,b)=>new bX({value:a,typeName:o.ZodLiteral,...bf(b)});class bZ extends bg{_parse(a){if("string"!=typeof a.data){let b=this._getOrReturnCtx(a),c=this._def.values;return a4(b,{expected:l.joinValues(c),received:b.parsedType,code:aX.invalid_type}),a6}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(a.data)){let b=this._getOrReturnCtx(a),c=this._def.values;return a4(b,{received:b.data,code:aX.invalid_enum_value,options:c}),a6}return a8(a.data)}get options(){return this._def.values}get enum(){let a={};for(let b of this._def.values)a[b]=b;return a}get Values(){let a={};for(let b of this._def.values)a[b]=b;return a}get Enum(){let a={};for(let b of this._def.values)a[b]=b;return a}extract(a,b=this._def){return bZ.create(a,{...this._def,...b})}exclude(a,b=this._def){return bZ.create(this.options.filter(b=>!a.includes(b)),{...this._def,...b})}}bZ.create=bY;class b$ extends bg{_parse(a){let b=l.getValidEnumValues(this._def.values),c=this._getOrReturnCtx(a);if(c.parsedType!==aV.string&&c.parsedType!==aV.number){let a=l.objectValues(b);return a4(c,{expected:l.joinValues(a),received:c.parsedType,code:aX.invalid_type}),a6}if(this._cache||(this._cache=new Set(l.getValidEnumValues(this._def.values))),!this._cache.has(a.data)){let a=l.objectValues(b);return a4(c,{received:c.data,code:aX.invalid_enum_value,options:a}),a6}return a8(a.data)}get enum(){return this._def.values}}b$.create=(a,b)=>new b$({values:a,typeName:o.ZodNativeEnum,...bf(b)});class b_ extends bg{unwrap(){return this._def.type}_parse(a){let{ctx:b}=this._processInputParams(a);return b.parsedType!==aV.promise&&!1===b.common.async?(a4(b,{code:aX.invalid_type,expected:aV.promise,received:b.parsedType}),a6):a8((b.parsedType===aV.promise?b.data:Promise.resolve(b.data)).then(a=>this._def.type.parseAsync(a,{path:b.path,errorMap:b.common.contextualErrorMap})))}}b_.create=(a,b)=>new b_({type:a,typeName:o.ZodPromise,...bf(b)});class b0 extends bg{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===o.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(a){let{status:b,ctx:c}=this._processInputParams(a),d=this._def.effect||null,e={addIssue:a=>{a4(c,a),a.fatal?b.abort():b.dirty()},get path(){return c.path}};if(e.addIssue=e.addIssue.bind(e),"preprocess"===d.type){let a=d.transform(c.data,e);if(c.common.async)return Promise.resolve(a).then(async a=>{if("aborted"===b.value)return a6;let d=await this._def.schema._parseAsync({data:a,path:c.path,parent:c});return"aborted"===d.status?a6:"dirty"===d.status||"dirty"===b.value?a7(d.value):d});{if("aborted"===b.value)return a6;let d=this._def.schema._parseSync({data:a,path:c.path,parent:c});return"aborted"===d.status?a6:"dirty"===d.status||"dirty"===b.value?a7(d.value):d}}if("refinement"===d.type){let a=a=>{let b=d.refinement(a,e);if(c.common.async)return Promise.resolve(b);if(b instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return a};if(!1!==c.common.async)return this._def.schema._parseAsync({data:c.data,path:c.path,parent:c}).then(c=>"aborted"===c.status?a6:("dirty"===c.status&&b.dirty(),a(c.value).then(()=>({status:b.value,value:c.value}))));{let d=this._def.schema._parseSync({data:c.data,path:c.path,parent:c});return"aborted"===d.status?a6:("dirty"===d.status&&b.dirty(),a(d.value),{status:b.value,value:d.value})}}if("transform"===d.type)if(!1!==c.common.async)return this._def.schema._parseAsync({data:c.data,path:c.path,parent:c}).then(a=>bb(a)?Promise.resolve(d.transform(a.value,e)).then(a=>({status:b.value,value:a})):a6);else{let a=this._def.schema._parseSync({data:c.data,path:c.path,parent:c});if(!bb(a))return a6;let f=d.transform(a.value,e);if(f instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:b.value,value:f}}l.assertNever(d)}}b0.create=(a,b,c)=>new b0({schema:a,typeName:o.ZodEffects,effect:b,...bf(c)}),b0.createWithPreprocess=(a,b,c)=>new b0({schema:b,effect:{type:"preprocess",transform:a},typeName:o.ZodEffects,...bf(c)});class b1 extends bg{_parse(a){return this._getType(a)===aV.undefined?a8(void 0):this._def.innerType._parse(a)}unwrap(){return this._def.innerType}}b1.create=(a,b)=>new b1({innerType:a,typeName:o.ZodOptional,...bf(b)});class b2 extends bg{_parse(a){return this._getType(a)===aV.null?a8(null):this._def.innerType._parse(a)}unwrap(){return this._def.innerType}}b2.create=(a,b)=>new b2({innerType:a,typeName:o.ZodNullable,...bf(b)});class b3 extends bg{_parse(a){let{ctx:b}=this._processInputParams(a),c=b.data;return b.parsedType===aV.undefined&&(c=this._def.defaultValue()),this._def.innerType._parse({data:c,path:b.path,parent:b})}removeDefault(){return this._def.innerType}}b3.create=(a,b)=>new b3({innerType:a,typeName:o.ZodDefault,defaultValue:"function"==typeof b.default?b.default:()=>b.default,...bf(b)});class b4 extends bg{_parse(a){let{ctx:b}=this._processInputParams(a),c={...b,common:{...b.common,issues:[]}},d=this._def.innerType._parse({data:c.data,path:c.path,parent:{...c}});return bc(d)?d.then(a=>({status:"valid",value:"valid"===a.status?a.value:this._def.catchValue({get error(){return new aZ(c.common.issues)},input:c.data})})):{status:"valid",value:"valid"===d.status?d.value:this._def.catchValue({get error(){return new aZ(c.common.issues)},input:c.data})}}removeCatch(){return this._def.innerType}}b4.create=(a,b)=>new b4({innerType:a,typeName:o.ZodCatch,catchValue:"function"==typeof b.catch?b.catch:()=>b.catch,...bf(b)});class b5 extends bg{_parse(a){if(this._getType(a)!==aV.nan){let b=this._getOrReturnCtx(a);return a4(b,{code:aX.invalid_type,expected:aV.nan,received:b.parsedType}),a6}return{status:"valid",value:a.data}}}b5.create=a=>new b5({typeName:o.ZodNaN,...bf(a)});let b6=Symbol("zod_brand");class b7 extends bg{_parse(a){let{ctx:b}=this._processInputParams(a),c=b.data;return this._def.type._parse({data:c,path:b.path,parent:b})}unwrap(){return this._def.type}}class b8 extends bg{_parse(a){let{status:b,ctx:c}=this._processInputParams(a);if(c.common.async)return(async()=>{let a=await this._def.in._parseAsync({data:c.data,path:c.path,parent:c});return"aborted"===a.status?a6:"dirty"===a.status?(b.dirty(),a7(a.value)):this._def.out._parseAsync({data:a.value,path:c.path,parent:c})})();{let a=this._def.in._parseSync({data:c.data,path:c.path,parent:c});return"aborted"===a.status?a6:"dirty"===a.status?(b.dirty(),{status:"dirty",value:a.value}):this._def.out._parseSync({data:a.value,path:c.path,parent:c})}}static create(a,b){return new b8({in:a,out:b,typeName:o.ZodPipeline})}}class b9 extends bg{_parse(a){let b=this._def.innerType._parse(a),c=a=>(bb(a)&&(a.value=Object.freeze(a.value)),a);return bc(b)?b.then(a=>c(a)):c(b)}unwrap(){return this._def.innerType}}function ca(a,b){let c="function"==typeof a?a(b):"string"==typeof a?{message:a}:a;return"string"==typeof c?{message:c}:c}function cb(a,b={},c){return a?bH.create().superRefine((d,e)=>{let f=a(d);if(f instanceof Promise)return f.then(a=>{if(!a){let a=ca(b,d),f=a.fatal??c??!0;e.addIssue({code:"custom",...a,fatal:f})}});if(!f){let a=ca(b,d),f=a.fatal??c??!0;e.addIssue({code:"custom",...a,fatal:f})}}):bH.create()}b9.create=(a,b)=>new b9({innerType:a,typeName:o.ZodReadonly,...bf(b)});let cc={object:bM.lazycreate};!function(a){a.ZodString="ZodString",a.ZodNumber="ZodNumber",a.ZodNaN="ZodNaN",a.ZodBigInt="ZodBigInt",a.ZodBoolean="ZodBoolean",a.ZodDate="ZodDate",a.ZodSymbol="ZodSymbol",a.ZodUndefined="ZodUndefined",a.ZodNull="ZodNull",a.ZodAny="ZodAny",a.ZodUnknown="ZodUnknown",a.ZodNever="ZodNever",a.ZodVoid="ZodVoid",a.ZodArray="ZodArray",a.ZodObject="ZodObject",a.ZodUnion="ZodUnion",a.ZodDiscriminatedUnion="ZodDiscriminatedUnion",a.ZodIntersection="ZodIntersection",a.ZodTuple="ZodTuple",a.ZodRecord="ZodRecord",a.ZodMap="ZodMap",a.ZodSet="ZodSet",a.ZodFunction="ZodFunction",a.ZodLazy="ZodLazy",a.ZodLiteral="ZodLiteral",a.ZodEnum="ZodEnum",a.ZodEffects="ZodEffects",a.ZodNativeEnum="ZodNativeEnum",a.ZodOptional="ZodOptional",a.ZodNullable="ZodNullable",a.ZodDefault="ZodDefault",a.ZodCatch="ZodCatch",a.ZodPromise="ZodPromise",a.ZodBranded="ZodBranded",a.ZodPipeline="ZodPipeline",a.ZodReadonly="ZodReadonly"}(o||(o={}));let cd=(a,b={message:`Input not instance of ${a.name}`})=>cb(b=>b instanceof a,b),ce=bz.create,cf=bA.create,cg=b5.create,ch=bB.create,ci=bC.create,cj=bD.create,ck=bE.create,cl=bF.create,cm=bG.create,cn=bH.create,co=bI.create,cp=bJ.create,cq=bK.create,cr=bL.create,cs=bM.create,ct=bM.strictCreate,cu=bN.create,cv=bP.create,cw=bQ.create,cx=bR.create,cy=bS.create,cz=bT.create,cA=bU.create,cB=bV.create,cC=bW.create,cD=bX.create,cE=bZ.create,cF=b$.create,cG=b_.create,cH=b0.create,cI=b1.create,cJ=b2.create,cK=b0.createWithPreprocess,cL=b8.create,cM=()=>ce().optional(),cN=()=>cf().optional(),cO=()=>ci().optional(),cP={string:a=>bz.create({...a,coerce:!0}),number:a=>bA.create({...a,coerce:!0}),boolean:a=>bC.create({...a,coerce:!0}),bigint:a=>bB.create({...a,coerce:!0}),date:a=>bD.create({...a,coerce:!0})},cQ=a6;function cR(...a){return a.reduce((a,b)=>({...a,...null!=b?b:{}}),{})}function cS(a){return Object.fromEntries([...a.headers])}function cT(a){return(a instanceof Error||a instanceof DOMException)&&("AbortError"===a.name||"ResponseAborted"===a.name||"TimeoutError"===a.name)}a.s(["BRAND",()=>b6,"DIRTY",()=>a7,"EMPTY_PATH",()=>a3,"INVALID",()=>a6,"NEVER",()=>cQ,"OK",()=>a8,"ParseStatus",()=>a5,"Schema",()=>bg,"ZodAny",()=>bH,"ZodArray",()=>bL,"ZodBigInt",()=>bB,"ZodBoolean",()=>bC,"ZodBranded",()=>b7,"ZodCatch",()=>b4,"ZodDate",()=>bD,"ZodDefault",()=>b3,"ZodDiscriminatedUnion",()=>bP,"ZodEffects",()=>b0,"ZodEnum",()=>bZ,"ZodError",()=>aZ,"ZodFirstPartyTypeKind",()=>o,"ZodFunction",()=>bV,"ZodIntersection",()=>bQ,"ZodIssueCode",()=>aX,"ZodLazy",()=>bW,"ZodLiteral",()=>bX,"ZodMap",()=>bT,"ZodNaN",()=>b5,"ZodNativeEnum",()=>b$,"ZodNever",()=>bJ,"ZodNull",()=>bG,"ZodNullable",()=>b2,"ZodNumber",()=>bA,"ZodObject",()=>bM,"ZodOptional",()=>b1,"ZodParsedType",()=>aV,"ZodPipeline",()=>b8,"ZodPromise",()=>b_,"ZodReadonly",()=>b9,"ZodRecord",()=>bS,"ZodSchema",()=>bg,"ZodSet",()=>bU,"ZodString",()=>bz,"ZodSymbol",()=>bE,"ZodTransformer",()=>b0,"ZodTuple",()=>bR,"ZodType",()=>bg,"ZodUndefined",()=>bF,"ZodUnion",()=>bN,"ZodUnknown",()=>bI,"ZodVoid",()=>bK,"addIssueToContext",()=>a4,"any",()=>cn,"array",()=>cr,"bigint",()=>ch,"boolean",()=>ci,"coerce",()=>cP,"custom",()=>cb,"date",()=>cj,"datetimeRegex",()=>by,"defaultErrorMap",()=>a$,"discriminatedUnion",()=>cv,"effect",()=>cH,"enum",()=>cE,"function",()=>cB,"getErrorMap",()=>a1,"getParsedType",()=>aW,"instanceof",()=>cd,"intersection",()=>cw,"isAborted",()=>a9,"isAsync",()=>bc,"isDirty",()=>ba,"isValid",()=>bb,"late",()=>cc,"lazy",()=>cC,"literal",()=>cD,"makeIssue",()=>a2,"map",()=>cz,"nan",()=>cg,"nativeEnum",()=>cF,"never",()=>cp,"null",()=>cm,"nullable",()=>cJ,"number",()=>cf,"object",()=>cs,"objectUtil",()=>m,"oboolean",()=>cO,"onumber",()=>cN,"optional",()=>cI,"ostring",()=>cM,"pipeline",()=>cL,"preprocess",()=>cK,"promise",()=>cG,"quotelessJson",()=>aY,"record",()=>cy,"set",()=>cA,"setErrorMap",()=>a0,"strictObject",()=>ct,"string",()=>ce,"symbol",()=>ck,"transformer",()=>cH,"tuple",()=>cx,"undefined",()=>cl,"union",()=>cu,"unknown",()=>co,"util",()=>l,"void",()=>cq],737411),a.i(991791),a.s(["defaultErrorMap",()=>a$,"getErrorMap",()=>a1,"setErrorMap",()=>a0],711150),a.i(219115),a.i(711150),a.i(714810),a.i(797100),a.i(580598),a.i(590455),a.i(540366),a.i(737411),(({prefix:a,size:b=16,alphabet:c="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:d="-"}={})=>{if(null!=a){if(c.includes(d))throw new ar({argument:"separator",message:`The separator "${d}" must not be part of the alphabet "${c}".`});return()=>`${a}${d}${(()=>{let a=c.length,d=Array(b);for(let e=0;e<b;e++)d[e]=c[Math.random()*a|0];return d.join("")})()}`}})();var cU=["fetch failed","failed to fetch"];function cV({error:a,url:b,requestBodyValues:c}){if(cT(a))return a;if(a instanceof TypeError&&cU.includes(a.message.toLowerCase())){let d=a.cause;if(null!=d)return new ai({message:`Cannot connect to API: ${d.message}`,cause:d,url:b,requestBodyValues:c,isRetryable:!0})}return a}function cW(a=globalThis){var b,c,d;return a.window?"runtime/browser":(null==(b=a.navigator)?void 0:b.userAgent)?`runtime/${a.navigator.userAgent.toLowerCase()}`:(null==(d=null==(c=a.process)?void 0:c.versions)?void 0:d.node)?`runtime/node.js/${a.process.version.substring(0)}`:a.EdgeRuntime?"runtime/vercel-edge":"runtime/unknown"}function cX(a,...b){let c=new Headers(function(a){if(null==a)return{};let b={};if(a instanceof Headers)a.forEach((a,c)=>{b[c.toLowerCase()]=a});else for(let[c,d]of(Array.isArray(a)||(a=Object.entries(a)),a))null!=d&&(b[c.toLowerCase()]=d);return b}(a)),d=c.get("user-agent")||"";return c.set("user-agent",[d,...b].filter(Boolean).join(" ")),Object.fromEntries(c.entries())}var cY="3.0.17",cZ=()=>globalThis.fetch,c$=async({url:a,headers:b={},successfulResponseHandler:c,failedResponseHandler:d,abortSignal:e,fetch:f=cZ()})=>{try{let g=await f(a,{method:"GET",headers:cX(b,`ai-sdk/provider-utils/${cY}`,cW()),signal:e}),h=cS(g);if(!g.ok){let b;try{b=await d({response:g,url:a,requestBodyValues:{}})}catch(b){if(cT(b)||ai.isInstance(b))throw b;throw new ai({message:"Failed to process error response",cause:b,statusCode:g.status,url:a,responseHeaders:h,requestBodyValues:{}})}throw b.value}try{return await c({response:g,url:a,requestBodyValues:{}})}catch(b){if(b instanceof Error&&(cT(b)||ai.isInstance(b)))throw b;throw new ai({message:"Failed to process successful response",cause:b,statusCode:g.status,url:a,responseHeaders:h,requestBodyValues:{}})}}catch(b){throw cV({error:b,url:a,requestBodyValues:{}})}};function c_({settingValue:a,environmentVariableName:b}){return"string"==typeof a?a:null!=a||"undefined"==typeof process?void 0:null!=(a=process.env[b])&&"string"==typeof a?a:void 0}var c0=/"__proto__"\s*:/,c1=/"constructor"\s*:/;function c2(a){let b=JSON.parse(a);return null===b||"object"!=typeof b||!1===c0.test(a)&&!1===c1.test(a)?b:function(a){let b=[a];for(;b.length;){let a=b;for(let c of(b=[],a)){if(Object.prototype.hasOwnProperty.call(c,"__proto__")||Object.prototype.hasOwnProperty.call(c,"constructor")&&Object.prototype.hasOwnProperty.call(c.constructor,"prototype"))throw SyntaxError("Object contains forbidden prototype property");for(let a in c){let d=c[a];d&&"object"==typeof d&&b.push(d)}}}return a}(b)}function c3(a){let{stackTraceLimit:b}=Error;try{Error.stackTraceLimit=0}catch(b){return c2(a)}try{return c2(a)}finally{Error.stackTraceLimit=b}}var c4=Symbol.for("vercel.ai.validator");function c5(a){let b;return()=>(null==b&&(b=a()),b)}async function c6({value:a,schema:b}){let c=await c7({value:a,schema:b});if(!c.success)throw aH.wrap({value:a,cause:c.error});return c.value}async function c7({value:a,schema:b}){var c;let d="object"==typeof b&&null!==b&&c4 in b&&!0===b[c4]&&"validate"in b?b:"function"==typeof b?b():(c=b,{[c4]:!0,validate:async a=>{let b=await c["~standard"].validate(a);return null==b.issues?{success:!0,value:b.value}:{success:!1,error:new aH({value:a,cause:b.issues})}}});try{if(null==d.validate)return{success:!0,value:a,rawValue:a};let b=await d.validate(a);if(b.success)return{success:!0,value:b.value,rawValue:a};return{success:!1,error:aH.wrap({value:a,cause:b.error}),rawValue:a}}catch(b){return{success:!1,error:aH.wrap({value:a,cause:b}),rawValue:a}}}async function c8({text:a,schema:b}){try{let c=c3(a);if(null==b)return c;return c6({value:c,schema:b})}catch(b){if(az.isInstance(b)||aH.isInstance(b))throw b;throw new az({text:a,cause:b})}}async function c9({text:a,schema:b}){try{let c=c3(a);if(null==b)return{success:!0,value:c,rawValue:c};return await c7({value:c,schema:b})}catch(b){return{success:!1,error:az.isInstance(b)?b:new az({text:a,cause:b}),rawValue:void 0}}}var da=()=>globalThis.fetch,db=async({url:a,headers:b,body:c,failedResponseHandler:d,successfulResponseHandler:e,abortSignal:f,fetch:g})=>dc({url:a,headers:{"Content-Type":"application/json",...b},body:{content:JSON.stringify(c),values:c},failedResponseHandler:d,successfulResponseHandler:e,abortSignal:f,fetch:g}),dc=async({url:a,headers:b={},body:c,successfulResponseHandler:d,failedResponseHandler:e,abortSignal:f,fetch:g=da()})=>{try{let h=await g(a,{method:"POST",headers:cX(b,`ai-sdk/provider-utils/${cY}`,cW()),body:c.content,signal:f}),i=cS(h);if(!h.ok){let b;try{b=await e({response:h,url:a,requestBodyValues:c.values})}catch(b){if(cT(b)||ai.isInstance(b))throw b;throw new ai({message:"Failed to process error response",cause:b,statusCode:h.status,url:a,responseHeaders:i,requestBodyValues:c.values})}throw b.value}try{return await d({response:h,url:a,requestBodyValues:c.values})}catch(b){if(b instanceof Error&&(cT(b)||ai.isInstance(b)))throw b;throw new ai({message:"Failed to process successful response",cause:b,statusCode:h.status,url:a,responseHeaders:i,requestBodyValues:c.values})}}catch(b){throw cV({error:b,url:a,requestBodyValues:c.values})}};async function dd(a){return"function"==typeof a&&(a=a()),Promise.resolve(a)}var de=({errorSchema:a,errorToMessage:b,isRetryable:c})=>async({response:d,url:e,requestBodyValues:f})=>{let g=await d.text(),h=cS(d);if(""===g.trim())return{responseHeaders:h,value:new ai({message:d.statusText,url:e,requestBodyValues:f,statusCode:d.status,responseHeaders:h,responseBody:g,isRetryable:null==c?void 0:c(d)})};try{let i=await c8({text:g,schema:a});return{responseHeaders:h,value:new ai({message:b(i),url:e,requestBodyValues:f,statusCode:d.status,responseHeaders:h,responseBody:g,data:i,isRetryable:null==c?void 0:c(d,i)})}}catch(a){return{responseHeaders:h,value:new ai({message:d.statusText,url:e,requestBodyValues:f,statusCode:d.status,responseHeaders:h,responseBody:g,isRetryable:null==c?void 0:c(d)})}}},df=a=>async({response:b,url:c,requestBodyValues:d})=>{let e=await b.text(),f=await c9({text:e,schema:a}),g=cS(b);if(!f.success)throw new ai({message:"Invalid JSON response",cause:f.error,statusCode:b.status,responseHeaders:g,responseBody:e,url:c,requestBodyValues:d});return{responseHeaders:g,value:f.value,rawValue:f.rawValue}},dg=Symbol("Let zodToJsonSchema decide on which parser to use"),dh={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",strictUnions:!1,definitions:{},errorMessages:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"};function di(a,b){return du(a.type._def,b)}var dj=void 0,dk={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(void 0===dj&&(dj=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),dj),ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function dl(a,b){let c={type:"string"};if(a.checks)for(let d of a.checks)switch(d.kind){case"min":c.minLength="number"==typeof c.minLength?Math.max(c.minLength,d.value):d.value;break;case"max":c.maxLength="number"==typeof c.maxLength?Math.min(c.maxLength,d.value):d.value;break;case"email":switch(b.emailStrategy){case"format:email":dp(c,"email",d.message,b);break;case"format:idn-email":dp(c,"idn-email",d.message,b);break;case"pattern:zod":dq(c,dk.email,d.message,b)}break;case"url":dp(c,"uri",d.message,b);break;case"uuid":dp(c,"uuid",d.message,b);break;case"regex":dq(c,d.regex,d.message,b);break;case"cuid":dq(c,dk.cuid,d.message,b);break;case"cuid2":dq(c,dk.cuid2,d.message,b);break;case"startsWith":dq(c,RegExp(`^${dm(d.value,b)}`),d.message,b);break;case"endsWith":dq(c,RegExp(`${dm(d.value,b)}$`),d.message,b);break;case"datetime":dp(c,"date-time",d.message,b);break;case"date":dp(c,"date",d.message,b);break;case"time":dp(c,"time",d.message,b);break;case"duration":dp(c,"duration",d.message,b);break;case"length":c.minLength="number"==typeof c.minLength?Math.max(c.minLength,d.value):d.value,c.maxLength="number"==typeof c.maxLength?Math.min(c.maxLength,d.value):d.value;break;case"includes":dq(c,RegExp(dm(d.value,b)),d.message,b);break;case"ip":"v6"!==d.version&&dp(c,"ipv4",d.message,b),"v4"!==d.version&&dp(c,"ipv6",d.message,b);break;case"base64url":dq(c,dk.base64url,d.message,b);break;case"jwt":dq(c,dk.jwt,d.message,b);break;case"cidr":"v6"!==d.version&&dq(c,dk.ipv4Cidr,d.message,b),"v4"!==d.version&&dq(c,dk.ipv6Cidr,d.message,b);break;case"emoji":dq(c,dk.emoji(),d.message,b);break;case"ulid":dq(c,dk.ulid,d.message,b);break;case"base64":switch(b.base64Strategy){case"format:binary":dp(c,"binary",d.message,b);break;case"contentEncoding:base64":c.contentEncoding="base64";break;case"pattern:zod":dq(c,dk.base64,d.message,b)}break;case"nanoid":dq(c,dk.nanoid,d.message,b)}return c}function dm(a,b){return"escape"===b.patternStrategy?function(a){let b="";for(let c=0;c<a.length;c++)dn.has(a[c])||(b+="\\"),b+=a[c];return b}(a):a}var dn=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function dp(a,b,c,d){var e;a.format||(null==(e=a.anyOf)?void 0:e.some(a=>a.format))?(a.anyOf||(a.anyOf=[]),a.format&&(a.anyOf.push({format:a.format}),delete a.format),a.anyOf.push({format:b,...c&&d.errorMessages&&{errorMessage:{format:c}}})):a.format=b}function dq(a,b,c,d){var e;a.pattern||(null==(e=a.allOf)?void 0:e.some(a=>a.pattern))?(a.allOf||(a.allOf=[]),a.pattern&&(a.allOf.push({pattern:a.pattern}),delete a.pattern),a.allOf.push({pattern:dr(b,d),...c&&d.errorMessages&&{errorMessage:{pattern:c}}})):a.pattern=dr(b,d)}function dr(a,b){var c;if(!b.applyRegexFlags||!a.flags)return a.source;let d={i:a.flags.includes("i"),m:a.flags.includes("m"),s:a.flags.includes("s")},e=d.i?a.source.toLowerCase():a.source,f="",g=!1,h=!1,i=!1;for(let a=0;a<e.length;a++){if(g){f+=e[a],g=!1;continue}if(d.i){if(h){if(e[a].match(/[a-z]/)){i?(f+=e[a],f+=`${e[a-2]}-${e[a]}`.toUpperCase(),i=!1):"-"===e[a+1]&&(null==(c=e[a+2])?void 0:c.match(/[a-z]/))?(f+=e[a],i=!0):f+=`${e[a]}${e[a].toUpperCase()}`;continue}}else if(e[a].match(/[a-z]/)){f+=`[${e[a]}${e[a].toUpperCase()}]`;continue}}if(d.m){if("^"===e[a]){f+=`(^|(?<=[\r
]))`;continue}else if("$"===e[a]){f+=`($|(?=[\r
]))`;continue}}if(d.s&&"."===e[a]){f+=h?`${e[a]}\r
`:`[${e[a]}\r
]`;continue}f+=e[a],"\\"===e[a]?g=!0:h&&"]"===e[a]?h=!1:h||"["!==e[a]||(h=!0)}try{new RegExp(f)}catch(c){return console.warn(`Could not convert regex pattern at ${b.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),a.source}return f}function ds(a,b){var c,d,e,f,g,h;let i={type:"object",additionalProperties:null!=(c=du(a.valueType._def,{...b,currentPath:[...b.currentPath,"additionalProperties"]}))?c:b.allowedAdditionalProperties};if((null==(d=a.keyType)?void 0:d._def.typeName)===o.ZodString&&(null==(e=a.keyType._def.checks)?void 0:e.length)){let{type:c,...d}=dl(a.keyType._def,b);return{...i,propertyNames:d}}if((null==(f=a.keyType)?void 0:f._def.typeName)===o.ZodEnum)return{...i,propertyNames:{enum:a.keyType._def.values}};if((null==(g=a.keyType)?void 0:g._def.typeName)===o.ZodBranded&&a.keyType._def.type._def.typeName===o.ZodString&&(null==(h=a.keyType._def.type._def.checks)?void 0:h.length)){let{type:c,...d}=di(a.keyType._def,b);return{...i,propertyNames:d}}return i}var dt={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function du(a,b,c=!1){var d;let e=b.seen.get(a);if(b.override){let f=null==(d=b.override)?void 0:d.call(b,a,b,e,c);if(f!==dg)return f}if(e&&!c){let a=dv(e,b);if(void 0!==a)return a}let f={def:a,path:b.currentPath,jsonSchema:void 0};b.seen.set(a,f);let g=((a,b,c)=>{switch(b){case o.ZodString:return dl(a,c);case o.ZodNumber:var d,e,f,g,h,i,j=a;let k={type:"number"};if(!j.checks)return k;for(let a of j.checks)switch(a.kind){case"int":k.type="integer";break;case"min":a.inclusive?k.minimum=a.value:k.exclusiveMinimum=a.value;break;case"max":a.inclusive?k.maximum=a.value:k.exclusiveMaximum=a.value;break;case"multipleOf":k.multipleOf=a.value}return k;case o.ZodObject:return function(a,b){let c={type:"object",properties:{}},d=[],e=a.shape();for(let a in e){let f=e[a];if(void 0===f||void 0===f._def)continue;let g=function(a){try{return a.isOptional()}catch(a){return!0}}(f),h=du(f._def,{...b,currentPath:[...b.currentPath,"properties",a],propertyPath:[...b.currentPath,"properties",a]});void 0!==h&&(c.properties[a]=h,g||d.push(a))}d.length&&(c.required=d);let f=function(a,b){if("ZodNever"!==a.catchall._def.typeName)return du(a.catchall._def,{...b,currentPath:[...b.currentPath,"additionalProperties"]});switch(a.unknownKeys){case"passthrough":return b.allowedAdditionalProperties;case"strict":return b.rejectedAdditionalProperties;case"strip":return"strict"===b.removeAdditionalStrategy?b.allowedAdditionalProperties:b.rejectedAdditionalProperties}}(a,b);return void 0!==f&&(c.additionalProperties=f),c}(a,c);case o.ZodBigInt:var l=a;let m={type:"integer",format:"int64"};if(!l.checks)return m;for(let a of l.checks)switch(a.kind){case"min":a.inclusive?m.minimum=a.value:m.exclusiveMinimum=a.value;break;case"max":a.inclusive?m.maximum=a.value:m.exclusiveMaximum=a.value;break;case"multipleOf":m.multipleOf=a.value}return m;case o.ZodBoolean:return{type:"boolean"};case o.ZodDate:return function a(b,c,d){let e=null!=d?d:c.dateStrategy;if(Array.isArray(e))return{anyOf:e.map((d,e)=>a(b,c,d))};switch(e){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":var f=b;let g={type:"integer",format:"unix-time"};for(let a of f.checks)switch(a.kind){case"min":g.minimum=a.value;break;case"max":g.maximum=a.value}return g}}(a,c);case o.ZodUndefined:return{not:{}};case o.ZodNull:return{type:"null"};case o.ZodArray:var n,p,q,r=a,s=c;let t={type:"array"};return(null==(n=r.type)?void 0:n._def)&&(null==(q=null==(p=r.type)?void 0:p._def)?void 0:q.typeName)!==o.ZodAny&&(t.items=du(r.type._def,{...s,currentPath:[...s.currentPath,"items"]})),r.minLength&&(t.minItems=r.minLength.value),r.maxLength&&(t.maxItems=r.maxLength.value),r.exactLength&&(t.minItems=r.exactLength.value,t.maxItems=r.exactLength.value),t;case o.ZodUnion:case o.ZodDiscriminatedUnion:return function(a,b){let c=a.options instanceof Map?Array.from(a.options.values()):a.options;if(c.every(a=>a._def.typeName in dt&&(!a._def.checks||!a._def.checks.length))){let a=c.reduce((a,b)=>{let c=dt[b._def.typeName];return c&&!a.includes(c)?[...a,c]:a},[]);return{type:a.length>1?a:a[0]}}if(c.every(a=>"ZodLiteral"===a._def.typeName&&!a.description)){let a=c.reduce((a,b)=>{let c=typeof b._def.value;switch(c){case"string":case"number":case"boolean":return[...a,c];case"bigint":return[...a,"integer"];case"object":if(null===b._def.value)return[...a,"null"];default:return a}},[]);if(a.length===c.length){let b=a.filter((a,b,c)=>c.indexOf(a)===b);return{type:b.length>1?b:b[0],enum:c.reduce((a,b)=>a.includes(b._def.value)?a:[...a,b._def.value],[])}}}else if(c.every(a=>"ZodEnum"===a._def.typeName))return{type:"string",enum:c.reduce((a,b)=>[...a,...b._def.values.filter(b=>!a.includes(b))],[])};var d=a,e=b;let f=(d.options instanceof Map?Array.from(d.options.values()):d.options).map((a,b)=>du(a._def,{...e,currentPath:[...e.currentPath,"anyOf",`${b}`]})).filter(a=>!!a&&(!e.strictUnions||"object"==typeof a&&Object.keys(a).length>0));return f.length?{anyOf:f}:void 0}(a,c);case o.ZodIntersection:var u=a,v=c;let w=[du(u.left._def,{...v,currentPath:[...v.currentPath,"allOf","0"]}),du(u.right._def,{...v,currentPath:[...v.currentPath,"allOf","1"]})].filter(a=>!!a),x=[];return w.forEach(a=>{if((!("type"in a)||"string"!==a.type)&&"allOf"in a)x.push(...a.allOf);else{let b=a;if("additionalProperties"in a&&!1===a.additionalProperties){let{additionalProperties:c,...d}=a;b=d}x.push(b)}}),x.length?{allOf:x}:void 0;case o.ZodTuple:return H=a,I=c,H.rest?{type:"array",minItems:H.items.length,items:H.items.map((a,b)=>du(a._def,{...I,currentPath:[...I.currentPath,"items",`${b}`]})).reduce((a,b)=>void 0===b?a:[...a,b],[]),additionalItems:du(H.rest._def,{...I,currentPath:[...I.currentPath,"additionalItems"]})}:{type:"array",minItems:H.items.length,maxItems:H.items.length,items:H.items.map((a,b)=>du(a._def,{...I,currentPath:[...I.currentPath,"items",`${b}`]})).reduce((a,b)=>void 0===b?a:[...a,b],[])};case o.ZodRecord:return ds(a,c);case o.ZodLiteral:var y=a;let z=typeof y.value;return"bigint"!==z&&"number"!==z&&"boolean"!==z&&"string"!==z?{type:Array.isArray(y.value)?"array":"object"}:{type:"bigint"===z?"integer":z,const:y.value};case o.ZodEnum:return{type:"string",enum:Array.from(a.values)};case o.ZodNativeEnum:var A=a;let B=A.values,C=Object.keys(A.values).filter(a=>"number"!=typeof B[B[a]]).map(a=>B[a]),D=Array.from(new Set(C.map(a=>typeof a)));return{type:1===D.length?"string"===D[0]?"string":"number":["string","number"],enum:C};case o.ZodNullable:var E=a,F=c;if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(E.innerType._def.typeName)&&(!E.innerType._def.checks||!E.innerType._def.checks.length))return{type:[dt[E.innerType._def.typeName],"null"]};let G=du(E.innerType._def,{...F,currentPath:[...F.currentPath,"anyOf","0"]});return G&&{anyOf:[G,{type:"null"}]};case o.ZodOptional:var H,I,J,K=a,L=c;if(L.currentPath.toString()===(null==(J=L.propertyPath)?void 0:J.toString()))return du(K.innerType._def,L);let M=du(K.innerType._def,{...L,currentPath:[...L.currentPath,"anyOf","1"]});return M?{anyOf:[{not:{}},M]}:{};case o.ZodMap:return d=a,"record"===(e=c).mapStrategy?ds(d,e):{type:"array",maxItems:125,items:{type:"array",items:[du(d.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},du(d.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{}],minItems:2,maxItems:2}};case o.ZodSet:var N=a,O=c;let P={type:"array",uniqueItems:!0,items:du(N.valueType._def,{...O,currentPath:[...O.currentPath,"items"]})};return N.minSize&&(P.minItems=N.minSize.value),N.maxSize&&(P.maxItems=N.maxSize.value),P;case o.ZodLazy:return()=>a.getter()._def;case o.ZodPromise:return du(a.type._def,c);case o.ZodNaN:case o.ZodNever:return{not:{}};case o.ZodEffects:return f=a,"input"===(g=c).effectStrategy?du(f.schema._def,g):{};case o.ZodAny:case o.ZodUnknown:return{};case o.ZodDefault:return h=a,i=c,{...du(h.innerType._def,i),default:h.defaultValue()};case o.ZodBranded:return di(a,c);case o.ZodReadonly:case o.ZodCatch:return du(a.innerType._def,c);case o.ZodPipeline:var Q=a,R=c;if("input"===R.pipeStrategy)return du(Q.in._def,R);if("output"===R.pipeStrategy)return du(Q.out._def,R);let S=du(Q.in._def,{...R,currentPath:[...R.currentPath,"allOf","0"]}),T=du(Q.out._def,{...R,currentPath:[...R.currentPath,"allOf",S?"1":"0"]});return{allOf:[S,T].filter(a=>void 0!==a)};case o.ZodFunction:case o.ZodVoid:case o.ZodSymbol:default:return}})(a,a.typeName,b),h="function"==typeof g?du(g(),b):g;if(h&&dw(a,b,h),b.postProcess){let c=b.postProcess(h,a,b);return f.jsonSchema=h,c}return f.jsonSchema=h,h}var dv=(a,b)=>{switch(b.$refStrategy){case"root":return{$ref:a.path.join("/")};case"relative":return{$ref:((a,b)=>{let c=0;for(;c<a.length&&c<b.length&&a[c]===b[c];c++);return[(a.length-c).toString(),...b.slice(c)].join("/")})(b.currentPath,a.path)};case"none":case"seen":if(a.path.length<b.currentPath.length&&a.path.every((a,c)=>b.currentPath[c]===a))return console.warn(`Recursive reference detected at ${b.currentPath.join("/")}! Defaulting to any`),{};return"seen"===b.$refStrategy?{}:void 0}},dw=(a,b,c)=>(a.description&&(c.description=a.description),c);function dx(a,b){var c,d;if("_zod"in a){let d=null!=(c=null==b?void 0:b.useReferences)&&c;return dz(()=>aS.toJSONSchema(a,{target:"draft-7",io:"output",reused:d?"ref":"inline"}),{validate:async b=>{let c=await aU.safeParseAsync(a,b);return c.success?{success:!0,value:c.data}:{success:!1,error:c.error}}})}let e=null!=(d=null==b?void 0:b.useReferences)&&d;return dz(()=>((a,b)=>{var c;let d=(a=>{let b,c="string"==typeof(b=a)?{...dh,name:b}:{...dh,...b},d=void 0!==c.name?[...c.basePath,c.definitionPath,c.name]:c.basePath;return{...c,currentPath:d,propertyPath:void 0,seen:new Map(Object.entries(c.definitions).map(([a,b])=>[b._def,{def:b._def,path:[...c.basePath,c.definitionPath,a],jsonSchema:void 0}]))}})(b),e="object"==typeof b&&b.definitions?Object.entries(b.definitions).reduce((a,[b,c])=>{var e;return{...a,[b]:null!=(e=du(c._def,{...d,currentPath:[...d.basePath,d.definitionPath,b]},!0))?e:{}}},{}):void 0,f="string"==typeof b?b:(null==b?void 0:b.nameStrategy)==="title"||null==b?void 0:b.name,g=null!=(c=du(a._def,void 0===f?d:{...d,currentPath:[...d.basePath,d.definitionPath,f]},!1))?c:{},h="object"==typeof b&&void 0!==b.name&&"title"===b.nameStrategy?b.name:void 0;void 0!==h&&(g.title=h);let i=void 0===f?e?{...g,[d.definitionPath]:e}:g:{$ref:[..."relative"===d.$refStrategy?[]:d.basePath,d.definitionPath,f].join("/"),[d.definitionPath]:{...e,[f]:g}};return i.$schema="http://json-schema.org/draft-07/schema#",i})(a,{$refStrategy:e?"root":"none"}),{validate:async b=>{let c=await a.safeParseAsync(b);return c.success?{success:!0,value:c.data}:{success:!1,error:c.error}}})}var dy=Symbol.for("vercel.ai.schema");function dz(a,{validate:b}={}){return{[dy]:!0,_type:void 0,[c4]:!0,get jsonSchema(){return"function"==typeof a&&(a=a()),a},validate:b}}var{btoa:dA,atob:dB}=globalThis;a.i(353804);var dC=aS,dD=a.i(784628),dE=Symbol.for("vercel.ai.gateway.error"),dF=class a extends(q=Error,p=dE,q){constructor({message:a,statusCode:b=500,cause:c}){super(a),this[p]=!0,this.statusCode=b,this.cause=c}static isInstance(b){return a.hasMarker(b)}static hasMarker(a){return"object"==typeof a&&null!==a&&dE in a&&!0===a[dE]}},dG="GatewayAuthenticationError",dH=Symbol.for(`vercel.ai.gateway.error.${dG}`),dI=class a extends(s=dF,r=dH,s){constructor({message:a="Authentication failed",statusCode:b=401,cause:c}={}){super({message:a,statusCode:b,cause:c}),this[r]=!0,this.name=dG,this.type="authentication_error"}static isInstance(a){return dF.hasMarker(a)&&dH in a}static createContextualError({apiKeyProvided:b,oidcTokenProvided:c,message:d="Authentication failed",statusCode:e=401,cause:f}){return new a({message:b?`AI Gateway authentication failed: Invalid API key.

Create a new API key: https://vercel.com/d?to=%2F%5Bteam%5D%2F%7E%2Fai%2Fapi-keys

Provide via 'apiKey' option or 'AI_GATEWAY_API_KEY' environment variable.`:c?`AI Gateway authentication failed: Invalid OIDC token.

Run 'npx vercel link' to link your project, then 'vc env pull' to fetch the token.

Alternatively, use an API key: https://vercel.com/d?to=%2F%5Bteam%5D%2F%7E%2Fai%2Fapi-keys`:`AI Gateway authentication failed: No authentication provided.

Option 1 - API key:
Create an API key: https://vercel.com/d?to=%2F%5Bteam%5D%2F%7E%2Fai%2Fapi-keys
Provide via 'apiKey' option or 'AI_GATEWAY_API_KEY' environment variable.

Option 2 - OIDC token:
Run 'npx vercel link' to link your project, then 'vc env pull' to fetch the token.`,statusCode:e,cause:f})}},dJ="GatewayInvalidRequestError",dK=Symbol.for(`vercel.ai.gateway.error.${dJ}`),dL=class extends(u=dF,t=dK,u){constructor({message:a="Invalid request",statusCode:b=400,cause:c}={}){super({message:a,statusCode:b,cause:c}),this[t]=!0,this.name=dJ,this.type="invalid_request_error"}static isInstance(a){return dF.hasMarker(a)&&dK in a}},dM="GatewayRateLimitError",dN=Symbol.for(`vercel.ai.gateway.error.${dM}`),dO=class extends(w=dF,v=dN,w){constructor({message:a="Rate limit exceeded",statusCode:b=429,cause:c}={}){super({message:a,statusCode:b,cause:c}),this[v]=!0,this.name=dM,this.type="rate_limit_exceeded"}static isInstance(a){return dF.hasMarker(a)&&dN in a}},dP="GatewayModelNotFoundError",dQ=Symbol.for(`vercel.ai.gateway.error.${dP}`),dR=c5(()=>dx(dC.object({modelId:dC.string()}))),dS=class extends(y=dF,x=dQ,y){constructor({message:a="Model not found",statusCode:b=404,modelId:c,cause:d}={}){super({message:a,statusCode:b,cause:d}),this[x]=!0,this.name=dP,this.type="model_not_found",this.modelId=c}static isInstance(a){return dF.hasMarker(a)&&dQ in a}},dT="GatewayInternalServerError",dU=Symbol.for(`vercel.ai.gateway.error.${dT}`),dV=class extends(A=dF,z=dU,A){constructor({message:a="Internal server error",statusCode:b=500,cause:c}={}){super({message:a,statusCode:b,cause:c}),this[z]=!0,this.name=dT,this.type="internal_server_error"}static isInstance(a){return dF.hasMarker(a)&&dU in a}},dW="GatewayResponseError",dX=Symbol.for(`vercel.ai.gateway.error.${dW}`),dY=class extends(C=dF,B=dX,C){constructor({message:a="Invalid response from Gateway",statusCode:b=502,response:c,validationError:d,cause:e}={}){super({message:a,statusCode:b,cause:e}),this[B]=!0,this.name=dW,this.type="response_error",this.response=c,this.validationError=d}static isInstance(a){return dF.hasMarker(a)&&dX in a}};async function dZ({response:a,statusCode:b,defaultMessage:c="Gateway request failed",cause:d,authMethod:e}){let f=await c7({value:a,schema:d$});if(!f.success)return new dY({message:`Invalid error response format: ${c}`,statusCode:b,response:a,validationError:f.error,cause:d});let g=f.value,h=g.error.type,i=g.error.message;switch(h){case"authentication_error":return dI.createContextualError({apiKeyProvided:"api-key"===e,oidcTokenProvided:"oidc"===e,statusCode:b,cause:d});case"invalid_request_error":return new dL({message:i,statusCode:b,cause:d});case"rate_limit_exceeded":return new dO({message:i,statusCode:b,cause:d});case"model_not_found":{let a=await c7({value:g.error.param,schema:dR});return new dS({message:i,statusCode:b,modelId:a.success?a.value.modelId:void 0,cause:d})}default:return new dV({message:i,statusCode:b,cause:d})}}var d$=c5(()=>dx(dC.object({error:dC.object({message:dC.string(),type:dC.string().nullish(),param:dC.unknown().nullish(),code:dC.union([dC.string(),dC.number()]).nullish()})})));function d_(a,b){var c;return dF.isInstance(a)?a:ai.isInstance(a)?dZ({response:function(a){if(void 0!==a.data)return a.data;if(null!=a.responseBody)try{return JSON.parse(a.responseBody)}catch(b){return a.responseBody}return{}}(a),statusCode:null!=(c=a.statusCode)?c:500,defaultMessage:"Gateway request failed",cause:a,authMethod:b}):dZ({response:{},statusCode:500,defaultMessage:a instanceof Error?`Gateway request failed: ${a.message}`:"Unknown Gateway error",cause:a,authMethod:b})}var d0="ai-gateway-auth-method";async function d1(a){let b=await c7({value:a[d0],schema:d2});return b.success?b.value:void 0}var d2=c5(()=>dx(dC.union([dC.literal("api-key"),dC.literal("oidc")]))),d3=class{constructor(a){this.config=a}async getAvailableModels(){try{let{value:a}=await c$({url:`${this.config.baseURL}/config`,headers:await dd(this.config.headers()),successfulResponseHandler:df(d4),failedResponseHandler:de({errorSchema:dC.any(),errorToMessage:a=>a}),fetch:this.config.fetch});return a}catch(a){throw await d_(a)}}async getCredits(){try{let a=new URL(this.config.baseURL),{value:b}=await c$({url:`${a.origin}/v1/credits`,headers:await dd(this.config.headers()),successfulResponseHandler:df(d5),failedResponseHandler:de({errorSchema:dC.any(),errorToMessage:a=>a}),fetch:this.config.fetch});return b}catch(a){throw await d_(a)}}},d4=c5(()=>dx(dC.object({models:dC.array(dC.object({id:dC.string(),name:dC.string(),description:dC.string().nullish(),pricing:dC.object({input:dC.string(),output:dC.string(),input_cache_read:dC.string().nullish(),input_cache_write:dC.string().nullish()}).transform(({input:a,output:b,input_cache_read:c,input_cache_write:d})=>({input:a,output:b,...c?{cachedInputTokens:c}:{},...d?{cacheCreationInputTokens:d}:{}})).nullish(),specification:dC.object({specificationVersion:dC.literal("v2"),provider:dC.string(),modelId:dC.string()}),modelType:dC.enum(["language","embedding","image"]).nullish()}))}))),d5=c5(()=>dx(dC.object({balance:dC.string(),total_used:dC.string()}).transform(({balance:a,total_used:b})=>({balance:a,totalUsed:b})))),d6=class{constructor(a,b){this.modelId=a,this.config=b,this.specificationVersion="v2",this.supportedUrls={"*/*":[/.*/]}}get provider(){return this.config.provider}async getArgs(a){let{abortSignal:b,...c}=a;return{args:this.maybeEncodeFileParts(c),warnings:[]}}async doGenerate(a){let{args:b,warnings:c}=await this.getArgs(a),{abortSignal:d}=a,e=await dd(this.config.headers());try{let{responseHeaders:f,value:g,rawValue:h}=await db({url:this.getUrl(),headers:cR(e,a.headers,this.getModelConfigHeaders(this.modelId,!1),await dd(this.config.o11yHeaders)),body:b,successfulResponseHandler:df(dC.any()),failedResponseHandler:de({errorSchema:dC.any(),errorToMessage:a=>a}),...d&&{abortSignal:d},fetch:this.config.fetch});return{...g,request:{body:b},response:{headers:f,body:h},warnings:c}}catch(a){throw await d_(a,await d1(e))}}async doStream(a){let{args:b,warnings:c}=await this.getArgs(a),{abortSignal:d}=a,e=await dd(this.config.headers());try{let f,{value:g,responseHeaders:h}=await db({url:this.getUrl(),headers:cR(e,a.headers,this.getModelConfigHeaders(this.modelId,!0),await dd(this.config.o11yHeaders)),body:b,successfulResponseHandler:(f=dC.any(),async({response:a})=>{let b=cS(a);if(null==a.body)throw new am({});return{responseHeaders:b,value:function({stream:a,schema:b}){return a.pipeThrough(new TextDecoderStream).pipeThrough(new aR).pipeThrough(new TransformStream({async transform({data:a},c){"[DONE]"!==a&&c.enqueue(await c9({text:a,schema:b}))}}))}({stream:a.body,schema:f})}}),failedResponseHandler:de({errorSchema:dC.any(),errorToMessage:a=>a}),...d&&{abortSignal:d},fetch:this.config.fetch});return{stream:g.pipeThrough(new TransformStream({start(a){c.length>0&&a.enqueue({type:"stream-start",warnings:c})},transform(b,c){if(b.success){let d=b.value;("raw"!==d.type||a.includeRawChunks)&&("response-metadata"===d.type&&d.timestamp&&"string"==typeof d.timestamp&&(d.timestamp=new Date(d.timestamp)),c.enqueue(d))}else c.error(b.error)}})),request:{body:b},response:{headers:h}}}catch(a){throw await d_(a,await d1(e))}}isFilePart(a){return a&&"object"==typeof a&&"type"in a&&"file"===a.type}maybeEncodeFileParts(a){for(let b of a.prompt)for(let a of b.content)if(this.isFilePart(a)&&a.data instanceof Uint8Array){let b=Uint8Array.from(a.data),c=Buffer.from(b).toString("base64");a.data=new URL(`data:${a.mediaType||"application/octet-stream"};base64,${c}`)}return a}getUrl(){return`${this.config.baseURL}/language-model`}getModelConfigHeaders(a,b){return{"ai-language-model-specification-version":"2","ai-language-model-id":a,"ai-language-model-streaming":String(b)}}},d7=class{constructor(a,b){this.modelId=a,this.config=b,this.specificationVersion="v2",this.maxEmbeddingsPerCall=2048,this.supportsParallelCalls=!0}get provider(){return this.config.provider}async doEmbed({values:a,headers:b,abortSignal:c,providerOptions:d}){var e;let f=await dd(this.config.headers());try{let{responseHeaders:g,value:h,rawValue:i}=await db({url:this.getUrl(),headers:cR(f,null!=b?b:{},this.getModelConfigHeaders(),await dd(this.config.o11yHeaders)),body:{input:1===a.length?a[0]:a,...d?{providerOptions:d}:{}},successfulResponseHandler:df(d8),failedResponseHandler:de({errorSchema:dC.any(),errorToMessage:a=>a}),...c&&{abortSignal:c},fetch:this.config.fetch});return{embeddings:h.embeddings,usage:null!=(e=h.usage)?e:void 0,providerMetadata:h.providerMetadata,response:{headers:g,body:i}}}catch(a){throw await d_(a,await d1(f))}}getUrl(){return`${this.config.baseURL}/embedding-model`}getModelConfigHeaders(){return{"ai-embedding-model-specification-version":"2","ai-model-id":this.modelId}}},d8=c5(()=>dx(dC.object({embeddings:dC.array(dC.array(dC.number())),usage:dC.object({tokens:dC.number()}).nullish(),providerMetadata:dC.record(dC.string(),dC.record(dC.string(),dC.unknown())).optional()})));async function d9(){var a;return null==(a=(0,dD.getContext)().headers)?void 0:a["x-vercel-id"]}var ea=function(a={}){var b,c,d;let e=null,f=null,g=null!=(b=a.metadataCacheRefreshMillis)?b:3e5,h=0,i=null!=(c=null==(d=a.baseURL)?void 0:d.replace(/\/$/,""))?c:"https://ai-gateway.vercel.sh/v1/ai",j=async()=>{let b=await eb(a);if(b)return cX({Authorization:`Bearer ${b.token}`,"ai-gateway-protocol-version":"0.0.1",[d0]:b.authMethod,...a.headers},"ai-sdk/gateway/2.0.9");throw dI.createContextualError({apiKeyProvided:!1,oidcTokenProvided:!1,statusCode:401})},k=()=>{let a=c_({settingValue:void 0,environmentVariableName:"VERCEL_DEPLOYMENT_ID"}),b=c_({settingValue:void 0,environmentVariableName:"VERCEL_ENV"}),c=c_({settingValue:void 0,environmentVariableName:"VERCEL_REGION"});return async()=>{let d=await d9();return{...a&&{"ai-o11y-deployment-id":a},...b&&{"ai-o11y-environment":b},...c&&{"ai-o11y-region":c},...d&&{"ai-o11y-request-id":d}}}},l=b=>new d6(b,{provider:"gateway",baseURL:i,headers:j,fetch:a.fetch,o11yHeaders:k()}),m=async()=>new d3({baseURL:i,headers:j,fetch:a.fetch}).getCredits().catch(async a=>{throw await d_(a,await d1(await j()))}),n=function(a){if(new.target)throw Error("The Gateway Provider model function cannot be called with the new keyword.");return l(a)};return n.getAvailableModels=async()=>{var b,c,d;let k=null!=(d=null==(c=null==(b=a._internal)?void 0:b.currentDate)?void 0:c.call(b).getTime())?d:Date.now();return(!e||k-h>g)&&(h=k,e=new d3({baseURL:i,headers:j,fetch:a.fetch}).getAvailableModels().then(a=>(f=a,a)).catch(async a=>{throw await d_(a,await d1(await j()))})),f?Promise.resolve(f):e},n.getCredits=m,n.imageModel=a=>{throw new aD({modelId:a,modelType:"imageModel"})},n.languageModel=l,n.textEmbeddingModel=b=>new d7(b,{provider:"gateway",baseURL:i,headers:j,fetch:a.fetch,o11yHeaders:k()}),n}();async function eb(a){let b=c_({settingValue:a.apiKey,environmentVariableName:"AI_GATEWAY_API_KEY"});if(b)return{token:b,authMethod:"api-key"};try{return{token:await (0,dD.getVercelOidcToken)(),authMethod:"oidc"}}catch(a){return null}}async function ec(a,b){if(null==a)return Promise.resolve();let c=null==b?void 0:b.abortSignal;return new Promise((b,d)=>{if(null==c?void 0:c.aborted)return void d(ed());let e=setTimeout(()=>{f(),b()},a),f=()=>{clearTimeout(e),null==c||c.removeEventListener("abort",g)},g=()=>{f(),d(ed())};null==c||c.addEventListener("abort",g)})}function ed(){return new DOMException("Delay was aborted","AbortError")}var ee=({prefix:a,size:b=16,alphabet:c="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:d="-"}={})=>{let e=()=>{let a=c.length,d=Array(b);for(let e=0;e<b;e++)d[e]=c[Math.random()*a|0];return d.join("")};if(null==a)return e;if(c.includes(d))throw new ar({argument:"separator",message:`The separator "${d}" must not be part of the alphabet "${c}".`});return()=>`${a}${d}${e()}`};function ef(a){return null==a?"unknown error":"string"==typeof a?a:a instanceof Error?a.message:JSON.stringify(a)}function eg(a,...b){let c=new Headers(function(a){if(null==a)return{};let b={};if(a instanceof Headers)a.forEach((a,c)=>{b[c.toLowerCase()]=a});else for(let[c,d]of(Array.isArray(a)||(a=Object.entries(a)),a))null!=d&&(b[c.toLowerCase()]=d);return b}(a)),d=c.get("user-agent")||"";return c.set("user-agent",[d,...b].filter(Boolean).join(" ")),Object.fromEntries(c.entries())}ee();var eh=/"__proto__"\s*:/,ei=/"constructor"\s*:/;function ej(a){let b=JSON.parse(a);return null===b||"object"!=typeof b||!1===eh.test(a)&&!1===ei.test(a)?b:function(a){let b=[a];for(;b.length;){let a=b;for(let c of(b=[],a)){if(Object.prototype.hasOwnProperty.call(c,"__proto__")||Object.prototype.hasOwnProperty.call(c,"constructor")&&Object.prototype.hasOwnProperty.call(c.constructor,"prototype"))throw SyntaxError("Object contains forbidden prototype property");for(let a in c){let d=c[a];d&&"object"==typeof d&&b.push(d)}}}return a}(b)}var ek=Symbol.for("vercel.ai.validator");function el(a){let b;return()=>(null==b&&(b=a()),b)}async function em({value:a,schema:b}){var c;let d="object"==typeof b&&null!==b&&ek in b&&!0===b[ek]&&"validate"in b?b:"function"==typeof b?b():(c=b,{[ek]:!0,validate:async a=>{let b=await c["~standard"].validate(a);return null==b.issues?{success:!0,value:b.value}:{success:!1,error:new aH({value:a,cause:b.issues})}}});try{if(null==d.validate)return{success:!0,value:a,rawValue:a};let b=await d.validate(a);if(b.success)return{success:!0,value:b.value,rawValue:a};return{success:!1,error:aH.wrap({value:a,cause:b.error}),rawValue:a}}catch(b){return{success:!1,error:aH.wrap({value:a,cause:b}),rawValue:a}}}async function en({text:a,schema:b}){try{let c=function(a){let{stackTraceLimit:b}=Error;try{Error.stackTraceLimit=0}catch(b){return ej(a)}try{return ej(a)}finally{Error.stackTraceLimit=b}}(a);if(null==b)return{success:!0,value:c,rawValue:c};return await em({value:c,schema:b})}catch(b){return{success:!1,error:az.isInstance(b)?b:new az({text:a,cause:b}),rawValue:void 0}}}var eo=Symbol("Let zodToJsonSchema decide on which parser to use"),ep={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",strictUnions:!1,definitions:{},errorMessages:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"};function eq(a,b){return eB(a.type._def,b)}var er=void 0,es={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(void 0===er&&(er=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),er),ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function et(a,b){let c={type:"string"};if(a.checks)for(let d of a.checks)switch(d.kind){case"min":c.minLength="number"==typeof c.minLength?Math.max(c.minLength,d.value):d.value;break;case"max":c.maxLength="number"==typeof c.maxLength?Math.min(c.maxLength,d.value):d.value;break;case"email":switch(b.emailStrategy){case"format:email":ew(c,"email",d.message,b);break;case"format:idn-email":ew(c,"idn-email",d.message,b);break;case"pattern:zod":ex(c,es.email,d.message,b)}break;case"url":ew(c,"uri",d.message,b);break;case"uuid":ew(c,"uuid",d.message,b);break;case"regex":ex(c,d.regex,d.message,b);break;case"cuid":ex(c,es.cuid,d.message,b);break;case"cuid2":ex(c,es.cuid2,d.message,b);break;case"startsWith":ex(c,RegExp(`^${eu(d.value,b)}`),d.message,b);break;case"endsWith":ex(c,RegExp(`${eu(d.value,b)}$`),d.message,b);break;case"datetime":ew(c,"date-time",d.message,b);break;case"date":ew(c,"date",d.message,b);break;case"time":ew(c,"time",d.message,b);break;case"duration":ew(c,"duration",d.message,b);break;case"length":c.minLength="number"==typeof c.minLength?Math.max(c.minLength,d.value):d.value,c.maxLength="number"==typeof c.maxLength?Math.min(c.maxLength,d.value):d.value;break;case"includes":ex(c,RegExp(eu(d.value,b)),d.message,b);break;case"ip":"v6"!==d.version&&ew(c,"ipv4",d.message,b),"v4"!==d.version&&ew(c,"ipv6",d.message,b);break;case"base64url":ex(c,es.base64url,d.message,b);break;case"jwt":ex(c,es.jwt,d.message,b);break;case"cidr":"v6"!==d.version&&ex(c,es.ipv4Cidr,d.message,b),"v4"!==d.version&&ex(c,es.ipv6Cidr,d.message,b);break;case"emoji":ex(c,es.emoji(),d.message,b);break;case"ulid":ex(c,es.ulid,d.message,b);break;case"base64":switch(b.base64Strategy){case"format:binary":ew(c,"binary",d.message,b);break;case"contentEncoding:base64":c.contentEncoding="base64";break;case"pattern:zod":ex(c,es.base64,d.message,b)}break;case"nanoid":ex(c,es.nanoid,d.message,b)}return c}function eu(a,b){return"escape"===b.patternStrategy?function(a){let b="";for(let c=0;c<a.length;c++)ev.has(a[c])||(b+="\\"),b+=a[c];return b}(a):a}var ev=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function ew(a,b,c,d){var e;a.format||(null==(e=a.anyOf)?void 0:e.some(a=>a.format))?(a.anyOf||(a.anyOf=[]),a.format&&(a.anyOf.push({format:a.format}),delete a.format),a.anyOf.push({format:b,...c&&d.errorMessages&&{errorMessage:{format:c}}})):a.format=b}function ex(a,b,c,d){var e;a.pattern||(null==(e=a.allOf)?void 0:e.some(a=>a.pattern))?(a.allOf||(a.allOf=[]),a.pattern&&(a.allOf.push({pattern:a.pattern}),delete a.pattern),a.allOf.push({pattern:ey(b,d),...c&&d.errorMessages&&{errorMessage:{pattern:c}}})):a.pattern=ey(b,d)}function ey(a,b){var c;if(!b.applyRegexFlags||!a.flags)return a.source;let d={i:a.flags.includes("i"),m:a.flags.includes("m"),s:a.flags.includes("s")},e=d.i?a.source.toLowerCase():a.source,f="",g=!1,h=!1,i=!1;for(let a=0;a<e.length;a++){if(g){f+=e[a],g=!1;continue}if(d.i){if(h){if(e[a].match(/[a-z]/)){i?(f+=e[a],f+=`${e[a-2]}-${e[a]}`.toUpperCase(),i=!1):"-"===e[a+1]&&(null==(c=e[a+2])?void 0:c.match(/[a-z]/))?(f+=e[a],i=!0):f+=`${e[a]}${e[a].toUpperCase()}`;continue}}else if(e[a].match(/[a-z]/)){f+=`[${e[a]}${e[a].toUpperCase()}]`;continue}}if(d.m){if("^"===e[a]){f+=`(^|(?<=[\r
]))`;continue}else if("$"===e[a]){f+=`($|(?=[\r
]))`;continue}}if(d.s&&"."===e[a]){f+=h?`${e[a]}\r
`:`[${e[a]}\r
]`;continue}f+=e[a],"\\"===e[a]?g=!0:h&&"]"===e[a]?h=!1:h||"["!==e[a]||(h=!0)}try{new RegExp(f)}catch(c){return console.warn(`Could not convert regex pattern at ${b.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),a.source}return f}function ez(a,b){var c,d,e,f,g,h;let i={type:"object",additionalProperties:null!=(c=eB(a.valueType._def,{...b,currentPath:[...b.currentPath,"additionalProperties"]}))?c:b.allowedAdditionalProperties};if((null==(d=a.keyType)?void 0:d._def.typeName)===o.ZodString&&(null==(e=a.keyType._def.checks)?void 0:e.length)){let{type:c,...d}=et(a.keyType._def,b);return{...i,propertyNames:d}}if((null==(f=a.keyType)?void 0:f._def.typeName)===o.ZodEnum)return{...i,propertyNames:{enum:a.keyType._def.values}};if((null==(g=a.keyType)?void 0:g._def.typeName)===o.ZodBranded&&a.keyType._def.type._def.typeName===o.ZodString&&(null==(h=a.keyType._def.type._def.checks)?void 0:h.length)){let{type:c,...d}=eq(a.keyType._def,b);return{...i,propertyNames:d}}return i}var eA={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function eB(a,b,c=!1){var d;let e=b.seen.get(a);if(b.override){let f=null==(d=b.override)?void 0:d.call(b,a,b,e,c);if(f!==eo)return f}if(e&&!c){let a=eC(e,b);if(void 0!==a)return a}let f={def:a,path:b.currentPath,jsonSchema:void 0};b.seen.set(a,f);let g=((a,b,c)=>{switch(b){case o.ZodString:return et(a,c);case o.ZodNumber:var d,e,f,g,h,i,j=a;let k={type:"number"};if(!j.checks)return k;for(let a of j.checks)switch(a.kind){case"int":k.type="integer";break;case"min":a.inclusive?k.minimum=a.value:k.exclusiveMinimum=a.value;break;case"max":a.inclusive?k.maximum=a.value:k.exclusiveMaximum=a.value;break;case"multipleOf":k.multipleOf=a.value}return k;case o.ZodObject:return function(a,b){let c={type:"object",properties:{}},d=[],e=a.shape();for(let a in e){let f=e[a];if(void 0===f||void 0===f._def)continue;let g=function(a){try{return a.isOptional()}catch(a){return!0}}(f),h=eB(f._def,{...b,currentPath:[...b.currentPath,"properties",a],propertyPath:[...b.currentPath,"properties",a]});void 0!==h&&(c.properties[a]=h,g||d.push(a))}d.length&&(c.required=d);let f=function(a,b){if("ZodNever"!==a.catchall._def.typeName)return eB(a.catchall._def,{...b,currentPath:[...b.currentPath,"additionalProperties"]});switch(a.unknownKeys){case"passthrough":return b.allowedAdditionalProperties;case"strict":return b.rejectedAdditionalProperties;case"strip":return"strict"===b.removeAdditionalStrategy?b.allowedAdditionalProperties:b.rejectedAdditionalProperties}}(a,b);return void 0!==f&&(c.additionalProperties=f),c}(a,c);case o.ZodBigInt:var l=a;let m={type:"integer",format:"int64"};if(!l.checks)return m;for(let a of l.checks)switch(a.kind){case"min":a.inclusive?m.minimum=a.value:m.exclusiveMinimum=a.value;break;case"max":a.inclusive?m.maximum=a.value:m.exclusiveMaximum=a.value;break;case"multipleOf":m.multipleOf=a.value}return m;case o.ZodBoolean:return{type:"boolean"};case o.ZodDate:return function a(b,c,d){let e=null!=d?d:c.dateStrategy;if(Array.isArray(e))return{anyOf:e.map((d,e)=>a(b,c,d))};switch(e){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":var f=b;let g={type:"integer",format:"unix-time"};for(let a of f.checks)switch(a.kind){case"min":g.minimum=a.value;break;case"max":g.maximum=a.value}return g}}(a,c);case o.ZodUndefined:return{not:{}};case o.ZodNull:return{type:"null"};case o.ZodArray:var n,p,q,r=a,s=c;let t={type:"array"};return(null==(n=r.type)?void 0:n._def)&&(null==(q=null==(p=r.type)?void 0:p._def)?void 0:q.typeName)!==o.ZodAny&&(t.items=eB(r.type._def,{...s,currentPath:[...s.currentPath,"items"]})),r.minLength&&(t.minItems=r.minLength.value),r.maxLength&&(t.maxItems=r.maxLength.value),r.exactLength&&(t.minItems=r.exactLength.value,t.maxItems=r.exactLength.value),t;case o.ZodUnion:case o.ZodDiscriminatedUnion:return function(a,b){let c=a.options instanceof Map?Array.from(a.options.values()):a.options;if(c.every(a=>a._def.typeName in eA&&(!a._def.checks||!a._def.checks.length))){let a=c.reduce((a,b)=>{let c=eA[b._def.typeName];return c&&!a.includes(c)?[...a,c]:a},[]);return{type:a.length>1?a:a[0]}}if(c.every(a=>"ZodLiteral"===a._def.typeName&&!a.description)){let a=c.reduce((a,b)=>{let c=typeof b._def.value;switch(c){case"string":case"number":case"boolean":return[...a,c];case"bigint":return[...a,"integer"];case"object":if(null===b._def.value)return[...a,"null"];default:return a}},[]);if(a.length===c.length){let b=a.filter((a,b,c)=>c.indexOf(a)===b);return{type:b.length>1?b:b[0],enum:c.reduce((a,b)=>a.includes(b._def.value)?a:[...a,b._def.value],[])}}}else if(c.every(a=>"ZodEnum"===a._def.typeName))return{type:"string",enum:c.reduce((a,b)=>[...a,...b._def.values.filter(b=>!a.includes(b))],[])};var d=a,e=b;let f=(d.options instanceof Map?Array.from(d.options.values()):d.options).map((a,b)=>eB(a._def,{...e,currentPath:[...e.currentPath,"anyOf",`${b}`]})).filter(a=>!!a&&(!e.strictUnions||"object"==typeof a&&Object.keys(a).length>0));return f.length?{anyOf:f}:void 0}(a,c);case o.ZodIntersection:var u=a,v=c;let w=[eB(u.left._def,{...v,currentPath:[...v.currentPath,"allOf","0"]}),eB(u.right._def,{...v,currentPath:[...v.currentPath,"allOf","1"]})].filter(a=>!!a),x=[];return w.forEach(a=>{if((!("type"in a)||"string"!==a.type)&&"allOf"in a)x.push(...a.allOf);else{let b=a;if("additionalProperties"in a&&!1===a.additionalProperties){let{additionalProperties:c,...d}=a;b=d}x.push(b)}}),x.length?{allOf:x}:void 0;case o.ZodTuple:return H=a,I=c,H.rest?{type:"array",minItems:H.items.length,items:H.items.map((a,b)=>eB(a._def,{...I,currentPath:[...I.currentPath,"items",`${b}`]})).reduce((a,b)=>void 0===b?a:[...a,b],[]),additionalItems:eB(H.rest._def,{...I,currentPath:[...I.currentPath,"additionalItems"]})}:{type:"array",minItems:H.items.length,maxItems:H.items.length,items:H.items.map((a,b)=>eB(a._def,{...I,currentPath:[...I.currentPath,"items",`${b}`]})).reduce((a,b)=>void 0===b?a:[...a,b],[])};case o.ZodRecord:return ez(a,c);case o.ZodLiteral:var y=a;let z=typeof y.value;return"bigint"!==z&&"number"!==z&&"boolean"!==z&&"string"!==z?{type:Array.isArray(y.value)?"array":"object"}:{type:"bigint"===z?"integer":z,const:y.value};case o.ZodEnum:return{type:"string",enum:Array.from(a.values)};case o.ZodNativeEnum:var A=a;let B=A.values,C=Object.keys(A.values).filter(a=>"number"!=typeof B[B[a]]).map(a=>B[a]),D=Array.from(new Set(C.map(a=>typeof a)));return{type:1===D.length?"string"===D[0]?"string":"number":["string","number"],enum:C};case o.ZodNullable:var E=a,F=c;if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(E.innerType._def.typeName)&&(!E.innerType._def.checks||!E.innerType._def.checks.length))return{type:[eA[E.innerType._def.typeName],"null"]};let G=eB(E.innerType._def,{...F,currentPath:[...F.currentPath,"anyOf","0"]});return G&&{anyOf:[G,{type:"null"}]};case o.ZodOptional:var H,I,J,K=a,L=c;if(L.currentPath.toString()===(null==(J=L.propertyPath)?void 0:J.toString()))return eB(K.innerType._def,L);let M=eB(K.innerType._def,{...L,currentPath:[...L.currentPath,"anyOf","1"]});return M?{anyOf:[{not:{}},M]}:{};case o.ZodMap:return d=a,"record"===(e=c).mapStrategy?ez(d,e):{type:"array",maxItems:125,items:{type:"array",items:[eB(d.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},eB(d.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{}],minItems:2,maxItems:2}};case o.ZodSet:var N=a,O=c;let P={type:"array",uniqueItems:!0,items:eB(N.valueType._def,{...O,currentPath:[...O.currentPath,"items"]})};return N.minSize&&(P.minItems=N.minSize.value),N.maxSize&&(P.maxItems=N.maxSize.value),P;case o.ZodLazy:return()=>a.getter()._def;case o.ZodPromise:return eB(a.type._def,c);case o.ZodNaN:case o.ZodNever:return{not:{}};case o.ZodEffects:return f=a,"input"===(g=c).effectStrategy?eB(f.schema._def,g):{};case o.ZodAny:case o.ZodUnknown:return{};case o.ZodDefault:return h=a,i=c,{...eB(h.innerType._def,i),default:h.defaultValue()};case o.ZodBranded:return eq(a,c);case o.ZodReadonly:case o.ZodCatch:return eB(a.innerType._def,c);case o.ZodPipeline:var Q=a,R=c;if("input"===R.pipeStrategy)return eB(Q.in._def,R);if("output"===R.pipeStrategy)return eB(Q.out._def,R);let S=eB(Q.in._def,{...R,currentPath:[...R.currentPath,"allOf","0"]}),T=eB(Q.out._def,{...R,currentPath:[...R.currentPath,"allOf",S?"1":"0"]});return{allOf:[S,T].filter(a=>void 0!==a)};case o.ZodFunction:case o.ZodVoid:case o.ZodSymbol:default:return}})(a,a.typeName,b),h="function"==typeof g?eB(g(),b):g;if(h&&eD(a,b,h),b.postProcess){let c=b.postProcess(h,a,b);return f.jsonSchema=h,c}return f.jsonSchema=h,h}var eC=(a,b)=>{switch(b.$refStrategy){case"root":return{$ref:a.path.join("/")};case"relative":return{$ref:((a,b)=>{let c=0;for(;c<a.length&&c<b.length&&a[c]===b[c];c++);return[(a.length-c).toString(),...b.slice(c)].join("/")})(b.currentPath,a.path)};case"none":case"seen":if(a.path.length<b.currentPath.length&&a.path.every((a,c)=>b.currentPath[c]===a))return console.warn(`Recursive reference detected at ${b.currentPath.join("/")}! Defaulting to any`),{};return"seen"===b.$refStrategy?{}:void 0}},eD=(a,b,c)=>(a.description&&(c.description=a.description),c);function eE(a,b){var c,d;if("_zod"in a){let d=null!=(c=null==b?void 0:b.useReferences)&&c;return eG(()=>aS.toJSONSchema(a,{target:"draft-7",io:"output",reused:d?"ref":"inline"}),{validate:async b=>{let c=await aU.safeParseAsync(a,b);return c.success?{success:!0,value:c.data}:{success:!1,error:c.error}}})}let e=null!=(d=null==b?void 0:b.useReferences)&&d;return eG(()=>((a,b)=>{var c;let d=(a=>{let b,c="string"==typeof(b=a)?{...ep,name:b}:{...ep,...b},d=void 0!==c.name?[...c.basePath,c.definitionPath,c.name]:c.basePath;return{...c,currentPath:d,propertyPath:void 0,seen:new Map(Object.entries(c.definitions).map(([a,b])=>[b._def,{def:b._def,path:[...c.basePath,c.definitionPath,a],jsonSchema:void 0}]))}})(b),e="object"==typeof b&&b.definitions?Object.entries(b.definitions).reduce((a,[b,c])=>{var e;return{...a,[b]:null!=(e=eB(c._def,{...d,currentPath:[...d.basePath,d.definitionPath,b]},!0))?e:{}}},{}):void 0,f="string"==typeof b?b:(null==b?void 0:b.nameStrategy)==="title"||null==b?void 0:b.name,g=null!=(c=eB(a._def,void 0===f?d:{...d,currentPath:[...d.basePath,d.definitionPath,f]},!1))?c:{},h="object"==typeof b&&void 0!==b.name&&"title"===b.nameStrategy?b.name:void 0;void 0!==h&&(g.title=h);let i=void 0===f?e?{...g,[d.definitionPath]:e}:g:{$ref:[..."relative"===d.$refStrategy?[]:d.basePath,d.definitionPath,f].join("/"),[d.definitionPath]:{...e,[f]:g}};return i.$schema="http://json-schema.org/draft-07/schema#",i})(a,{$refStrategy:e?"root":"none"}),{validate:async b=>{let c=await a.safeParseAsync(b);return c.success?{success:!0,value:c.data}:{success:!1,error:c.error}}})}var eF=Symbol.for("vercel.ai.schema");function eG(a,{validate:b}={}){return{[eF]:!0,_type:void 0,[ek]:!0,get jsonSchema(){return"function"==typeof a&&(a=a()),a},validate:b}}function eH(a){return null==a?eG({properties:{},additionalProperties:!1}):"object"==typeof a&&null!==a&&eF in a&&!0===a[eF]&&"jsonSchema"in a&&"validate"in a?a:"function"==typeof a?a():eE(a)}var{btoa:eI,atob:eJ}=globalThis;function eK(a){let b=eJ(a.replace(/-/g,"+").replace(/_/g,"/"));return Uint8Array.from(b,a=>a.codePointAt(0))}function eL(a){let b="";for(let c=0;c<a.length;c++)b+=String.fromCodePoint(a[c]);return eI(b)}async function*eM({execute:a,input:b,options:c}){let d=a(b,c);if(null!=d&&"function"==typeof d[Symbol.asyncIterator]){let a;for await(let b of d)a=b,yield{type:"preliminary",output:b};yield{type:"final",output:a}}else yield{type:"final",output:await d}}var dC=aS,eN=a.i(234381),eO=a.i(72721),eP=Object.defineProperty,eQ="AI_NoOutputSpecifiedError",eR=`vercel.ai.error.${eQ}`,eS=Symbol.for(eR),eT=class extends ae{constructor({message:a="No output specified."}={}){super({name:eQ,message:a}),this[D]=!0}static isInstance(a){return ae.hasMarker(a,eR)}};D=eS;var eU=!1,eV=a=>{if(0===a.length)return;let b=globalThis.AI_SDK_LOG_WARNINGS;if(!1!==b){if("function"==typeof b)return void b(a);for(let b of(eU||(eU=!0,console.info("AI SDK Warning System: To turn off warning logging, set the AI_SDK_LOG_WARNINGS global to false.")),a))console.warn(function(a){let b="AI SDK Warning:";switch(a.type){case"unsupported-setting":{let c=`${b} The "${a.setting}" setting is not supported by this model`;return a.details&&(c+=` - ${a.details}`),c}case"unsupported-tool":{let c="name"in a.tool?a.tool.name:"unknown tool",d=`${b} The tool "${c}" is not supported by this model`;return a.details&&(d+=` - ${a.details}`),d}case"other":return`${b} ${a.message}`;default:return`${b} ${JSON.stringify(a,null,2)}`}}(b))}},eW="AI_InvalidArgumentError",eX=`vercel.ai.error.${eW}`,eY=Symbol.for(eX),eZ=class extends ae{constructor({parameter:a,value:b,message:c}){super({name:eW,message:`Invalid argument for parameter ${a}: ${c}`}),this[E]=!0,this.parameter=a,this.value=b}static isInstance(a){return ae.hasMarker(a,eX)}};E=eY,Symbol.for("vercel.ai.error.AI_InvalidStreamPartError");var e$="AI_InvalidToolInputError",e_=`vercel.ai.error.${e$}`,e0=Symbol.for(e_),e1=class extends ae{constructor({toolInput:a,toolName:b,cause:c,message:d=`Invalid input for tool ${b}: ${an(c)}`}){super({name:e$,message:d,cause:c}),this[F]=!0,this.toolInput=a,this.toolName=b}static isInstance(a){return ae.hasMarker(a,e_)}};F=e0,Symbol.for("vercel.ai.error.AI_NoImageGeneratedError");var e2="AI_NoObjectGeneratedError",e3=`vercel.ai.error.${e2}`,e4=Symbol.for(e3),e5=class extends ae{constructor({message:a="No object generated.",cause:b,text:c,response:d,usage:e,finishReason:f}){super({name:e2,message:a,cause:b}),this[G]=!0,this.text=c,this.response=d,this.usage=e,this.finishReason=f}static isInstance(a){return ae.hasMarker(a,e3)}};G=e4,Symbol.for("vercel.ai.error.AI_NoOutputGeneratedError");var e6="AI_NoSuchToolError",e7=`vercel.ai.error.${e6}`,e8=Symbol.for(e7),e9=class extends ae{constructor({toolName:a,availableTools:b,message:c=`Model tried to call unavailable tool '${a}'. ${void 0===b?"No tools are available.":`Available tools: ${b.join(", ")}.`}`}){super({name:e6,message:c}),this[H]=!0,this.toolName=a,this.availableTools=b}static isInstance(a){return ae.hasMarker(a,e7)}};H=e8;var fa="AI_ToolCallRepairError",fb=`vercel.ai.error.${fa}`,fc=Symbol.for(fb),fd=class extends ae{constructor({cause:a,originalError:b,message:c=`Error repairing tool call: ${an(a)}`}){super({name:fa,message:c,cause:a}),this[I]=!0,this.originalError=b}static isInstance(a){return ae.hasMarker(a,fb)}};I=fc;var fe=class extends ae{constructor(a){super({name:"AI_UnsupportedModelVersionError",message:`Unsupported model version ${a.version} for provider "${a.provider}" and model "${a.modelId}". AI SDK 5 only supports models that implement specification version "v2".`}),this.version=a.version,this.provider=a.provider,this.modelId=a.modelId}},ff=(Symbol.for("vercel.ai.error.AI_InvalidDataContentError"),"AI_InvalidMessageRoleError"),fg=`vercel.ai.error.${ff}`,fh=Symbol.for(fg),fi=class extends ae{constructor({role:a,message:b=`Invalid message role: '${a}'. Must be one of: "system", "user", "assistant", "tool".`}){super({name:ff,message:b}),this[J]=!0,this.role=a}static isInstance(a){return ae.hasMarker(a,fg)}};J=fh,Symbol.for("vercel.ai.error.AI_MessageConversionError");var fj="AI_DownloadError",fk=`vercel.ai.error.${fj}`,fl=Symbol.for(fk),fm=class extends ae{constructor({url:a,statusCode:b,statusText:c,cause:d,message:e=null==d?`Failed to download ${a}: ${b} ${c}`:`Failed to download ${a}: ${d}`}){super({name:fj,message:e,cause:d}),this[K]=!0,this.url=a,this.statusCode=b,this.statusText=c}static isInstance(a){return ae.hasMarker(a,fk)}};K=fl;var fn="AI_RetryError",fo=`vercel.ai.error.${fn}`,fp=Symbol.for(fo),fq=class extends ae{constructor({message:a,reason:b,errors:c}){super({name:fn,message:a}),this[L]=!0,this.reason=b,this.errors=c,this.lastError=c[c.length-1]}static isInstance(a){return ae.hasMarker(a,fo)}};function fr(a){var b;if("string"!=typeof a){if("v2"!==a.specificationVersion)throw new fe({version:a.specificationVersion,provider:a.provider,modelId:a.modelId});return a}return(null!=(b=globalThis.AI_SDK_DEFAULT_PROVIDER)?b:ea).languageModel(a)}L=fp;var fs=[{mediaType:"image/gif",bytesPrefix:[71,73,70]},{mediaType:"image/png",bytesPrefix:[137,80,78,71]},{mediaType:"image/jpeg",bytesPrefix:[255,216]},{mediaType:"image/webp",bytesPrefix:[82,73,70,70,null,null,null,null,87,69,66,80]},{mediaType:"image/bmp",bytesPrefix:[66,77]},{mediaType:"image/tiff",bytesPrefix:[73,73,42,0]},{mediaType:"image/tiff",bytesPrefix:[77,77,0,42]},{mediaType:"image/avif",bytesPrefix:[0,0,0,32,102,116,121,112,97,118,105,102]},{mediaType:"image/heic",bytesPrefix:[0,0,0,32,102,116,121,112,104,101,105,99]}],ft="5.0.93",fu=async({url:a})=>{var b;let c=a.toString();try{let a=await fetch(c,{headers:eg({},`ai-sdk/${ft}`,function(a=globalThis){var b,c,d;return a.window?"runtime/browser":(null==(b=a.navigator)?void 0:b.userAgent)?`runtime/${a.navigator.userAgent.toLowerCase()}`:(null==(d=null==(c=a.process)?void 0:c.versions)?void 0:d.node)?`runtime/node.js/${a.process.version.substring(0)}`:a.EdgeRuntime?"runtime/vercel-edge":"runtime/unknown"}())});if(!a.ok)throw new fm({url:c,statusCode:a.status,statusText:a.statusText});return{data:new Uint8Array(await a.arrayBuffer()),mediaType:null!=(b=a.headers.get("content-type"))?b:void 0}}catch(a){if(fm.isInstance(a))throw a;throw new fm({url:c,cause:a})}},fv=dC.union([dC.string(),dC.instanceof(Uint8Array),dC.instanceof(ArrayBuffer),dC.custom(a=>{var b,c;return null!=(c=null==(b=globalThis.Buffer)?void 0:b.isBuffer(a))&&c},{message:"Must be a Buffer"})]);function fw(a){if(a instanceof Uint8Array)return{data:a,mediaType:void 0};if(a instanceof ArrayBuffer)return{data:new Uint8Array(a),mediaType:void 0};if("string"==typeof a)try{a=new URL(a)}catch(a){}if(a instanceof URL&&"data:"===a.protocol){let{mediaType:b,base64Content:c}=function(a){try{let[b,c]=a.split(",");return{mediaType:b.split(";")[0].split(":")[1],base64Content:c}}catch(a){return{mediaType:void 0,base64Content:void 0}}}(a.toString());if(null==b||null==c)throw new ae({name:"InvalidDataContentError",message:`Invalid data URL format in content ${a.toString()}`});return{data:c,mediaType:b}}return{data:a,mediaType:void 0}}async function fx({prompt:a,supportedUrls:b,download:c=((a=fu)=>b=>Promise.all(b.map(async b=>b.isUrlSupportedByModel?null:a(b))))()}){let d=await fy(a.messages,c,b);return[...null!=a.system?[{role:"system",content:a.system}]:[],...a.messages.map(a=>(function({message:a,downloadedAssets:b}){let c=a.role;switch(c){case"system":return{role:"system",content:a.content,providerOptions:a.providerOptions};case"user":if("string"==typeof a.content)return{role:"user",content:[{type:"text",text:a.content}],providerOptions:a.providerOptions};return{role:"user",content:a.content.map(a=>(function(a,b){var c;let d;if("text"===a.type)return{type:"text",text:a.text,providerOptions:a.providerOptions};let e=a.type;switch(e){case"image":d=a.image;break;case"file":d=a.data;break;default:throw Error(`Unsupported part type: ${e}`)}let{data:f,mediaType:g}=fw(d),h=null!=g?g:a.mediaType,i=f;if(i instanceof URL){let a=b[i.toString()];a&&(i=a.data,null!=h||(h=a.mediaType))}switch(e){case"image":return(i instanceof Uint8Array||"string"==typeof i)&&(h=null!=(c=function({data:a,signatures:b}){let c="string"==typeof a&&a.startsWith("SUQz")||"string"!=typeof a&&a.length>10&&73===a[0]&&68===a[1]&&51===a[2]?(a=>{let b="string"==typeof a?eK(a):a,c=(127&b[6])<<21|(127&b[7])<<14|(127&b[8])<<7|127&b[9];return b.slice(c+10)})(a):a,d="string"==typeof c?eK(c.substring(0,Math.min(c.length,24))):c;for(let a of b)if(d.length>=a.bytesPrefix.length&&a.bytesPrefix.every((a,b)=>null===a||d[b]===a))return a.mediaType}({data:i,signatures:fs}))?c:h),{type:"file",mediaType:null!=h?h:"image/*",filename:void 0,data:i,providerOptions:a.providerOptions};case"file":if(null==h)throw Error("Media type is missing for file part");return{type:"file",mediaType:h,filename:a.filename,data:i,providerOptions:a.providerOptions}}})(a,b)).filter(a=>"text"!==a.type||""!==a.text),providerOptions:a.providerOptions};case"assistant":if("string"==typeof a.content)return{role:"assistant",content:[{type:"text",text:a.content}],providerOptions:a.providerOptions};return{role:"assistant",content:a.content.filter(a=>"text"!==a.type||""!==a.text||null!=a.providerOptions).map(a=>{let b=a.providerOptions;switch(a.type){case"file":{let{data:c,mediaType:d}=fw(a.data);return{type:"file",data:c,filename:a.filename,mediaType:null!=d?d:a.mediaType,providerOptions:b}}case"reasoning":return{type:"reasoning",text:a.text,providerOptions:b};case"text":return{type:"text",text:a.text,providerOptions:b};case"tool-call":return{type:"tool-call",toolCallId:a.toolCallId,toolName:a.toolName,input:a.input,providerExecuted:a.providerExecuted,providerOptions:b};case"tool-result":return{type:"tool-result",toolCallId:a.toolCallId,toolName:a.toolName,output:a.output,providerOptions:b}}}),providerOptions:a.providerOptions};case"tool":return{role:"tool",content:a.content.map(a=>({type:"tool-result",toolCallId:a.toolCallId,toolName:a.toolName,output:a.output,providerOptions:a.providerOptions})),providerOptions:a.providerOptions};default:throw new fi({role:c})}})({message:a,downloadedAssets:d}))]}async function fy(a,b,c){let d=a.filter(a=>"user"===a.role).map(a=>a.content).filter(a=>Array.isArray(a)).flat().filter(a=>"image"===a.type||"file"===a.type).map(a=>{var b;let c=null!=(b=a.mediaType)?b:"image"===a.type?"image/*":void 0,d="image"===a.type?a.image:a.data;if("string"==typeof d)try{d=new URL(d)}catch(a){}return{mediaType:c,data:d}}).filter(a=>a.data instanceof URL).map(a=>({url:a.data,isUrlSupportedByModel:null!=a.mediaType&&function({mediaType:a,url:b,supportedUrls:c}){return b=b.toLowerCase(),a=a.toLowerCase(),Object.entries(c).map(([a,b])=>{let c=a.toLowerCase();return"*"===c||"*/*"===c?{mediaTypePrefix:"",regexes:b}:{mediaTypePrefix:c.replace(/\*/,""),regexes:b}}).filter(({mediaTypePrefix:b})=>a.startsWith(b)).flatMap(({regexes:a})=>a).some(a=>a.test(b))}({url:a.data.toString(),mediaType:a.mediaType,supportedUrls:c})}));return Object.fromEntries((await b(d)).map((a,b)=>null==a?null:[d[b].url.toString(),{data:a.data,mediaType:a.mediaType}]).filter(a=>null!=a))}function fz({maxOutputTokens:a,temperature:b,topP:c,topK:d,presencePenalty:e,frequencyPenalty:f,seed:g,stopSequences:h}){if(null!=a){if(!Number.isInteger(a))throw new eZ({parameter:"maxOutputTokens",value:a,message:"maxOutputTokens must be an integer"});if(a<1)throw new eZ({parameter:"maxOutputTokens",value:a,message:"maxOutputTokens must be >= 1"})}if(null!=b&&"number"!=typeof b)throw new eZ({parameter:"temperature",value:b,message:"temperature must be a number"});if(null!=c&&"number"!=typeof c)throw new eZ({parameter:"topP",value:c,message:"topP must be a number"});if(null!=d&&"number"!=typeof d)throw new eZ({parameter:"topK",value:d,message:"topK must be a number"});if(null!=e&&"number"!=typeof e)throw new eZ({parameter:"presencePenalty",value:e,message:"presencePenalty must be a number"});if(null!=f&&"number"!=typeof f)throw new eZ({parameter:"frequencyPenalty",value:f,message:"frequencyPenalty must be a number"});if(null!=g&&!Number.isInteger(g))throw new eZ({parameter:"seed",value:g,message:"seed must be an integer"});return{maxOutputTokens:a,temperature:b,topP:c,topK:d,presencePenalty:e,frequencyPenalty:f,stopSequences:h,seed:g}}var fA=dC.lazy(()=>dC.union([dC.null(),dC.string(),dC.number(),dC.boolean(),dC.record(dC.string(),fA),dC.array(fA)])),fB=dC.record(dC.string(),dC.record(dC.string(),fA)),fC=dC.object({type:dC.literal("text"),text:dC.string(),providerOptions:fB.optional()}),fD=dC.object({type:dC.literal("image"),image:dC.union([fv,dC.instanceof(URL)]),mediaType:dC.string().optional(),providerOptions:fB.optional()}),fE=dC.object({type:dC.literal("file"),data:dC.union([fv,dC.instanceof(URL)]),filename:dC.string().optional(),mediaType:dC.string(),providerOptions:fB.optional()}),fF=dC.object({type:dC.literal("reasoning"),text:dC.string(),providerOptions:fB.optional()}),fG=dC.object({type:dC.literal("tool-call"),toolCallId:dC.string(),toolName:dC.string(),input:dC.unknown(),providerOptions:fB.optional(),providerExecuted:dC.boolean().optional()}),fH=dC.discriminatedUnion("type",[dC.object({type:dC.literal("text"),value:dC.string()}),dC.object({type:dC.literal("json"),value:fA}),dC.object({type:dC.literal("error-text"),value:dC.string()}),dC.object({type:dC.literal("error-json"),value:fA}),dC.object({type:dC.literal("content"),value:dC.array(dC.union([dC.object({type:dC.literal("text"),text:dC.string()}),dC.object({type:dC.literal("media"),data:dC.string(),mediaType:dC.string()})]))})]),fI=dC.object({type:dC.literal("tool-result"),toolCallId:dC.string(),toolName:dC.string(),output:fH,providerOptions:fB.optional()}),fJ=dC.object({role:dC.literal("system"),content:dC.string(),providerOptions:fB.optional()}),fK=dC.object({role:dC.literal("user"),content:dC.union([dC.string(),dC.array(dC.union([fC,fD,fE]))]),providerOptions:fB.optional()}),fL=dC.object({role:dC.literal("assistant"),content:dC.union([dC.string(),dC.array(dC.union([fC,fE,fF,fG,fI]))]),providerOptions:fB.optional()}),fM=dC.object({role:dC.literal("tool"),content:dC.array(fI),providerOptions:fB.optional()}),fN=dC.union([fJ,fK,fL,fM]);async function fO(a){let b;if(null==a.prompt&&null==a.messages)throw new av({prompt:a,message:"prompt or messages must be defined"});if(null!=a.prompt&&null!=a.messages)throw new av({prompt:a,message:"prompt and messages cannot be defined at the same time"});if(null!=a.system&&"string"!=typeof a.system)throw new av({prompt:a,message:"system must be a string"});if(null!=a.prompt&&"string"==typeof a.prompt)b=[{role:"user",content:a.prompt}];else if(null!=a.prompt&&Array.isArray(a.prompt))b=a.prompt;else if(null!=a.messages)b=a.messages;else throw new av({prompt:a,message:"prompt or messages must be defined"});if(0===b.length)throw new av({prompt:a,message:"messages must not be empty"});let c=await em({value:b,schema:dC.array(fN)});if(!c.success)throw new av({prompt:a,message:"The messages must be a ModelMessage[]. If you have passed a UIMessage[], you can use convertToModelMessages to convert them.",cause:c.error});return{messages:b,system:a.system}}function fP(a){return dI.isInstance(a)||dS.isInstance(a)?new ae({name:"GatewayError",message:"Vercel AI Gateway access failed. If you want to use AI SDK providers directly, use the providers, e.g. @ai-sdk/openai, or register a different global default provider.",cause:a}):a}function fQ({operationId:a,telemetry:b}){return{"operation.name":`${a}${(null==b?void 0:b.functionId)!=null?` ${b.functionId}`:""}`,"resource.name":null==b?void 0:b.functionId,"ai.operationId":a,"ai.telemetry.functionId":null==b?void 0:b.functionId}}function fR({model:a,settings:b,telemetry:c,headers:d}){var e;return{"ai.model.provider":a.provider,"ai.model.id":a.modelId,...Object.entries(b).reduce((a,[b,c])=>(a[`ai.settings.${b}`]=c,a),{}),...Object.entries(null!=(e=null==c?void 0:c.metadata)?e:{}).reduce((a,[b,c])=>(a[`ai.telemetry.metadata.${b}`]=c,a),{}),...Object.entries(null!=d?d:{}).reduce((a,[b,c])=>(void 0!==c&&(a[`ai.request.headers.${b}`]=c),a),{})}}var fS={startSpan:()=>fT,startActiveSpan:(a,b,c,d)=>"function"==typeof b?b(fT):"function"==typeof c?c(fT):"function"==typeof d?d(fT):void 0},fT={spanContext:()=>fU,setAttribute(){return this},setAttributes(){return this},addEvent(){return this},addLink(){return this},addLinks(){return this},setStatus(){return this},updateName(){return this},end(){return this},isRecording:()=>!1,recordException(){return this}},fU={traceId:"",spanId:"",traceFlags:0};function fV({isEnabled:a=!1,tracer:b}={}){return a?b||eN.trace.getTracer("ai"):fS}function fW({name:a,tracer:b,attributes:c,fn:d,endWhenDone:e=!0}){return b.startActiveSpan(a,{attributes:c},async a=>{try{let b=await d(a);return e&&a.end(),b}catch(b){try{fX(a,b)}finally{a.end()}throw b}})}function fX(a,b){b instanceof Error?(a.recordException({name:b.name,message:b.message,stack:b.stack}),a.setStatus({code:eO.SpanStatusCode.ERROR,message:b.message})):a.setStatus({code:eO.SpanStatusCode.ERROR})}function fY({telemetry:a,attributes:b}){return(null==a?void 0:a.isEnabled)!==!0?{}:Object.entries(b).reduce((b,[c,d])=>{if(null==d)return b;if("object"==typeof d&&"input"in d&&"function"==typeof d.input){if((null==a?void 0:a.recordInputs)===!1)return b;let e=d.input();return null==e?b:{...b,[c]:e}}if("object"==typeof d&&"output"in d&&"function"==typeof d.output){if((null==a?void 0:a.recordOutputs)===!1)return b;let e=d.output();return null==e?b:{...b,[c]:e}}return{...b,[c]:d}},{})}function fZ(a){return JSON.stringify(a.map(a=>({...a,content:"string"==typeof a.content?a.content:a.content.map(a=>{var b;return"file"===a.type?{...a,data:a.data instanceof Uint8Array?"string"==typeof(b=a.data)?b:b instanceof ArrayBuffer?eL(new Uint8Array(b)):eL(b):a.data}:a})})))}function f$(a,b){return null==a&&null==b?void 0:(null!=a?a:0)+(null!=b?b:0)}function f_(a){return void 0===a?[]:Array.isArray(a)?a:[a]}async function f0(a,{maxRetries:b,delayInMs:c,backoffFactor:d,abortSignal:e},f=[]){try{return await a()}catch(j){if((j instanceof Error||j instanceof DOMException)&&("AbortError"===j.name||"ResponseAborted"===j.name||"TimeoutError"===j.name)||0===b)throw j;let g=ef(j),h=[...f,j],i=h.length;if(i>b)throw new fq({message:`Failed after ${i} attempts. Last error: ${g}`,reason:"maxRetriesExceeded",errors:h});if(j instanceof Error&&ai.isInstance(j)&&!0===j.isRetryable&&i<=b)return await ec(function({error:a,exponentialBackoffDelay:b}){let c,d=a.responseHeaders;if(!d)return b;let e=d["retry-after-ms"];if(e){let a=parseFloat(e);Number.isNaN(a)||(c=a)}let f=d["retry-after"];if(f&&void 0===c){let a=parseFloat(f);c=Number.isNaN(a)?Date.parse(f)-Date.now():1e3*a}return null!=c&&!Number.isNaN(c)&&0<=c&&(c<6e4||c<b)?c:b}({error:j,exponentialBackoffDelay:c}),{abortSignal:e}),f0(a,{maxRetries:b,delayInMs:d*c,backoffFactor:d,abortSignal:e},h);if(1===i)throw j;throw new fq({message:`Failed after ${i} attempts with non-retryable error: '${g}'`,reason:"errorNotRetryable",errors:h})}}function f1({maxRetries:a,abortSignal:b}){if(null!=a){if(!Number.isInteger(a))throw new eZ({parameter:"maxRetries",value:a,message:"maxRetries must be an integer"});if(a<0)throw new eZ({parameter:"maxRetries",value:a,message:"maxRetries must be >= 0"})}let c=null!=a?a:2;return{maxRetries:c,retry:(({maxRetries:a=2,initialDelayInMs:b=2e3,backoffFactor:c=2,abortSignal:d}={})=>async e=>f0(e,{maxRetries:a,delayInMs:b,backoffFactor:c,abortSignal:d}))({maxRetries:c,abortSignal:b})}}function f2(a){let b=a.filter(a=>"text"===a.type);if(0!==b.length)return b.map(a=>a.text).join("")}var f3=class{constructor({data:a,mediaType:b}){let c=a instanceof Uint8Array;this.base64Data=c?void 0:a,this.uint8ArrayData=c?a:void 0,this.mediaType=b}get base64(){return null==this.base64Data&&(this.base64Data=eL(this.uint8ArrayData)),this.base64Data}get uint8Array(){return null==this.uint8ArrayData&&(this.uint8ArrayData=eK(this.base64Data)),this.uint8ArrayData}};async function f4({toolCall:a,tools:b,repairToolCall:c,system:d,messages:e}){try{if(null==b)throw new e9({toolName:a.toolName});try{return await f5({toolCall:a,tools:b})}catch(g){if(null==c||!(e9.isInstance(g)||e1.isInstance(g)))throw g;let f=null;try{f=await c({toolCall:a,tools:b,inputSchema:({toolName:a})=>{let{inputSchema:c}=b[a];return eH(c).jsonSchema},system:d,messages:e,error:g})}catch(a){throw new fd({cause:a,originalError:g})}if(null==f)throw g;return await f5({toolCall:f,tools:b})}}catch(d){let b=await en({text:a.input}),c=b.success?b.value:a.input;return{type:"tool-call",toolCallId:a.toolCallId,toolName:a.toolName,input:c,dynamic:!0,invalid:!0,error:d}}}async function f5({toolCall:a,tools:b}){let c=a.toolName,d=b[c];if(null==d)throw new e9({toolName:a.toolName,availableTools:Object.keys(b)});let e=eH(d.inputSchema),f=""===a.input.trim()?await em({value:{},schema:e}):await en({text:a.input,schema:e});if(!1===f.success)throw new e1({toolName:c,toolInput:a.input,cause:f.error});return"dynamic"===d.type?{type:"tool-call",toolCallId:a.toolCallId,toolName:a.toolName,input:f.value,providerExecuted:a.providerExecuted,providerMetadata:a.providerMetadata,dynamic:!0}:{type:"tool-call",toolCallId:a.toolCallId,toolName:c,input:f.value,providerExecuted:a.providerExecuted,providerMetadata:a.providerMetadata}}var f6=class{constructor({content:a,finishReason:b,usage:c,warnings:d,request:e,response:f,providerMetadata:g}){this.content=a,this.finishReason=b,this.usage=c,this.warnings=d,this.request=e,this.response=f,this.providerMetadata=g}get text(){return this.content.filter(a=>"text"===a.type).map(a=>a.text).join("")}get reasoning(){return this.content.filter(a=>"reasoning"===a.type)}get reasoningText(){return 0===this.reasoning.length?void 0:this.reasoning.map(a=>a.text).join("")}get files(){return this.content.filter(a=>"file"===a.type).map(a=>a.file)}get sources(){return this.content.filter(a=>"source"===a.type)}get toolCalls(){return this.content.filter(a=>"tool-call"===a.type)}get staticToolCalls(){return this.toolCalls.filter(a=>!0!==a.dynamic)}get dynamicToolCalls(){return this.toolCalls.filter(a=>!0===a.dynamic)}get toolResults(){return this.content.filter(a=>"tool-result"===a.type)}get staticToolResults(){return this.toolResults.filter(a=>!0!==a.dynamic)}get dynamicToolResults(){return this.toolResults.filter(a=>!0===a.dynamic)}};async function f7({stopConditions:a,steps:b}){return(await Promise.all(a.map(a=>a({steps:b})))).some(a=>a)}function f8({output:a,tool:b,errorMode:c}){return"text"===c?{type:"error-text",value:an(a)}:"json"===c?{type:"error-json",value:f9(a)}:(null==b?void 0:b.toModelOutput)?b.toModelOutput(a):"string"==typeof a?{type:"text",value:a}:{type:"json",value:f9(a)}}function f9(a){return void 0===a?null:a}var ga=ee({prefix:"aitxt",size:24});async function gb({model:a,tools:b,toolChoice:c,system:d,prompt:e,messages:f,maxRetries:g,abortSignal:h,headers:i,stopWhen:j=function(a){return({steps:a})=>1===a.length}(0),experimental_output:k,experimental_telemetry:l,providerOptions:m,experimental_activeTools:n,activeTools:o=n,experimental_prepareStep:p,prepareStep:q=p,experimental_repairToolCall:r,experimental_download:s,experimental_context:t,_internal:{generateId:u=ga,currentDate:v=()=>new Date}={},onStepFinish:w,...x}){let y=fr(a),z=f_(j),{maxRetries:A,retry:B}=f1({maxRetries:g,abortSignal:h}),C=fz(x),D=eg(null!=i?i:{},`ai/${ft}`),E=fR({model:y,telemetry:l,headers:D,settings:{...C,maxRetries:A}}),F=await fO({system:d,prompt:e,messages:f}),G=fV(l);try{return await fW({name:"ai.generateText",attributes:fY({telemetry:l,attributes:{...fQ({operationId:"ai.generateText",telemetry:l}),...E,"ai.model.provider":y.provider,"ai.model.id":y.modelId,"ai.prompt":{input:()=>JSON.stringify({system:d,prompt:e,messages:f})}}}),tracer:G,fn:async a=>{var e,f,g,i,j,n,p;let A,C,H=fz(x),I=[],J=[],K=[],L=[];do{let a=[...F.messages,...K],z=await (null==q?void 0:q({model:y,steps:L,stepNumber:L.length,messages:a})),C=fr(null!=(e=null==z?void 0:z.model)?e:y),M=await fx({prompt:{system:null!=(f=null==z?void 0:z.system)?f:F.system,messages:null!=(g=null==z?void 0:z.messages)?g:a},supportedUrls:await C.supportedUrls,download:s}),{toolChoice:N,tools:O}=function({tools:a,toolChoice:b,activeTools:c}){return null!=a&&Object.keys(a).length>0?{tools:(null!=c?Object.entries(a).filter(([a])=>c.includes(a)):Object.entries(a)).map(([a,b])=>{let c=b.type;switch(c){case void 0:case"dynamic":case"function":return{type:"function",name:a,description:b.description,inputSchema:eH(b.inputSchema).jsonSchema,providerOptions:b.providerOptions};case"provider-defined":return{type:"provider-defined",name:a,id:b.id,args:b.args};default:throw Error(`Unsupported tool type: ${c}`)}}),toolChoice:null==b?{type:"auto"}:"string"==typeof b?{type:b}:{type:"tool",toolName:b.toolName}}:{tools:void 0,toolChoice:void 0}}({tools:b,toolChoice:null!=(i=null==z?void 0:z.toolChoice)?i:c,activeTools:null!=(j=null==z?void 0:z.activeTools)?j:o});A=await B(()=>{var a;return fW({name:"ai.generateText.doGenerate",attributes:fY({telemetry:l,attributes:{...fQ({operationId:"ai.generateText.doGenerate",telemetry:l}),...E,"ai.model.provider":C.provider,"ai.model.id":C.modelId,"ai.prompt.messages":{input:()=>fZ(M)},"ai.prompt.tools":{input:()=>null==O?void 0:O.map(a=>JSON.stringify(a))},"ai.prompt.toolChoice":{input:()=>null!=N?JSON.stringify(N):void 0},"gen_ai.system":C.provider,"gen_ai.request.model":C.modelId,"gen_ai.request.frequency_penalty":x.frequencyPenalty,"gen_ai.request.max_tokens":x.maxOutputTokens,"gen_ai.request.presence_penalty":x.presencePenalty,"gen_ai.request.stop_sequences":x.stopSequences,"gen_ai.request.temperature":null!=(a=x.temperature)?a:void 0,"gen_ai.request.top_k":x.topK,"gen_ai.request.top_p":x.topP}}),tracer:G,fn:async a=>{var b,c,d,e,f,g,i,j;let n=await C.doGenerate({...H,tools:O,toolChoice:N,responseFormat:null==k?void 0:k.responseFormat,prompt:M,providerOptions:m,abortSignal:h,headers:D}),o={id:null!=(c=null==(b=n.response)?void 0:b.id)?c:u(),timestamp:null!=(e=null==(d=n.response)?void 0:d.timestamp)?e:v(),modelId:null!=(g=null==(f=n.response)?void 0:f.modelId)?g:C.modelId,headers:null==(i=n.response)?void 0:i.headers,body:null==(j=n.response)?void 0:j.body};return a.setAttributes(fY({telemetry:l,attributes:{"ai.response.finishReason":n.finishReason,"ai.response.text":{output:()=>f2(n.content)},"ai.response.toolCalls":{output:()=>{let a=ge(n.content);return null==a?void 0:JSON.stringify(a)}},"ai.response.id":o.id,"ai.response.model":o.modelId,"ai.response.timestamp":o.timestamp.toISOString(),"ai.response.providerMetadata":JSON.stringify(n.providerMetadata),"ai.usage.promptTokens":n.usage.inputTokens,"ai.usage.completionTokens":n.usage.outputTokens,"gen_ai.response.finish_reasons":[n.finishReason],"gen_ai.response.id":o.id,"gen_ai.response.model":o.modelId,"gen_ai.usage.input_tokens":n.usage.inputTokens,"gen_ai.usage.output_tokens":n.usage.outputTokens}})),{...n,response:o}}})});let P=await Promise.all(A.content.filter(a=>"tool-call"===a.type).map(c=>f4({toolCall:c,tools:b,repairToolCall:r,system:d,messages:a})));for(let c of P){if(c.invalid)continue;let d=b[c.toolName];(null==d?void 0:d.onInputAvailable)!=null&&await d.onInputAvailable({input:c.input,toolCallId:c.toolCallId,messages:a,abortSignal:h,experimental_context:t})}let Q=P.filter(a=>a.invalid&&a.dynamic);for(let a of(J=[],Q))J.push({type:"tool-error",toolCallId:a.toolCallId,toolName:a.toolName,input:a.input,error:ef(a.error),dynamic:!0});I=P.filter(a=>!a.providerExecuted),null!=b&&J.push(...await gc({toolCalls:I.filter(a=>!a.invalid),tools:b,tracer:G,telemetry:l,messages:a,abortSignal:h,experimental_context:t}));let R=function({content:a,toolCalls:b,toolOutputs:c}){return[...a.map(a=>{switch(a.type){case"text":case"reasoning":case"source":return a;case"file":return{type:"file",file:new f3(a)};case"tool-call":return b.find(b=>b.toolCallId===a.toolCallId);case"tool-result":{let c=b.find(b=>b.toolCallId===a.toolCallId);if(null==c)throw Error(`Tool call ${a.toolCallId} not found.`);if(a.isError)return{type:"tool-error",toolCallId:a.toolCallId,toolName:a.toolName,input:c.input,error:a.result,providerExecuted:!0,dynamic:c.dynamic};return{type:"tool-result",toolCallId:a.toolCallId,toolName:a.toolName,input:c.input,output:a.result,providerExecuted:!0,dynamic:c.dynamic}}}}),...c]}({content:A.content,toolCalls:P,toolOutputs:J});K.push(...function({content:a,tools:b}){let c=[],d=a.filter(a=>"source"!==a.type).filter(a=>("tool-result"!==a.type||a.providerExecuted)&&("tool-error"!==a.type||a.providerExecuted)).filter(a=>"text"!==a.type||a.text.length>0).map(a=>{switch(a.type){case"text":return{type:"text",text:a.text,providerOptions:a.providerMetadata};case"reasoning":return{type:"reasoning",text:a.text,providerOptions:a.providerMetadata};case"file":return{type:"file",data:a.file.base64,mediaType:a.file.mediaType,providerOptions:a.providerMetadata};case"tool-call":return{type:"tool-call",toolCallId:a.toolCallId,toolName:a.toolName,input:a.input,providerExecuted:a.providerExecuted,providerOptions:a.providerMetadata};case"tool-result":return{type:"tool-result",toolCallId:a.toolCallId,toolName:a.toolName,output:f8({tool:null==b?void 0:b[a.toolName],output:a.output,errorMode:"none"}),providerExecuted:!0,providerOptions:a.providerMetadata};case"tool-error":return{type:"tool-result",toolCallId:a.toolCallId,toolName:a.toolName,output:f8({tool:null==b?void 0:b[a.toolName],output:a.error,errorMode:"json"}),providerOptions:a.providerMetadata}}});d.length>0&&c.push({role:"assistant",content:d});let e=a.filter(a=>"tool-result"===a.type||"tool-error"===a.type).filter(a=>!a.providerExecuted).map(a=>({type:"tool-result",toolCallId:a.toolCallId,toolName:a.toolName,output:f8({tool:null==b?void 0:b[a.toolName],output:"tool-result"===a.type?a.output:a.error,errorMode:"tool-error"===a.type?"text":"none"})}));return e.length>0&&c.push({role:"tool",content:e}),c}({content:R,tools:b}));let S=new f6({content:R,finishReason:A.finishReason,usage:A.usage,warnings:A.warnings,providerMetadata:A.providerMetadata,request:null!=(n=A.request)?n:{},response:{...A.response,messages:structuredClone(K)}});eV(null!=(p=A.warnings)?p:[]),L.push(S),await (null==w?void 0:w(S))}while(I.length>0&&J.length===I.length&&!await f7({stopConditions:z,steps:L}))a.setAttributes(fY({telemetry:l,attributes:{"ai.response.finishReason":A.finishReason,"ai.response.text":{output:()=>f2(A.content)},"ai.response.toolCalls":{output:()=>{let a=ge(A.content);return null==a?void 0:JSON.stringify(a)}},"ai.response.providerMetadata":JSON.stringify(A.providerMetadata),"ai.usage.promptTokens":A.usage.inputTokens,"ai.usage.completionTokens":A.usage.outputTokens}}));let M=L[L.length-1];return"stop"===M.finishReason&&(C=await (null==k?void 0:k.parseOutput({text:M.text},{response:M.response,usage:M.usage,finishReason:M.finishReason}))),new gd({steps:L,resolvedOutput:C})}})}catch(a){throw fP(a)}}async function gc({toolCalls:a,tools:b,tracer:c,telemetry:d,messages:e,abortSignal:f,experimental_context:g}){return(await Promise.all(a.map(async({toolCallId:a,toolName:h,input:i})=>{let j=b[h];if((null==j?void 0:j.execute)!=null)return fW({name:"ai.toolCall",attributes:fY({telemetry:d,attributes:{...fQ({operationId:"ai.toolCall",telemetry:d}),"ai.toolCall.name":h,"ai.toolCall.id":a,"ai.toolCall.args":{output:()=>JSON.stringify(i)}}}),tracer:c,fn:async b=>{try{let c;for await(let b of eM({execute:j.execute.bind(j),input:i,options:{toolCallId:a,messages:e,abortSignal:f,experimental_context:g}}))"final"===b.type&&(c=b.output);try{b.setAttributes(fY({telemetry:d,attributes:{"ai.toolCall.result":{output:()=>JSON.stringify(c)}}}))}catch(a){}return{type:"tool-result",toolCallId:a,toolName:h,input:i,output:c,dynamic:"dynamic"===j.type}}catch(c){return fX(b,c),{type:"tool-error",toolCallId:a,toolName:h,input:i,error:c,dynamic:"dynamic"===j.type}}}})}))).filter(a=>null!=a)}var gd=class{constructor(a){this.steps=a.steps,this.resolvedOutput=a.resolvedOutput}get finalStep(){return this.steps[this.steps.length-1]}get content(){return this.finalStep.content}get text(){return this.finalStep.text}get files(){return this.finalStep.files}get reasoningText(){return this.finalStep.reasoningText}get reasoning(){return this.finalStep.reasoning}get toolCalls(){return this.finalStep.toolCalls}get staticToolCalls(){return this.finalStep.staticToolCalls}get dynamicToolCalls(){return this.finalStep.dynamicToolCalls}get toolResults(){return this.finalStep.toolResults}get staticToolResults(){return this.finalStep.staticToolResults}get dynamicToolResults(){return this.finalStep.dynamicToolResults}get sources(){return this.finalStep.sources}get finishReason(){return this.finalStep.finishReason}get warnings(){return this.finalStep.warnings}get providerMetadata(){return this.finalStep.providerMetadata}get response(){return this.finalStep.response}get request(){return this.finalStep.request}get usage(){return this.finalStep.usage}get totalUsage(){return this.steps.reduce((a,b)=>{var c;return c=b.usage,{inputTokens:f$(a.inputTokens,c.inputTokens),outputTokens:f$(a.outputTokens,c.outputTokens),totalTokens:f$(a.totalTokens,c.totalTokens),reasoningTokens:f$(a.reasoningTokens,c.reasoningTokens),cachedInputTokens:f$(a.cachedInputTokens,c.cachedInputTokens)}},{inputTokens:void 0,outputTokens:void 0,totalTokens:void 0,reasoningTokens:void 0,cachedInputTokens:void 0})}get experimental_output(){if(null==this.resolvedOutput)throw new eT;return this.resolvedOutput}};function ge(a){let b=a.filter(a=>"tool-call"===a.type);if(0!==b.length)return b.map(a=>({toolCallId:a.toolCallId,toolName:a.toolName,input:a.input}))}async function gf(a){if(void 0===a)return{value:void 0,state:"undefined-input"};let b=await en({text:a});return b.success?{value:b.value,state:"successful-parse"}:(b=await en({text:function(a){let b=["ROOT"],c=-1,d=null;function e(a,e,f){switch(a){case'"':c=e,b.pop(),b.push(f),b.push("INSIDE_STRING");break;case"f":case"t":case"n":c=e,d=e,b.pop(),b.push(f),b.push("INSIDE_LITERAL");break;case"-":b.pop(),b.push(f),b.push("INSIDE_NUMBER");break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":c=e,b.pop(),b.push(f),b.push("INSIDE_NUMBER");break;case"{":c=e,b.pop(),b.push(f),b.push("INSIDE_OBJECT_START");break;case"[":c=e,b.pop(),b.push(f),b.push("INSIDE_ARRAY_START")}}function f(a,d){switch(a){case",":b.pop(),b.push("INSIDE_OBJECT_AFTER_COMMA");break;case"}":c=d,b.pop()}}function g(a,d){switch(a){case",":b.pop(),b.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":c=d,b.pop()}}for(let h=0;h<a.length;h++){let i=a[h];switch(b[b.length-1]){case"ROOT":e(i,h,"FINISH");break;case"INSIDE_OBJECT_START":switch(i){case'"':b.pop(),b.push("INSIDE_OBJECT_KEY");break;case"}":c=h,b.pop()}break;case"INSIDE_OBJECT_AFTER_COMMA":'"'===i&&(b.pop(),b.push("INSIDE_OBJECT_KEY"));break;case"INSIDE_OBJECT_KEY":'"'===i&&(b.pop(),b.push("INSIDE_OBJECT_AFTER_KEY"));break;case"INSIDE_OBJECT_AFTER_KEY":":"===i&&(b.pop(),b.push("INSIDE_OBJECT_BEFORE_VALUE"));break;case"INSIDE_OBJECT_BEFORE_VALUE":e(i,h,"INSIDE_OBJECT_AFTER_VALUE");break;case"INSIDE_OBJECT_AFTER_VALUE":f(i,h);break;case"INSIDE_STRING":switch(i){case'"':b.pop(),c=h;break;case"\\":b.push("INSIDE_STRING_ESCAPE");break;default:c=h}break;case"INSIDE_ARRAY_START":"]"===i?(c=h,b.pop()):(c=h,e(i,h,"INSIDE_ARRAY_AFTER_VALUE"));break;case"INSIDE_ARRAY_AFTER_VALUE":switch(i){case",":b.pop(),b.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":c=h,b.pop();break;default:c=h}break;case"INSIDE_ARRAY_AFTER_COMMA":e(i,h,"INSIDE_ARRAY_AFTER_VALUE");break;case"INSIDE_STRING_ESCAPE":b.pop(),c=h;break;case"INSIDE_NUMBER":switch(i){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":c=h;break;case"e":case"E":case"-":case".":break;case",":b.pop(),"INSIDE_ARRAY_AFTER_VALUE"===b[b.length-1]&&g(i,h),"INSIDE_OBJECT_AFTER_VALUE"===b[b.length-1]&&f(i,h);break;case"}":b.pop(),"INSIDE_OBJECT_AFTER_VALUE"===b[b.length-1]&&f(i,h);break;case"]":b.pop(),"INSIDE_ARRAY_AFTER_VALUE"===b[b.length-1]&&g(i,h);break;default:b.pop()}break;case"INSIDE_LITERAL":{let e=a.substring(d,h+1);"false".startsWith(e)||"true".startsWith(e)||"null".startsWith(e)?c=h:(b.pop(),"INSIDE_OBJECT_AFTER_VALUE"===b[b.length-1]?f(i,h):"INSIDE_ARRAY_AFTER_VALUE"===b[b.length-1]&&g(i,h))}}}let h=a.slice(0,c+1);for(let c=b.length-1;c>=0;c--)switch(b[c]){case"INSIDE_STRING":h+='"';break;case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":h+="}";break;case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":h+="]";break;case"INSIDE_LITERAL":{let b=a.substring(d,a.length);"true".startsWith(b)?h+="true".slice(b.length):"false".startsWith(b)?h+="false".slice(b.length):"null".startsWith(b)&&(h+="null".slice(b.length))}}return h}(a)})).success?{value:b.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"}}TransformStream,el(()=>eE(dC.union([dC.strictObject({type:dC.literal("text-start"),id:dC.string(),providerMetadata:fB.optional()}),dC.strictObject({type:dC.literal("text-delta"),id:dC.string(),delta:dC.string(),providerMetadata:fB.optional()}),dC.strictObject({type:dC.literal("text-end"),id:dC.string(),providerMetadata:fB.optional()}),dC.strictObject({type:dC.literal("error"),errorText:dC.string()}),dC.strictObject({type:dC.literal("tool-input-start"),toolCallId:dC.string(),toolName:dC.string(),providerExecuted:dC.boolean().optional(),dynamic:dC.boolean().optional()}),dC.strictObject({type:dC.literal("tool-input-delta"),toolCallId:dC.string(),inputTextDelta:dC.string()}),dC.strictObject({type:dC.literal("tool-input-available"),toolCallId:dC.string(),toolName:dC.string(),input:dC.unknown(),providerExecuted:dC.boolean().optional(),providerMetadata:fB.optional(),dynamic:dC.boolean().optional()}),dC.strictObject({type:dC.literal("tool-input-error"),toolCallId:dC.string(),toolName:dC.string(),input:dC.unknown(),providerExecuted:dC.boolean().optional(),providerMetadata:fB.optional(),dynamic:dC.boolean().optional(),errorText:dC.string()}),dC.strictObject({type:dC.literal("tool-output-available"),toolCallId:dC.string(),output:dC.unknown(),providerExecuted:dC.boolean().optional(),dynamic:dC.boolean().optional(),preliminary:dC.boolean().optional()}),dC.strictObject({type:dC.literal("tool-output-error"),toolCallId:dC.string(),errorText:dC.string(),providerExecuted:dC.boolean().optional(),dynamic:dC.boolean().optional()}),dC.strictObject({type:dC.literal("reasoning-start"),id:dC.string(),providerMetadata:fB.optional()}),dC.strictObject({type:dC.literal("reasoning-delta"),id:dC.string(),delta:dC.string(),providerMetadata:fB.optional()}),dC.strictObject({type:dC.literal("reasoning-end"),id:dC.string(),providerMetadata:fB.optional()}),dC.strictObject({type:dC.literal("source-url"),sourceId:dC.string(),url:dC.string(),title:dC.string().optional(),providerMetadata:fB.optional()}),dC.strictObject({type:dC.literal("source-document"),sourceId:dC.string(),mediaType:dC.string(),title:dC.string(),filename:dC.string().optional(),providerMetadata:fB.optional()}),dC.strictObject({type:dC.literal("file"),url:dC.string(),mediaType:dC.string(),providerMetadata:fB.optional()}),dC.strictObject({type:dC.custom(a=>"string"==typeof a&&a.startsWith("data-"),{message:'Type must start with "data-"'}),id:dC.string().optional(),data:dC.unknown(),transient:dC.boolean().optional()}),dC.strictObject({type:dC.literal("start-step")}),dC.strictObject({type:dC.literal("finish-step")}),dC.strictObject({type:dC.literal("start"),messageId:dC.string().optional(),messageMetadata:dC.unknown().optional()}),dC.strictObject({type:dC.literal("finish"),finishReason:dC.enum(["stop","length","content-filter","tool-calls","error","other","unknown"]).optional(),messageMetadata:dC.unknown().optional()}),dC.strictObject({type:dC.literal("abort")}),dC.strictObject({type:dC.literal("message-metadata"),messageMetadata:dC.unknown()})]))),ee({prefix:"aitxt",size:24});var gg={type:"no-schema",jsonSchema:void 0,validatePartialResult:async({value:a,textDelta:b})=>({success:!0,value:{partial:a,textDelta:b}}),validateFinalResult:async(a,b)=>void 0===a?{success:!1,error:new e5({message:"No object generated: response did not match schema.",text:b.text,response:b.response,usage:b.usage,finishReason:b.finishReason})}:{success:!0,value:a},createElementStream(){throw new aL({functionality:"element streams in no-schema mode"})}};async function gh(a,b,c){let d=await en({text:a});if(!d.success)throw new e5({message:"No object generated: could not parse the response.",cause:d.error,text:a,response:c.response,usage:c.usage,finishReason:c.finishReason});let e=await b.validateFinalResult(d.value,{text:a,response:c.response,usage:c.usage});if(!e.success)throw new e5({message:"No object generated: response did not match schema.",cause:e.error,text:a,response:c.response,usage:c.usage,finishReason:c.finishReason});return e.value}async function gi(a,b,c,d){try{return await gh(a,b,d)}catch(e){if(null!=c&&e5.isInstance(e)&&(az.isInstance(e.cause)||aH.isInstance(e.cause))){let f=await c({text:a,error:e.cause});if(null===f)throw e;return await gh(f,b,d)}throw e}}var gj=ee({prefix:"aiobj",size:24});async function gk(a){let{model:b,output:c="object",system:d,prompt:e,messages:f,maxRetries:g,abortSignal:h,headers:i,experimental_repairText:j,experimental_telemetry:k,experimental_download:l,providerOptions:m,_internal:{generateId:n=gj,currentDate:o=()=>new Date}={},...p}=a,q=fr(b),r="enum"in a?a.enum:void 0,{schema:s,schemaDescription:t,schemaName:u}="schema"in a?a:{};!function({output:a,schema:b,schemaName:c,schemaDescription:d,enumValues:e}){if(null!=a&&"object"!==a&&"array"!==a&&"enum"!==a&&"no-schema"!==a)throw new eZ({parameter:"output",value:a,message:"Invalid output type."});if("no-schema"===a){if(null!=b)throw new eZ({parameter:"schema",value:b,message:"Schema is not supported for no-schema output."});if(null!=d)throw new eZ({parameter:"schemaDescription",value:d,message:"Schema description is not supported for no-schema output."});if(null!=c)throw new eZ({parameter:"schemaName",value:c,message:"Schema name is not supported for no-schema output."});if(null!=e)throw new eZ({parameter:"enumValues",value:e,message:"Enum values are not supported for no-schema output."})}if("object"===a){if(null==b)throw new eZ({parameter:"schema",value:b,message:"Schema is required for object output."});if(null!=e)throw new eZ({parameter:"enumValues",value:e,message:"Enum values are not supported for object output."})}if("array"===a){if(null==b)throw new eZ({parameter:"schema",value:b,message:"Element schema is required for array output."});if(null!=e)throw new eZ({parameter:"enumValues",value:e,message:"Enum values are not supported for array output."})}if("enum"===a){if(null!=b)throw new eZ({parameter:"schema",value:b,message:"Schema is not supported for enum output."});if(null!=d)throw new eZ({parameter:"schemaDescription",value:d,message:"Schema description is not supported for enum output."});if(null!=c)throw new eZ({parameter:"schemaName",value:c,message:"Schema name is not supported for enum output."});if(null==e)throw new eZ({parameter:"enumValues",value:e,message:"Enum values are required for enum output."});for(let a of e)if("string"!=typeof a)throw new eZ({parameter:"enumValues",value:a,message:"Enum values must be strings."})}}({output:c,schema:s,schemaName:u,schemaDescription:t,enumValues:r});let{maxRetries:v,retry:w}=f1({maxRetries:g,abortSignal:h}),x=function({output:a,schema:b,enumValues:c}){switch(a){case"object":let d;return{type:"object",jsonSchema:(d=eH(b)).jsonSchema,validatePartialResult:async({value:a,textDelta:b})=>({success:!0,value:{partial:a,textDelta:b}}),validateFinalResult:async a=>em({value:a,schema:d}),createElementStream(){throw new aL({functionality:"element streams in object mode"})}};case"array":var e=eH(b);let{$schema:f,...g}=e.jsonSchema;return{type:"array",jsonSchema:{$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{elements:{type:"array",items:g}},required:["elements"],additionalProperties:!1},async validatePartialResult({value:a,latestObject:b,isFirstDelta:c,isFinalDelta:d}){var f;if(!aO(a)||!aN(a.elements))return{success:!1,error:new aH({value:a,cause:"value must be an object that contains an array of elements"})};let g=a.elements,h=[];for(let a=0;a<g.length;a++){let b=g[a],c=await em({value:b,schema:e});if(a!==g.length-1||d){if(!c.success)return c;h.push(c.value)}}let i=null!=(f=null==b?void 0:b.length)?f:0,j="";return c&&(j+="["),i>0&&(j+=","),j+=h.slice(i).map(a=>JSON.stringify(a)).join(","),d&&(j+="]"),{success:!0,value:{partial:h,textDelta:j}}},async validateFinalResult(a){if(!aO(a)||!aN(a.elements))return{success:!1,error:new aH({value:a,cause:"value must be an object that contains an array of elements"})};let b=a.elements;for(let a of b){let b=await em({value:a,schema:e});if(!b.success)return b}return{success:!0,value:b}},createElementStream(a){let b=0,c=a.pipeThrough(new TransformStream({transform(a,c){switch(a.type){case"object":{let d=a.object;for(;b<d.length;b++)c.enqueue(d[b]);break}case"text-delta":case"finish":case"error":break;default:throw Error(`Unsupported chunk type: ${a}`)}}})).pipeThrough(new TransformStream);return c[Symbol.asyncIterator]=function(){let a=this.getReader(),b=!1;async function c(c){var d;b=!0;try{c&&await (null==(d=a.cancel)?void 0:d.call(a))}finally{try{a.releaseLock()}catch(a){}}}return{async next(){if(b)return{done:!0,value:void 0};let{done:d,value:e}=await a.read();return d?(await c(!0),{done:!0,value:void 0}):{done:!1,value:e}},return:async()=>(await c(!0),{done:!0,value:void 0}),async throw(a){throw await c(!0),a}}},c}};case"enum":return{type:"enum",jsonSchema:{$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{result:{type:"string",enum:c}},required:["result"],additionalProperties:!1},async validateFinalResult(a){if(!aO(a)||"string"!=typeof a.result)return{success:!1,error:new aH({value:a,cause:'value must be an object that contains a string in the "result" property.'})};let b=a.result;return c.includes(b)?{success:!0,value:b}:{success:!1,error:new aH({value:a,cause:"value must be a string in the enum"})}},async validatePartialResult({value:a,textDelta:b}){if(!aO(a)||"string"!=typeof a.result)return{success:!1,error:new aH({value:a,cause:'value must be an object that contains a string in the "result" property.'})};let d=a.result,e=c.filter(a=>a.startsWith(d));return 0===a.result.length||0===e.length?{success:!1,error:new aH({value:a,cause:"value must be a string in the enum"})}:{success:!0,value:{partial:e.length>1?d:e[0],textDelta:b}}},createElementStream(){throw new aL({functionality:"element streams in enum mode"})}};case"no-schema":return gg;default:throw Error(`Unsupported output: ${a}`)}}({output:c,schema:s,enumValues:r}),y=fz(p),z=eg(null!=i?i:{},`ai/${ft}`),A=fR({model:q,telemetry:k,headers:z,settings:{...y,maxRetries:v}}),B=fV(k);try{return await fW({name:"ai.generateObject",attributes:fY({telemetry:k,attributes:{...fQ({operationId:"ai.generateObject",telemetry:k}),...A,"ai.prompt":{input:()=>JSON.stringify({system:d,prompt:e,messages:f})},"ai.schema":null!=x.jsonSchema?{input:()=>JSON.stringify(x.jsonSchema)}:void 0,"ai.schema.name":u,"ai.schema.description":t,"ai.settings.output":x.type}}),tracer:B,fn:async a=>{var b;let c,g,i,r,s,v,C,D,E=await fO({system:d,prompt:e,messages:f}),F=await fx({prompt:E,supportedUrls:await q.supportedUrls,download:l}),G=await w(()=>fW({name:"ai.generateObject.doGenerate",attributes:fY({telemetry:k,attributes:{...fQ({operationId:"ai.generateObject.doGenerate",telemetry:k}),...A,"ai.prompt.messages":{input:()=>fZ(F)},"gen_ai.system":q.provider,"gen_ai.request.model":q.modelId,"gen_ai.request.frequency_penalty":y.frequencyPenalty,"gen_ai.request.max_tokens":y.maxOutputTokens,"gen_ai.request.presence_penalty":y.presencePenalty,"gen_ai.request.temperature":y.temperature,"gen_ai.request.top_k":y.topK,"gen_ai.request.top_p":y.topP}}),tracer:B,fn:async a=>{var b,c,d,e,f,g,i,j;let l=await q.doGenerate({responseFormat:{type:"json",schema:x.jsonSchema,name:u,description:t},...fz(p),prompt:F,providerOptions:m,abortSignal:h,headers:z}),r={id:null!=(c=null==(b=l.response)?void 0:b.id)?c:n(),timestamp:null!=(e=null==(d=l.response)?void 0:d.timestamp)?e:o(),modelId:null!=(g=null==(f=l.response)?void 0:f.modelId)?g:q.modelId,headers:null==(i=l.response)?void 0:i.headers,body:null==(j=l.response)?void 0:j.body},s=f2(l.content),v=function(a){let b=a.filter(a=>"reasoning"===a.type);return 0===b.length?void 0:b.map(a=>a.text).join("\n")}(l.content);if(void 0===s)throw new e5({message:"No object generated: the model did not return a response.",response:r,usage:l.usage,finishReason:l.finishReason});return a.setAttributes(fY({telemetry:k,attributes:{"ai.response.finishReason":l.finishReason,"ai.response.object":{output:()=>s},"ai.response.id":r.id,"ai.response.model":r.modelId,"ai.response.timestamp":r.timestamp.toISOString(),"ai.response.providerMetadata":JSON.stringify(l.providerMetadata),"ai.usage.promptTokens":l.usage.inputTokens,"ai.usage.completionTokens":l.usage.outputTokens,"gen_ai.response.finish_reasons":[l.finishReason],"gen_ai.response.id":r.id,"gen_ai.response.model":r.modelId,"gen_ai.usage.input_tokens":l.usage.inputTokens,"gen_ai.usage.output_tokens":l.usage.outputTokens}})),{...l,objectText:s,reasoning:v,responseData:r}}}));c=G.objectText,g=G.finishReason,i=G.usage,r=G.warnings,C=G.providerMetadata,v=null!=(b=G.request)?b:{},s=G.responseData,D=G.reasoning,eV(r);let H=await gi(c,x,j,{response:s,usage:i,finishReason:g});return a.setAttributes(fY({telemetry:k,attributes:{"ai.response.finishReason":g,"ai.response.object":{output:()=>JSON.stringify(H)},"ai.response.providerMetadata":JSON.stringify(C),"ai.usage.promptTokens":i.inputTokens,"ai.usage.completionTokens":i.outputTokens}})),new gl({object:H,reasoning:D,finishReason:g,usage:i,warnings:r,request:v,response:s,providerMetadata:C})}})}catch(a){throw fP(a)}}var gl=class{constructor(a){this.object=a.object,this.finishReason=a.finishReason,this.usage=a.usage,this.warnings=a.warnings,this.providerMetadata=a.providerMetadata,this.response=a.response,this.request=a.request,this.reasoning=a.reasoning}toJsonResponse(a){var b;return new Response(JSON.stringify(this.object),{status:null!=(b=null==a?void 0:a.status)?b:200,headers:function(a,b){let c=new Headers(null!=a?a:{});for(let[a,d]of Object.entries(b))c.has(a)||c.set(a,d);return c}(null==a?void 0:a.headers,{"content-type":"application/json; charset=utf-8"})})}};ee({prefix:"aiobj",size:24}),((a,b)=>{for(var c in b)eP(a,c,{get:b[c],enumerable:!0})})({},{object:()=>gn,text:()=>gm});var gm=()=>({type:"text",responseFormat:{type:"text"},parsePartial:async({text:a})=>({partial:a}),parseOutput:async({text:a})=>a}),gn=({schema:a})=>{let b=eH(a);return{type:"object",responseFormat:{type:"json",schema:b.jsonSchema},async parsePartial({text:a}){let b=await gf(a);switch(b.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:b.value};default:{let a=b.state;throw Error(`Unsupported parse state: ${a}`)}}},async parseOutput({text:a},c){let d=await en({text:a});if(!d.success)throw new e5({message:"No object generated: could not parse the response.",cause:d.error,text:a,response:c.response,usage:c.usage,finishReason:c.finishReason});let e=await em({value:d.value,schema:b});if(!e.success)throw new e5({message:"No object generated: response did not match schema.",cause:e.error,text:a,response:c.response,usage:c.usage,finishReason:c.finishReason});return e.value}}};Symbol.for("vercel.ai.error.AI_NoSuchProviderError"),el(()=>eE(dC.array(dC.object({id:dC.string(),role:dC.enum(["system","user","assistant"]),metadata:dC.unknown().optional(),parts:dC.array(dC.union([dC.object({type:dC.literal("text"),text:dC.string(),state:dC.enum(["streaming","done"]).optional(),providerMetadata:fB.optional()}),dC.object({type:dC.literal("reasoning"),text:dC.string(),state:dC.enum(["streaming","done"]).optional(),providerMetadata:fB.optional()}),dC.object({type:dC.literal("source-url"),sourceId:dC.string(),url:dC.string(),title:dC.string().optional(),providerMetadata:fB.optional()}),dC.object({type:dC.literal("source-document"),sourceId:dC.string(),mediaType:dC.string(),title:dC.string(),filename:dC.string().optional(),providerMetadata:fB.optional()}),dC.object({type:dC.literal("file"),mediaType:dC.string(),filename:dC.string().optional(),url:dC.string(),providerMetadata:fB.optional()}),dC.object({type:dC.literal("step-start")}),dC.object({type:dC.string().startsWith("data-"),id:dC.string().optional(),data:dC.unknown()}),dC.object({type:dC.literal("dynamic-tool"),toolName:dC.string(),toolCallId:dC.string(),state:dC.literal("input-streaming"),input:dC.unknown().optional(),providerExecuted:dC.boolean().optional(),output:dC.never().optional(),errorText:dC.never().optional()}),dC.object({type:dC.literal("dynamic-tool"),toolName:dC.string(),toolCallId:dC.string(),state:dC.literal("input-available"),input:dC.unknown(),providerExecuted:dC.boolean().optional(),output:dC.never().optional(),errorText:dC.never().optional(),callProviderMetadata:fB.optional()}),dC.object({type:dC.literal("dynamic-tool"),toolName:dC.string(),toolCallId:dC.string(),state:dC.literal("output-available"),input:dC.unknown(),providerExecuted:dC.boolean().optional(),output:dC.unknown(),errorText:dC.never().optional(),callProviderMetadata:fB.optional(),preliminary:dC.boolean().optional()}),dC.object({type:dC.literal("dynamic-tool"),toolName:dC.string(),toolCallId:dC.string(),state:dC.literal("output-error"),input:dC.unknown(),providerExecuted:dC.boolean().optional(),output:dC.never().optional(),errorText:dC.string(),callProviderMetadata:fB.optional()}),dC.object({type:dC.string().startsWith("tool-"),toolCallId:dC.string(),state:dC.literal("input-streaming"),providerExecuted:dC.boolean().optional(),input:dC.unknown().optional(),output:dC.never().optional(),errorText:dC.never().optional(),approval:dC.never().optional()}),dC.object({type:dC.string().startsWith("tool-"),toolCallId:dC.string(),state:dC.literal("input-available"),providerExecuted:dC.boolean().optional(),input:dC.unknown(),output:dC.never().optional(),errorText:dC.never().optional(),callProviderMetadata:fB.optional(),approval:dC.never().optional()}),dC.object({type:dC.string().startsWith("tool-"),toolCallId:dC.string(),state:dC.literal("approval-requested"),input:dC.unknown(),providerExecuted:dC.boolean().optional(),output:dC.never().optional(),errorText:dC.never().optional(),callProviderMetadata:fB.optional(),approval:dC.object({id:dC.string(),approved:dC.never().optional(),reason:dC.never().optional()})}),dC.object({type:dC.string().startsWith("tool-"),toolCallId:dC.string(),state:dC.literal("approval-responded"),input:dC.unknown(),providerExecuted:dC.boolean().optional(),output:dC.never().optional(),errorText:dC.never().optional(),callProviderMetadata:fB.optional(),approval:dC.object({id:dC.string(),approved:dC.boolean(),reason:dC.string().optional()})}),dC.object({type:dC.string().startsWith("tool-"),toolCallId:dC.string(),state:dC.literal("output-available"),providerExecuted:dC.boolean().optional(),input:dC.unknown(),output:dC.unknown(),errorText:dC.never().optional(),callProviderMetadata:fB.optional(),preliminary:dC.boolean().optional(),approval:dC.object({id:dC.string(),approved:dC.literal(!0),reason:dC.string().optional()}).optional()}),dC.object({type:dC.string().startsWith("tool-"),toolCallId:dC.string(),state:dC.literal("output-error"),providerExecuted:dC.boolean().optional(),input:dC.unknown(),output:dC.never().optional(),errorText:dC.string(),callProviderMetadata:fB.optional(),approval:dC.object({id:dC.string(),approved:dC.literal(!0),reason:dC.string().optional()}).optional()}),dC.object({type:dC.string().startsWith("tool-"),toolCallId:dC.string(),state:dC.literal("output-denied"),providerExecuted:dC.boolean().optional(),input:dC.unknown(),output:dC.never().optional(),errorText:dC.never().optional(),callProviderMetadata:fB.optional(),approval:dC.object({id:dC.string(),approved:dC.literal(!1),reason:dC.string().optional()})})])).nonempty("Message must contain at least one part")})).nonempty("Messages array must not be empty")));var go=a.i(905246),gp=a.i(53112),dC=aS,gq=Object.defineProperty,gr=Object.defineProperties,gs=Object.getOwnPropertyDescriptors,gt=Object.getOwnPropertySymbols,gu=Object.prototype.hasOwnProperty,gv=Object.prototype.propertyIsEnumerable,gw=(a,b,c)=>b in a?gq(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,gx=(a,b)=>{for(var c in b||(b={}))gu.call(b,c)&&gw(a,c,b[c]);if(gt)for(var c of gt(b))gv.call(b,c)&&gw(a,c,b[c]);return a},gy=(a,b)=>gr(a,gs(b)),gz="vercel.ai.error",gA=Symbol.for(gz),gB=class a extends Error{constructor({name:a,message:b,cause:c}){super(b),this[M]=!0,this.name=a,this.cause=c}static isInstance(b){return a.hasMarker(b,gz)}static hasMarker(a,b){let c=Symbol.for(b);return null!=a&&"object"==typeof a&&c in a&&"boolean"==typeof a[c]&&!0===a[c]}};M=gA;var gC=gB,gD="AI_APICallError",gE=`vercel.ai.error.${gD}`,gF=Symbol.for(gE),gG=class extends gC{constructor({message:a,url:b,requestBodyValues:c,statusCode:d,responseHeaders:e,responseBody:f,cause:g,isRetryable:h=null!=d&&(408===d||409===d||429===d||d>=500),data:i}){super({name:gD,message:a,cause:g}),this[N]=!0,this.url=b,this.requestBodyValues=c,this.statusCode=d,this.responseHeaders=e,this.responseBody=f,this.isRetryable=h,this.data=i}static isInstance(a){return gC.hasMarker(a,gE)}};N=gF;var gH="AI_EmptyResponseBodyError",gI=`vercel.ai.error.${gH}`,gJ=Symbol.for(gI),gK=class extends gC{constructor({message:a="Empty response body"}={}){super({name:gH,message:a}),this[O]=!0}static isInstance(a){return gC.hasMarker(a,gI)}};function gL(a){return null==a?"unknown error":"string"==typeof a?a:a instanceof Error?a.message:JSON.stringify(a)}O=gJ;var gM="AI_InvalidArgumentError",gN=`vercel.ai.error.${gM}`,gO=Symbol.for(gN),gP=class extends gC{constructor({message:a,cause:b,argument:c}){super({name:gM,message:a,cause:b}),this[P]=!0,this.argument=c}static isInstance(a){return gC.hasMarker(a,gN)}};P=gO;var gQ="AI_InvalidPromptError",gR=`vercel.ai.error.${gQ}`,gS=Symbol.for(gR),gT=class extends gC{constructor({prompt:a,message:b,cause:c}){super({name:gQ,message:`Invalid prompt: ${b}`,cause:c}),this[Q]=!0,this.prompt=a}static isInstance(a){return gC.hasMarker(a,gR)}};Q=gS;var gU="AI_InvalidResponseDataError",gV=`vercel.ai.error.${gU}`,gW=Symbol.for(gV),gX=class extends gC{constructor({data:a,message:b=`Invalid response data: ${JSON.stringify(a)}.`}){super({name:gU,message:b}),this[R]=!0,this.data=a}static isInstance(a){return gC.hasMarker(a,gV)}};R=gW;var gY="AI_JSONParseError",gZ=`vercel.ai.error.${gY}`,g$=Symbol.for(gZ),g_=class extends gC{constructor({text:a,cause:b}){super({name:gY,message:`JSON parsing failed: Text: ${a}.
Error message: ${gL(b)}`,cause:b}),this[S]=!0,this.text=a}static isInstance(a){return gC.hasMarker(a,gZ)}};S=g$;var g0="AI_LoadAPIKeyError",g1=`vercel.ai.error.${g0}`,g2=Symbol.for(g1),g3=class extends gC{constructor({message:a}){super({name:g0,message:a}),this[T]=!0}static isInstance(a){return gC.hasMarker(a,g1)}};T=g2,Symbol.for("vercel.ai.error.AI_LoadSettingError");var g4="AI_NoContentGeneratedError",g5=`vercel.ai.error.${g4}`,g6=Symbol.for(g5),g7=class extends gC{constructor({message:a="No content generated."}={}){super({name:g4,message:a}),this[U]=!0}static isInstance(a){return gC.hasMarker(a,g5)}};U=g6,Symbol.for("vercel.ai.error.AI_NoSuchModelError"),Symbol.for("vercel.ai.error.AI_TooManyEmbeddingValuesForCallError");var g8="AI_TypeValidationError",g9=`vercel.ai.error.${g8}`,ha=Symbol.for(g9),hb=class a extends gC{constructor({value:a,cause:b}){super({name:g8,message:`Type validation failed: Value: ${JSON.stringify(a)}.
Error message: ${gL(b)}`,cause:b}),this[V]=!0,this.value=a}static isInstance(a){return gC.hasMarker(a,g9)}static wrap({value:b,cause:c}){return a.isInstance(c)&&c.value===b?c:new a({value:b,cause:c})}};V=ha;var hc="AI_UnsupportedFunctionalityError",hd=`vercel.ai.error.${hc}`,he=Symbol.for(hd),hf=class extends gC{constructor({functionality:a,message:b=`'${a}' functionality not supported.`}){super({name:hc,message:b}),this[W]=!0,this.functionality=a}static isInstance(a){return gC.hasMarker(a,hd)}};W=he;var hg=class extends Error{constructor(a,b){super(a),this.name="ParseError",this.type=b.type,this.field=b.field,this.value=b.value,this.line=b.line}};function hh(a){}var hi=class extends TransformStream{constructor({onError:a,onRetry:b,onComment:c}={}){let d;super({start(e){d=function(a){if("function"==typeof a)throw TypeError("`callbacks` must be an object, got a function instead. Did you mean `{onEvent: fn}`?");let{onEvent:b=hh,onError:c=hh,onRetry:d=hh,onComment:e}=a,f="",g=!0,h,i="",j="";function k(a){if(""===a)return void(i.length>0&&b({id:h,event:j||void 0,data:i.endsWith(`
`)?i.slice(0,-1):i}),h=void 0,i="",j="");if(a.startsWith(":")){e&&e(a.slice(a.startsWith(": ")?2:1));return}let c=a.indexOf(":");if(-1!==c){let b=a.slice(0,c),d=" "===a[c+1]?2:1;l(b,a.slice(c+d),a);return}l(a,"",a)}function l(a,b,e){switch(a){case"event":j=b;break;case"data":i=`${i}${b}
`;break;case"id":h=b.includes("\0")?void 0:b;break;case"retry":/^\d+$/.test(b)?d(parseInt(b,10)):c(new hg(`Invalid \`retry\` value: "${b}"`,{type:"invalid-retry",value:b,line:e}));break;default:c(new hg(`Unknown field "${a.length>20?`${a.slice(0,20)}\u2026`:a}"`,{type:"unknown-field",field:a,value:b,line:e}))}}return{feed:function(a){let b=g?a.replace(/^\xEF\xBB\xBF/,""):a,[c,d]=function(a){let b=[],c="",d=0;for(;d<a.length;){let e=a.indexOf("\r",d),f=a.indexOf(`
`,d),g=-1;if(-1!==e&&-1!==f?g=Math.min(e,f):-1!==e?g=e:-1!==f&&(g=f),-1===g){c=a.slice(d);break}{let c=a.slice(d,g);b.push(c),"\r"===a[(d=g+1)-1]&&a[d]===`
`&&d++}}return[b,c]}(`${f}${b}`);for(let a of c)k(a);f=d,g=!1},reset:function(a={}){f&&a.consume&&k(f),g=!0,h=void 0,i="",j="",f=""}}}({onEvent:a=>{e.enqueue(a)},onError(b){"terminate"===a?e.error(b):"function"==typeof a&&a(b)},onRetry:b,onComment:c})},transform(a){d.feed(a)}})}};function hj(...a){return a.reduce((a,b)=>gx(gx({},a),null!=b?b:{}),{})}function hk(a){return Object.fromEntries([...a.headers])}Symbol("Let zodToJsonSchema decide on which parser to use");var hl=(({prefix:a,size:b=16,alphabet:c="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:d="-"}={})=>{let e=()=>{let a=c.length,d=Array(b);for(let e=0;e<b;e++)d[e]=c[Math.random()*a|0];return d.join("")};if(null==a)return e;if(c.includes(d))throw new gP({argument:"separator",message:`The separator "${d}" must not be part of the alphabet "${c}".`});return()=>`${a}${d}${e()}`})();function hm(a){return(a instanceof Error||a instanceof DOMException)&&("AbortError"===a.name||"ResponseAborted"===a.name||"TimeoutError"===a.name)}var hn=["fetch failed","failed to fetch"],ho=/"__proto__"\s*:/,hp=/"constructor"\s*:/;function hq(a){let{stackTraceLimit:b}=Error;Error.stackTraceLimit=0;try{let b=JSON.parse(a);return null===b||"object"!=typeof b||!1===ho.test(a)&&!1===hp.test(a)?b:function(a){let b=[a];for(;b.length;){let a=b;for(let c of(b=[],a)){if(Object.prototype.hasOwnProperty.call(c,"__proto__")||Object.prototype.hasOwnProperty.call(c,"constructor")&&Object.prototype.hasOwnProperty.call(c.constructor,"prototype"))throw SyntaxError("Object contains forbidden prototype property");for(let a in c){let d=c[a];d&&"object"==typeof d&&b.push(d)}}}return a}(b)}finally{Error.stackTraceLimit=b}}var hr=Symbol.for("vercel.ai.validator");async function hs({value:a,schema:b}){let c=await ht({value:a,schema:b});if(!c.success)throw hb.wrap({value:a,cause:c.error});return c.value}async function ht({value:a,schema:b}){var c;let d="object"==typeof b&&null!==b&&hr in b&&!0===b[hr]&&"validate"in b?b:(c=b,{[hr]:!0,validate:async a=>{let b=await c["~standard"].validate(a);return null==b.issues?{success:!0,value:b.value}:{success:!1,error:new hb({value:a,cause:b.issues})}}});try{if(null==d.validate)return{success:!0,value:a,rawValue:a};let b=await d.validate(a);if(b.success)return{success:!0,value:b.value,rawValue:a};return{success:!1,error:hb.wrap({value:a,cause:b.error}),rawValue:a}}catch(b){return{success:!1,error:hb.wrap({value:a,cause:b}),rawValue:a}}}async function hu({text:a,schema:b}){try{let c=hq(a);if(null==b)return c;return hs({value:c,schema:b})}catch(b){if(g_.isInstance(b)||hb.isInstance(b))throw b;throw new g_({text:a,cause:b})}}async function hv({text:a,schema:b}){try{let c=hq(a);if(null==b)return{success:!0,value:c,rawValue:c};return await ht({value:c,schema:b})}catch(b){return{success:!1,error:g_.isInstance(b)?b:new g_({text:a,cause:b}),rawValue:void 0}}}function hw(a){try{return hq(a),!0}catch(a){return!1}}var hx=()=>globalThis.fetch,hy=async({url:a,headers:b,body:c,failedResponseHandler:d,successfulResponseHandler:e,abortSignal:f,fetch:g})=>hz({url:a,headers:gx({"Content-Type":"application/json"},b),body:{content:JSON.stringify(c),values:c},failedResponseHandler:d,successfulResponseHandler:e,abortSignal:f,fetch:g}),hz=async({url:a,headers:b={},body:c,successfulResponseHandler:d,failedResponseHandler:e,abortSignal:f,fetch:g=hx()})=>{try{let h=await g(a,{method:"POST",headers:Object.fromEntries(Object.entries(b).filter(([a,b])=>null!=b)),body:c.content,signal:f}),i=hk(h);if(!h.ok){let b;try{b=await e({response:h,url:a,requestBodyValues:c.values})}catch(b){if(hm(b)||gG.isInstance(b))throw b;throw new gG({message:"Failed to process error response",cause:b,statusCode:h.status,url:a,responseHeaders:i,requestBodyValues:c.values})}throw b.value}try{return await d({response:h,url:a,requestBodyValues:c.values})}catch(b){if(b instanceof Error&&(hm(b)||gG.isInstance(b)))throw b;throw new gG({message:"Failed to process successful response",cause:b,statusCode:h.status,url:a,responseHeaders:i,requestBodyValues:c.values})}}catch(b){throw function({error:a,url:b,requestBodyValues:c}){if(hm(a))return a;if(a instanceof TypeError&&hn.includes(a.message.toLowerCase())){let d=a.cause;if(null!=d)return new gG({message:`Cannot connect to API: ${d.message}`,cause:d,url:b,requestBodyValues:c,isRetryable:!0})}return a}({error:b,url:a,requestBodyValues:c.values})}},hA=a=>async({response:b})=>{let c=hk(b);if(null==b.body)throw new gK({});return{responseHeaders:c,value:function({stream:a,schema:b}){return a.pipeThrough(new TextDecoderStream).pipeThrough(new hi).pipeThrough(new TransformStream({async transform({data:a},c){"[DONE]"!==a&&c.enqueue(await hv({text:a,schema:b}))}}))}({stream:b.body,schema:a})}},hB=a=>async({response:b,url:c,requestBodyValues:d})=>{let e=await b.text(),f=await hv({text:e,schema:a}),g=hk(b);if(!f.success)throw new gG({message:"Invalid JSON response",cause:f.error,statusCode:b.status,responseHeaders:g,responseBody:e,url:c,requestBodyValues:d});return{responseHeaders:g,value:f.value,rawValue:f.rawValue}};Symbol.for("vercel.ai.schema");var{btoa:hC,atob:hD}=globalThis;function hE(a){return null!=a}var hF=(a=>(a.Unknown="unknown",a.OpenAIResponsesV1="openai-responses-v1",a.XAIResponsesV1="xai-responses-v1",a.AnthropicClaudeV1="anthropic-claude-v1",a))(hF||{}),hG=dC.object({id:dC.string().nullish(),format:dC.nativeEnum(hF).nullish(),index:dC.number().optional()}),hH=dC.object({type:dC.literal("reasoning.summary"),summary:dC.string()}).extend(hG.shape),hI=dC.object({type:dC.literal("reasoning.encrypted"),data:dC.string()}).extend(hG.shape),hJ=dC.object({type:dC.literal("reasoning.text"),text:dC.string().nullish(),signature:dC.string().nullish()}).extend(hG.shape),hK=dC.union([hH,hI,hJ]),hL=dC.union([hK,dC.unknown().transform(()=>null)]),hM=dC.array(hL).transform(a=>a.filter(a=>!!a));dC.union([dC.object({delta:dC.object({reasoning_details:dC.array(hL)})}).transform(a=>a.delta.reasoning_details.filter(hE)),dC.object({message:dC.object({reasoning_details:dC.array(hL)})}).transform(a=>a.message.reasoning_details.filter(hE)),dC.object({text:dC.string(),reasoning_details:dC.array(hL)}).transform(a=>a.reasoning_details.filter(hE))]);var hN=dC.object({error:dC.object({code:dC.union([dC.string(),dC.number()]).nullable().optional().default(null),message:dC.string(),type:dC.string().nullable().optional().default(null),param:dC.any().nullable().optional().default(null)})}),hO=(({errorSchema:a,errorToMessage:b,isRetryable:c})=>async({response:d,url:e,requestBodyValues:f})=>{let g=await d.text(),h=hk(d);if(""===g.trim())return{responseHeaders:h,value:new gG({message:d.statusText,url:e,requestBodyValues:f,statusCode:d.status,responseHeaders:h,responseBody:g,isRetryable:null==c?void 0:c(d)})};try{let i=await hu({text:g,schema:a});return{responseHeaders:h,value:new gG({message:b(i),url:e,requestBodyValues:f,statusCode:d.status,responseHeaders:h,responseBody:g,data:i,isRetryable:null==c?void 0:c(d,i)})}}catch(a){return{responseHeaders:h,value:new gG({message:d.statusText,url:e,requestBodyValues:f,statusCode:d.status,responseHeaders:h,responseBody:g,isRetryable:null==c?void 0:c(d)})}}})({errorSchema:hN,errorToMessage:a=>a.error.message}),hP=dC.object({provider:dC.string(),reasoning_details:dC.array(hK).optional(),usage:dC.object({promptTokens:dC.number(),promptTokensDetails:dC.object({cachedTokens:dC.number()}).optional(),completionTokens:dC.number(),completionTokensDetails:dC.object({reasoningTokens:dC.number()}).optional(),totalTokens:dC.number(),cost:dC.number().optional(),costDetails:dC.object({upstreamInferenceCost:dC.number()})})}),hQ=dC.object({openrouter:dC.object({reasoning_details:dC.array(hK).optional()}).optional()}).optional();function hR(a){switch(a){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"unknown"}}function hS({url:a,protocols:b}){try{let c=new URL(a);return b.has(c.protocol)}catch(a){return!1}}function hT({part:a,defaultMediaType:b}){var c,d;if(a.data instanceof Uint8Array){let d=function(a){let b="";for(let c=0;c<a.length;c++)b+=String.fromCodePoint(a[c]);return hC(b)}(a.data);return`data:${null!=(c=a.mediaType)?c:b};base64,${d}`}let e=a.data.toString();return hS({url:e,protocols:new Set(["http:","https:"])})||e.startsWith("data:")?e:`data:${null!=(d=a.mediaType)?d:b};base64,${e}`}function hU(a,b){var c;let d=a.match(/^data:([^;]+)/);return d&&null!=(c=d[1])?c:b}function hV(a){let b=a.match(/^data:[^;]*;base64,(.+)$/);return b?b[1]:a}function hW(a){var b,c,d;let e=null==a?void 0:a.anthropic,f=null==a?void 0:a.openrouter;return null!=(d=null!=(c=null!=(b=null==f?void 0:f.cacheControl)?b:null==f?void 0:f.cache_control)?c:null==e?void 0:e.cacheControl)?d:null==e?void 0:e.cache_control}dC.union([dC.literal("auto"),dC.literal("none"),dC.literal("required"),dC.object({type:dC.literal("function"),function:dC.object({name:dC.string()})})]);var hX=dC.object({type:dC.literal("image_url"),image_url:dC.object({url:dC.string()})}),hY=dC.union([hX,dC.unknown().transform(()=>null)]),hZ=dC.array(hY).transform(a=>a.filter(a=>!!a)),h$=dC.object({id:dC.string().optional(),model:dC.string().optional(),provider:dC.string().optional(),usage:dC.object({prompt_tokens:dC.number(),prompt_tokens_details:dC.object({cached_tokens:dC.number()}).nullish(),completion_tokens:dC.number(),completion_tokens_details:dC.object({reasoning_tokens:dC.number()}).nullish(),total_tokens:dC.number(),cost:dC.number().optional(),cost_details:dC.object({upstream_inference_cost:dC.number().nullish()}).nullish()}).nullish()}),h_=dC.union([h$.extend({choices:dC.array(dC.object({message:dC.object({role:dC.literal("assistant"),content:dC.string().nullable().optional(),reasoning:dC.string().nullable().optional(),reasoning_details:hM.nullish(),images:hZ.nullish(),tool_calls:dC.array(dC.object({id:dC.string().optional().nullable(),type:dC.literal("function"),function:dC.object({name:dC.string(),arguments:dC.string()})})).optional(),annotations:dC.array(dC.union([dC.object({type:dC.literal("url_citation"),url_citation:dC.object({end_index:dC.number(),start_index:dC.number(),title:dC.string(),url:dC.string(),content:dC.string().optional()})}),dC.object({type:dC.literal("file_annotation"),file_annotation:dC.object({file_id:dC.string(),quote:dC.string().optional()})}),dC.object({type:dC.literal("file"),file:dC.object({hash:dC.string(),name:dC.string(),content:dC.array(dC.object({type:dC.string(),text:dC.string()})).optional()})})])).nullish()}),index:dC.number().nullish(),logprobs:dC.object({content:dC.array(dC.object({token:dC.string(),logprob:dC.number(),top_logprobs:dC.array(dC.object({token:dC.string(),logprob:dC.number()}))})).nullable()}).nullable().optional(),finish_reason:dC.string().optional().nullable()}))}),hN.extend({user_id:dC.string().optional()})]),h0=dC.union([h$.extend({choices:dC.array(dC.object({delta:dC.object({role:dC.enum(["assistant"]).optional(),content:dC.string().nullish(),reasoning:dC.string().nullish().optional(),reasoning_details:hM.nullish(),images:hZ.nullish(),tool_calls:dC.array(dC.object({index:dC.number().nullish(),id:dC.string().nullish(),type:dC.literal("function").optional(),function:dC.object({name:dC.string().nullish(),arguments:dC.string().nullish()})})).nullish(),annotations:dC.array(dC.union([dC.object({type:dC.literal("url_citation"),url_citation:dC.object({end_index:dC.number(),start_index:dC.number(),title:dC.string(),url:dC.string(),content:dC.string().optional()})}),dC.object({type:dC.literal("file_annotation"),file_annotation:dC.object({file_id:dC.string(),quote:dC.string().optional()})}),dC.object({type:dC.literal("file"),file:dC.object({hash:dC.string(),name:dC.string(),content:dC.array(dC.object({type:dC.string(),text:dC.string()})).optional()})})])).nullish()}).nullish(),logprobs:dC.object({content:dC.array(dC.object({token:dC.string(),logprob:dC.number(),top_logprobs:dC.array(dC.object({token:dC.string(),logprob:dC.number()}))})).nullable()}).nullish(),finish_reason:dC.string().nullable().optional(),index:dC.number().nullish()}))}),hN]),h1=class{constructor(a,b,c){this.specificationVersion="v2",this.provider="openrouter",this.defaultObjectGenerationMode="tool",this.supportedUrls={"image/*":[/^data:image\/[a-zA-Z]+;base64,/,/^https?:\/\/.+\.(jpg|jpeg|png|gif|webp)$/i],"application/*":[/^data:application\//,/^https?:\/\/.+$/]},this.modelId=a,this.settings=b,this.config=c}getArgs({prompt:a,maxOutputTokens:b,temperature:c,topP:d,frequencyPenalty:e,presencePenalty:f,seed:g,stopSequences:h,responseFormat:i,topK:j,tools:k,toolChoice:l}){var m;let n=gx(gx({model:this.modelId,models:this.settings.models,logit_bias:this.settings.logitBias,logprobs:!0===this.settings.logprobs||"number"==typeof this.settings.logprobs||void 0,top_logprobs:"number"==typeof this.settings.logprobs?this.settings.logprobs:"boolean"==typeof this.settings.logprobs&&this.settings.logprobs?0:void 0,user:this.settings.user,parallel_tool_calls:this.settings.parallelToolCalls,max_tokens:b,temperature:c,top_p:d,frequency_penalty:e,presence_penalty:f,seed:g,stop:h,response_format:i,top_k:j,messages:function(a){var b,c,d,e,f,g;let h=[];for(let{role:i,content:j,providerOptions:k}of a)switch(i){case"system":h.push({role:"system",content:j,cache_control:hW(k)});break;case"user":{if(1===j.length&&(null==(b=j[0])?void 0:b.type)==="text"){let a=null!=(c=hW(k))?c:hW(j[0].providerOptions),b=a?[{type:"text",text:j[0].text,cache_control:a}]:j[0].text;h.push({role:"user",content:b});break}let a=hW(k),d=j.map(b=>{var c,d,e,f,g,h;let i=null!=(c=hW(b.providerOptions))?c:a;switch(b.type){case"text":return{type:"text",text:b.text,cache_control:i};case"file":{if(null==(d=b.mediaType)?void 0:d.startsWith("image/"))return{type:"image_url",image_url:{url:hT({part:b,defaultMediaType:"image/jpeg"})},cache_control:i};let a=String(null!=(h=null!=(g=null==(f=null==(e=b.providerOptions)?void 0:e.openrouter)?void 0:f.filename)?g:b.filename)?h:""),c=hT({part:b,defaultMediaType:"application/pdf"});if(hS({url:c,protocols:new Set(["http:","https:"])}))return{type:"file",file:{filename:a,file_data:c}};return{type:"file",file:{filename:a,file_data:c},cache_control:i}}default:return{type:"text",text:"",cache_control:i}}});h.push({role:"user",content:d});break}case"assistant":{let a="",b="",c=[];for(let d of j)switch(d.type){case"text":a+=d.text;break;case"tool-call":c.push({id:d.toolCallId,type:"function",function:{name:d.toolName,arguments:JSON.stringify(d.input)}});break;case"reasoning":b+=d.text}let f=hQ.safeParse(k),g=f.success?null==(e=null==(d=f.data)?void 0:d.openrouter)?void 0:e.reasoning_details:void 0;h.push({role:"assistant",content:a,tool_calls:c.length>0?c:void 0,reasoning:b||void 0,reasoning_details:g&&Array.isArray(g)&&g.length>0?g:void 0,cache_control:hW(k)});break}case"tool":for(let a of j){let b="text"===(g=a).output.type?g.output.value:JSON.stringify(g.output.value);h.push({role:"tool",tool_call_id:a.toolCallId,content:b,cache_control:null!=(f=hW(k))?f:hW(a.providerOptions)})}}return h}(a),include_reasoning:this.settings.includeReasoning,reasoning:this.settings.reasoning,usage:this.settings.usage,plugins:this.settings.plugins,web_search_options:this.settings.web_search_options,provider:this.settings.provider},this.config.extraBody),this.settings.extraBody);if((null==i?void 0:i.type)==="json"&&null!=i.schema)return gy(gx({},n),{response_format:{type:"json_schema",json_schema:gx({schema:i.schema,strict:!0,name:null!=(m=i.name)?m:"response"},i.description&&{description:i.description})}});if(k&&k.length>0){let a=k.filter(a=>"function"===a.type).map(a=>({type:"function",function:{name:a.name,description:a.description,parameters:a.inputSchema}}));return gy(gx({},n),{tools:a,tool_choice:l?function(a){switch(a.type){case"auto":case"none":case"required":return a.type;case"tool":return{type:"function",function:{name:a.toolName}};default:throw new gP({argument:"toolChoice",message:`Invalid tool choice type: ${JSON.stringify(a)}`})}}(l):void 0})}return n}async doGenerate(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z;let A=(a.providerOptions||{}).openrouter||{},B=gx(gx({},this.getArgs(a)),A),{value:C,responseHeaders:D}=await hy({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:hj(this.config.headers(),a.headers),body:B,failedResponseHandler:hO,successfulResponseHandler:hB(h_),abortSignal:a.abortSignal,fetch:this.config.fetch});if("error"in C)throw new gG({message:C.error.message,url:this.config.url({path:"/chat/completions",modelId:this.modelId}),requestBodyValues:B,statusCode:200,responseHeaders:D,data:C.error});let E=C.choices[0];if(!E)throw new g7({message:"No choice in response"});let F=C.usage?{inputTokens:null!=(b=C.usage.prompt_tokens)?b:0,outputTokens:null!=(c=C.usage.completion_tokens)?c:0,totalTokens:(null!=(d=C.usage.prompt_tokens)?d:0)+(null!=(e=C.usage.completion_tokens)?e:0),reasoningTokens:null!=(g=null==(f=C.usage.completion_tokens_details)?void 0:f.reasoning_tokens)?g:0,cachedInputTokens:null!=(i=null==(h=C.usage.prompt_tokens_details)?void 0:h.cached_tokens)?i:0}:{inputTokens:0,outputTokens:0,totalTokens:0,reasoningTokens:0,cachedInputTokens:0},G=null!=(j=E.message.reasoning_details)?j:[],H=G.length>0?G.map(a=>{switch(a.type){case"reasoning.text":if(a.text)return{type:"reasoning",text:a.text};break;case"reasoning.summary":if(a.summary)return{type:"reasoning",text:a.summary};break;case"reasoning.encrypted":if(a.data)return{type:"reasoning",text:"[REDACTED]"}}return null}).filter(a=>null!==a):E.message.reasoning?[{type:"reasoning",text:E.message.reasoning}]:[],I=[];if(I.push(...H),E.message.content&&I.push({type:"text",text:E.message.content}),E.message.tool_calls)for(let a of E.message.tool_calls)I.push({type:"tool-call",toolCallId:null!=(k=a.id)?k:hl(),toolName:a.function.name,input:a.function.arguments});if(E.message.images)for(let a of E.message.images)I.push({type:"file",mediaType:hU(a.image_url.url,"image/jpeg"),data:hV(a.image_url.url)});if(E.message.annotations)for(let a of E.message.annotations)"url_citation"===a.type&&I.push({type:"source",sourceType:"url",id:a.url_citation.url,url:a.url_citation.url,title:a.url_citation.title,providerMetadata:{openrouter:{content:a.url_citation.content||""}}});return{content:I,finishReason:hR(E.finish_reason),usage:F,warnings:[],providerMetadata:{openrouter:hP.parse({provider:null!=(l=C.provider)?l:"",reasoning_details:null!=(m=E.message.reasoning_details)?m:[],usage:{promptTokens:null!=(n=F.inputTokens)?n:0,completionTokens:null!=(o=F.outputTokens)?o:0,totalTokens:null!=(p=F.totalTokens)?p:0,cost:null==(q=C.usage)?void 0:q.cost,promptTokensDetails:{cachedTokens:null!=(t=null==(s=null==(r=C.usage)?void 0:r.prompt_tokens_details)?void 0:s.cached_tokens)?t:0},completionTokensDetails:{reasoningTokens:null!=(w=null==(v=null==(u=C.usage)?void 0:u.completion_tokens_details)?void 0:v.reasoning_tokens)?w:0},costDetails:{upstreamInferenceCost:null!=(z=null==(y=null==(x=C.usage)?void 0:x.cost_details)?void 0:y.upstream_inference_cost)?z:0}}})},request:{body:B},response:{id:C.id,modelId:C.model,headers:D}}}async doStream(a){var b;let c,d,e,f,g=(a.providerOptions||{}).openrouter||{},h=gx(gx({},this.getArgs(a)),g),{value:i,responseHeaders:j}=await hy({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:hj(this.config.headers(),a.headers),body:gy(gx({},h),{stream:!0,stream_options:"strict"===this.config.compatibility?gx({include_usage:!0},(null==(b=this.settings.usage)?void 0:b.include)?{include_usage:!0}:{}):void 0}),failedResponseHandler:hO,successfulResponseHandler:hA(h0),abortSignal:a.abortSignal,fetch:this.config.fetch}),k=[],l="other",m={inputTokens:NaN,outputTokens:NaN,totalTokens:NaN,reasoningTokens:NaN,cachedInputTokens:NaN},n={},o=[],p=!1,q=!1;return{stream:i.pipeThrough(new TransformStream({transform(a,b){var g,h,i,j,r,s,t,u,v,w,x,y,z,A;if(!a.success){l="error",b.enqueue({type:"error",error:a.error});return}let B=a.value;if("error"in B){l="error",b.enqueue({type:"error",error:B.error});return}if(B.provider&&(f=B.provider),B.id&&(e=B.id,b.enqueue({type:"response-metadata",id:B.id})),B.model&&b.enqueue({type:"response-metadata",modelId:B.model}),null!=B.usage){if(m.inputTokens=B.usage.prompt_tokens,m.outputTokens=B.usage.completion_tokens,m.totalTokens=B.usage.prompt_tokens+B.usage.completion_tokens,n.promptTokens=B.usage.prompt_tokens,B.usage.prompt_tokens_details){let a=null!=(g=B.usage.prompt_tokens_details.cached_tokens)?g:0;m.cachedInputTokens=a,n.promptTokensDetails={cachedTokens:a}}if(n.completionTokens=B.usage.completion_tokens,B.usage.completion_tokens_details){let a=null!=(h=B.usage.completion_tokens_details.reasoning_tokens)?h:0;m.reasoningTokens=a,n.completionTokensDetails={reasoningTokens:a}}n.cost=B.usage.cost,n.totalTokens=B.usage.total_tokens}let C=B.choices[0];if((null==C?void 0:C.finish_reason)!=null&&(l=hR(C.finish_reason)),(null==C?void 0:C.delta)==null)return;let D=C.delta,E=a=>{q||(d=e||hl(),b.enqueue({type:"reasoning-start",id:d}),q=!0),b.enqueue({type:"reasoning-delta",delta:a,id:d||hl()})};if(D.reasoning_details&&D.reasoning_details.length>0)for(let a of(o.push(...D.reasoning_details),D.reasoning_details))switch(a.type){case"reasoning.text":a.text&&E(a.text);break;case"reasoning.encrypted":a.data&&E("[REDACTED]");break;case"reasoning.summary":a.summary&&E(a.summary)}else D.reasoning&&E(D.reasoning);if(D.content&&(q&&!p&&(b.enqueue({type:"reasoning-end",id:d||hl()}),q=!1),p||(c=e||hl(),b.enqueue({type:"text-start",id:c}),p=!0),b.enqueue({type:"text-delta",delta:D.content,id:c||hl()})),D.annotations)for(let a of D.annotations)"url_citation"===a.type&&b.enqueue({type:"source",sourceType:"url",id:a.url_citation.url,url:a.url_citation.url,title:a.url_citation.title,providerMetadata:{openrouter:{content:a.url_citation.content||""}}});if(null!=D.tool_calls)for(let a of D.tool_calls){let c=null!=(i=a.index)?i:k.length-1;if(null==k[c]){if("function"!==a.type)throw new gX({data:a,message:"Expected 'function' type."});if(null==a.id)throw new gX({data:a,message:"Expected 'id' to be a string."});if((null==(j=a.function)?void 0:j.name)==null)throw new gX({data:a,message:"Expected 'function.name' to be a string."});k[c]={id:a.id,type:"function",function:{name:a.function.name,arguments:null!=(r=a.function.arguments)?r:""},inputStarted:!1,sent:!1};let d=k[c];if(null==d)throw new gX({data:{index:c,toolCallsLength:k.length},message:`Tool call at index ${c} is missing after creation.`});(null==(s=d.function)?void 0:s.name)!=null&&(null==(t=d.function)?void 0:t.arguments)!=null&&hw(d.function.arguments)&&(d.inputStarted=!0,b.enqueue({type:"tool-input-start",id:d.id,toolName:d.function.name}),b.enqueue({type:"tool-input-delta",id:d.id,delta:d.function.arguments}),b.enqueue({type:"tool-input-end",id:d.id}),b.enqueue({type:"tool-call",toolCallId:d.id,toolName:d.function.name,input:d.function.arguments}),d.sent=!0);continue}let d=k[c];if(null==d)throw new gX({data:{index:c,toolCallsLength:k.length,toolCallDelta:a},message:`Tool call at index ${c} is missing during merge.`});d.inputStarted||(d.inputStarted=!0,b.enqueue({type:"tool-input-start",id:d.id,toolName:d.function.name})),(null==(u=a.function)?void 0:u.arguments)!=null&&(d.function.arguments+=null!=(w=null==(v=a.function)?void 0:v.arguments)?w:""),b.enqueue({type:"tool-input-delta",id:d.id,delta:null!=(x=a.function.arguments)?x:""}),(null==(y=d.function)?void 0:y.name)!=null&&(null==(z=d.function)?void 0:z.arguments)!=null&&hw(d.function.arguments)&&(b.enqueue({type:"tool-call",toolCallId:null!=(A=d.id)?A:hl(),toolName:d.function.name,input:d.function.arguments}),d.sent=!0)}if(null!=D.images)for(let a of D.images)b.enqueue({type:"file",mediaType:hU(a.image_url.url,"image/jpeg"),data:hV(a.image_url.url)})},flush(a){var b;if("tool-calls"===l)for(let c of k)c&&!c.sent&&(a.enqueue({type:"tool-call",toolCallId:null!=(b=c.id)?b:hl(),toolName:c.function.name,input:hw(c.function.arguments)?c.function.arguments:"{}"}),c.sent=!0);q&&a.enqueue({type:"reasoning-end",id:d||hl()}),p&&a.enqueue({type:"text-end",id:c||hl()});let e={usage:n};void 0!==f&&(e.provider=f),o.length>0&&(e.reasoning_details=o),a.enqueue({type:"finish",finishReason:l,usage:m,providerMetadata:{openrouter:e}})}})),warnings:[],request:{body:h},response:{headers:j}}}},h2=dC.union([dC.object({id:dC.string().optional(),model:dC.string().optional(),choices:dC.array(dC.object({text:dC.string(),reasoning:dC.string().nullish().optional(),reasoning_details:hM.nullish(),finish_reason:dC.string().nullish(),index:dC.number().nullish(),logprobs:dC.object({tokens:dC.array(dC.string()),token_logprobs:dC.array(dC.number()),top_logprobs:dC.array(dC.record(dC.string(),dC.number())).nullable()}).nullable().optional()})),usage:dC.object({prompt_tokens:dC.number(),prompt_tokens_details:dC.object({cached_tokens:dC.number()}).nullish(),completion_tokens:dC.number(),completion_tokens_details:dC.object({reasoning_tokens:dC.number()}).nullish(),total_tokens:dC.number(),cost:dC.number().optional()}).nullish()}),hN]),h3=class{constructor(a,b,c){this.specificationVersion="v2",this.provider="openrouter",this.supportedUrls={"image/*":[/^data:image\/[a-zA-Z]+;base64,/,/^https?:\/\/.+\.(jpg|jpeg|png|gif|webp)$/i],"text/*":[/^data:text\//,/^https?:\/\/.+$/],"application/*":[/^data:application\//,/^https?:\/\/.+$/]},this.defaultObjectGenerationMode=void 0,this.modelId=a,this.settings=b,this.config=c}getArgs({prompt:a,maxOutputTokens:b,temperature:c,topP:d,frequencyPenalty:e,presencePenalty:f,seed:g,responseFormat:h,topK:i,stopSequences:j,tools:k,toolChoice:l}){let{prompt:m}=function({prompt:a,inputFormat:b,user:c="user",assistant:d="assistant"}){if("prompt"===b&&1===a.length&&a[0]&&"user"===a[0].role&&1===a[0].content.length&&a[0].content[0]&&"text"===a[0].content[0].type)return{prompt:a[0].content[0].text};let e="";for(let{role:b,content:f}of(a[0]&&"system"===a[0].role&&(e+=`${a[0].content}

`,a=a.slice(1)),a))switch(b){case"system":throw new gT({message:`Unexpected system message in prompt: ${f}`,prompt:a});case"user":{let a=f.map(a=>{switch(a.type){case"text":return a.text;case"file":throw new hf({functionality:"file attachments"});default:return""}}).join("");e+=`${c}:
${a}

`;break}case"assistant":{let a=f.map(a=>{switch(a.type){case"text":return a.text;case"tool-call":throw new hf({functionality:"tool-call messages"});case"tool-result":throw new hf({functionality:"tool-result messages"});case"reasoning":throw new hf({functionality:"reasoning messages"});case"file":throw new hf({functionality:"file attachments"});default:return""}}).join("");e+=`${d}:
${a}

`;break}case"tool":throw new hf({functionality:"tool messages"})}return{prompt:e+=`${d}:
`}}({prompt:a,inputFormat:"prompt"});if(null==k?void 0:k.length)throw new hf({functionality:"tools"});if(l)throw new hf({functionality:"toolChoice"});return gx(gx({model:this.modelId,models:this.settings.models,logit_bias:this.settings.logitBias,logprobs:"number"==typeof this.settings.logprobs?this.settings.logprobs:"boolean"==typeof this.settings.logprobs&&this.settings.logprobs?0:void 0,suffix:this.settings.suffix,user:this.settings.user,max_tokens:b,temperature:c,top_p:d,frequency_penalty:e,presence_penalty:f,seed:g,stop:j,response_format:h,top_k:i,prompt:m,include_reasoning:this.settings.includeReasoning,reasoning:this.settings.reasoning},this.config.extraBody),this.settings.extraBody)}async doGenerate(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;let q=(a.providerOptions||{}).openrouter||{},r=gx(gx({},this.getArgs(a)),q),{value:s,responseHeaders:t}=await hy({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:hj(this.config.headers(),a.headers),body:r,failedResponseHandler:hO,successfulResponseHandler:hB(h2),abortSignal:a.abortSignal,fetch:this.config.fetch});if("error"in s)throw new gG({message:s.error.message,url:this.config.url({path:"/completions",modelId:this.modelId}),requestBodyValues:r,statusCode:200,responseHeaders:t,data:s.error});let u=s.choices[0];if(!u)throw new g7({message:"No choice in OpenRouter completion response"});return{content:[{type:"text",text:null!=(b=u.text)?b:""}],finishReason:hR(u.finish_reason),usage:{inputTokens:null!=(d=null==(c=s.usage)?void 0:c.prompt_tokens)?d:0,outputTokens:null!=(f=null==(e=s.usage)?void 0:e.completion_tokens)?f:0,totalTokens:(null!=(h=null==(g=s.usage)?void 0:g.prompt_tokens)?h:0)+(null!=(j=null==(i=s.usage)?void 0:i.completion_tokens)?j:0),reasoningTokens:null!=(m=null==(l=null==(k=s.usage)?void 0:k.completion_tokens_details)?void 0:l.reasoning_tokens)?m:0,cachedInputTokens:null!=(p=null==(o=null==(n=s.usage)?void 0:n.prompt_tokens_details)?void 0:o.cached_tokens)?p:0},warnings:[],response:{headers:t}}}async doStream(a){let b=(a.providerOptions||{}).openrouter||{},c=gx(gx({},this.getArgs(a)),b),{value:d,responseHeaders:e}=await hy({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:hj(this.config.headers(),a.headers),body:gy(gx({},c),{stream:!0,stream_options:"strict"===this.config.compatibility?{include_usage:!0}:void 0}),failedResponseHandler:hO,successfulResponseHandler:hA(h2),abortSignal:a.abortSignal,fetch:this.config.fetch}),f="other",g={inputTokens:NaN,outputTokens:NaN,totalTokens:NaN,reasoningTokens:NaN,cachedInputTokens:NaN},h={};return{stream:d.pipeThrough(new TransformStream({transform(a,b){var c,d;if(!a.success){f="error",b.enqueue({type:"error",error:a.error});return}let e=a.value;if("error"in e){f="error",b.enqueue({type:"error",error:e.error});return}if(null!=e.usage){if(g.inputTokens=e.usage.prompt_tokens,g.outputTokens=e.usage.completion_tokens,g.totalTokens=e.usage.prompt_tokens+e.usage.completion_tokens,h.promptTokens=e.usage.prompt_tokens,e.usage.prompt_tokens_details){let a=null!=(c=e.usage.prompt_tokens_details.cached_tokens)?c:0;g.cachedInputTokens=a,h.promptTokensDetails={cachedTokens:a}}if(h.completionTokens=e.usage.completion_tokens,e.usage.completion_tokens_details){let a=null!=(d=e.usage.completion_tokens_details.reasoning_tokens)?d:0;g.reasoningTokens=a,h.completionTokensDetails={reasoningTokens:a}}h.cost=e.usage.cost,h.totalTokens=e.usage.total_tokens}let i=e.choices[0];(null==i?void 0:i.finish_reason)!=null&&(f=hR(i.finish_reason)),(null==i?void 0:i.text)!=null&&b.enqueue({type:"text-delta",delta:i.text,id:hl()})},flush(a){a.enqueue({type:"finish",finishReason:f,usage:g,providerMetadata:{openrouter:{usage:h}}})}})),response:{headers:e}}}};function h4(a={}){var b,c,d,e;let f=null!=(c=null==(e=null!=(b=a.baseURL)?b:a.baseUrl)?void 0:e.replace(/\/$/,""))?c:"https://openrouter.ai/api/v1",g=null!=(d=a.compatibility)?d:"compatible",h=()=>(function(a,...b){let c=Object.fromEntries(Object.entries(null!=a?a:{}).filter(([,a])=>null!==a)),d=[c["user-agent"]||"",...b].filter(Boolean).join(" ");return gy(gx({},c),{"user-agent":d})})(gx({Authorization:`Bearer ${function({apiKey:a,environmentVariableName:b,apiKeyParameterName:c="apiKey",description:d}){if("string"==typeof a)return a;if(null!=a)throw new g3({message:`${d} API key must be a string.`});if("undefined"==typeof process)throw new g3({message:`${d} API key is missing. Pass it using the '${c}' parameter. Environment variables is not supported in this environment.`});if(null==(a=process.env[b]))throw new g3({message:`${d} API key is missing. Pass it using the '${c}' parameter or the ${b} environment variable.`});if("string"!=typeof a)throw new g3({message:`${d} API key must be a string. The value of the ${b} environment variable is not a string.`});return a}({apiKey:a.apiKey,environmentVariableName:"OPENROUTER_API_KEY",description:"OpenRouter"})}`},a.headers),"ai-sdk/openrouter/1.2.2"),i=(b,c={})=>new h1(b,c,{provider:"openrouter.chat",url:({path:a})=>`${f}${a}`,headers:h,compatibility:g,fetch:a.fetch,extraBody:a.extraBody}),j=(b,c={})=>new h3(b,c,{provider:"openrouter.completion",url:({path:a})=>`${f}${a}`,headers:h,compatibility:g,fetch:a.fetch,extraBody:a.extraBody}),k=(a,b)=>{if(new.target)throw Error("The OpenRouter model function cannot be called with the new keyword.");return"openai/gpt-3.5-turbo-instruct"===a?j(a,b):i(a,b)},l=(a,b)=>k(a,b);return l.languageModel=k,l.chat=i,l.completion=j,l}h4({compatibility:"strict"});let h5=h4({apiKey:process.env.OPENROUTER_API_KEY}),h6=function({languageModels:a,textEmbeddingModels:b,imageModels:c,transcriptionModels:d,speechModels:e,fallbackProvider:f}){return{languageModel(b){if(null!=a&&b in a)return a[b];if(f)return f.languageModel(b);throw new aD({modelId:b,modelType:"languageModel"})},textEmbeddingModel(a){if(null!=b&&a in b)return b[a];if(f)return f.textEmbeddingModel(a);throw new aD({modelId:a,modelType:"textEmbeddingModel"})},imageModel(a){if(null!=c&&a in c)return c[a];if(null==f?void 0:f.imageModel)return f.imageModel(a);throw new aD({modelId:a,modelType:"imageModel"})},transcriptionModel(a){if(null!=d&&a in d)return d[a];if(null==f?void 0:f.transcriptionModel)return f.transcriptionModel(a);throw new aD({modelId:a,modelType:"transcriptionModel"})},speechModel(a){if(null!=e&&a in e)return e[a];if(null==f?void 0:f.speechModel)return f.speechModel(a);throw new aD({modelId:a,modelType:"speechModel"})}}}({languageModels:{"chat-model":h5.chat("@preset/viovietnamese"),"chat-model-reasoning":(({model:a,middleware:b,modelId:c,providerId:d})=>[...f_(b)].reverse().reduce((a,b)=>(({model:a,middleware:{transformParams:b,wrapGenerate:c,wrapStream:d,overrideProvider:e,overrideModelId:f,overrideSupportedUrls:g},modelId:h,providerId:i})=>{var j,k,l;async function m({params:c,type:d}){return b?await b({params:c,type:d,model:a}):c}return{specificationVersion:"v2",provider:null!=(j=null!=i?i:null==e?void 0:e({model:a}))?j:a.provider,modelId:null!=(k=null!=h?h:null==f?void 0:f({model:a}))?k:a.modelId,supportedUrls:null!=(l=null==g?void 0:g({model:a}))?l:a.supportedUrls,async doGenerate(b){let d=await m({params:b,type:"generate"}),e=async()=>a.doGenerate(d),f=async()=>a.doStream(d);return c?c({doGenerate:e,doStream:f,params:d,model:a}):e()},async doStream(b){let c=await m({params:b,type:"stream"}),e=async()=>a.doGenerate(c),f=async()=>a.doStream(c);return d?d({doGenerate:e,doStream:f,params:c,model:a}):f()}}})({model:a,middleware:b,modelId:c,providerId:d}),a))({model:h5.chat("tngtech/deepseek-r1t2-chimera:free"),middleware:function({tagName:a,separator:b="\n",startWithReasoning:c=!1}){let d=`<${a}>`,e=`</${a}>`;return{middlewareVersion:"v2",wrapGenerate:async({doGenerate:a})=>{let{content:f,...g}=await a(),h=[];for(let a of f){if("text"!==a.type){h.push(a);continue}let f=c?d+a.text:a.text,g=RegExp(`${d}(.*?)${e}`,"gs"),i=Array.from(f.matchAll(g));if(!i.length){h.push(a);continue}let j=i.map(a=>a[1]).join(b),k=f;for(let a=i.length-1;a>=0;a--){let c=i[a],d=k.slice(0,c.index),e=k.slice(c.index+c[0].length);k=d+(d.length>0&&e.length>0?b:"")+e}h.push({type:"reasoning",text:j}),h.push({type:"text",text:k})}return{content:h,...g}},wrapStream:async({doStream:a})=>{let f,{stream:g,...h}=await a(),i={};return{stream:g.pipeThrough(new TransformStream({transform:(a,g)=>{if("text-start"===a.type){f=a;return}if("text-end"===a.type&&f&&(g.enqueue(f),f=void 0),"text-delta"!==a.type)return void g.enqueue(a);null==i[a.id]&&(i[a.id]={isFirstReasoning:!0,isFirstText:!0,afterSwitch:!1,isReasoning:c,buffer:"",idCounter:0,textId:a.id});let h=i[a.id];function j(a){if(a.length>0){let c=!h.afterSwitch||(h.isReasoning?h.isFirstReasoning:h.isFirstText)?"":b;h.isReasoning&&(h.afterSwitch||h.isFirstReasoning)&&g.enqueue({type:"reasoning-start",id:`reasoning-${h.idCounter}`}),h.isReasoning?g.enqueue({type:"reasoning-delta",delta:c+a,id:`reasoning-${h.idCounter}`}):(f&&(g.enqueue(f),f=void 0),g.enqueue({type:"text-delta",delta:c+a,id:h.textId})),h.afterSwitch=!1,h.isReasoning?h.isFirstReasoning=!1:h.isFirstText=!1}}for(h.buffer+=a.delta;;){let a=h.isReasoning?e:d,b=function(a,b){if(0===b.length)return null;let c=a.indexOf(b);if(-1!==c)return c;for(let c=a.length-1;c>=0;c--){let d=a.substring(c);if(b.startsWith(d))return c}return null}(h.buffer,a);if(null==b){j(h.buffer),h.buffer="";break}if(j(h.buffer.slice(0,b)),b+a.length<=h.buffer.length)h.buffer=h.buffer.slice(b+a.length),h.isReasoning&&g.enqueue({type:"reasoning-end",id:`reasoning-${h.idCounter++}`}),h.isReasoning=!h.isReasoning,h.afterSwitch=!0;else{h.buffer=h.buffer.slice(b);break}}}})),...h}}}}({tagName:"think"})}),"title-model":h5.chat("@preset/viovietnamese"),"artifact-model":h5.chat("@preset/viovietnamese")}});async function h7(a){(await (0,go.cookies)()).set("chat-model",a)}function h8(a){try{let b="";Array.isArray(a.parts)&&(b=a.parts.map(a=>"string"==typeof a?a:"text"===a.type?a.text:"").join(" "));let c=b.trim().split(/\s+/).filter(a=>a.length>0).slice(0,6).join(" ");return c.length>50?c.slice(0,47)+"...":c||"New Chat"}catch(a){return console.error("Fallback title generation failed:",a),"New Chat"}}async function h9({message:a}){try{let b,{text:c}=await gb({model:h6.languageModel("title-model"),system:`Generate a concise chat title from the user's first message.

STRICT RULES:
- MAXIMUM 5 WORDS ONLY - NO MORE!
- MAXIMUM 50 CHARACTERS TOTAL
- No quotes, colons, or punctuation
- Capture the main topic/intent
- Use title case
- If the topic is complex, use the most important keyword
- DO NOT include any special tokens, XML tags, or markup in your response
- Return ONLY plain text title

Examples:
"Tell me about Vietnamese grammar"  "Vietnamese Grammar Guide"
"What are proverbs about time?"  "Vietnamese Time Proverbs"
"Help me learn conversation"  "Conversation Practice"
"Show me folk songs about family"  "Family Folk Songs"

RESPOND WITH ONLY THE TITLE - NO EXPLANATIONS, NO SPECIAL TOKENS!`,prompt:JSON.stringify(a),maxRetries:2}),d=(b=c,[/<\|beginofsentence\|>/gi,/<\|endofsentence\|>/gi,/<\|begin_of_text\|>/gi,/<\|end_of_text\|>/gi,/<\|im_start\|>/gi,/<\|im_end\|>/gi,/<s>/gi,/<\/s>/gi,/\[INST\]/gi,/\[\/INST\]/gi,/<<SYS>>/gi,/<\/SYS>>/gi].forEach(a=>{b=b.replace(a,"")}),b=(b=(b=(b=b.replace(/<\|[^|]+\|>/g,"")).replace(/<[^>]+>/g,"")).replace(/^["']|["']$/g,"")).replace(/\s+/g," ").trim()).slice(0,50).trim();if(!d||d.length<3)return console.warn("Title too short after cleaning, using fallback:",c),h8(a);return d}catch(b){return console.warn("Title generation failed, using fallback:",b?.message||b),(b?.message?.includes("502")||b?.message?.includes("Upstream error")||b?.message?.includes("Invalid JSON response"))&&console.warn("AI provider experiencing issues (502), using fallback title"),h8(a)}}async function ia({id:a}){let[b]=await (0,$.getMessageById)({id:a});await (0,$.deleteMessagesByChatIdAfterTimestamp)({chatId:b.chatId,timestamp:b.createdAt})}async function ib({chatId:a}){await (0,$.updateChatVisiblityById)({chatId:a,visibility:"private"})}async function ic({chatId:a,title:b}){let c=await (0,Z.createClient)(),{data:d,error:e}=await c.from("chat_sessions").update({title:b.trim(),updated_at:new Date().toISOString()}).eq("id",a).select("id, title, updated_at").single();if(e)throw console.error("[updateChatTitle] Error updating chat title:",e),Error("Failed to update chat title");return d}async function id({chatId:a}){let b=await (0,Z.createClient)(),{data:c,error:d}=await b.from("chat_sessions").update({is_active:!1,updated_at:new Date().toISOString()}).eq("id",a).select("id, is_active").single();if(d)throw console.error("[deleteChatSession] Error deleting chat:",d),Error("Failed to delete chat");return c}let ie=gp.z.object({sqlQuery:gp.z.string().describe("PostgreSQL SELECT query that answers the user question"),analysis:gp.z.object({tablesUsed:gp.z.array(gp.z.string()).describe("List of database tables used in the query"),filterApplied:gp.z.boolean().describe("Whether user_id filter was applied"),aggregationUsed:gp.z.boolean().describe("Whether aggregation functions (COUNT, AVG, etc.) were used"),expectedResultType:gp.z.enum(["single_value","list","aggregated_stats"]).describe("Type of result expected")})});async function ig({naturalLanguageQuery:a,queryContext:b,userId:c}){let d=function(a){let b={learning_progress:`
-- user_lesson_progress
user_id (uuid, FK to user_profiles) - MUST filter by this
lesson_id (bigint, FK to lessons)
topic_id (bigint, FK to topics)
best_score_percent (numeric)
total_attempts (integer)
status (varchar: 'not_started', 'in_progress', 'completed')
first_attempted_at, last_attempted_at, passed_at (timestamps)

-- lessons
id (bigint, PK)
lesson_name (varchar)
summary (text)
duration_minutes (smallint)
topic_id (bigint, FK to topics)
status (enum: 'draft', 'published', 'archived')

-- topics
topic_id (bigint, PK)
vietnamese_title (text)
english_title (varchar)
topic_description (text)
zone_id (smallint, FK to zones)
status (enum: 'draft', 'published', 'archived')

-- zones
id (bigint, PK)
name (varchar) - Level name (e.g., 'Beginner', 'Elementary', 'Intermediate')
    `,practice_performance:`
-- practice_results
user_id (uuid, FK to user_profiles) - MUST filter by this
practice_set_id (uuid, FK to practice_sets)
score_percent (real)
total_correct, total_incorrect, total_skipped (integer)
time_spent_seconds (integer)
coins_earned, xp_earned (integer)
practice_date (date)
    `,flashcards:`
-- flashcard_statistics
user_id (uuid, FK to user_profiles) - MUST filter by this
date (date)
flashcards_reviewed (integer)
correct_answers, total_questions (integer)
accuracy_rate (numeric)
time_spent_minutes (integer)
learning_streak (integer)

-- flashcard_srs_records
user_id (uuid, FK to user_profiles) - MUST filter by this
flashcard_id (varchar)
due_date (date)
total_reviews, correct_reviews (integer)
    `,topic_recommendations:`
-- topics (for recommendations)
topic_id (bigint, PK)
vietnamese_title (text)
english_title (varchar)
topic_description (text)
zone_id (smallint, FK to zones)
status (enum: 'draft', 'published', 'archived') - ONLY show 'published'
sort_order (smallint)

-- lessons (for topic content)
id (bigint, PK)
lesson_name (varchar)
summary (text)
topic_id (bigint, FK to topics)
duration_minutes (smallint)
coins_reward (smallint)
status (enum: 'draft', 'published', 'archived') - ONLY show 'published'

-- zones (learning levels)
id (bigint, PK)
name (varchar) - e.g., 'Beginner', 'Elementary', 'Intermediate', 'Advanced'
level (smallint) - Numeric level 1-5

-- user_lesson_progress (to check what user completed)
user_id (uuid, FK to user_profiles) - MUST filter by this
topic_id (bigint, FK to topics)
status (varchar: 'not_started', 'in_progress', 'completed')

RECOMMENDATION RULES:
1. ONLY recommend topics where status = 'published'
2. Filter out topics user already completed (check user_lesson_progress)
3. Recommend based on user's current level or slightly higher
4. Match keywords like 'traveling', 'health', 'shopping', 'greetings' to topic descriptions
5. Include zone_name and lesson_count in results
6. Order by zone level and sort_order
    `,achievements:`
-- user_achievements
user_id (uuid, FK to user_profiles) - MUST filter by this
achievement_id (uuid, FK to achievement_definitions)
current_progress (integer)
is_completed (boolean)
completed_at, claimed_at (timestamps)

-- achievement_definitions
id (uuid, PK)
name (varchar)
description (text)
target_value (integer)
    `,overall_stats:`
-- user_progress_summary
user_id (uuid, FK to user_profiles) - MUST filter by this
total_flashcards_reviewed, total_flashcards_created (integer)
total_exercises_completed (integer)
total_study_time_minutes (integer)
current_streak_days, max_streak_days (integer)
best_accuracy_rate (numeric)
total_achievements_unlocked (integer)
    `};return b[a]||b.overall_stats}(b),e=`You are a PostgreSQL query generator for a Vietnamese learning app database.

DATABASE SCHEMA (relevant to this query):
${d}

CRITICAL RULES:
1. ALWAYS include "WHERE user_id = '${c}'" for tables with user_id column
2. For user_profiles table, use "WHERE id = '${c}'"
3. ONLY generate SELECT queries - no INSERT, UPDATE, DELETE, or DDL
4. Use explicit column names - avoid SELECT *
5. Use appropriate JOINs when combining tables
6. Apply date filters using PostgreSQL date functions
7. Use aggregate functions (COUNT, AVG, SUM) for statistics
8. Order results logically (usually by date DESC or relevant metric)
9. Limit results to reasonable amounts (LIMIT 100 by default)
10. Handle NULL values appropriately

QUERY CONTEXT: ${b}

Generate a SQL query that answers the user's question while respecting all security constraints.`;return(await gk({model:h6.languageModel("chat-model"),schema:ie,system:e,prompt:`User question: "${a}"
    
Generate a PostgreSQL query that:
1. Answers this specific question
2. Filters by user_id = '${c}' for security
3. Returns results in a meaningful format
4. Is optimized for performance`})).object}async function ih({sqlQuery:a,userId:b}){try{let c=function(a,b){let c=a.toLowerCase().trim();if(!c.startsWith("select"))return{valid:!1,error:"Only SELECT queries are allowed"};for(let a of["insert","update","delete","drop","truncate","alter","create","grant","revoke"])if(c.includes(a))return{valid:!1,error:`Forbidden keyword detected: ${a}`};let d=(c.match(/;/g)||[]).length;return d>1||1===d&&!c.endsWith(";")?{valid:!1,error:"Multiple SQL statements are not allowed"}:(c.includes(b.toLowerCase())||console.warn("[validateSQLQuery] Warning: user_id may not be included in query"),{valid:!0})}(a,b);if(!c.valid)return{results:[],error:c.error};let d=await (0,Z.createClient)(),{data:e,error:f}=await d.rpc("execute_readonly_query",{query_text:a,user_id:b});if(f)return console.error("[executeSQLQuery] Supabase RPC error:",f),{results:[],error:`Query execution failed: ${f.message}`};if(e&&"object"==typeof e){if("error"in e)return{results:[],error:e.error};return{results:Array.isArray(e)?e:[e]}}return{results:[]}}catch(a){return console.error("[executeSQLQuery] Unexpected error:",a),{results:[],error:a instanceof Error?a.message:"Failed to execute query"}}}let ii=gp.z.object({summary:gp.z.string().describe("One-sentence summary of what the query does"),sections:gp.z.array(gp.z.object({title:gp.z.string().describe('Section title (e.g., "Data Source", "Filtering", "Aggregation")'),explanation:gp.z.string().describe("Plain English explanation of this section")})).describe("Breakdown of query logic into sections"),insights:gp.z.array(gp.z.string()).describe("Key insights from the results")});async function ij({sqlQuery:a,naturalLanguageQuery:b,results:c}){return(await gk({model:h6.languageModel("chat-model"),schema:ii,system:"You are a database query explainer. Break down SQL queries into plain English that non-technical users can understand.",prompt:`Natural Language Question: "${b}"

SQL Query:
\`\`\`sql
${a}
\`\`\`

Query Results: ${c.length} rows returned

Explain this query in plain English, breaking it into logical sections. Then provide 2-3 key insights from the results.`})).object}let ik=gp.z.object({type:gp.z.enum(["line","bar","area","pie","donut"]).describe("Chart type based on data structure"),xAxisKey:gp.z.string().describe("Key from results to use for X-axis"),yAxisKey:gp.z.string().describe("Key from results to use for Y-axis"),title:gp.z.string().describe("Chart title"),description:gp.z.string().describe("Brief description of what the chart shows"),colorScheme:gp.z.enum(["blue","green","purple","orange","red"]).describe("Color scheme"),showLegend:gp.z.boolean().describe("Whether to show legend"),showGrid:gp.z.boolean().describe("Whether to show grid lines")});async function il({results:a,naturalLanguageQuery:b,queryContext:c}){if(0===a.length)return null;let d=a.slice(0,3),e=Object.keys(a[0]);return(await gk({model:h6.languageModel("chat-model"),schema:ik,system:"You are a data visualization expert. Generate chart configurations based on query results.",prompt:`Natural Language Question: "${b}"
Query context: ${c}

Data structure:
${JSON.stringify(d,null,2)}

Available keys: ${e.join(", ")}
Total data points: ${a.length}

Generate a chart configuration that best visualizes this data. Consider:
- Time series data  line/area chart
- Categorical comparisons  bar chart
- Part-to-whole  pie/donut chart
- Multiple metrics  line chart with multiple series`})).object}let im=gp.z.object({topics:gp.z.array(gp.z.object({topic_id:gp.z.number(),vietnamese_title:gp.z.string(),english_title:gp.z.string(),topic_description:gp.z.string(),zone_name:gp.z.string(),zone_level:gp.z.number(),lesson_count:gp.z.number(),reasons:gp.z.array(gp.z.string()).describe("2-3 specific reasons why this topic matches the user query")})),lessons:gp.z.array(gp.z.object({lesson_id:gp.z.number(),lesson_name:gp.z.string(),summary:gp.z.string(),topic_name:gp.z.string(),duration_minutes:gp.z.number(),coins_reward:gp.z.number(),match_reason:gp.z.string().describe("Why this lesson matches the query")})),recommendationType:gp.z.enum(["topics","lessons","mixed"]).describe("What type of recommendations to show")});async function io({naturalLanguageQuery:a,userId:b}){try{let c=await (0,Z.createClient)(),{data:d,error:e}=await c.rpc("execute_readonly_query",{query_text:`
          SELECT 
            t.topic_id,
            t.vietnamese_title,
            t.english_title,
            t.topic_description,
            z.name as zone_name,
            z.level as zone_level,
            COUNT(l.id) as lesson_count
          FROM topics t
          LEFT JOIN zones z ON t.zone_id = z.id
          LEFT JOIN lessons l ON l.topic_id = t.topic_id AND l.status = 'published'
          WHERE t.status = 'published'
          GROUP BY t.topic_id, t.vietnamese_title, t.english_title, t.topic_description, z.name, z.level
          ORDER BY z.level, t.sort_order
        `,user_id:b});if(e)return console.error("[generateTopicRecommendations] Topics query error:",e),{topics:[],lessons:[],totalResults:0,recommendationType:"topics",query:a};let{data:f,error:g}=await c.rpc("execute_readonly_query",{query_text:`
          SELECT DISTINCT topic_id
          FROM user_lesson_progress
          WHERE user_id = '${b}' AND status = 'completed'
        `,user_id:b}),h=new Set(Array.isArray(f)?f.map(a=>a.topic_id):[]),i=Array.isArray(d)?d.filter(a=>!h.has(a.topic_id)):[],j=await gk({model:h6.languageModel("chat-model"),schema:im,system:`You are a Vietnamese learning course advisor. Analyze the user's query and recommend relevant topics/lessons.

AVAILABLE TOPICS:
${JSON.stringify(i,null,2)}

RECOMMENDATION RULES:
1. Match keywords in the query to topic descriptions (e.g., "traveling"  "Du lch v\xe0 tham quan")
2. Consider difficulty level - recommend appropriate level for the user
3. Recommend 3-5 most relevant topics
4. For each topic, provide 2-3 specific reasons why it matches the query
5. If query is specific (e.g., "shopping lessons"), recommend individual lessons within that topic
6. If query is general (e.g., "beginner topics"), recommend topics
7. Order by relevance to query

QUERY CONTEXT: topic_recommendations`,prompt:`User query: "${a}"

Analyze this query and recommend the most relevant Vietnamese learning topics/lessons. Consider:
1. Keywords match (traveling, shopping, health, greetings, etc.)
2. Difficulty level implied in the query
3. Specific vs. general request
4. User's learning goals

Provide recommendations with clear reasoning.`});return{...j.object,query:a,totalResults:j.object.topics.length+j.object.lessons.length}}catch(b){return console.error("[generateTopicRecommendations] Error:",b),{topics:[],lessons:[],totalResults:0,recommendationType:"topics",query:a}}}(0,_.ensureServerEntryExports)([h7,h9,ia,ib,ic,id,ig,ih,ij,il,io]),(0,X.registerServerReference)(h7,"40592004c2dee7f30475faccbd268c8d1828d6c16a",null),(0,X.registerServerReference)(h9,"4075b806905239fc8618b00bcab4cd2c2a3691319c",null),(0,X.registerServerReference)(ia,"404661e4153bb69d6d88099efdcda982f44bf464b3",null),(0,X.registerServerReference)(ib,"40c42535e3542dc51896f4c0b0c29d4b50972488df",null),(0,X.registerServerReference)(ic,"40f9590a388d9a5d1bcd972ec52e3fd38c7927fb93",null),(0,X.registerServerReference)(id,"408ba46ed4abb27f277ca7040c4f2c6a02b2e632db",null),(0,X.registerServerReference)(ig,"40d92d13388efa1de3adf0e958ce63490716e60385",null),(0,X.registerServerReference)(ih,"40395044ae35091763e5b9f8afbcb2d4e00ee88aa3",null),(0,X.registerServerReference)(ij,"40add748e5fbd8fdade2926f89afe4de9809cc6a57",null),(0,X.registerServerReference)(il,"40b9da3b6cceff8f99a045a7342803a23d79cf8e51",null),(0,X.registerServerReference)(io,"4055af552a83013064c37b5dad22a707038b1389de",null)}];

//# sourceMappingURL=_8dbb4430._.js.map