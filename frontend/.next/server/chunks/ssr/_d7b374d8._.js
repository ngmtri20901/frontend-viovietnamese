module.exports=[728447,a=>{"use strict";a.s(["ExerciseContainer",()=>c,"ExerciseContainerShell",()=>d]);var b=a.i(211857);let c=(0,b.registerClientReference)(function(){throw Error("Attempted to call ExerciseContainer() from the server but ExerciseContainer is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/features/learn/components/exercises/ExerciseContainer.tsx <module evaluation>","ExerciseContainer"),d=(0,b.registerClientReference)(function(){throw Error("Attempted to call ExerciseContainerShell() from the server but ExerciseContainerShell is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/features/learn/components/exercises/ExerciseContainer.tsx <module evaluation>","ExerciseContainerShell")},661126,a=>{"use strict";a.s(["ExerciseContainer",()=>c,"ExerciseContainerShell",()=>d]);var b=a.i(211857);let c=(0,b.registerClientReference)(function(){throw Error("Attempted to call ExerciseContainer() from the server but ExerciseContainer is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/features/learn/components/exercises/ExerciseContainer.tsx","ExerciseContainer"),d=(0,b.registerClientReference)(function(){throw Error("Attempted to call ExerciseContainerShell() from the server but ExerciseContainerShell is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/features/learn/components/exercises/ExerciseContainer.tsx","ExerciseContainerShell")},181684,a=>{"use strict";a.i(728447);var b=a.i(661126);a.n(b)},725528,a=>{"use strict";a.s(["ChooseWords",()=>b]);let b=(0,a.i(211857).registerClientReference)(function(){throw Error("Attempted to call ChooseWords() from the server but ChooseWords is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/features/learn/components/exercises/ChooseWords/choose-words.tsx <module evaluation>","ChooseWords")},236907,a=>{"use strict";a.s(["ChooseWords",()=>b]);let b=(0,a.i(211857).registerClientReference)(function(){throw Error("Attempted to call ChooseWords() from the server but ChooseWords is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/features/learn/components/exercises/ChooseWords/choose-words.tsx","ChooseWords")},351890,a=>{"use strict";a.i(725528);var b=a.i(236907);a.n(b)},910235,a=>{"use strict";a.s(["MultipleChoiceQuestion",()=>b]);let b=(0,a.i(211857).registerClientReference)(function(){throw Error("Attempted to call MultipleChoiceQuestion() from the server but MultipleChoiceQuestion is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/features/learn/components/exercises/MCQ/multiple-choice-question.tsx <module evaluation>","MultipleChoiceQuestion")},382320,a=>{"use strict";a.s(["MultipleChoiceQuestion",()=>b]);let b=(0,a.i(211857).registerClientReference)(function(){throw Error("Attempted to call MultipleChoiceQuestion() from the server but MultipleChoiceQuestion is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/features/learn/components/exercises/MCQ/multiple-choice-question.tsx","MultipleChoiceQuestion")},317555,a=>{"use strict";a.i(910235);var b=a.i(382320);a.n(b)},479030,a=>{"use strict";a.s(["SynonymsMatching",()=>b]);let b=(0,a.i(211857).registerClientReference)(function(){throw Error("Attempted to call SynonymsMatching() from the server but SynonymsMatching is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/features/learn/components/exercises/SynonymsMatching/synonyms-matching.tsx <module evaluation>","SynonymsMatching")},70390,a=>{"use strict";a.s(["SynonymsMatching",()=>b]);let b=(0,a.i(211857).registerClientReference)(function(){throw Error("Attempted to call SynonymsMatching() from the server but SynonymsMatching is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/features/learn/components/exercises/SynonymsMatching/synonyms-matching.tsx","SynonymsMatching")},708230,a=>{"use strict";a.i(479030);var b=a.i(70390);a.n(b)},844817,a=>{"use strict";a.s(["WordsMatching",()=>b]);let b=(0,a.i(211857).registerClientReference)(function(){throw Error("Attempted to call WordsMatching() from the server but WordsMatching is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/features/learn/components/exercises/WordsMatching/words-matching.tsx <module evaluation>","WordsMatching")},239951,a=>{"use strict";a.s(["WordsMatching",()=>b]);let b=(0,a.i(211857).registerClientReference)(function(){throw Error("Attempted to call WordsMatching() from the server but WordsMatching is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/features/learn/components/exercises/WordsMatching/words-matching.tsx","WordsMatching")},230628,a=>{"use strict";a.i(844817);var b=a.i(239951);a.n(b)},443714,a=>{"use strict";a.s(["DialogueCompletion",()=>b]);let b=(0,a.i(211857).registerClientReference)(function(){throw Error("Attempted to call DialogueCompletion() from the server but DialogueCompletion is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/features/learn/components/exercises/dialogue/DialogueCompletion.tsx <module evaluation>","DialogueCompletion")},578016,a=>{"use strict";a.s(["DialogueCompletion",()=>b]);let b=(0,a.i(211857).registerClientReference)(function(){throw Error("Attempted to call DialogueCompletion() from the server but DialogueCompletion is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/features/learn/components/exercises/dialogue/DialogueCompletion.tsx","DialogueCompletion")},471432,a=>{"use strict";a.i(443714);var b=a.i(578016);a.n(b)},640062,a=>{"use strict";a.s(["RolePlay",()=>b]);let b=(0,a.i(211857).registerClientReference)(function(){throw Error("Attempted to call RolePlay() from the server but RolePlay is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/features/learn/components/exercises/dialogue/RolePlay.tsx <module evaluation>","RolePlay")},662393,a=>{"use strict";a.s(["RolePlay",()=>b]);let b=(0,a.i(211857).registerClientReference)(function(){throw Error("Attempted to call RolePlay() from the server but RolePlay is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/features/learn/components/exercises/dialogue/RolePlay.tsx","RolePlay")},613230,a=>{"use strict";a.i(640062);var b=a.i(662393);a.n(b)},812451,a=>{"use strict";a.s(["ErrorCorrection",()=>b]);let b=(0,a.i(211857).registerClientReference)(function(){throw Error("Attempted to call ErrorCorrection() from the server but ErrorCorrection is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/features/learn/components/exercises/writing/ErrorCorrection.tsx <module evaluation>","ErrorCorrection")},118141,a=>{"use strict";a.s(["ErrorCorrection",()=>b]);let b=(0,a.i(211857).registerClientReference)(function(){throw Error("Attempted to call ErrorCorrection() from the server but ErrorCorrection is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/features/learn/components/exercises/writing/ErrorCorrection.tsx","ErrorCorrection")},444456,a=>{"use strict";a.i(812451);var b=a.i(118141);a.n(b)},96454,a=>{"use strict";a.s(["default",()=>v,"revalidate",()=>u],96454);var b=a.i(907997),c=a.i(905246);a.i(342537);var d=a.i(905860);a.i(570396);var e=a.i(673727);a.s([],823419);var f=a.i(181684),g=a.i(351890),h=a.i(317555),i=a.i(708230),j=a.i(230628),k=a.i(471432),l=a.i(613230),m=a.i(444456);a.s([],174233),a.i(823419),a.j(f,174233),a.j(g,174233),a.j(h,174233),a.j(i,174233),a.j(j,174233),a.j(k,174233),a.j(l,174233),a.j(m,174233);var n=a.i(174233),o=a.i(142238);async function p(a,b){let c=await (0,o.createClient)(),{data:d,error:e}=await c.from("topics").select(`
      topic_id,
      zone_id,
      zones!inner (
        level
      )
    `).eq("slug",a).single();if(e||!d)return console.error("[getLessonIdsBySlugs] Supabase error fetching topic",{error:e,topicSlug:a}),null;let f=c.from("lessons").select("id, slug, status").eq("topic_id",d.topic_id).eq("slug",b).eq("status","published").maybeSingle(),{data:g,error:h}=await f;return h||!g?(console.error("[getLessonIdsBySlugs] Supabase error fetching lesson",{error:h,lessonSlug:b,topic_id:d.topic_id}),null):(console.log("[getLessonIdsBySlugs] Successfully found lesson",{topic_id:d.topic_id,lesson_id:g.id,zone_id:d.zone_id,zone_level:d.zones.level}),{topic_id:d.topic_id,lesson_id:g.id,zone_id:d.zone_id,zone_level:d.zones.level})}async function q(a){let b=await (0,o.createClient)();console.log("[getActivePracticeSet] Searching for practice set with lesson_id:",a);let c=b.from("practice_sets").select("id, title, description, coin_reward, xp_reward, reward_coins, status, is_active, sequence_order").eq("lesson_id",a).eq("is_active",!0).eq("status","ACTIVE").order("sequence_order",{ascending:!0}).limit(1).maybeSingle(),{data:d,error:e}=await c;if(e)return console.error("[getActivePracticeSet] Supabase error",{error:e,lesson_id:a}),null;if(!d){console.warn("[getActivePracticeSet] No active practice set found",{lesson_id:a});let c=b.from("practice_sets").select("id, title, status, is_active, sequence_order").eq("lesson_id",a),{data:d}=await c;return console.warn("[getActivePracticeSet] All practice sets for lesson:",d),null}return console.log("[getActivePracticeSet] Found practice set:",{id:d.id,title:d.title}),{id:d.id,title:d.title,description:d.description,coinReward:d.coin_reward??d.reward_coins??0,xpReward:d.xp_reward??0}}async function r(a,b,c){let d=await (0,o.createClient)(),e=d.from("practice_set_questions").select(`
      sort_order,
      questions (
        id,
        question_type,
        question_subtype,
        question_data,
        correct_choice_id,
        metadata,
        image_url,
        audio_url
      )
    `).eq("practice_set_id",a).order("sort_order",{ascending:!0}),{data:f,error:g}=await e;return g||!f?[]:f.map(a=>{let e,f,g=a.questions;if(!g)return null;let h={id:g.id.toString(),type:g.question_type},i={};if(g.question_data)try{i="string"==typeof g.question_data?JSON.parse(g.question_data):g.question_data}catch{i={}}let j={};if(g.metadata)try{j="string"==typeof g.metadata?JSON.parse(g.metadata):g.metadata}catch{j={}}if(g.audio_url)try{let a="string"==typeof g.audio_url?JSON.parse(g.audio_url):g.audio_url;e=a?.url}catch{}let k=[];if(g.image_url){console.log("[practice.ts] Processing image_url for question:",g.id,"raw value:",g.image_url);try{let a="string"==typeof g.image_url?JSON.parse(g.image_url):g.image_url;if(console.log("[practice.ts] Parsed image_url:",a),Array.isArray(a))k=a,console.log("[practice.ts] Set imageArray:",k);else if(a&&"object"==typeof a){if(a.url)f=a.url;else if(a.src&&b&&c){let e=`${b}/${c}/images/${a.src}`,{data:g}=d.storage.from("exercises").getPublicUrl(e);f=g.publicUrl||void 0}}else"string"==typeof a&&(f=a)}catch{}}let l=null;switch(g.question_type){case"multiple-choice":{let a;switch(g.question_subtype){case"mcq_text_only":default:a="text-only";break;case"mcq_image_question":a="image-question";break;case"mcq_image_choices":a="image-choices";break;case"mcq_grammar_structure":a="grammar-structure";break;case"mcq_word_translation":a="word-translation"}let e=[],m=g.correct_choice_id?.toString()||"",n=a=>{if(a){if(/^https?:\/\//i.test(a))return a;if(b&&c){let e=`${b}/${c}/images/${a}`,{data:f}=d.storage.from("exercises").getPublicUrl(e);return console.log("[practice.ts] Resolving image path:",e,"to URL:",f.publicUrl),f.publicUrl||void 0}}};if("mcq_image_choices"===g.question_subtype&&k.length>0){if(console.log("[practice.ts] Processing mcq_image_choices with imageArray:",k),console.log("[practice.ts] Built choices for mcq_image_choices:",e=k.map((a,b)=>({id:String(b+1),text:a.alt||`Option ${b+1}`,imageUrl:n(a.src)}))),!m||""===m){let a=k.findIndex(a=>"main"===(a.role||"").toLowerCase());console.log("[practice.ts] Inferred correctChoiceId from role=main:",m=String((a>=0?a:0)+1))}}else"mcq_image_choices"!==g.question_subtype&&(e=i.choices?.map(a=>({id:a.id,text:a.text,imageUrl:a.imageUrl}))||[]);let o={...h,type:"multiple-choice",questionType:a,choices:e,correctChoiceId:m,hint:j?.hint};if("text-only"===a)o.passage=i.context||i.passage,o.questionText=i.questionText;else if("image-question"===a)if(o.questionText=i.questionText,!f&&k.length>0){let a=k.find(a=>"main"===(a.role||"").toLowerCase())||k[0];o.questionImage=n(a?.src)}else o.questionImage=f||i.imageUrl;else"image-choices"===a?o.targetWord=i.targetWord:("grammar-structure"===a||"word-translation"===a)&&(o.questionText=i.questionText,o.targetWord=i.targetWord);l=o;break}case"choose-words":{let a=i.data||i,b=i.ui||j?.ui||{};l={...h,type:"choose-words",question_data:{spec_version:1,subtype:g.question_subtype,data:a,ui:b},audioUrl:e};break}case"error-correction":l={...h,type:"error-correction",question:i.question||i.instruction||"Correct the sentence",faultySentence:i.faultySentence||i.faulty,target:i.target||i.correct,hint:i.hint||j?.hint};break;case"synonyms-matching":{let a=i.pairs?.map((a,b)=>({id:b+1,word1:a.left||a.word1,word2:a.right||a.word2,meaning:a.meaning}))||[];l={...h,type:"synonyms-matching",pairs:a};break}case"word-matching":{let a=i.pairs?.map((a,b)=>({id:b+1,english:a.left||a.word1,vietnamese:a.right||a.word2}))||[];l={...h,type:"word-matching",pairs:a};break}case"dialogue-completion":{let a=i.dialogue?.map(a=>({who:a.who,text:a.text}))||i.context||[];l={...h,type:"dialogue-completion",context:a,choices:i.choices?.map(a=>({id:a.id,text:a.text}))||[],correctChoiceId:g.correct_choice_id?.toString()||"",explanation:i.explanation};break}case"role-play":l={...h,type:"role-play",title:i.context||"",steps:i.steps?.map(a=>({bot:a.bot||a.prompt,choices:a.choices?.map(a=>({text:a.text}))||a.options?.map(a=>({text:a.text}))||[],expected:a.expected||a.correctIndex||0,tips:a.tips||a.hint}))||[]}}return l}).filter(a=>null!==a)}async function s(a,b){console.log("Fetching exercise for topicSlug:",a,"lessonSlug:",b);let c=await p(a,b);if(console.log("Lesson IDs result:",c),!c)return console.warn("[getExerciseBySlugs] Could not resolve IDs for provided slugs",{topicSlug:a,lessonSlug:b}),null;let d=await q(c.lesson_id);if(console.log("Practice set result:",d),!d||!("id"in d))return console.warn("[getExerciseBySlugs] No active practice set data",{ids:c}),null;let e=await r(d.id.toString(),a,b);return console.log("Questions length:",e.length),{...d,id:d.id.toString(),topicId:a,chapterId:"",lessonId:b,zoneId:c.zone_id,zoneLevel:c.zone_level,questions:e}}async function t(a,b){let c=await (0,o.createClient)(),{data:d,error:e}=await c.from("practice_results").select("id, status").eq("practice_set_id",a).eq("user_id",b).eq("status","in_progress").maybeSingle();if(e)return console.error("[canAccessExercise] Error checking for active session:",e),!1;let f=!!d;return f||console.log("[canAccessExercise] No active session found for practice_set:",a),f}let u=1;async function v(a){let f=await (0,c.cookies)(),g=(0,d.createServerClient)("https://uavvljncupscxoxofcvp.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVhdnZsam5jdXBzY3hveG9mY3ZwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ1MDk4NjAsImV4cCI6MjA2MDA4NTg2MH0.1ym2TlBf6_orJS3TgFxaMIeAHOGQsElaEjwRGRV_9U8",{cookies:{getAll:()=>f.getAll(),setAll(a){try{a.forEach(({name:a,value:b,options:c})=>f.set(a,b,c))}catch{}}}}),{data:{session:h}}=await g.auth.getSession(),{topicSlug:i,lessonSlug:j}=await a.params,k=await s(i,j);return k?(h?.user?.id?await t(k.id,h.user.id)||(console.log("[ExercisePage] Access denied - exercise already completed, redirecting to lesson page"),(0,e.redirect)(`/learn/${i}/${j}`)):(0,e.redirect)(`/learn/${i}/${j}`),(0,b.jsx)(n.ExerciseContainerShell,{exercise:k,topicSlug:i,lessonSlug:j})):(0,b.jsxs)("div",{className:"p-6 space-y-4",children:[(0,b.jsx)("h1",{className:"text-xl font-semibold",children:"Exercise Debug Mode"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Không tìm thấy dữ liệu exercise nhưng tạm thời không chuyển sang 404 để debug."}),(0,b.jsx)("div",{className:"rounded bg-muted p-4 text-sm whitespace-pre-wrap",children:`Slugs:
  topicSlug: ${i}
  lessonSlug: ${j}`}),(0,b.jsx)("p",{className:"text-sm font-medium",children:"Gợi ý kiểm tra:"}),(0,b.jsxs)("ul",{className:"list-disc pl-6 text-sm space-y-1",children:[(0,b.jsx)("li",{children:"Lesson status phải = published"}),(0,b.jsx)("li",{children:"practice_sets có lesson_id đúng, is_active = true, status = ACTIVE"}),(0,b.jsx)("li",{children:"Có ít nhất 1 record trong practice_set_questions"})]}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Xem console server để thấy log từ getLessonIdsBySlugs / getActivePracticeSet / getQuestionsForSet."})]})}}];

//# sourceMappingURL=_d7b374d8._.js.map