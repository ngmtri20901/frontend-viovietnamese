{"version":3,"sources":["turbopack:///[project]/features/flashcards/utils/vocab-key.ts","turbopack:///[project]/node_modules/@vercel/oidc/dist/token-error.js","turbopack:///[project]/.next-internal/server/app/(app)/ai/chat/page/actions.js (server actions loader)","turbopack:///[project]/app/(app)/ai/chat/page.tsx"],"sourcesContent":["/**\r\n * Utility functions for generating and parsing deterministic vocabulary keys\r\n * Format: t{topicId}-l{lessonId}-{slugified_vietnamese}\r\n */\r\n\r\n/**\r\n * Generates a deterministic vocabulary key from topic, lesson, and Vietnamese text\r\n * @param topicId - Topic ID (bigint)\r\n * @param lessonId - Lesson ID (bigint)\r\n * @param vietnameseText - Vietnamese text to slugify\r\n * @returns Deterministic key in format: t{topicId}-l{lessonId}-{slugified}\r\n */\r\nexport function generateVocabKey(\r\n  topicId: number,\r\n  lessonId: number,\r\n  vietnameseText: string\r\n): string {\r\n  const slugified = vietnameseText\r\n    .toLowerCase()\r\n    .trim()\r\n    .replace(/\\s+/g, '_')\r\n    .replace(/[^\\w\\-_]/g, '')\r\n    .replace(/_+/g, '_') // Replace multiple underscores with single\r\n    .replace(/^_|_$/g, ''); // Remove leading/trailing underscores\r\n\r\n  return `t${topicId}-l${lessonId}-${slugified}`;\r\n}\r\n\r\n/**\r\n * Parses a vocabulary key to extract topic ID, lesson ID, and slug\r\n * @param key - Vocabulary key in format: t{topicId}-l{lessonId}-{slug}\r\n * @returns Parsed components or null if invalid format\r\n */\r\nexport function parseVocabKey(\r\n  key: string\r\n): { topicId: number; lessonId: number; slug: string } | null {\r\n  const match = key.match(/^t(\\d+)-l(\\d+)-(.+)$/);\r\n  if (!match) return null;\r\n\r\n  return {\r\n    topicId: parseInt(match[1], 10),\r\n    lessonId: parseInt(match[2], 10),\r\n    slug: match[3],\r\n  };\r\n}\r\n\r\n/**\r\n * Checks if a string is a valid vocabulary key format\r\n * @param key - String to validate\r\n * @returns True if key matches vocabulary key format\r\n */\r\nexport function isValidVocabKey(key: string): boolean {\r\n  return /^t\\d+-l\\d+-[\\w\\-_]+$/.test(key);\r\n}\r\n\r\n","\"use strict\";\nvar __defProp = Object.defineProperty;\nvar __getOwnPropDesc = Object.getOwnPropertyDescriptor;\nvar __getOwnPropNames = Object.getOwnPropertyNames;\nvar __hasOwnProp = Object.prototype.hasOwnProperty;\nvar __export = (target, all) => {\n  for (var name in all)\n    __defProp(target, name, { get: all[name], enumerable: true });\n};\nvar __copyProps = (to, from, except, desc) => {\n  if (from && typeof from === \"object\" || typeof from === \"function\") {\n    for (let key of __getOwnPropNames(from))\n      if (!__hasOwnProp.call(to, key) && key !== except)\n        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });\n  }\n  return to;\n};\nvar __toCommonJS = (mod) => __copyProps(__defProp({}, \"__esModule\", { value: true }), mod);\nvar token_error_exports = {};\n__export(token_error_exports, {\n  VercelOidcTokenError: () => VercelOidcTokenError\n});\nmodule.exports = __toCommonJS(token_error_exports);\nclass VercelOidcTokenError extends Error {\n  constructor(message, cause) {\n    super(message);\n    this.name = \"VercelOidcTokenError\";\n    this.cause = cause;\n  }\n  toString() {\n    if (this.cause) {\n      return `${this.name}: ${this.message}: ${this.cause}`;\n    }\n    return `${this.name}: ${this.message}`;\n  }\n}\n// Annotate the CommonJS export names for ESM import in node:\n0 && (module.exports = {\n  VercelOidcTokenError\n});\n","export {saveVocabularyFromLesson as '40b7874b5beee18e2e913212052e9efd3061f9459a'} from 'ACTIONS_MODULE0'\nexport {unsaveVocabularyFromLesson as '40a12d3392f5f7e3fd35f464eebcfef7da83f3293b'} from 'ACTIONS_MODULE1'\nexport {getSuggestions as '40a3d36627abd5814739c7249a840c4c1f52a42d51'} from 'ACTIONS_MODULE2'\nexport {deleteTrailingMessages as '404661e4153bb69d6d88099efdcda982f44bf464b3'} from 'ACTIONS_MODULE3'\nexport {saveChatModelAsCookie as '40592004c2dee7f30475faccbd268c8d1828d6c16a'} from 'ACTIONS_MODULE3'\nexport {updateChatTitle as '40f9590a388d9a5d1bcd972ec52e3fd38c7927fb93'} from 'ACTIONS_MODULE3'\nexport {deleteChatSession as '408ba46ed4abb27f277ca7040c4f2c6a02b2e632db'} from 'ACTIONS_MODULE3'\n","import { cookies } from \"next/headers\";\r\nimport { Chat } from \"@/features/ai/chat/components/core/chat\";\r\nimport { ChatSidebarWrapper } from \"@/features/ai/chat/components/sidebar/chat-sidebar-wrapper\";\r\nimport { DataStreamHandler } from \"@/features/ai/chat/components/core/data-stream-handler\";\r\nimport { DEFAULT_CHAT_MODEL } from \"@/features/ai/chat/core/models\";\r\nimport { generateUUID } from \"@/features/ai/chat/utils\";\r\nimport { getUserOrNull } from \"@/shared/lib/supabase/auth\";\r\nimport { ensureUserProfile } from \"@/features/ai/chat/services/queries\";\r\n\r\nexport default async function Page() {\r\n  const user = await getUserOrNull();\r\n\r\n  // Ensure user profile exists in database\r\n  if (user?.id) {\r\n    try {\r\n      await ensureUserProfile(user.id, user.email);\r\n    } catch (error) {\r\n      console.error(\"Failed to ensure user profile:\", error);\r\n    }\r\n  }\r\n\r\n  const id = generateUUID();\r\n\r\n  const cookieStore = await cookies();\r\n  const modelIdFromCookie = cookieStore.get(\"chat-model\");\r\n\r\n  return (\r\n    <div className=\"flex h-full w-full overflow-hidden\">\r\n      <div className=\"flex-1 overflow-hidden\">\r\n        <Chat\r\n          autoResume={false}\r\n          id={id}\r\n          initialChatModel={modelIdFromCookie?.value || DEFAULT_CHAT_MODEL}\r\n          initialMessages={[]}\r\n          isReadonly={false}\r\n          key={id}\r\n        />\r\n      </div>\r\n      <ChatSidebarWrapper user={user ?? undefined} defaultOpen={true} />\r\n      <DataStreamHandler />\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":"uCAYO,SAAS,EACd,CAAe,CACf,CAAgB,CAChB,CAAsB,EAEtB,IAAM,EAAY,EACf,WAAW,GACX,IAAI,GACJ,OAAO,CAAC,OAAQ,KAChB,OAAO,CAAC,YAAa,IACrB,OAAO,CAAC,MAAO,KAAK,AACpB,OAAO,CAAC,SAAU,IAErB,CAF0B,KAEnB,CAAC,CAAC,EAAE,EAAQ,EAAE,EAAE,EAAS,CAAC,EAAE,CAH+B,CAG/B,CAAW,AAChD,CAyBO,SAAS,EAAgB,CAAW,EACzC,AA7BgE,MA6BzD,uBAAuB,IAAI,CAAC,EACrC,CA1CC,EAAA,CAAA,CAAA,qSCVD,IAAI,EAAY,OAAO,cAAc,CACjC,EAAmB,OAAO,wBAAwB,CAClD,EAAoB,OAAO,mBAAmB,CAC9C,EAAe,OAAO,SAAS,CAAC,cAAc,CAc9C,EAAsB,CAAC,EAC3B,CAde,CAAC,EAAQ,KACtB,IAAK,IAAI,KAAQ,EACf,EAAU,EAAQ,EAAM,CAAE,IAAK,CAAG,CAAC,EAAK,CAAE,YAAY,CAAK,GAC/D,EAWS,EAAqB,CAC5B,qBAAsB,IAAM,CAC9B,GACA,EAAO,OAAO,CALc,CARV,CAAC,AAaF,EAbM,IAAc,KACnC,GAAI,GAAwB,UAAhB,OAAO,GAAqC,YAAY,AAA5B,OAAO,EAC7C,IAAK,IAAI,KAAO,EAAkB,GAC5B,AAAC,EAAa,CAAlB,GAAsB,CAAC,EAAI,IAAQ,KAHZ,GAGoB,IACzC,EAAU,EAAI,EAAK,CAAE,IAAK,IAAM,CAAI,CAAC,EAAI,CAAE,WAAY,CAAC,CAAC,EAAO,EAAiB,EAAM,EAAA,CAAI,EAAK,EAAK,UAAU,AAAC,GAEtH,OAAO,EACT,EACwC,EAAU,CAAC,EAAG,aAAc,CAAE,OAAO,CAAK,GAKpD,CALwD,CAMtF,OAAM,UAA6B,MACjC,YAAY,CAAO,CAAE,CAAK,CAAE,CAC1B,KAAK,CAAC,GACN,IAAI,CAAC,IAAI,CAAG,uBACZ,IAAI,CAAC,KAAK,CAAG,CACf,CACA,UAAW,QACT,AAAI,IAAI,CAAC,KAAK,CACL,CAAA,AADO,EACJ,IAAI,CAAC,IAAI,CAAC,EAAE,EAAE,IAAI,CAAC,OAAO,CAAC,EAAE,EAAE,IAAI,CAAC,KAAK,CAAA,CAAE,CAEhD,CAAA,EAAG,IAAI,CAAC,IAAI,CAAC,EAAE,EAAE,IAAI,CAAC,OAAO,CAAA,CAAE,AACxC,CACF,4kBCnCA,IAAA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,0GCHA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,CAAA,CAAA,OAAA,IAAA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QAEe,eAAe,IAC5B,IAAM,EAAO,MAAM,CAAA,EAAA,EAAA,aAAA,AAAa,IAGhC,GAAI,GAAM,GACR,CADY,EACR,CACF,MAAM,CAAA,EAAA,EAAA,iBAAA,AAAiB,EAAC,EAAK,EAAE,CAAE,EAAK,KAAK,CAC7C,CAAE,MAAO,EAAO,CACd,QAAQ,KAAK,CAAC,iCAAkC,EAClD,CAGF,IAAM,EAAK,CAAA,EAAA,EAAA,YAAA,AAAY,IAGjB,EAAoB,CADN,MAAM,CAAA,EAAA,EAAA,OAAA,AAAO,GAAA,EACK,GAAG,CAAC,cAE1C,MACE,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,+CACb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,kCACb,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,IAAI,CAAA,CACH,YAAY,EACZ,GAAI,EACJ,iBAAkB,GAAmB,OAAS,EAAA,kBAAkB,CAChE,gBAAiB,EAAE,CACnB,YAAY,GACP,KAGT,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,kBAAkB,CAAA,CAAC,KAAM,QAAQ,EAAW,aAAa,IAC1D,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,iBAAiB,CAAA,CAAA,KAGxB","ignoreList":[1]}