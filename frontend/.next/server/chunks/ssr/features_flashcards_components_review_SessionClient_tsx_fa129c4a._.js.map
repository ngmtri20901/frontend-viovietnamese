{"version":3,"sources":["turbopack:///[project]/features/flashcards/components/review/review-session-summary-modal.tsx","turbopack:///[project]/features/flashcards/components/review/SessionClient.tsx","turbopack:///[project]/node_modules/lucide-react/src/icons/trophy.ts","turbopack:///[project]/node_modules/lucide-react/src/icons/chart-column.ts"],"sourcesContent":["\"use client\"\n\nimport { useState, useEffect } from \"react\"\nimport { useRouter } from \"next/navigation\"\nimport { supabase } from \"@/shared/lib/supabase/client\"\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/shared/components/ui/dialog\"\nimport { Button } from \"@/shared/components/ui/button\"\nimport { Card, CardContent } from \"@/shared/components/ui/card\"\nimport { Badge } from \"@/shared/components/ui/badge\"\nimport { Progress } from \"@/shared/components/ui/progress\"\nimport { \n  Trophy, \n  Target, \n  Clock, \n  Coins, \n  TrendingUp, \n  RefreshCw,\n  BarChart3,\n  Lock,\n  Crown\n} from \"lucide-react\"\nimport { toast } from \"sonner\"\nimport Link from \"next/link\"\n\ninterface SessionSummaryData {\n  totalCards: number\n  correctAnswers: number\n  accuracyRate: number\n  coinsEarned: number\n  timeSpent: number // in seconds\n}\n\ninterface User {\n  subscription_type: \"FREE\" | \"PLUS\" | \"UNLIMITED\"\n}\n\ninterface ReviewSessionSummaryModalProps {\n  isOpen: boolean\n  onClose: () => void\n  sessionData: SessionSummaryData\n}\n\nconst FREE_DAILY_SESSION_LIMIT = 3\n\nexport function ReviewSessionSummaryModal({ \n  isOpen, \n  onClose, \n  sessionData \n}: ReviewSessionSummaryModalProps) {\n  const router = useRouter()\n  const [user, setUser] = useState<User | null>(null)\n  const [todaysSessions, setTodaysSessions] = useState(0)\n  const [streakIncreased, setStreakIncreased] = useState(false)\n  const [newStreak, setNewStreak] = useState(0)\n\n  useEffect(() => {\n    if (isOpen) {\n      fetchUserData()\n      fetchTodaysSessions()\n      checkStreakUpdate()\n    }\n  }, [isOpen])\n\n  const fetchUserData = async () => {\n    try {\n      const { data: { user: authUser } } = await supabase.auth.getUser()\n      if (!authUser) return\n\n      const { data: userProfile } = await supabase\n        .from(\"user_profiles\")\n        .select(\"subscription_type, streak_days\")\n        .eq(\"id\", authUser.id)\n        .single()\n\n      if (userProfile) {\n        setUser(userProfile)\n        setNewStreak(userProfile.streak_days)\n      }\n    } catch (error) {\n      console.error(\"Error fetching user data:\", error)\n    }\n  }\n\n  const fetchTodaysSessions = async () => {\n    try {\n      const { data: { user: authUser } } = await supabase.auth.getUser()\n      if (!authUser) return\n\n      const today = new Date().toISOString().split('T')[0]\n      \n      const { count } = await supabase\n        .from(\"review_sessions\")\n        .select(\"*\", { count: 'exact' })\n        .eq(\"user_id\", authUser.id)\n        .eq(\"status\", \"completed\")\n        .gte(\"started_at\", `${today}T00:00:00.000Z`)\n        .lt(\"started_at\", `${today}T23:59:59.999Z`)\n\n      setTodaysSessions(count || 0)\n    } catch (error) {\n      console.error(\"Error fetching today's sessions:\", error)\n    }\n  }\n\n  const checkStreakUpdate = async () => {\n    try {\n      const { data: { user: authUser } } = await supabase.auth.getUser()\n      if (!authUser) return\n\n      // Check if this is the user's first session today\n      const today = new Date().toISOString().split('T')[0]\n      const yesterday = new Date()\n      yesterday.setDate(yesterday.getDate() - 1)\n      const yesterdayStr = yesterday.toISOString().split('T')[0]\n\n      const { count: todaysCompletedSessions } = await supabase\n        .from(\"review_sessions\")\n        .select(\"*\", { count: 'exact' })\n        .eq(\"user_id\", authUser.id)\n        .eq(\"status\", \"completed\")\n        .gte(\"started_at\", `${today}T00:00:00.000Z`)\n        .lt(\"started_at\", `${today}T23:59:59.999Z`)\n\n      // If this is the first completed session today, update streak\n      if (todaysCompletedSessions === 1) {\n        const { data: userProfile } = await supabase\n          .from(\"user_profiles\")\n          .select(\"streak_days, last_login\")\n          .eq(\"id\", authUser.id)\n          .single()\n\n        if (userProfile) {\n          let newStreakDays = userProfile.streak_days || 0\n          const lastLoginDate = userProfile.last_login ? \n            new Date(userProfile.last_login).toISOString().split('T')[0] : null\n\n          if (lastLoginDate === yesterdayStr) {\n            // Consecutive day - increment streak\n            newStreakDays += 1\n            setStreakIncreased(true)\n          } else if (lastLoginDate !== today) {\n            // Streak broken or first time - reset to 1\n            newStreakDays = 1\n            setStreakIncreased(lastLoginDate !== null)\n          }\n\n          // Update user streak and last login\n          await supabase\n            .from(\"user_profiles\")\n            .update({\n              streak_days: newStreakDays,\n              last_login: new Date().toISOString()\n            })\n            .eq(\"id\", authUser.id)\n\n          setNewStreak(newStreakDays)\n        }\n      }\n    } catch (error) {\n      console.error(\"Error checking streak update:\", error)\n    }\n  }\n\n  const formatTime = (seconds: number): string => {\n    const minutes = Math.floor(seconds / 60)\n    const remainingSeconds = seconds % 60\n    \n    if (minutes > 0) {\n      return `${minutes}m ${remainingSeconds}s`\n    }\n    return `${remainingSeconds}s`\n  }\n\n  const getAccuracyColor = (accuracy: number): string => {\n    if (accuracy >= 80) return \"text-green-600\"\n    if (accuracy >= 60) return \"text-yellow-600\"\n    return \"text-red-600\"\n  }\n\n  const getAccuracyBadgeVariant = (accuracy: number) => {\n    if (accuracy >= 80) return \"default\"\n    if (accuracy >= 60) return \"secondary\"\n    return \"destructive\"\n  }\n\n  const handleNewSession = () => {\n    onClose()\n    router.push(\"/flashcards/review\")\n  }\n\n  const handleViewStatistics = () => {\n    onClose()\n    router.push(\"/flashcards/statistics\")\n  }\n\n  const handleClose = () => {\n    onClose()\n    router.push(\"/flashcards/review\")\n  }\n\n  return (\n    <Dialog open={isOpen} onOpenChange={handleClose}>\n      <DialogContent className=\"sm:max-w-md\">\n        <DialogHeader>\n          <DialogTitle className=\"text-center text-2xl font-bold flex items-center justify-center gap-2\">\n            <Trophy className=\"h-6 w-6 text-yellow-500\" />\n            Session Complete!\n          </DialogTitle>\n        </DialogHeader>\n\n        <div className=\"space-y-6\">\n          {/* Main Stats Grid */}\n          <div className=\"grid grid-cols-2 gap-4\">\n            <Card>\n              <CardContent className=\"p-4 text-center\">\n                <div className=\"text-2xl font-bold text-blue-600\">\n                  {sessionData.totalCards}\n                </div>\n                <p className=\"text-sm text-muted-foreground\">Cards Reviewed</p>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardContent className=\"p-4 text-center\">\n                <div className=\"text-2xl font-bold text-green-600\">\n                  {sessionData.correctAnswers}\n                </div>\n                <p className=\"text-sm text-muted-foreground\">Correct Answers</p>\n              </CardContent>\n            </Card>\n          </div>\n\n          {/* Accuracy Rate */}\n          <Card>\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center justify-between mb-3\">\n                <div className=\"flex items-center gap-2\">\n                  <Target className=\"h-5 w-5 text-muted-foreground\" />\n                  <span className=\"font-medium\">Accuracy Rate</span>\n                </div>\n                <Badge variant={getAccuracyBadgeVariant(sessionData.accuracyRate)}>\n                  {sessionData.accuracyRate.toFixed(0)}%\n                </Badge>\n              </div>\n              <Progress value={sessionData.accuracyRate} className=\"h-2\" />\n            </CardContent>\n          </Card>\n\n          {/* Time and Coins */}\n          <div className=\"grid grid-cols-2 gap-4\">\n            <Card>\n              <CardContent className=\"p-4 text-center\">\n                <div className=\"flex items-center justify-center gap-2 mb-2\">\n                  <Clock className=\"h-4 w-4 text-muted-foreground\" />\n                  <span className=\"text-sm font-medium\">Time Spent</span>\n                </div>\n                <div className=\"text-lg font-bold\">\n                  {formatTime(sessionData.timeSpent)}\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardContent className=\"p-4 text-center\">\n                <div className=\"flex items-center justify-center gap-2 mb-2\">\n                  <Coins className=\"h-4 w-4 text-yellow-500\" />\n                  <span className=\"text-sm font-medium\">Coins Earned</span>\n                </div>\n                <div className=\"text-lg font-bold text-yellow-600\">\n                  {sessionData.coinsEarned}\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n\n          {/* Streak Update */}\n          {streakIncreased && (\n            <Card className=\"bg-gradient-to-r from-orange-50 to-red-50 dark:from-orange-950/20 dark:to-red-950/20 border-orange-200 dark:border-orange-800\">\n              <CardContent className=\"p-4 text-center\">\n                <div className=\"flex items-center justify-center gap-2 mb-2\">\n                  <TrendingUp className=\"h-5 w-5 text-orange-600\" />\n                  <span className=\"font-medium text-orange-800 dark:text-orange-200\">\n                    Streak Updated!\n                  </span>\n                </div>\n                <p className=\"text-orange-700 dark:text-orange-300\">\n                  Your learning streak is now {newStreak} days!\n                </p>\n              </CardContent>\n            </Card>\n          )}\n\n          {/* Session Limit Warning for Free Users */}\n          {user?.subscription_type === \"FREE\" && todaysSessions >= FREE_DAILY_SESSION_LIMIT && (\n            <Card className=\"bg-gradient-to-r from-amber-50 to-orange-50 dark:from-amber-950/20 dark:to-orange-950/20 border-amber-200 dark:border-amber-800\">\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center gap-2 mb-2\">\n                  <Lock className=\"h-4 w-4 text-amber-600\" />\n                  <span className=\"font-medium text-amber-800 dark:text-amber-200\">\n                    Daily Limit Reached\n                  </span>\n                </div>\n                <p className=\"text-sm text-amber-700 dark:text-amber-300 mb-3\">\n                  You've completed {todaysSessions}/{FREE_DAILY_SESSION_LIMIT} free review sessions today. \n                  Upgrade to Plus for unlimited review!\n                </p>\n                <Button asChild size=\"sm\" className=\"w-full\">\n                  <Link href=\"/plans\">\n                    <Crown className=\"w-4 h-4 mr-2\" />\n                    Upgrade to Plus\n                  </Link>\n                </Button>\n              </CardContent>\n            </Card>\n          )}\n\n          {/* Action Buttons */}\n          <div className=\"space-y-3\">\n            <Button \n              onClick={handleNewSession} \n              className=\"w-full\"\n              disabled={user?.subscription_type === \"FREE\" && todaysSessions >= FREE_DAILY_SESSION_LIMIT}\n            >\n              <RefreshCw className=\"w-4 h-4 mr-2\" />\n              Start New Review Session\n            </Button>\n            \n            <Button \n              onClick={handleViewStatistics} \n              variant=\"outline\" \n              className=\"w-full\"\n            >\n              <BarChart3 className=\"w-4 h-4 mr-2\" />\n              View Detailed Statistics\n            </Button>\n          </div>\n\n          {/* Motivational Message */}\n          <div className=\"text-center p-4 bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-950/20 dark:to-indigo-950/20 rounded-lg\">\n            <p className=\"text-sm text-blue-700 dark:text-blue-300\">\n              {sessionData.accuracyRate >= 80 \n                ? \"üéâ Excellent work! You're mastering Vietnamese vocabulary!\"\n                : sessionData.accuracyRate >= 60\n                ? \"üëç Good progress! Keep practicing to improve further!\"\n                : \"üí™ Every review makes you stronger! Keep going!\"\n              }\n            </p>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  )\n} ","'use client'\r\n\r\nimport { useCallback, useEffect, useState } from 'react'\r\nimport { useRouter, useSearchParams } from 'next/navigation'\r\nimport { supabase } from '@/shared/lib/supabase/client'\r\nimport { ReviewSession } from './ReviewSession'\r\nimport type { FlashcardData } from '@/features/flashcards/types/flashcard.types'\r\nimport { useFlashcardReview } from '@/features/flashcards/hooks/use-flashcard-review'\r\nimport { Button } from '@/shared/components/ui/button'\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/shared/components/ui/card'\r\nimport { Separator } from '@/shared/components/ui/separator'\r\nimport { toast } from 'sonner'\r\nimport { authSessionManager } from '@/features/flashcards/utils/auth-session-manager'\r\nimport { ReviewSessionSummaryModal } from '@/features/flashcards/components/review/review-session-summary-modal'\r\n\r\nexport default function SessionClient() {\r\n  const router = useRouter()\r\n  const params = useSearchParams()\r\n  const sessionId = params?.get('id') || ''\r\n\r\n  const [loading, setLoading] = useState(true)\r\n  const [sessionCards, setSessionCards] = useState<FlashcardData[]>([])\r\n  const [sessionMeta, setSessionMeta] = useState<any | null>(null)\r\n  const [userId, setUserId] = useState<string | null>(null)\r\n  const [isCompleting, setIsCompleting] = useState(false)\r\n  const [isCompleted, setIsCompleted] = useState(false)\r\n  const [summaryOpen, setSummaryOpen] = useState(false)\r\n  const [summaryData, setSummaryData] = useState<{ totalCards: number, correctAnswers: number, accuracyRate: number, coinsEarned: number, timeSpent: number }>({ totalCards: 0, correctAnswers: 0, accuracyRate: 0, coinsEarned: 0, timeSpent: 0 })\r\n\r\n  // Enforce focus mode by collapsing sidebar and disabling toggle\r\n  useEffect(() => {\r\n    // Mark as review session to avoid auth refresh side-effects\r\n    authSessionManager.setReviewSession(true)\r\n\r\n    // Collapse sidebar via cookie and block Ctrl/Cmd+B\r\n    try {\r\n      document.cookie = `sidebar:state=false; path=/; max-age=${60 * 60}`\r\n      const preventToggle = (e: KeyboardEvent) => {\r\n        const isToggle = (e.key === 'b' || e.key === 'B') && (e.ctrlKey || e.metaKey)\r\n        if (isToggle) {\r\n          e.preventDefault()\r\n          e.stopPropagation()\r\n        }\r\n      }\r\n      window.addEventListener('keydown', preventToggle, { capture: true })\r\n      return () => {\r\n        window.removeEventListener('keydown', preventToggle, { capture: true } as any)\r\n        authSessionManager.setReviewSession(false)\r\n      }\r\n    } catch {\r\n      return () => authSessionManager.setReviewSession(false)\r\n    }\r\n  }, [])\r\n\r\n  // Load session + cards\r\n  useEffect(() => {\r\n    const run = async () => {\r\n      try {\r\n        if (!sessionId) {\r\n          toast.error('Missing session id')\r\n          router.push('/flashcards/review')\r\n          return\r\n        }\r\n\r\n        const { data: { user }, error: authError } = await supabase.auth.getUser()\r\n        if (authError || !user) {\r\n          toast.error('Please log in to continue')\r\n          router.push('/auth/login')\r\n          return\r\n        }\r\n        setUserId(user.id)\r\n\r\n        // Load session\r\n        const { data: sessionRow, error: sessionError } = await supabase\r\n          .from('review_sessions')\r\n          .select('*')\r\n          .eq('id', sessionId)\r\n          .maybeSingle()\r\n\r\n        if (sessionError || !sessionRow) {\r\n          toast.error('Session not found')\r\n          router.push('/flashcards/review')\r\n          return\r\n        }\r\n        setSessionMeta(sessionRow)\r\n\r\n        // Load session cards mapping table\r\n        const { data: sessionCardRows, error: sessionCardsError } = await supabase\r\n          .from('review_session_cards')\r\n          .select('flashcard_id, card_order')\r\n          .eq('session_id', sessionId)\r\n          .order('card_order', { ascending: true })\r\n\r\n        if (sessionCardsError) {\r\n          throw sessionCardsError\r\n        }\r\n\r\n        const flashcardIds = (sessionCardRows || []).map((r: any) => r.flashcard_id)\r\n        if (!flashcardIds.length) {\r\n          toast.error('No cards in this session')\r\n          router.push('/flashcards/review')\r\n          return\r\n        }\r\n\r\n        // Fetch card details from backend API by IDs\r\n        const { flashcardAPI } = await import('@/features/flashcards/services/flashcardService')\r\n        const cards: FlashcardData[] = await flashcardAPI.getFlashcardsByIds(flashcardIds)\r\n\r\n        setSessionCards(cards)\r\n      } catch (e) {\r\n        console.error(e)\r\n        toast.error('Failed to load review session')\r\n      } finally {\r\n        setLoading(false)\r\n      }\r\n    }\r\n    run()\r\n  }, [router, sessionId])\r\n\r\n  const {\r\n    currentCard,\r\n    currentCardIndex,\r\n    isFlipped,\r\n    timer,\r\n    isTimerActive,\r\n    cardResults,\r\n    savedCards,\r\n    handleCardResult,\r\n    handleSaveCard,\r\n    handleFlipCard,\r\n    resetSession,\r\n    getProgressStats,\r\n  } = useFlashcardReview({ cards: sessionCards, enableTimer: true })\r\n\r\n  // Finalize when finished\r\n  useEffect(() => {\r\n    const finished = sessionCards.length > 0 && cardResults.length === sessionCards.length\r\n    if (!finished) return\r\n    ;(async () => {\r\n      try {\r\n        const stats = getProgressStats()\r\n        await supabase\r\n          .from('review_sessions')\r\n          .update({\r\n            status: 'completed',\r\n            completed_cards: stats.total,\r\n            correct_answers: stats.correct,\r\n            total_time_seconds: null,\r\n            completed_at: new Date().toISOString(),\r\n            updated_at: new Date().toISOString(),\r\n          })\r\n          .eq('id', sessionId)\r\n\r\n        // Aggregate and update daily flashcard statistics for the user\r\n        if (userId) {\r\n          const today = new Date().toISOString().slice(0, 10)\r\n          // Sum time from this session's cards\r\n          const { data: sumRows } = await supabase\r\n            .from('review_session_cards')\r\n            .select('time_spent_seconds')\r\n            .eq('session_id', sessionId)\r\n          const totalSeconds = (sumRows || []).reduce((acc: number, r: any) => acc + (r?.time_spent_seconds || 0), 0)\r\n          const timeMinutes = Math.max(0, Math.round(totalSeconds / 60))\r\n\r\n          // Load today's row\r\n          const { data: todayRow } = await supabase\r\n            .from('flashcard_statistics')\r\n            .select('*')\r\n            .eq('user_id', userId)\r\n            .eq('date', today)\r\n            .maybeSingle()\r\n\r\n          const reviewed = stats.total\r\n          const correct = stats.correct\r\n          const totalQuestions = stats.total\r\n\r\n          if (todayRow) {\r\n            const newReviewed = (todayRow.flashcards_reviewed || 0) + reviewed\r\n            const newCorrect = (todayRow.correct_answers || 0) + correct\r\n            const newTotalQ = (todayRow.total_questions || 0) + totalQuestions\r\n            const newAccuracy = newTotalQ > 0 ? (newCorrect / newTotalQ) * 100 : 0\r\n            const newMinutes = (todayRow.time_spent_minutes || 0) + timeMinutes\r\n\r\n            await supabase\r\n              .from('flashcard_statistics')\r\n              .update({\r\n                flashcards_reviewed: newReviewed,\r\n                correct_answers: newCorrect,\r\n                total_questions: newTotalQ,\r\n                accuracy_rate: newAccuracy,\r\n                time_spent_minutes: newMinutes,\r\n                updated_at: new Date().toISOString(),\r\n              })\r\n              .eq('id', todayRow.id)\r\n          } else {\r\n            const accuracy = totalQuestions > 0 ? (correct / totalQuestions) * 100 : 0\r\n            await supabase\r\n              .from('flashcard_statistics')\r\n              .insert({\r\n                user_id: userId,\r\n                date: today,\r\n                flashcards_reviewed: reviewed,\r\n                correct_answers: correct,\r\n                total_questions: totalQuestions,\r\n                accuracy_rate: accuracy,\r\n                time_spent_minutes: timeMinutes,\r\n              })\r\n          }\r\n\r\n          // Prepare and open summary modal\r\n          setSummaryData({\r\n            totalCards: stats.total,\r\n            correctAnswers: stats.correct,\r\n            accuracyRate: stats.accuracy,\r\n            coinsEarned: 0,\r\n            timeSpent: Math.max(0, (sumRows || []).reduce((acc: number, r: any) => acc + (r?.time_spent_seconds || 0), 0)),\r\n          })\r\n          setIsCompleted(true)\r\n          setSummaryOpen(true)\r\n        }\r\n        toast.success('Session completed!')\r\n      } catch (e) {\r\n        console.error(e)\r\n      }\r\n    })()\r\n  }, [cardResults.length, sessionCards.length, getProgressStats, sessionId, userId])\r\n\r\n  // Persist a single card result to DB\r\n  const persistCardResult = useCallback(async (cardId: string, result: 'correct' | 'incorrect' | 'unsure', timeSpentMs: number) => {\r\n    if (!userId || !sessionId) return\r\n\r\n    // 1) Update review_session_cards\r\n    await supabase\r\n      .from('review_session_cards')\r\n      .update({ result, time_spent_seconds: Math.max(1, Math.round(timeSpentMs / 1000)), reviewed_at: new Date().toISOString() })\r\n      .eq('session_id', sessionId)\r\n      .eq('flashcard_id', cardId)\r\n\r\n    // 2) Update SRS record using simple SM-2 style logic\r\n    const { data: existingRows } = await supabase\r\n      .from('flashcard_srs_records')\r\n      .select('*')\r\n      .eq('user_id', userId)\r\n      .eq('flashcard_id', cardId)\r\n      .limit(1)\r\n\r\n    const now = new Date()\r\n    if (existingRows && existingRows.length > 0) {\r\n      const row = existingRows[0] as any\r\n      const wasCorrect = result === 'correct'\r\n      const easeFactor = Math.max(1.3, Number(row.ease_factor || 2.5) + (wasCorrect ? 0.1 : -0.2))\r\n      const repetition = wasCorrect ? Number(row.repetition_number || 0) + 1 : 0\r\n      let intervalDays = 1\r\n      if (repetition <= 1) intervalDays = 1\r\n      else if (repetition === 2) intervalDays = 6\r\n      else intervalDays = Math.round((row.interval_days || 6) * easeFactor)\r\n      const dueDate = new Date(now)\r\n      dueDate.setDate(dueDate.getDate() + intervalDays)\r\n\r\n      await supabase\r\n        .from('flashcard_srs_records')\r\n        .update({\r\n          ease_factor: easeFactor,\r\n          repetition_number: repetition,\r\n          interval_days: intervalDays,\r\n          due_date: dueDate.toISOString().slice(0, 10),\r\n          total_reviews: (row.total_reviews || 0) + 1,\r\n          correct_reviews: (row.correct_reviews || 0) + (wasCorrect ? 1 : 0),\r\n          last_reviewed: now.toISOString(),\r\n          updated_at: now.toISOString(),\r\n        })\r\n        .eq('id', row.id)\r\n    } else {\r\n      const wasCorrect = result === 'correct'\r\n      const easeFactor = wasCorrect ? 2.6 : 2.3\r\n      const repetition = wasCorrect ? 1 : 0\r\n      const intervalDays = wasCorrect ? 1 : 1\r\n      const dueDate = new Date(now)\r\n      dueDate.setDate(dueDate.getDate() + intervalDays)\r\n      await supabase\r\n        .from('flashcard_srs_records')\r\n        .insert({\r\n          user_id: userId,\r\n          flashcard_id: cardId,\r\n          ease_factor: easeFactor,\r\n          repetition_number: repetition,\r\n          interval_days: intervalDays,\r\n          due_date: dueDate.toISOString().slice(0, 10),\r\n          total_reviews: 1,\r\n          correct_reviews: wasCorrect ? 1 : 0,\r\n          last_reviewed: now.toISOString(),\r\n          updated_at: now.toISOString(),\r\n        })\r\n    }\r\n  }, [sessionId, userId])\r\n\r\n  // Intercept result handler to persist\r\n  const handleResultAndPersist = useCallback((result: 'correct' | 'incorrect' | 'unsure') => {\r\n    if (isCompleting || isCompleted) return\r\n    const card = sessionCards[currentCardIndex]\r\n    // If this is the last card, mark as completing to block further clicks\r\n    if (currentCardIndex === sessionCards.length - 1) {\r\n      setIsCompleting(true)\r\n    }\r\n    handleCardResult(result)\r\n    if (!card?.id) return\r\n    // Defer to read the timeSpent added by hook\r\n    setTimeout(() => {\r\n      const last = cardResults[cardResults.length - 1]\r\n      const timeMs = last && last.cardId === card.id ? last.timeSpent : 0\r\n      persistCardResult(card.id, result, timeMs).catch(() => {})\r\n    }, 50)\r\n  }, [currentCardIndex, sessionCards, handleCardResult, persistCardResult, cardResults, isCompleting, isCompleted])\r\n\r\n  // Complete session handler defined above\r\n\r\n  const quitSession = useCallback(async () => {\r\n    try {\r\n      const stats = getProgressStats()\r\n      await supabase\r\n        .from('review_sessions')\r\n        .update({\r\n          status: 'abandoned',\r\n          completed_cards: stats.total,\r\n          correct_answers: stats.correct,\r\n          updated_at: new Date().toISOString(),\r\n        })\r\n        .eq('id', sessionId)\r\n\r\n      toast.success('Session exited')\r\n      router.push('/flashcards/review')\r\n    } catch (e) {\r\n      console.error(e)\r\n      router.push('/flashcards/review')\r\n    }\r\n  }, [getProgressStats, router, sessionId])\r\n\r\n  if (loading) {\r\n    return null\r\n  }\r\n\r\n  if (!sessionCards.length) {\r\n    return (\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle>No cards loaded</CardTitle>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <Button onClick={() => router.push('/flashcards/review')}>Back</Button>\r\n        </CardContent>\r\n      </Card>\r\n    )\r\n  }\r\n\r\n  const progressStats = getProgressStats()\r\n\r\n  return (\r\n    <div className=\"container mx-auto py-6 px-4 max-w-4xl\">\r\n      <div className=\"flex items-center justify-between mb-4\">\r\n        <h1 className=\"text-2xl font-bold\">Focused Review Session</h1>\r\n        <div className=\"flex gap-2\">\r\n          <Button variant=\"outline\" onClick={quitSession}>Quit</Button>\r\n        </div>\r\n      </div>\r\n\r\n      <ReviewSession\r\n        practiceCards={sessionCards}\r\n        currentCard={currentCard}\r\n        currentCardIndex={currentCardIndex}\r\n        isFlipped={isFlipped}\r\n        timer={timer}\r\n        isTimerActive={isTimerActive}\r\n        cardResults={cardResults}\r\n        progressStats={progressStats}\r\n        savedCards={savedCards}\r\n        onCardResult={handleResultAndPersist}\r\n        onSaveCard={isCompleted || isCompleting ? () => {} : handleSaveCard}\r\n        onFlipCard={isCompleted || isCompleting ? () => {} : handleFlipCard}\r\n        onRefreshCards={() => router.refresh()}\r\n        onGetFreshCards={() => router.refresh()}\r\n        getAnimationDuration={() => 300}\r\n        isLoading={isCompleting || isCompleted}\r\n      />\r\n\r\n      <Separator className=\"my-6\" />\r\n      <div className=\"text-sm text-muted-foreground\">Session ID: {sessionId}</div>\r\n\r\n      <ReviewSessionSummaryModal\r\n        isOpen={summaryOpen}\r\n        onClose={() => {\r\n          setSummaryOpen(false)\r\n          router.push('/flashcards/review')\r\n        }}\r\n        sessionData={summaryData}\r\n      />\r\n    </div>\r\n  )\r\n}\r\n\r\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['path', { d: 'M10 14.66v1.626a2 2 0 0 1-.976 1.696A5 5 0 0 0 7 21.978', key: '1n3hpd' }],\n  ['path', { d: 'M14 14.66v1.626a2 2 0 0 0 .976 1.696A5 5 0 0 1 17 21.978', key: 'rfe1zi' }],\n  ['path', { d: 'M18 9h1.5a1 1 0 0 0 0-5H18', key: '7xy6bh' }],\n  ['path', { d: 'M4 22h16', key: '57wxv0' }],\n  ['path', { d: 'M6 9a6 6 0 0 0 12 0V3a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1z', key: '1mhfuq' }],\n  ['path', { d: 'M6 9H4.5a1 1 0 0 1 0-5H6', key: 'tex48p' }],\n];\n\n/**\n * @component @name Trophy\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMTAgMTQuNjZ2MS42MjZhMiAyIDAgMCAxLS45NzYgMS42OTZBNSA1IDAgMCAwIDcgMjEuOTc4IiAvPgogIDxwYXRoIGQ9Ik0xNCAxNC42NnYxLjYyNmEyIDIgMCAwIDAgLjk3NiAxLjY5NkE1IDUgMCAwIDEgMTcgMjEuOTc4IiAvPgogIDxwYXRoIGQ9Ik0xOCA5aDEuNWExIDEgMCAwIDAgMC01SDE4IiAvPgogIDxwYXRoIGQ9Ik00IDIyaDE2IiAvPgogIDxwYXRoIGQ9Ik02IDlhNiA2IDAgMCAwIDEyIDBWM2ExIDEgMCAwIDAtMS0xSDdhMSAxIDAgMCAwLTEgMXoiIC8+CiAgPHBhdGggZD0iTTYgOUg0LjVhMSAxIDAgMCAxIDAtNUg2IiAvPgo8L3N2Zz4K) - https://lucide.dev/icons/trophy\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Trophy = createLucideIcon('trophy', __iconNode);\n\nexport default Trophy;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['path', { d: 'M3 3v16a2 2 0 0 0 2 2h16', key: 'c24i48' }],\n  ['path', { d: 'M18 17V9', key: '2bz60n' }],\n  ['path', { d: 'M13 17V5', key: '1frdt8' }],\n  ['path', { d: 'M8 17v-3', key: '17ska0' }],\n];\n\n/**\n * @component @name ChartColumn\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMyAzdjE2YTIgMiAwIDAgMCAyIDJoMTYiIC8+CiAgPHBhdGggZD0iTTE4IDE3VjkiIC8+CiAgPHBhdGggZD0iTTEzIDE3VjUiIC8+CiAgPHBhdGggZD0iTTggMTd2LTMiIC8+Cjwvc3ZnPgo=) - https://lucide.dev/icons/chart-column\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst ChartColumn = createLucideIcon('chart-column', __iconNode);\n\nexport default ChartColumn;\n"],"names":[],"mappings":"wFCEA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QAEA,EAAA,EAAA,CAAA,CAAA,MACA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QDPA,EAAA,EAAA,CAAA,CAAA,QAGA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,sBEcA,CAAA,GAAM,EAAA,CAAA,EAAS,CAAA,CAAA,OAAA,EAAA,SCpBF,CDoB6B,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAU,CAAA,0DAnBuB,CAAA,CAAA,CAAA,CAAA,AAAK,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAU,CAAA,uEACd,CAAA,CAAA,CAAA,CAAA,AAAK,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAU,CAAA,yCAC7C,CAAA,CAAA,CAAA,CAAA,AAAK,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAU,CAAA,qCAClB,CACzC,CAAC,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,AAAQ,CAAA,AAAE,EAAG,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,AAAwD,CAAA,CAAA,CAAA,CAAA,AAAK,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAU,CAAA,SAC5E,CAAE,AAAF,EAAK,CCYV,ADZU,CCYV,ADZU,CAAA,ACYV,uCDXN,EFAA,IAAA,EAAA,EAAA,CAAA,CAAA,OAAA,EAAA,EAAA,CAAA,CAAA,QAAA,EAAA,EAAA,CAAA,CAAA,QAAA,EAAA,EAAA,CAAA,CAAA,QAAA,EAAA,EAAA,CAAA,CAAA,YGWM,CDZH,CAAA,CAAA,CAAA,CCYiB,CDZJ,ACYI,CDZJ,ACYI,CDZJ,ACYI,MAAA,EAAiB,CDZrB,ACYqB,CDZrB,ACYqB,CDZrB,ACYqB,CDZrB,ACYqB,CDZrB,ACYqB,CDZrB,ACYqB,SAlBD,CAClC,AAiBmD,CAjBlD,ADK8C,ACYI,CDjBlD,ACAA,ADK8C,ACYI,CDjBlD,ACAA,ADK8C,ACYI,CAAA,ADjBlD,ACAA,CDAA,ACAA,CDAA,ACAA,CDAA,ACAA,CDAA,ACAA,CAAU,EAAA,2BAA+B,CDA5B,ACA4B,CDA5B,ACA4B,CDA5B,ACA4B,CAAA,AAAK,ADAjC,CCAiC,ADAjC,CAAA,ACAiC,CDAjC,ACAiC,CDAjC,ACAiC,CAAA,ADAjC,CCAiC,ADAjC,CAAA,ACAiC,CDAjC,WCCL,CAAA,ADAA,ACAE,EAAA,WAAe,CDAZ,ACAY,CDAZ,ACAY,CDAZ,ACAY,CDAZ,ACAY,AAAK,CDAjB,ACAiB,CAAA,ADAjB,CAAA,ACAiB,CDAjB,ACAiB,CAAA,ADAjB,CCAiB,ADAjB,CCAiB,ADAjB,CAAA,WCCL,CDAA,ACAA,aAAiB,CDAZ,ACAY,CDAZ,ACAY,CAAA,ADAZ,CAAA,ACAY,AAAK,CAAA,ADAjB,CCAiB,ADAjB,CAAA,ACAiB,CDAjB,ACAiB,CAAA,ADAjB,CAAA,ACAiB,CDAjB,ACAiB,CDAjB,ECA2B,CDA3B,ACCd,CAAC,CDAA,ACAA,CDAA,ACAA,CAAA,ADAA,CAAA,ACAA,CAAA,ADAA,CAAA,ACAA,CDAA,ACAA,cAAyB,CDAA,ACAA,CDAA,ACAA,CDAA,ACAA,CDAA,ACAA,QAAK,KHGjC,IAAA,EAAA,EAAA,CAAA,CAAA,QAAA,EAAA,EAAA,CAAA,CAAA,QAYA,EAAA,EAAA,CAAA,CAAA,QAsBO,SAAS,EAA0B,QACxC,CAAM,SACN,CAAO,aACP,CAAW,CACoB,QAC/B,IAAM,EAAS,CAAA,EAAA,EAAA,SAAA,AAAS,IAClB,CAAC,EAAM,EAAQ,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","ignoreList":[2,3]}