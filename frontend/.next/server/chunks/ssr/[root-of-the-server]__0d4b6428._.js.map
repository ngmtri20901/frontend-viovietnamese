{"version":3,"sources":["turbopack:///[project]/features/flashcards/utils/vocab-key.ts","turbopack:///[project]/.next-internal/server/app/(app)/learn/page/actions.js (server actions loader)","turbopack:///[project]/features/learn/contexts/ExerciseContext.tsx/__nextjs-internal-proxy.mjs","turbopack:///[project]/features/learn/contexts/UserProgressContext.tsx/__nextjs-internal-proxy.mjs","turbopack:///[project]/app/(app)/learn/page.tsx","turbopack:///[project]/features/learn/contexts/index.ts"],"sourcesContent":["/**\r\n * Utility functions for generating and parsing deterministic vocabulary keys\r\n * Format: t{topicId}-l{lessonId}-{slugified_vietnamese}\r\n */\r\n\r\n/**\r\n * Generates a deterministic vocabulary key from topic, lesson, and Vietnamese text\r\n * @param topicId - Topic ID (bigint)\r\n * @param lessonId - Lesson ID (bigint)\r\n * @param vietnameseText - Vietnamese text to slugify\r\n * @returns Deterministic key in format: t{topicId}-l{lessonId}-{slugified}\r\n */\r\nexport function generateVocabKey(\r\n  topicId: number,\r\n  lessonId: number,\r\n  vietnameseText: string\r\n): string {\r\n  const slugified = vietnameseText\r\n    .toLowerCase()\r\n    .trim()\r\n    .replace(/\\s+/g, '_')\r\n    .replace(/[^\\w\\-_]/g, '')\r\n    .replace(/_+/g, '_') // Replace multiple underscores with single\r\n    .replace(/^_|_$/g, ''); // Remove leading/trailing underscores\r\n\r\n  return `t${topicId}-l${lessonId}-${slugified}`;\r\n}\r\n\r\n/**\r\n * Parses a vocabulary key to extract topic ID, lesson ID, and slug\r\n * @param key - Vocabulary key in format: t{topicId}-l{lessonId}-{slug}\r\n * @returns Parsed components or null if invalid format\r\n */\r\nexport function parseVocabKey(\r\n  key: string\r\n): { topicId: number; lessonId: number; slug: string } | null {\r\n  const match = key.match(/^t(\\d+)-l(\\d+)-(.+)$/);\r\n  if (!match) return null;\r\n\r\n  return {\r\n    topicId: parseInt(match[1], 10),\r\n    lessonId: parseInt(match[2], 10),\r\n    slug: match[3],\r\n  };\r\n}\r\n\r\n/**\r\n * Checks if a string is a valid vocabulary key format\r\n * @param key - String to validate\r\n * @returns True if key matches vocabulary key format\r\n */\r\nexport function isValidVocabKey(key: string): boolean {\r\n  return /^t\\d+-l\\d+-[\\w\\-_]+$/.test(key);\r\n}\r\n\r\n","export {saveVocabularyFromLesson as '40b7874b5beee18e2e913212052e9efd3061f9459a'} from 'ACTIONS_MODULE0'\nexport {unsaveVocabularyFromLesson as '40a12d3392f5f7e3fd35f464eebcfef7da83f3293b'} from 'ACTIONS_MODULE1'\n","// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const ExerciseProvider = registerClientReference(\n    function() { throw new Error(\"Attempted to call ExerciseProvider() from the server but ExerciseProvider is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/features/learn/contexts/ExerciseContext.tsx\",\n    \"ExerciseProvider\",\n);\nexport const useExercise = registerClientReference(\n    function() { throw new Error(\"Attempted to call useExercise() from the server but useExercise is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/features/learn/contexts/ExerciseContext.tsx\",\n    \"useExercise\",\n);\n","// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const UserProgressProvider = registerClientReference(\n    function() { throw new Error(\"Attempted to call UserProgressProvider() from the server but UserProgressProvider is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/features/learn/contexts/UserProgressContext.tsx\",\n    \"UserProgressProvider\",\n);\nexport const useUserProgress = registerClientReference(\n    function() { throw new Error(\"Attempted to call useUserProgress() from the server but useUserProgress is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/features/learn/contexts/UserProgressContext.tsx\",\n    \"useUserProgress\",\n);\n","export const revalidate = 2592000 // ISR: 30 days (30 * 24 * 60 * 60)\r\n\r\nimport { createClient } from \"@/shared/lib/supabase/server\"\r\nimport { UserProgressProvider } from \"@/features/learn/contexts\"\r\nimport { ZoneSection } from \"@/features/learn/components/lesson\"\r\nimport type { Zone, Topic } from \"@/features/learn/types\"\r\n\r\n// Map numeric zone_id from DB to app Zone ids\r\nconst zoneIdToKey: Record<number, Zone[\"id\"]> = {\r\n  1: \"beginner\",\r\n  2: \"elementary\",\r\n  3: \"intermediate\",\r\n  4: \"upper-intermediate\",\r\n  5: \"advanced\",\r\n  6: \"expert\",\r\n}\r\n\r\n// Base zones skeleton with existing UI text\r\nconst baseZones: Zone[] = [\r\n  {\r\n    id: \"beginner\",\r\n    title: \"Beginner Zone\",\r\n    description:\r\n      \"Get comfortable with the Vietnamese alphabet and sounds, learn essential everyday words, and confidently introduce yourself and greet people.\",\r\n    topics: [],\r\n  },\r\n  {\r\n    id: \"elementary\",\r\n    title: \"Elementary Zone\",\r\n    description:\r\n      \"Grow your vocabulary and grammar skills so you can chat about daily life and describe things simply in Vietnamese.\",\r\n    topics: [],\r\n  },\r\n  {\r\n    id: \"intermediate\",\r\n    title: \"Intermediate Zone\",\r\n    description:\r\n      \"Build more complex conversation skills for work, travel, and social situations.\",\r\n    topics: [],\r\n  },\r\n  {\r\n    id: \"upper-intermediate\",\r\n    title: \"Upper Intermediate Zone\",\r\n    description:\r\n      \"Master Vietnamese with nuanced expressions and cultural understanding.\",\r\n    topics: [],\r\n  },\r\n  {\r\n    id: \"advanced\",\r\n    title: \"Advanced Zone\",\r\n    description:\r\n      \"Master advanced Vietnamese with nuanced expressions and cultural understanding.\",\r\n    topics: [],\r\n  },\r\n  {\r\n    id: \"expert\",\r\n    title: \"Expert Zone\",\r\n    description:\r\n      \"Master advanced Vietnamese with nuanced expressions and cultural understanding.\",\r\n    topics: [],\r\n  },\r\n]\r\n\r\n// DB row shape for topics\r\ninterface DbTopicRow {\r\n  english_title: string | null\r\n  topic_description: string | null\r\n  is_review: boolean | null\r\n  sort_order: number | null\r\n  slug: string | null\r\n  zone_id: number | null\r\n  lessons?: Array<{\r\n    id: number\r\n    status: string\r\n  }>\r\n}\r\n\r\nexport default async function ExercisesPage() {\r\n  const supabase = await createClient()\r\n\r\n  const result = await (supabase as any)\r\n    .from(\"topics\")\r\n    .select(`\r\n      english_title, \r\n      topic_description, \r\n      is_review, \r\n      sort_order, \r\n      slug, \r\n      zone_id,\r\n      lessons!inner(\r\n        id,\r\n        status\r\n      )\r\n    `)\r\n    .eq(\"status\", \"published\")\r\n    .eq(\"lessons.status\", \"published\")\r\n\r\n  let rows: DbTopicRow[] = []\r\n  if (\"data\" in (result as any)) {\r\n    const { data, error } = result as { data: DbTopicRow[] | null; error: any }\r\n    if (error) {\r\n      console.error(error)\r\n    }\r\n    rows = Array.isArray(data) ? data : []\r\n  } else {\r\n    // Dummy client path: no data returned\r\n    rows = []\r\n  }\r\n\r\n  // Sort locally to avoid using .order() on the client stub\r\n  rows.sort((a, b) => {\r\n    const za = a.zone_id ?? 0\r\n    const zb = b.zone_id ?? 0\r\n    if (za !== zb) return za - zb\r\n    const sa = a.sort_order ?? 0\r\n    const sb = b.sort_order ?? 0\r\n    return sa - sb\r\n  })\r\n\r\n  // Clone base zones to avoid mutation\r\n  const zones: Zone[] = baseZones.map((z) => ({ ...z, topics: [] }))\r\n\r\n  for (const r of rows) {\r\n    const zoneKey = r.zone_id ? zoneIdToKey[r.zone_id] ?? \"beginner\" : \"beginner\"\r\n\r\n    const mappedTopic: Topic = {\r\n      id: r.slug ?? r.english_title ?? Math.random().toString(36).slice(2),\r\n      title: r.english_title ?? \"Untitled Topic\",\r\n      slug: r.slug ?? undefined,\r\n      zone: zoneKey,\r\n      description: r.topic_description ?? undefined,\r\n      image: (r.is_review || (r.slug && (r.slug.includes('review') || r.slug.includes('practice')))) \r\n        ? '/images/topic/review.webp' \r\n        : r.slug ? `/images/topic/${r.slug}.webp` : undefined,\r\n      chapters: [],\r\n      lessonCount: r.lessons?.length ?? 0,\r\n    }\r\n\r\n    const targetZone = zones.find((z) => z.id === zoneKey)\r\n    if (targetZone) {\r\n      targetZone.topics.push(mappedTopic)\r\n    }\r\n  }\r\n\r\n  return (\r\n    <UserProgressProvider>\r\n      <div className=\"space-y-6\">\r\n        {zones.map((zone) => (\r\n          <ZoneSection key={zone.id} zone={zone} />\r\n        ))}\r\n      </div>\r\n    </UserProgressProvider>\r\n  )\r\n}\r\n","// Context exports for the learn feature\r\nexport * from './ExerciseContext'\r\nexport * from './UserProgressContext'\r\n"],"names":[],"mappings":"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","ignoreList":[2,3]}