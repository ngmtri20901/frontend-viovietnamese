(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,905745,e=>{"use strict";e.s(["default",()=>eK],905745);var s=e.i(843476),a=e.i(271645),t=e.i(618566),r=e.i(859016),i=e.i(859951),o=e.i(800190),l=e.i(326357),n=e.i(938266),c=e.i(16715),d=e.i(846696),u=e.i(788510),m=e.i(269638),g=e.i(114683),p=e.i(531278),h=e.i(373884);let f=e=>{let{status:a}=e;switch(a){case"pending":default:return(0,s.jsx)(g.Circle,{className:"h-5 w-5 text-gray-400"});case"loading":return(0,s.jsx)(p.Loader2,{className:"h-5 w-5 text-blue-600 animate-spin"});case"completed":return(0,s.jsx)(m.CheckCircle,{className:"h-5 w-5 text-green-600"});case"error":return(0,s.jsx)(h.XCircle,{className:"h-5 w-5 text-red-600"})}},x=e=>{let{steps:a}=e,t=a.filter(e=>"completed"===e.status).length/a.length*100;return(0,s.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-6",children:(0,s.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-500 ease-out",style:{width:"".concat(t,"%")}})})},v=e=>{let{steps:a,title:t="Processing...",onCancel:r,className:i=""}=e,o=a.some(e=>"error"===e.status),l=a.every(e=>"completed"===e.status);return(0,s.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 ".concat(i),children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-xl p-6 w-full max-w-md",children:[(0,s.jsxs)("div",{className:"text-center mb-6",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:t}),(0,s.jsx)(x,{steps:a})]}),(0,s.jsx)("div",{className:"space-y-4 mb-6",children:a.map((e,a)=>(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)("div",{className:"flex-shrink-0 mt-0.5",children:(0,s.jsx)(f,{status:e.status})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("p",{className:"text-sm font-medium ".concat("completed"===e.status?"text-green-700":"loading"===e.status?"text-blue-700":"error"===e.status?"text-red-700":"text-gray-600"),children:e.label}),e.description&&(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:e.description})]})]},e.id))}),(o||r)&&!l&&(0,s.jsxs)("div",{className:"flex justify-end gap-2",children:[r&&(0,s.jsx)("button",{onClick:r,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md transition-colors",children:"Cancel"}),o&&(0,s.jsx)("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 text-sm font-medium text-white bg-red-600 hover:bg-red-700 rounded-md transition-colors",children:"Retry"})]}),l&&(0,s.jsx)("div",{className:"text-center",children:(0,s.jsx)("p",{className:"text-sm text-green-700 font-medium",children:"Ready to start your session!"})})]})})};var b=e.i(115518),y=e.i(532671);e.i(247167);var j=e.i(299749);let w=new class{async validateSessionFilters(e,s){try{let a={...e};s&&(a.user_id=s);let t=await fetch("".concat(this.baseUrl,"/api/v1/flashcards/session/validate"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!t.ok){let e=await t.json().catch(()=>null);throw Error((null==e?void 0:e.detail)||"HTTP error! status: ".concat(t.status))}return await t.json()}catch(e){throw console.error("Error validating session filters:",e),e}}async generateSessionCards(e){try{let s=await fetch("".concat(this.baseUrl,"/api/v1/flashcards/session/generate"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok){let e=await s.json().catch(()=>null);throw Error((null==e?void 0:e.detail)||"HTTP error! status: ".concat(s.status))}return await s.json()}catch(e){throw console.error("Error generating session cards:",e),e}}buildFiltersFromForm(e){return{topic:e.topic||void 0,complexity:"All"===e.complexity?"all":e.complexity.toLowerCase(),common_words_only:e.onlyCommonWords,num_cards:e.numberOfCards}}formatSuggestionForDisplay(e){var s;let a=[];return(null==(s=e.impact.removed_restrictions)?void 0:s.length)&&a.push("removes ".concat(e.impact.removed_restrictions.join(", ")," restrictions")),e.impact.expanded_complexity&&a.push("includes all complexity levels"),e.impact.expanded_topics&&a.push("includes all topics"),a.length>0?a.join(", "):e.description}constructor(){(0,j._)(this,"baseUrl",void 0),this.baseUrl="https://vietnamesenext.onrender.com"}};var C=e.i(220849),S=e.i(170275),N=e.i(981140),k=e.i(820783),R=e.i(30030),_=e.i(248425),T=e.i(842727),F=e.i(369340),E=e.i(586318),P=e.i(635804),D=e.i(999682),A=e.i(296626),I="Radio",[O,L]=(0,R.createContextScope)(I),[U,z]=O(I),G=a.forwardRef((e,t)=>{let{__scopeRadio:r,name:i,checked:o=!1,required:l,disabled:n,value:c="on",onCheck:d,form:u,...m}=e,[g,p]=a.useState(null),h=(0,k.useComposedRefs)(t,e=>p(e)),f=a.useRef(!1),x=!g||u||!!g.closest("form");return(0,s.jsxs)(U,{scope:r,checked:o,disabled:n,children:[(0,s.jsx)(_.Primitive.button,{type:"button",role:"radio","aria-checked":o,"data-state":H(o),"data-disabled":n?"":void 0,disabled:n,value:c,...m,ref:h,onClick:(0,N.composeEventHandlers)(e.onClick,e=>{o||null==d||d(),x&&(f.current=e.isPropagationStopped(),f.current||e.stopPropagation())})}),x&&(0,s.jsx)(q,{control:g,bubbles:!f.current,name:i,value:c,checked:o,required:l,disabled:n,form:u,style:{transform:"translateX(-100%)"}})]})});G.displayName=I;var V="RadioIndicator",B=a.forwardRef((e,a)=>{let{__scopeRadio:t,forceMount:r,...i}=e,o=z(V,t);return(0,s.jsx)(A.Presence,{present:r||o.checked,children:(0,s.jsx)(_.Primitive.span,{"data-state":H(o.checked),"data-disabled":o.disabled?"":void 0,...i,ref:a})})});B.displayName=V;var q=a.forwardRef((e,t)=>{let{__scopeRadio:r,control:i,checked:o,bubbles:l=!0,...n}=e,c=a.useRef(null),d=(0,k.useComposedRefs)(c,t),u=(0,D.usePrevious)(o),m=(0,P.useSize)(i);return a.useEffect(()=>{let e=c.current;if(!e)return;let s=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set;if(u!==o&&s){let a=new Event("click",{bubbles:l});s.call(e,o),e.dispatchEvent(a)}},[u,o,l]),(0,s.jsx)(_.Primitive.input,{type:"radio","aria-hidden":!0,defaultChecked:o,...n,tabIndex:-1,ref:d,style:{...n.style,...m,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});function H(e){return e?"checked":"unchecked"}q.displayName="RadioBubbleInput";var M=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],W="RadioGroup",[J,Q]=(0,R.createContextScope)(W,[T.createRovingFocusGroupScope,L]),Z=(0,T.createRovingFocusGroupScope)(),K=L(),[Y,X]=J(W),$=a.forwardRef((e,a)=>{let{__scopeRadioGroup:t,name:r,defaultValue:i,value:o,required:l=!1,disabled:n=!1,orientation:c,dir:d,loop:u=!0,onValueChange:m,...g}=e,p=Z(t),h=(0,E.useDirection)(d),[f,x]=(0,F.useControllableState)({prop:o,defaultProp:null!=i?i:null,onChange:m,caller:W});return(0,s.jsx)(Y,{scope:t,name:r,required:l,disabled:n,value:f,onValueChange:x,children:(0,s.jsx)(T.Root,{asChild:!0,...p,orientation:c,dir:h,loop:u,children:(0,s.jsx)(_.Primitive.div,{role:"radiogroup","aria-required":l,"aria-orientation":c,"data-disabled":n?"":void 0,dir:h,...g,ref:a})})})});$.displayName=W;var ee="RadioGroupItem",es=a.forwardRef((e,t)=>{let{__scopeRadioGroup:r,disabled:i,...o}=e,l=X(ee,r),n=l.disabled||i,c=Z(r),d=K(r),u=a.useRef(null),m=(0,k.useComposedRefs)(t,u),g=l.value===o.value,p=a.useRef(!1);return a.useEffect(()=>{let e=e=>{M.includes(e.key)&&(p.current=!0)},s=()=>p.current=!1;return document.addEventListener("keydown",e),document.addEventListener("keyup",s),()=>{document.removeEventListener("keydown",e),document.removeEventListener("keyup",s)}},[]),(0,s.jsx)(T.Item,{asChild:!0,...c,focusable:!n,active:g,children:(0,s.jsx)(G,{disabled:n,required:l.required,checked:g,...d,...o,name:l.name,ref:m,onCheck:()=>l.onValueChange(o.value),onKeyDown:(0,N.composeEventHandlers)(e=>{"Enter"===e.key&&e.preventDefault()}),onFocus:(0,N.composeEventHandlers)(o.onFocus,()=>{var e;p.current&&(null==(e=u.current)||e.click())})})})});es.displayName=ee;var ea=a.forwardRef((e,a)=>{let{__scopeRadioGroup:t,...r}=e,i=K(t);return(0,s.jsx)(B,{...i,...r,ref:a})});ea.displayName="RadioGroupIndicator";var et=e.i(733498),er=e.i(605458);function ei(e){let{className:a,...t}=e;return(0,s.jsx)($,{"data-slot":"radio-group",className:(0,er.cn)("grid gap-3",a),...t})}function eo(e){let{className:a,...t}=e;return(0,s.jsx)(es,{"data-slot":"radio-group-item",className:(0,er.cn)("border-input text-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 aspect-square size-4 shrink-0 rounded-full border shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",a),...t,children:(0,s.jsx)(ea,{"data-slot":"radio-group-indicator",className:"relative flex items-center justify-center",children:(0,s.jsx)(et.CircleIcon,{className:"fill-primary absolute top-1/2 left-1/2 size-2 -translate-x-1/2 -translate-y-1/2"})})})}var el=e.i(855193),en=e.i(878894),ec=e.i(463059),ed=e.i(25652),eu=e.i(166778);let em=e=>{let{isOpen:t,onClose:r,availableCount:o,requestedCount:l,suggestions:c,onAcceptSuggestion:d,onAdjustFilters:u,isLoading:m=!1}=e,[g,p]=(0,a.useState)(c.length>0?c[0].id:""),h=c.find(e=>e.id===g);return(0,s.jsx)(n.Dialog,{open:t,onOpenChange:r,children:(0,s.jsxs)(n.DialogContent,{className:"sm:max-w-2xl",children:[(0,s.jsx)(n.DialogHeader,{children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"p-2 bg-orange-100 dark:bg-orange-900 rounded-full",children:(0,s.jsx)(en.AlertTriangle,{className:"h-5 w-5 text-orange-600 dark:text-orange-400"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)(n.DialogTitle,{className:"text-xl",children:"Not Enough Cards Available"}),(0,s.jsxs)(n.DialogDescription,{className:"mt-1",children:["Only ",o," cards found, but you requested ",l," cards"]})]})]})}),(0,s.jsx)("div",{className:"py-6",children:c.length>0?(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,s.jsx)(ed.TrendingUp,{className:"h-4 w-4 text-blue-600"}),(0,s.jsxs)("span",{className:"font-medium text-blue-900 dark:text-blue-100",children:["Suggestions to reach ",l," cards:"]})]}),(0,s.jsx)(ei,{value:g,onValueChange:p,className:"space-y-4",children:c.map(e=>(0,s.jsx)("div",{className:"border rounded-lg p-4 transition-all ".concat(g===e.id?"border-blue-500 bg-blue-50 dark:bg-blue-950/20":"border-gray-200 dark:border-gray-700"),children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)(eo,{value:e.id,id:e.id,className:"mt-1"}),(0,s.jsxs)(el.Label,{htmlFor:e.id,className:"flex-1 cursor-pointer space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h3",{className:"font-medium text-gray-900 dark:text-gray-100",children:e.title}),(0,s.jsxs)(eu.Badge,{variant:"secondary",className:"ml-2",children:[e.estimated_count," cards"]})]}),(0,s.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.description}),e.impact.additional_count&&(0,s.jsxs)("div",{className:"flex items-center gap-1 text-sm text-green-600 dark:text-green-400",children:[(0,s.jsx)(ec.ChevronRight,{className:"h-3 w-3"}),(0,s.jsxs)("span",{children:["+",e.impact.additional_count," additional cards"]})]})]})]})},e.id))}),h&&(0,s.jsx)("div",{className:"mt-4 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:(0,s.jsxs)("div",{className:"text-sm",children:[(0,s.jsx)("span",{className:"font-medium",children:"Selected option will provide: "}),(0,s.jsxs)("span",{className:"text-green-600 dark:text-green-400 font-medium",children:[h.estimated_count," cards total"]})]})})]}):(0,s.jsx)("div",{className:"text-center py-8",children:(0,s.jsxs)("div",{className:"text-gray-500 dark:text-gray-400",children:[(0,s.jsxs)("p",{children:["No suggestions available to reach ",l," cards."]}),(0,s.jsx)("p",{className:"mt-2",children:"Try adjusting your filters manually."})]})})}),(0,s.jsxs)(n.DialogFooter,{className:"flex gap-3",children:[(0,s.jsx)(i.Button,{variant:"outline",onClick:u,className:"flex-1",disabled:m,children:"Adjust Filters"}),c.length>0&&h&&(0,s.jsx)(i.Button,{onClick:()=>{let e=c.find(e=>e.id===g);e&&d(e)},className:"flex-1",disabled:m,children:m?"Creating Session...":"Accept Suggestion"})]})]})})};var eg=e.i(87752),ep=e.i(628574),eh=e.i(507800),ef="Toggle",ex=a.forwardRef((e,a)=>{let{pressed:t,defaultPressed:r,onPressedChange:i,...o}=e,[l,n]=(0,F.useControllableState)({prop:t,onChange:i,defaultProp:null!=r&&r,caller:ef});return(0,s.jsx)(_.Primitive.button,{type:"button","aria-pressed":l,"data-state":l?"on":"off","data-disabled":e.disabled?"":void 0,...o,ref:a,onClick:(0,N.composeEventHandlers)(e.onClick,()=>{e.disabled||n(!l)})})});ex.displayName=ef;var ev="ToggleGroup",[eb,ey]=(0,R.createContextScope)(ev,[T.createRovingFocusGroupScope]),ej=(0,T.createRovingFocusGroupScope)(),ew=a.default.forwardRef((e,a)=>{let{type:t,...r}=e;if("single"===t)return(0,s.jsx)(eN,{...r,ref:a});if("multiple"===t)return(0,s.jsx)(ek,{...r,ref:a});throw Error("Missing prop `type` expected on `".concat(ev,"`"))});ew.displayName=ev;var[eC,eS]=eb(ev),eN=a.default.forwardRef((e,t)=>{let{value:r,defaultValue:i,onValueChange:o=()=>{},...l}=e,[n,c]=(0,F.useControllableState)({prop:r,defaultProp:null!=i?i:"",onChange:o,caller:ev});return(0,s.jsx)(eC,{scope:e.__scopeToggleGroup,type:"single",value:a.default.useMemo(()=>n?[n]:[],[n]),onItemActivate:c,onItemDeactivate:a.default.useCallback(()=>c(""),[c]),children:(0,s.jsx)(eT,{...l,ref:t})})}),ek=a.default.forwardRef((e,t)=>{let{value:r,defaultValue:i,onValueChange:o=()=>{},...l}=e,[n,c]=(0,F.useControllableState)({prop:r,defaultProp:null!=i?i:[],onChange:o,caller:ev}),d=a.default.useCallback(e=>c(function(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return[...s,e]}),[c]),u=a.default.useCallback(e=>c(function(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return s.filter(s=>s!==e)}),[c]);return(0,s.jsx)(eC,{scope:e.__scopeToggleGroup,type:"multiple",value:n,onItemActivate:d,onItemDeactivate:u,children:(0,s.jsx)(eT,{...l,ref:t})})});ew.displayName=ev;var[eR,e_]=eb(ev),eT=a.default.forwardRef((e,a)=>{let{__scopeToggleGroup:t,disabled:r=!1,rovingFocus:i=!0,orientation:o,dir:l,loop:n=!0,...c}=e,d=ej(t),u=(0,E.useDirection)(l),m={role:"group",dir:u,...c};return(0,s.jsx)(eR,{scope:t,rovingFocus:i,disabled:r,children:i?(0,s.jsx)(T.Root,{asChild:!0,...d,orientation:o,dir:u,loop:n,children:(0,s.jsx)(_.Primitive.div,{...m,ref:a})}):(0,s.jsx)(_.Primitive.div,{...m,ref:a})})}),eF="ToggleGroupItem",eE=a.default.forwardRef((e,t)=>{let r=eS(eF,e.__scopeToggleGroup),i=e_(eF,e.__scopeToggleGroup),o=ej(e.__scopeToggleGroup),l=r.value.includes(e.value),n=i.disabled||e.disabled,c={...e,pressed:l,disabled:n},d=a.default.useRef(null);return i.rovingFocus?(0,s.jsx)(T.Item,{asChild:!0,...o,focusable:!n,active:l,ref:d,children:(0,s.jsx)(eP,{...c,ref:t})}):(0,s.jsx)(eP,{...c,ref:t})});eE.displayName=eF;var eP=a.default.forwardRef((e,a)=>{let{__scopeToggleGroup:t,value:r,...i}=e,o=eS(eF,t),l={role:"radio","aria-checked":e.pressed,"aria-pressed":void 0},n="single"===o.type?l:void 0;return(0,s.jsx)(ex,{...n,...i,ref:a,onPressedChange:e=>{e?o.onItemActivate(r):o.onItemDeactivate(r)}})});let eD=(0,e.i(225913).cva)("inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium hover:bg-muted hover:text-muted-foreground disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 [&_svg]:shrink-0 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] outline-none transition-[color,box-shadow] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive whitespace-nowrap",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent shadow-xs hover:bg-accent hover:text-accent-foreground"},size:{default:"h-9 px-2 min-w-9",sm:"h-8 px-1.5 min-w-8",lg:"h-10 px-2.5 min-w-10"}},defaultVariants:{variant:"default",size:"default"}}),eA=a.createContext({size:"default",variant:"default",spacing:0});function eI(e){let{className:a,variant:t,size:r,spacing:i=0,children:o,...l}=e;return(0,s.jsx)(ew,{"data-slot":"toggle-group","data-variant":t,"data-size":r,"data-spacing":i,style:{"--gap":i},className:(0,er.cn)("group/toggle-group flex w-fit items-center gap-[--spacing(var(--gap))] rounded-md data-[spacing=default]:data-[variant=outline]:shadow-xs",a),...l,children:(0,s.jsx)(eA.Provider,{value:{variant:t,size:r,spacing:i},children:o})})}function eO(e){let{className:t,children:r,variant:i,size:o,...l}=e,n=a.useContext(eA);return(0,s.jsx)(eE,{"data-slot":"toggle-group-item","data-variant":n.variant||i,"data-size":n.size||o,"data-spacing":n.spacing,className:(0,er.cn)(eD({variant:n.variant||i,size:n.size||o}),"w-auto min-w-0 shrink-0 px-3 focus:z-10 focus-visible:z-10","data-[spacing=0]:rounded-none data-[spacing=0]:shadow-none data-[spacing=0]:first:rounded-l-md data-[spacing=0]:last:rounded-r-md data-[spacing=0]:data-[variant=outline]:border-l-0 data-[spacing=0]:data-[variant=outline]:first:border-l",t),...l,children:r})}var eL=e.i(740312);let eU=(0,e.i(475254).default)("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);var ez=e.i(431343),eG=e.i(270756),eV=e.i(243553),eB=e.i(522016);function eq(e){let{sessionConfig:a,setSessionConfig:t,topics:r,user:l,onStartCustomSession:n,isCreatingCustomSession:c,isValidating:d}=e;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(ep.Card,{className:"mb-8",children:[(0,s.jsxs)(ep.CardHeader,{children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(eU,{className:"h-5 w-5"}),(0,s.jsx)(ep.CardTitle,{children:"Create Your Own Review Session"})]}),(0,s.jsx)(ep.CardDescription,{children:"Customize your review experience with specific filters and preferences"})]}),(0,s.jsxs)(ep.CardContent,{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex flex-col md:flex-row md:items-end md:gap-6",children:[(0,s.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Filter by Topic"}),(0,s.jsxs)(eh.Select,{value:a.topic,onValueChange:e=>t({...a,topic:e}),children:[(0,s.jsx)(eh.SelectTrigger,{children:(0,s.jsx)(eh.SelectValue,{placeholder:"Select a Topic"})}),(0,s.jsx)(eh.SelectContent,{children:r.map(e=>(0,s.jsx)(eh.SelectItem,{value:e.name,children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{children:e.icon}),(0,s.jsx)("span",{children:e.name})]})},e.id))})]})]}),(0,s.jsxs)("div",{className:"flex-1 space-y-2 mt-4 md:mt-0",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Filter by Complexity"}),(0,s.jsxs)(eI,{type:"single",value:a.complexity,onValueChange:e=>e&&t({...a,complexity:e}),className:"w-full",children:[(0,s.jsx)(eO,{value:"All",children:"All"}),(0,s.jsx)(eO,{value:"Simple",children:"Simple"}),(0,s.jsx)(eO,{value:"Complex",children:"Complex"})]})]})]}),(0,s.jsx)("div",{className:"flex flex-col md:flex-row md:items-end md:gap-6",children:(0,s.jsxs)("div",{className:"flex-1 flex items-center",children:[(0,s.jsx)(o.Checkbox,{id:"onlyCommonWords",checked:!!a.onlyCommonWords,onCheckedChange:e=>t({...a,onlyCommonWords:!!e})}),(0,s.jsx)("label",{htmlFor:"onlyCommonWords",className:"ml-2 text-sm font-medium",children:"Only show common words"})]})}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(o.Checkbox,{id:"savedCards",checked:a.includeSavedCards,onCheckedChange:e=>t({...a,includeSavedCards:!!e}),disabled:(null==l?void 0:l.subscription_type)==="FREE"}),(0,s.jsx)("label",{htmlFor:"savedCards",className:"text-sm font-medium",children:"Include My Saved Cards"}),(null==l?void 0:l.subscription_type)==="FREE"&&(0,s.jsxs)(eu.Badge,{variant:"secondary",children:[(0,s.jsx)(eV.Crown,{className:"w-3 h-3 mr-1"}),"Plus"]})]}),(0,s.jsx)("div",{className:"p-3 bg-blue-50 dark:bg-blue-950/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(eU,{className:"h-4 w-4 text-blue-600 dark:text-blue-400"}),(0,s.jsx)("p",{className:"text-sm text-blue-800 dark:text-blue-200 font-medium",children:"Saved cards feature requires Supabase integration. Currently showing regular flashcards only."})]})}),(null==l?void 0:l.subscription_type)==="FREE"&&(0,s.jsxs)("div",{className:"p-3 bg-amber-50 dark:bg-amber-950/20 border border-amber-200 dark:border-amber-800 rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(eG.Lock,{className:"h-4 w-4 text-amber-600 dark:text-amber-400"}),(0,s.jsx)("p",{className:"text-sm text-amber-800 dark:text-amber-200 font-medium",children:"Tired of random words? Upgrade to Plus to unlock unlimited saved flashcards for review!"})]}),(0,s.jsx)(i.Button,{asChild:!0,size:"sm",className:"mt-2",children:(0,s.jsxs)(eB.default,{href:"/plans",children:[(0,s.jsx)(eV.Crown,{className:"w-4 h-4 mr-2"}),"Upgrade to Plus"]})})]})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("label",{className:"text-sm font-medium",children:["Number of cards to review: ",a.numberOfCards]}),(0,s.jsx)(eL.Slider,{value:[a.numberOfCards],onValueChange:e=>t({...a,numberOfCards:e[0]}),max:50,min:10,step:5,className:"w-full"})]})]})]}),(0,s.jsx)("div",{className:"text-center mb-8 space-y-4",children:(0,s.jsxs)(i.Button,{onClick:n,size:"lg",className:"text-lg px-8 py-6 h-auto",disabled:c||d,children:[(0,s.jsx)(ez.Play,{className:"w-5 h-5 mr-2"}),c||d?"Validating Session...":"Start Custom Review Session"]})})]})}let eH="flashcards:review";function eM(){return Intl.DateTimeFormat().resolvedOptions().timeZone}function eW(e){let s=new Date;return new Intl.DateTimeFormat("en-CA",{timeZone:e,year:"numeric",month:"2-digit",day:"2-digit"}).format(s)}var eJ=e.i(95187),eQ=(0,eJ.createServerReference)("40138ba5c927606e17947caf045f883ea82b7072d9",eJ.callServer,void 0,eJ.findSourceMapURL,"createReviewSession"),eZ=(0,eJ.createServerReference)("4066c3bfc9842b3e7a2fa482e6d40eb90f4e658ba3",eJ.callServer,void 0,eJ.findSourceMapURL,"createSessionCardMappings");function eK(){let e=(0,t.useRouter)(),[m,g]=(0,a.useState)(!1),[p,h]=(0,a.useState)(null),[f,x]=(0,a.useState)([]),[j,N]=(0,a.useState)({reviewedToday:0,dailyGoal:20,dueForReview:0,accuracy:0}),[k,R]=(0,a.useState)({complexity:"All",includeSavedCards:!1,numberOfCards:10,onlyCommonWords:!1}),[_,T]=(0,a.useState)([]),[F,E]=(0,a.useState)(!1),[P,D]=(0,a.useState)(!1),[A,I]=(0,a.useState)(!1),[O,L]=(0,a.useState)(!1),{isLoading:U,withLoading:z,stopLoading:G}=(0,b.useLoading)(),{isValidating:V,validationResult:B,validateSession:q,clearValidation:H}=(()=>{let[e,s]=(0,a.useState)(!1),[t,r]=(0,a.useState)(null),[i,o]=(0,a.useState)(null);return{isValidating:e,validationResult:t,validateSession:(0,a.useCallback)(async(e,a)=>{s(!0),o(null);try{console.log("ðŸ” Validating session filters:",e,a?"for user ".concat(a):"");let s=await w.validateSessionFilters(e,a);return console.log("âœ… Validation result:",s),r(s),s.insufficient?(console.log("âš ï¸ Insufficient cards: ".concat(s.available_count,"/").concat(e.num_cards)),s.suggestions&&s.suggestions.length>0&&console.log("ðŸ’¡ Found ".concat(s.suggestions.length," suggestions"))):console.log("âœ… Sufficient cards available: ".concat(s.available_count,"/").concat(e.num_cards)),s}catch(s){let e=s instanceof Error?s.message:"Failed to validate session";return console.error("âŒ Session validation error:",s),o(e),d.toast.error(e),null}finally{s(!1)}},[]),clearValidation:(0,a.useCallback)(()=>{r(null),o(null)},[]),error:i}})(),{steps:M,updateStep:W,resetSteps:J,hasError:Q}=(()=>{let[e,s]=(0,a.useState)([{id:"validate",label:"Validating session filters",status:"pending",description:"Checking if enough cards match your criteria"},{id:"generate",label:"Generating flashcards",status:"pending",description:"Fetching and preparing your cards"},{id:"save",label:"Creating session",status:"pending",description:"Saving session data to database"},{id:"redirect",label:"Preparing review interface",status:"pending",description:"Loading your flashcard session"}]),t=(0,a.useCallback)((e,a,t)=>{s(s=>s.map(s=>s.id===e?{...s,status:a,...t&&{description:t}}:s))},[]),r=(0,a.useCallback)(()=>{s(e=>e.map(e=>({...e,status:"pending"})))},[]),i=e.some(e=>"error"===e.status),o=e.every(e=>"completed"===e.status),l=e.find(e=>"loading"===e.status)||null;return{steps:e,updateStep:t,resetSteps:r,hasError:i,isCompleted:o,currentStep:l}})(),{getAnimationDuration:Z}=(0,C.useDisplaySettings)(),{currentCard:K,currentCardIndex:Y,isFlipped:X,timer:$,isTimerActive:ee,cardResults:es,handleCardResult:ea,handleSaveCard:et,handleFlipCard:er,resetSession:ei,getProgressStats:eo,savedCards:el}=(0,S.useFlashcardReview)({cards:_,onSessionComplete:function(){d.toast.success("Practice session completed! Starting a new session..."),eu()},enableTimer:!0});(0,a.useEffect)(()=>{g(!0)},[]),(0,a.useEffect)(()=>{if(!U)return;let e=setTimeout(()=>{try{G()}catch(e){}},33e3);return()=>clearTimeout(e)},[U,G]),(0,a.useEffect)(()=>{(async()=>{m&&await z(async()=>{try{let{data:{user:a},error:t}=await r.supabase.auth.getUser();if(t||!a){d.toast.error("Please log in to continue"),e.push("/auth/login");return}let{data:i,error:o}=await r.supabase.from("user_profiles").select("*").eq("id",a.id).maybeSingle();if(o||!i){var s;console.error("Profile error:",o);let e={id:a.id,name:(null==(s=a.email)?void 0:s.split("@")[0])||"User",email:a.email||"",subscription_type:"FREE",streak_days:0,coins:0};try{let{data:s,error:a}=await r.supabase.from("user_profiles").insert(e).select().single();!a&&s?h(s):h(e)}catch(s){console.error("Error creating profile:",s),h(e)}}else h(i);try{let e=await y.flashcardAPI.getAllTopics();x(e.map(e=>({id:e.id,name:e.title,description:e.description,icon:"ðŸ“š"})))}catch(e){console.error("Error fetching topics:",e),x([])}await en(a.id),await ec(a.id)}catch(e){console.error("Error fetching data:",e),d.toast.error("Failed to load review data")}})})()},[m,e,z]),(0,a.useEffect)(()=>{D("true"===sessionStorage.getItem("hideRestartSessionModal"))},[]);let en=async e=>{try{let s=new Date().toISOString().split("T")[0],{data:a,error:t}=await r.supabase.from("flashcard_statistics").select("*").eq("user_id",e).eq("date",s).maybeSingle(),{data:i,count:o}=await r.supabase.from("flashcard_srs_records").select("*",{count:"exact"}).eq("user_id",e).lte("due_date",s);N({reviewedToday:(null==a?void 0:a.flashcards_reviewed)||0,dailyGoal:20,dueForReview:o||0,accuracy:(null==a?void 0:a.accuracy_rate)||0})}catch(e){console.error("Error fetching today's stats:",e)}},ec=async function(s){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{console.log("Loading practice cards for user:",s,a?"(force refresh)":"");let r=null;if(a||(r=function(){try{let e=localStorage.getItem(eH);if(!e)return console.log("ðŸ“­ No cached flashcards found"),null;let s=JSON.parse(e),a=eM(),t=eW(a),r=Date.now();if(s.date===t&&r<s.expiry)return console.log("ðŸ“š Loaded ".concat(s.flashcards.length," cached flashcards from ").concat(s.date)),s.flashcards;return console.log("ðŸ—‘ï¸ Cache expired or from different day. Cached: ".concat(s.date,", Today: ").concat(t)),localStorage.removeItem(eH),null}catch(e){return console.error("Failed to load flashcards from localStorage:",e),localStorage.removeItem(eH),null}}()),r)d.toast.success("Using today's cached flashcards (".concat(r.length," cards)"));else if(console.log("ðŸ“¡ Fetching fresh flashcards from backend API..."),r=await y.flashcardAPI.getRandomFlashcards({count:15}),console.log("Fetched cards from backend:",r.length),r&&r.length>0){var t=r;let e=eM(),s=eW(e),a=function(e){let s=eW(e),a=new Date("".concat(s,"T23:59:59.999")),t=new Date(a.toLocaleString("en-US",{timeZone:e})),r=new Date(a.toLocaleString("en-US",{timeZone:"UTC"})).getTime()-t.getTime();return a.getTime()+r}(e);try{localStorage.setItem(eH,JSON.stringify({flashcards:t,date:s,expiry:a,timezone:e})),console.log("ðŸ’¾ Saved ".concat(t.length," flashcards to localStorage, expires at:"),new Date(a))}catch(e){console.error("Failed to save flashcards to localStorage:",e)}d.toast.success("Loaded ".concat(r.length," fresh flashcards for today!"))}else{console.log("No cards returned from backend"),d.toast.error("No flashcards available for review"),T([]),e.push("/404");return}console.log("Successfully loaded cards:",r.length),T(r)}catch(e){console.error("Error loading practice cards:",e),d.toast.error("Failed to load flashcards. Please try again."),T([])}},ed=(0,a.useCallback)(async()=>{p&&(ei(),await ec(p.id,!1))},[p,ei]),eu=(0,a.useCallback)(()=>{P?ed():E(!0)},[P,ed]),ep=(0,a.useCallback)(async()=>{p&&(ei(),await ec(p.id,!1),d.toast.success("Session restarted!"))},[p,ei]),eh=(0,a.useCallback)(async()=>{p&&await z(async()=>{ei(),await ec(p.id,!0),d.toast.success("Loaded fresh flashcards!")})},[p,z,ei]),ef=async()=>{if(p){L(!0),H(),J();try{W("validate","loading");let e=w.buildFiltersFromForm(k);console.log("ðŸŽ¯ Starting custom session validation:",e);let s=await q(e,p.id);if(console.log("Session validation result:",s),!s){W("validate","error","Validation failed"),d.toast.error("Failed to validate session filters");return}W("validate","completed"),s.insufficient?(console.log("âš ï¸ Insufficient cards - showing modal"),I(!0),L(!1)):(console.log("âœ… Sufficient cards - creating session directly"),await ex(e))}catch(e){console.error("Error starting custom session:",e),W("validate","error","Failed to start session"),d.toast.error("Failed to start custom session"),L(!1)}}},ex=async(s,a)=>{var t,r,i,o,l;if(!p)throw Error("User not found");try{W("generate","loading");let r={user_id:p.id,filters:{...s,include_saved_cards:k.includeSavedCards},suggestion_id:a,include_saved_cards:k.includeSavedCards,session_metadata:{created_from:a?"suggestion":"form",original_filters:k}};console.log("ðŸ—ï¸ Generating custom session:",r);let i=new Promise((e,s)=>{let a=setTimeout(()=>{s(Error("Timeout generating session cards - backend took too long"))},3e4);w.generateSessionCards(r).then(s=>{clearTimeout(a),e(s)}).catch(e=>{clearTimeout(a),s(e)})}),o=await i;if(console.log("âœ… Session generated:",o),!o||!o.flashcards||0===o.flashcards.length)throw Error("No flashcards generated for session");W("generate","completed"),W("save","loading"),console.log("ðŸ’¾ [STEP 3] Starting session save process (Server Action)"),console.log("ðŸ“‹ Session config:",k),console.log("ðŸ“‹ Flashcards count:",o.actual_count);let l=await eQ({session_type:"custom",total_cards:o.actual_count||0,session_config:{created_from:a?"suggestion":"form",original_filters:k},filters_applied:s});if(!l.success||!l.data)throw console.error("âŒ [STEP 3] Failed to create session:",l.error),Error(l.error||"Failed to save session");let n=l.data;console.log("âœ… [STEP 3] Session created successfully:",n.id),W("save","completed"),console.log("ðŸ“ [STEP 3.5] Persisting session cards mapping (Server Action)");let c=Array.isArray(o.flashcards)?o.flashcards:[];if(console.log("ðŸ“Š [STEP 3.5] Processing ".concat(c.length," flashcards")),c.length>0){let e=await eZ({session_id:n.id,flashcards:c});e.success?console.log("âœ… [STEP 3.5] Cards mapped: ".concat(null==(t=e.data)?void 0:t.inserted_count,"/").concat(c.length)):console.error("âŒ [STEP 3.5] Failed to persist session cards mapping:",e.error)}console.log("ðŸš€ [STEP 4] Navigating to session page"),W("redirect","loading"),d.toast.success("Custom session created with ".concat(o.actual_count," cards!")),W("redirect","completed"),setTimeout(()=>{console.log("âœ… [STEP 4] Redirecting to /flashcards/review/session?id=".concat(n.id)),L(!1),e.push("/flashcards/review/session?id=".concat(n.id))},800)}catch(s){console.error("Error creating custom session:",(null==s?void 0:s.message)||s);let e=M.find(e=>"loading"===e.status);e&&W(e.id,"error",(null==s?void 0:s.message)||"Failed to complete step"),(null==s||null==(r=s.message)?void 0:r.includes("Timeout"))?d.toast.error("Session creation timed out. Please try again or use Quick Review instead."):(null==s||null==(i=s.message)?void 0:i.includes("Database error"))?d.toast.error("Database error. Please check your connection and try again."):(null==s||null==(o=s.message)?void 0:o.includes("Network"))?d.toast.error("Network error. Please check your internet connection."):(null==s||null==(l=s.message)?void 0:l.includes("generating session cards"))?d.toast.error("Unable to generate cards. Try adjusting your filters or use Quick Review."):d.toast.error("Failed to create custom session: ".concat((null==s?void 0:s.message)||"Unknown error")),console.log("ðŸ’¡ Suggesting fallback to Quick Review")}},ev=async(e,s)=>{await ex(e,s)},eb=async e=>{I(!1),console.log("âœ… Accepting suggestion:",e),await ev(e.filters,e.id)};if(!m)return null;let ey=eo();return(0,s.jsx)(u.default,{isLoading:U,children:(0,s.jsxs)("div",{className:"container mx-auto py-10 px-4 max-w-4xl",children:[(0,s.jsxs)("div",{className:"text-center mb-8",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold mb-2",children:"Flashcard Quick Review"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"Practice Vietnamese vocabulary with intelligent spaced repetition"})]}),(0,s.jsx)(eg.ReviewSession,{practiceCards:_,currentCard:K,currentCardIndex:Y,isFlipped:X,timer:$,isTimerActive:ee,cardResults:es,progressStats:ey,savedCards:el,onCardResult:ea,onSaveCard:et,onFlipCard:er,onRefreshCards:ep,onGetFreshCards:eh,getAnimationDuration:Z,isLoading:U}),(0,s.jsx)("div",{className:"flex justify-center gap-4",children:(0,s.jsxs)(i.Button,{onClick:eh,variant:"outline",disabled:U,children:[(0,s.jsx)(c.RefreshCw,{className:"w-4 h-4 mr-2 ".concat(U?"animate-spin":"")}),"Get Fresh Cards for Today"]})}),(0,s.jsx)(l.Separator,{className:"my-8"}),(0,s.jsx)(eq,{sessionConfig:k,setSessionConfig:R,topics:f,user:p,onStartCustomSession:ef,isCreatingCustomSession:O,isValidating:V}),(0,s.jsx)(em,{isOpen:A,onClose:()=>I(!1),availableCount:(null==B?void 0:B.available_count)||0,requestedCount:k.numberOfCards,suggestions:(null==B?void 0:B.suggestions)||[],onAcceptSuggestion:eb,onAdjustFilters:()=>{I(!1),H(),console.log("ðŸ”§ User chose to adjust filters manually")},isLoading:O}),(0,s.jsx)(n.Dialog,{open:F,onOpenChange:E,children:(0,s.jsxs)(n.DialogContent,{className:"sm:max-w-md",children:[(0,s.jsxs)(n.DialogHeader,{children:[(0,s.jsx)(n.DialogTitle,{children:"Do you want to restart this session?"}),(0,s.jsx)(n.DialogDescription,{children:"This will reset your progress for the current session. Are you sure you want to continue?"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2 mt-4",children:[(0,s.jsx)(o.Checkbox,{id:"dontShowRestartAgain",checked:P,onCheckedChange:e=>{D(!!e),sessionStorage.setItem("hideRestartSessionModal",e?"true":"false")}}),(0,s.jsx)("label",{htmlFor:"dontShowRestartAgain",className:"text-sm font-medium",children:"Do not show this again"})]}),(0,s.jsxs)(n.DialogFooter,{className:"flex gap-2 mt-6",children:[(0,s.jsx)(i.Button,{variant:"outline",onClick:()=>E(!1),className:"flex-1",children:"Cancel"}),(0,s.jsx)(i.Button,{variant:"destructive",onClick:()=>{E(!1),ed()},className:"flex-1",children:"Yes, Restart"})]})]})}),O&&(0,s.jsx)(v,{title:"Creating Your Review Session",steps:M,onCancel:()=>{L(!1),J()}})]})})}}]);