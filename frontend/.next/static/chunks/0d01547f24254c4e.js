(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,299749,e=>{"use strict";function t(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}e.s(["_",()=>t])},204360,e=>{"use strict";e.s(["audioManager",()=>a,"playCorrectSound",()=>r,"playFlipSound",()=>n,"playIncorrectSound",()=>i]);var t=e.i(299749);class s{static getInstance(){return s.instance||(s.instance=new s),s.instance}updateSettings(e){this.settings=e}getSoundEffectsVolume(){return this.settings?this.settings.muteSounds?0:this.settings.soundVolume/100:0}getPronunciationVolume(){return this.settings?this.settings.soundVolume/100:.75}async loadAudio(e){var t,s;let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.audioCache.has(e))return this.audioCache.get(e);let r=new Audio(e);r.volume=null!=(t=a.volume)?t:.75,r.loop=null!=(s=a.loop)&&s,r.preload=a.preload?"auto":"metadata";try{return await new Promise((e,t)=>{r.oncanplaythrough=e,r.onerror=t,r.load()}),this.audioCache.set(e,r),r}catch(t){throw console.error("Failed to load audio: ".concat(e),t),t}}async playSoundEffect(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=this.getSoundEffectsVolume();if(0!==s)try{var a;let r=await this.loadAudio(e,t);r.volume=null!=(a=t.volume)?a:s,r.currentTime=0,await r.play()}catch(t){console.error("Failed to play sound effect: ".concat(e),t)}}async playPronunciation(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=this.getPronunciationVolume();try{var a;let r=await this.loadAudio(e,t);r.volume=null!=(a=t.volume)?a:s,r.currentTime=0,await r.play()}catch(t){console.error("Failed to play pronunciation: ".concat(e),t)}}stopAllSounds(){this.audioCache.forEach(e=>{e.pause(),e.currentTime=0})}updateVolume(){this.audioCache.forEach((e,t)=>{t.includes("/tts/")||t.includes("/pronunciation/")?e.volume=this.getPronunciationVolume():e.volume=this.getSoundEffectsVolume()})}clearCache(){this.stopAllSounds(),this.audioCache.clear()}constructor(){(0,t._)(this,"audioCache",new Map),(0,t._)(this,"settings",null)}}(0,t._)(s,"instance",void 0);let a=s.getInstance(),r=()=>a.playSoundEffect("/sounds/correct.mp3"),i=()=>a.playSoundEffect("/sounds/incorrect.wav"),n=()=>a.playSoundEffect("/sounds/flip.mp3")},896296,726714,435019,e=>{"use strict";e.s(["FlashcardFront",()=>u],896296);var t=e.i(843476),s=e.i(271645),a=e.i(382373),r=e.i(571930);e.s(["BookmarkCheck",()=>i],726714);let i=(0,e.i(475254).default)("bookmark-check",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2Z",key:"169p4p"}],["path",{d:"m9 10 2 2 4-4",key:"1gnqz4"}]]);var n=e.i(497058),l=e.i(859951),o=e.i(166778),c=e.i(589121),d=e.i(204360);function u(e){var u;let{data:h,saved:m,onSave:g}=e,[p,f]=(0,s.useState)(!1),[x,v]=(0,s.useState)(!1),y=async()=>{if(!x){v(!0);try{h.audio_url&&"APP"===h.flashcard_type?(console.log("Playing APP flashcard audio:",h.audio_url),await d.audioManager.playPronunciation(h.audio_url)):"CUSTOM"===h.flashcard_type?(console.log("Playing CUSTOM flashcard audio for:",h.vietnamese),await playCustomFlashcardAudio(h.id,h.vietnamese)):h.audio_url?(console.log("Playing fallback audio:",h.audio_url),await d.audioManager.playPronunciation(h.audio_url)):console.log("No audio available for:",h.vietnamese)}catch(e){console.error("Failed to play audio:",e)}finally{v(!1)}}};return Array.isArray(h.english)?h.english[0]:h.english,(0,t.jsxs)("div",{className:"w-full max-w-2xl mx-auto bg-white rounded-3xl p-8 shadow-lg border border-gray-200",children:[(0,t.jsx)("div",{className:"flex justify-end mb-4",children:(0,t.jsx)(l.Button,{variant:"ghost",size:"sm",onClick:e=>{e.stopPropagation(),console.log("Save button clicked for card:",h.id);try{g(h.id)}catch(e){console.error("Error saving flashcard:",e)}},className:"p-2 hover:bg-gray-100",children:m?(0,t.jsx)(i,{className:"h-5 w-5 text-blue-600"}):(0,t.jsx)(r.Bookmark,{className:"h-5 w-5 text-gray-500"})})}),(0,t.jsxs)("div",{className:"flex gap-8 h-full",children:[(0,t.jsx)("div",{className:"flex-shrink-0",children:h.image_url?(0,t.jsx)("img",{src:h.image_url,alt:h.vietnamese,className:"w-48 h-48 object-cover rounded-xl border-2 border-gray-200",loading:"lazy",onError:e=>{e.target.src="/placeholder.svg"}}):(0,t.jsx)("div",{className:"w-48 h-48 bg-gray-100 rounded-xl border-2 border-gray-200 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center text-gray-400",children:[(0,t.jsx)("div",{className:"text-4xl mb-2",children:"ðŸ“š"}),(0,t.jsx)("div",{className:"text-sm",children:"No image"})]})})}),(0,t.jsxs)("div",{className:"flex-1 flex flex-col justify-center space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("h2",{className:"text-4xl font-bold text-gray-800",children:h.vietnamese}),h.pronunciation&&(0,t.jsxs)("p",{className:"text-lg text-gray-500 mt-1 font-mono",children:["/",h.pronunciation,"/"]})]}),(0,t.jsx)(l.Button,{variant:"ghost",size:"sm",onClick:e=>{e.stopPropagation(),y()},className:"p-3 hover:bg-gray-100 rounded-full ".concat(x?"animate-pulse bg-blue-100":""),disabled:x,title:x?"Playing audio...":"Play pronunciation",children:(0,t.jsx)(a.Volume2,{className:"h-6 w-6 ".concat(x?"text-blue-700":"text-blue-600")})})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(o.Badge,{variant:"secondary",className:"bg-blue-100 text-blue-800",children:Array.isArray(u=h.type)?u.join(", "):u}),h.is_multimeaning&&(0,t.jsx)(o.Badge,{variant:"outline",className:"text-purple-600 border-purple-300",children:"Multi-meaning"})]}),h.vietnamese_sentence?(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("p",{className:"text-sm text-gray-500 font-medium",children:"Example sentence:"}),(0,t.jsxs)("p",{className:"text-md md:text-lg text-gray-700 italic",children:[(0,t.jsx)("span",{className:"text-gray-400",children:'"'}),((e,s)=>{let a;if(!e||!s)return e;let r=s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");try{a=RegExp("(?<!\\p{L})(".concat(r,")(?!\\p{L})"),"giu")}catch(e){a=RegExp("(".concat(r,")"),"gi")}let i=[],n=0;for(let s of e.matchAll(a)){var l;let a=null!=(l=s.index)?l:0,r=a+s[0].length;a>n&&i.push(e.slice(n,a)),i.push((0,t.jsx)("mark",{className:"rounded-md px-1 bg-amber-200/70 text-gray-900 ring-1 ring-amber-300 underline decoration-amber-500/50 decoration-2 underline-offset-2",children:s[0]},"hl-".concat(a))),n=r}return 0===n?e:(n<e.length&&i.push(e.slice(n)),i)})(h.vietnamese_sentence,h.vietnamese),(0,t.jsx)("span",{className:"text-gray-400",children:'"'})]}),h.english_sentence&&(0,t.jsx)("div",{className:"flex items-center gap-1 mt-1",children:(0,t.jsx)(c.TooltipProvider,{children:(0,t.jsxs)(c.Tooltip,{children:[(0,t.jsx)(c.TooltipTrigger,{asChild:!0,children:(0,t.jsx)(l.Button,{variant:"ghost",size:"icon",className:"p-1 h-auto text-gray-500 hover:text-indigo-600 hover:bg-indigo-50 rounded-full","aria-label":"Xem dá»‹ch cÃ¢u vÃ­ dá»¥",children:(0,t.jsx)(n.TbMessageLanguage,{className:"h-4 w-4"})})}),(0,t.jsx)(c.TooltipContent,{side:"bottom",align:"start",children:(0,t.jsxs)("p",{className:"text-sm text-gray-700 italic",children:['"',h.english_sentence,'"']})})]})})})]}):(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("p",{className:"text-sm text-gray-500 font-medium",children:"Example sentence:"}),(0,t.jsx)("p",{className:"text-md md:text-lg text-gray-400 italic",children:"No example sentence available"})]})]})]})]})}e.s(["FlashcardBack",()=>m],435019);var h=e.i(69578);function m(e){let{data:s,saved:a,onSave:n}=e,o=s.english?s.english.filter(e=>e!==s.common_meaning):[];return(0,t.jsxs)("div",{className:"w-full h-full bg-white rounded-3xl p-6 shadow-lg border border-gray-200 flex flex-col",children:[(0,t.jsx)("div",{className:"flex justify-end mb-4",children:(0,t.jsx)(l.Button,{variant:"ghost",size:"sm",onClick:e=>{e.stopPropagation(),console.log("Save button clicked for card:",s.id);try{n(s.id)}catch(e){console.error("Error saving flashcard:",e)}},className:"p-2 hover:bg-gray-100",children:a?(0,t.jsx)(i,{className:"h-5 w-5 text-green-600"}):(0,t.jsx)(r.Bookmark,{className:"h-5 w-5 text-gray-500"})})}),(0,t.jsxs)("div",{className:"flex-1 flex flex-col space-y-6 min-h-0",children:[(0,t.jsxs)("div",{className:"flex-shrink-0",children:[(0,t.jsx)("h3",{className:"text-xl font-semibold text-gray-800 mb-3",children:"Primary Meaning"}),(0,t.jsx)("p",{className:"text-2xl font-medium text-green-700 bg-green-50 rounded-lg p-4 border border-green-200",children:s.common_meaning||(s.english&&s.english.length>0?s.english[0]:"No translation available")}),"CUSTOM"===s.flashcard_type&&s.ipa_pronunciation&&(0,t.jsx)("div",{className:"mt-3",children:(0,t.jsxs)("p",{className:"text-sm text-gray-600 italic",children:["IPA: ",(0,t.jsx)("span",{className:"font-mono text-blue-600",children:s.ipa_pronunciation})]})})]}),o&&o.length>0&&(0,t.jsxs)("div",{className:"flex-1 flex flex-col min-h-0",children:[(0,t.jsxs)("h3",{className:"text-xl font-semibold text-gray-800 mb-3 flex-shrink-0",children:["Other Meanings (",o.length,")"]}),(0,t.jsx)(h.ScrollArea,{className:"flex-1 max-h-48 rounded-lg border border-gray-200 bg-gray-50 p-3",children:(0,t.jsx)("div",{className:"space-y-3",children:o.map((e,s)=>(0,t.jsxs)("p",{className:"text-base text-gray-700 bg-white rounded-lg p-3 border border-gray-200 shadow-sm",children:["â€¢ ",e]},s))})})]})]})]})}},220849,e=>{"use strict";e.s(["useDisplaySettings",()=>F],220849);var t,s,a,r,i,n,l=e.i(266027),o=e.i(271645),c=e.i(739946),d=e.i(470292),u=e.i(62351),h=e.i(337696),m=e.i(788245),g=e.i(114272),p=e.i(540143),f=e.i(915823),x=e.i(619273),v=(t=new WeakMap,s=new WeakMap,a=new WeakMap,r=new WeakMap,i=new WeakSet,n=new WeakSet,class extends f.Subscribable{bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){var s;let r=this.options;this.options=(0,c._)(this,t).defaultMutationOptions(e),(0,x.shallowEqualObjects)(this.options,r)||(0,c._)(this,t).getMutationCache().notify({type:"observerOptionsUpdated",mutation:(0,c._)(this,a),observer:this}),(null==r?void 0:r.mutationKey)&&this.options.mutationKey&&(0,x.hashKey)(r.mutationKey)!==(0,x.hashKey)(this.options.mutationKey)?this.reset():(null==(s=(0,c._)(this,a))?void 0:s.state.status)==="pending"&&(0,c._)(this,a).setOptions(this.options)}onUnsubscribe(){if(!this.hasListeners()){var e;null==(e=(0,c._)(this,a))||e.removeObserver(this)}}onMutationUpdate(e){(0,h._)(this,i,y).call(this),(0,h._)(this,n,b).call(this,e)}getCurrentResult(){return(0,c._)(this,s)}reset(){var e;null==(e=(0,c._)(this,a))||e.removeObserver(this),(0,u._)(this,a,void 0),(0,h._)(this,i,y).call(this),(0,h._)(this,n,b).call(this)}mutate(e,s){var i;return(0,u._)(this,r,s),null==(i=(0,c._)(this,a))||i.removeObserver(this),(0,u._)(this,a,(0,c._)(this,t).getMutationCache().build((0,c._)(this,t),this.options)),(0,c._)(this,a).addObserver(this),(0,c._)(this,a).execute(e)}constructor(e,l){super(),(0,m._)(this,i),(0,m._)(this,n),(0,d._)(this,t,{writable:!0,value:void 0}),(0,d._)(this,s,{writable:!0,value:void 0}),(0,d._)(this,a,{writable:!0,value:void 0}),(0,d._)(this,r,{writable:!0,value:void 0}),(0,u._)(this,t,e),this.setOptions(l),this.bindMethods(),(0,h._)(this,i,y).call(this)}});function y(){var e,t;let r=null!=(t=null==(e=(0,c._)(this,a))?void 0:e.state)?t:(0,g.getDefaultState)();(0,u._)(this,s,{...r,isPending:"pending"===r.status,isSuccess:"success"===r.status,isError:"error"===r.status,isIdle:"idle"===r.status,mutate:this.mutate,reset:this.reset})}function b(e){p.notifyManager.batch(()=>{if((0,c._)(this,r)&&this.hasListeners()){var a,i,n,l,o,d,u,h;let m=(0,c._)(this,s).variables,g=(0,c._)(this,s).context,p={client:(0,c._)(this,t),meta:this.options.meta,mutationKey:this.options.mutationKey};(null==e?void 0:e.type)==="success"?(null==(a=(i=(0,c._)(this,r)).onSuccess)||a.call(i,e.data,m,g,p),null==(n=(l=(0,c._)(this,r)).onSettled)||n.call(l,e.data,null,m,g,p)):(null==e?void 0:e.type)==="error"&&(null==(o=(d=(0,c._)(this,r)).onError)||o.call(d,e.error,m,g,p),null==(u=(h=(0,c._)(this,r)).onSettled)||u.call(h,void 0,e.error,m,g,p))}this.listeners.forEach(e=>{e((0,c._)(this,s))})})}var w=e.i(912598),j=e.i(846696),S=e.i(859016);let _={display:{flashcardAnimationSpeed:"normal",muteSounds:!1,soundVolume:75,reviewTimeSeconds:4,language:"en",timezone:"UTC",dateFormat:"MM/DD/YYYY",keyboardNavigation:!0,focusIndicators:!0},notifications:{email:{dailyReminders:!1,weeklyProgress:!1,achievements:!1,questUpdates:!1,marketingEmails:!1},push:{studyReminders:!1,streakReminders:!1,achievements:!1,questUpdates:!1,flashcardReviews:!1},inApp:{sounds:!0,popups:!0,achievements:!0,levelUps:!0},studyReminders:{enabled:!1,dailyGoal:!1,weeklyGoal:!1,streakMaintenance:!1}},privacy:{dataCollection:!0,analyticsTracking:!0,crashReporting:!0,marketingCommunications:!1,sessionTimeout:"30",passwordChangeNotifications:!0}};function N(e){try{return{display:e.display||_.display,notifications:e.notifications||_.notifications,privacy:e.privacy||_.privacy}}catch(e){return _}}let k={all:["user-settings"],detail:e=>[...k.all,"detail",e],category:(e,t)=>[...k.all,t,e]},C=async()=>{let{data:{user:e},error:t}=await S.supabase.auth.getUser();if(t||!e)throw Error("User not authenticated");return e.id},M=async()=>{let e=await C(),{data:t,error:s}=await S.supabase.from("user_settings").select("settings").eq("user_id",e).single();if(s){if("PGRST116"===s.code)return _;throw Error("Failed to fetch user settings: ".concat(s.message))}let a=function(e){try{let t="string"==typeof e?JSON.parse(e):e,s=N(t);return{success:!0,data:s}}catch(e){return{success:!1,error:e instanceof Error?e:Error("Failed to parse settings")}}}(t.settings);return a.success?a.data:(console.warn("Invalid settings from database, using defaults:",a.error),_)},E=async e=>{let t=await C(),s=N(e),{error:a}=await S.supabase.from("user_settings").upsert({user_id:t,settings:s,updated_at:new Date().toISOString()},{onConflict:"user_id"});if(a)throw Error("Failed to save user settings: ".concat(a.message))},T=(e,t)=>JSON.stringify(e)===JSON.stringify(t),D={slow:750,normal:500,fast:250},R={min:2,max:8,default:4},O={min:0,max:100,default:75,step:5},F=()=>{let{settings:e,savedSettings:t,updateDisplaySetting:s,updateDisplaySettings:a,saveSettings:r,discardChanges:i,resetToDefaults:n,hasUnsavedChanges:c,isSaving:d}=(()=>{let{settings:e,savedSettings:t,updateDraftCategory:s,updateDraftSetting:a,saveSettings:r,discardChanges:i,resetToDefaults:n,hasUnsavedChanges:c,isSaving:d}=(()=>{var e;let t=(0,w.useQueryClient)(),[s,a]=(0,o.useState)(null),r=(0,l.useQuery)({queryKey:k.all,queryFn:M,staleTime:3e5,gcTime:6e5,retry:(e,t)=>!t.message.includes("not authenticated")&&e<3}),i=null!=(e=r.data)?e:_,n=null!=s?s:i,c=null!==s&&!T(s,i);(0,o.useEffect)(()=>{r.data&&s&&T(s,r.data)&&a(null)},[r.data,s]);let d=function(e,t){let s=(0,w.useQueryClient)(void 0),[a]=o.useState(()=>new v(s,e));o.useEffect(()=>{a.setOptions(e)},[a,e]);let r=o.useSyncExternalStore(o.useCallback(e=>a.subscribe(p.notifyManager.batchCalls(e)),[a]),()=>a.getCurrentResult(),()=>a.getCurrentResult()),i=o.useCallback((e,t)=>{a.mutate(e,t).catch(x.noop)},[a]);if(r.error&&(0,x.shouldThrowError)(a.options.throwOnError,[r.error]))throw r.error;return{...r,mutate:i,mutateAsync:r.mutate}}({mutationFn:E,onMutate:async e=>{await t.cancelQueries({queryKey:k.all});let s=t.getQueryData(k.all);return t.setQueryData(k.all,e),{previousSettings:s}},onError:(e,s,a)=>{(null==a?void 0:a.previousSettings)&&t.setQueryData(k.all,a.previousSettings),j.toast.error("Failed to save settings"),console.error("Settings save error:",e)},onSuccess:()=>{a(null),j.toast.success("Settings saved successfully")},onSettled:()=>{t.invalidateQueries({queryKey:k.all})}}),u=(0,o.useCallback)((e,t,r)=>{let n=null!=s?s:i;a({...n,[e]:{...n[e],[t]:r}})},[s,i]),h=(0,o.useCallback)((e,t)=>{a({...null!=s?s:i,[e]:t})},[s,i]),m=(0,o.useCallback)(e=>{let t=null!=e?e:n;return new Promise((e,s)=>{d.mutate(t,{onSuccess:()=>{e()},onError:e=>{s(e)}})})},[n,d]),g=(0,o.useCallback)(()=>{a(null)},[]),f=(0,o.useCallback)(()=>{a(_)},[]);return{settings:n,savedSettings:i,isLoading:r.isLoading,isError:r.isError,error:r.error,hasUnsavedChanges:c,draftSettings:s,saveSettings:m,updateDraftSetting:u,updateDraftCategory:h,discardChanges:g,resetToDefaults:f,isSaving:d.isPending}})();return{settings:e.display,savedSettings:t.display,updateDisplaySettings:e=>s("display",e),updateDisplaySetting:(e,t)=>a("display",e,t),saveSettings:()=>r(),discardChanges:i,resetToDefaults:n,hasUnsavedChanges:c,isSaving:d}})(),u=(e,t)=>{s(e,t)},h=()=>{let{min:t,max:s}=O;return Math.max(t,Math.min(s,e.soundVolume))};return{settings:e,savedSettings:t,updateSetting:u,updateMultipleSettings:t=>{a({...e,...t})},resetSettings:()=>{n()},saveSettings:()=>{r()},discardSettings:()=>{i()},hasUnsavedChanges:c,isLoaded:!0,isSaving:d,getAnimationDuration:()=>D[e.flashcardAnimationSpeed],getReviewTimeSeconds:()=>{let{min:t,max:s}=R;return Math.max(t,Math.min(s,e.reviewTimeSeconds))},updateReviewTime:e=>{let{min:t,max:s}=R;u("reviewTimeSeconds",Math.max(t,Math.min(s,e)))},getSoundVolume:h,updateSoundVolume:e=>{let{min:t,max:s}=O;u("soundVolume",Math.max(t,Math.min(s,e)))},areSoundEffectsDisabled:()=>e.muteSounds||0===e.soundVolume,getEffectiveVolume:()=>e.muteSounds?0:h(),getPronunciationVolume:()=>h(),toggleMute:()=>{u("muteSounds",!e.muteSounds)}}}},399220,e=>{"use strict";e.s(["FlashcardComponent",()=>h]);var t=e.i(843476),s=e.i(271645),a=e.i(846932),r=e.i(887652),i=e.i(895420),n=e.i(88653),l=e.i(896296),o=e.i(435019),c=e.i(220849),d=e.i(204360);function u(e){let{data:n,saved:c,onSave:u,onFlip:h,isFlipped:m,frontCard:g,index:p,setIndex:f,drag:x,animationDuration:v=500}=e,[y,b]=(0,s.useState)(0),w=(0,r.useMotionValue)(0),j=(0,i.useTransform)(w,[-150,0,150],[.5,1,.5]),S=(0,i.useTransform)(w,[-150,0,150],[-45,0,45],{clamp:!1}),_=v/1e3;return(0,t.jsx)(a.motion.div,{style:{width:"100%",height:400,position:"absolute",top:0,x:w,rotate:S,cursor:"grab",pointerEvents:"auto"},whileTap:{cursor:"grabbing"},drag:x,dragConstraints:{top:0,right:0,bottom:0,left:0},onDragEnd:(e,t)=>{t.offset.x<-100&&(b(-250),f&&"number"==typeof p&&f(p+1)),t.offset.x>100&&(b(250),f&&"number"==typeof p&&f(p-1))},variants:g?{animate:{scale:1,y:0,opacity:1},exit:e=>({x:e,opacity:0,scale:.5,transition:{duration:.2}})}:{initial:{scale:0,y:105,opacity:0},animate:{scale:.75,y:30,opacity:.5}},initial:"initial",animate:"animate",exit:"exit",custom:y,transition:g?{type:"spring",stiffness:300,damping:20}:{scale:{duration:.2},opacity:{duration:.4}},onClick:e=>{!e.target.closest("button")&&5>Math.abs(w.get())&&h&&(e.preventDefault(),(0,d.playFlipSound)(),h())},children:(0,t.jsx)(a.motion.div,{style:{width:"100%",height:"100%",scale:j,perspective:"1000px"},children:(0,t.jsxs)("div",{className:"relative w-full h-full transform-style-preserve-3d ".concat(m?"rotate-y-180":""),style:{transformStyle:"preserve-3d",transform:m?"rotateY(180deg)":"rotateY(0deg)",transition:"transform ".concat(_,"s ease-in-out")},children:[(0,t.jsx)("div",{className:"w-full h-full backface-hidden ".concat(m?"opacity-0 pointer-events-none":"opacity-100"),style:{backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden",transition:"opacity ".concat(_,"s ease-in-out")},children:(0,t.jsx)(l.FlashcardFront,{data:n,saved:c,onSave:u})}),(0,t.jsx)("div",{className:"absolute inset-0 w-full h-full backface-hidden ".concat(m?"opacity-100":"opacity-0 pointer-events-none"),style:{backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden",transform:"rotateY(180deg)",transition:"opacity ".concat(_,"s ease-in-out")},children:(0,t.jsx)(o.FlashcardBack,{data:n,saved:c,onSave:u})})]})})})}function h(e){let{data:r,saved:i,onSave:l,onSwipe:o,onFlip:h,isFlipped:m=!1,animationDuration:g=500}=e,[p,f]=(0,s.useState)(0),{settings:x}=(0,c.useDisplaySettings)();return(0,s.useEffect)(()=>{x&&d.audioManager.updateSettings(x)},[x]),(0,t.jsx)("div",{className:"w-full max-w-2xl mx-auto mb-8",children:(0,t.jsx)(a.motion.div,{style:{width:"100%",height:400,position:"relative",userSelect:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",pointerEvents:"auto"},children:(0,t.jsxs)(n.AnimatePresence,{initial:!1,children:[(0,t.jsx)(u,{data:r,saved:i,onSave:l,onFlip:h,isFlipped:m,frontCard:!1,animationDuration:g},p+1),(0,t.jsx)(u,{data:r,saved:i,onSave:l,onFlip:h,isFlipped:m,frontCard:!0,index:p,setIndex:e=>{e>p&&o?o("left"):e<p&&o&&o("right"),f(e)},drag:"x",animationDuration:g},p)]})})})}},620278,e=>{"use strict";e.s(["Target",()=>t.default]);var t=e.i(517170)},938266,e=>{"use strict";e.s(["Dialog",()=>i,"DialogContent",()=>o,"DialogDescription",()=>h,"DialogFooter",()=>d,"DialogHeader",()=>c,"DialogTitle",()=>u]);var t=e.i(843476),s=e.i(326999),a=e.i(995926),r=e.i(605458);function i(e){let{...a}=e;return(0,t.jsx)(s.Root,{"data-slot":"dialog",...a})}function n(e){let{...a}=e;return(0,t.jsx)(s.Portal,{"data-slot":"dialog-portal",...a})}function l(e){let{className:a,...i}=e;return(0,t.jsx)(s.Overlay,{"data-slot":"dialog-overlay",className:(0,r.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",a),...i})}function o(e){let{className:i,children:o,showCloseButton:c=!0,...d}=e;return(0,t.jsxs)(n,{"data-slot":"dialog-portal",children:[(0,t.jsx)(l,{}),(0,t.jsxs)(s.Content,{"data-slot":"dialog-content",className:(0,r.cn)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",i),...d,children:[o,c&&(0,t.jsxs)(s.Close,{"data-slot":"dialog-close",className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[(0,t.jsx)(a.XIcon,{}),(0,t.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})}function c(e){let{className:s,...a}=e;return(0,t.jsx)("div",{"data-slot":"dialog-header",className:(0,r.cn)("flex flex-col gap-2 text-center sm:text-left",s),...a})}function d(e){let{className:s,...a}=e;return(0,t.jsx)("div",{"data-slot":"dialog-footer",className:(0,r.cn)("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",s),...a})}function u(e){let{className:a,...i}=e;return(0,t.jsx)(s.Title,{"data-slot":"dialog-title",className:(0,r.cn)("text-lg leading-none font-semibold",a),...i})}function h(e){let{className:a,...i}=e;return(0,t.jsx)(s.Description,{"data-slot":"dialog-description",className:(0,r.cn)("text-muted-foreground text-sm",a),...i})}},37727,e=>{"use strict";e.s(["X",()=>t.default]);var t=e.i(841947)},16715,e=>{"use strict";e.s(["RefreshCw",()=>t],16715);let t=(0,e.i(475254).default)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},87752,e=>{"use strict";e.s(["ReviewSession",()=>d],87752);var t=e.i(843476),s=e.i(628574),a=e.i(859951);let r=(0,e.i(475254).default)("alarm-clock",[["circle",{cx:"12",cy:"13",r:"8",key:"3y4lt7"}],["path",{d:"M12 9v4l2 2",key:"1c63tq"}],["path",{d:"M5 3 2 6",key:"18tl5t"}],["path",{d:"m22 6-3-3",key:"1opdir"}],["path",{d:"M6.38 18.7 4 21",key:"17xu3x"}],["path",{d:"M17.64 18.67 20 21",key:"kv2oe2"}]]);var i=e.i(643531),n=e.i(37727),l=e.i(23737),l=l,o=e.i(16715),c=e.i(399220);function d(e){let{practiceCards:d,currentCard:u,currentCardIndex:h,isFlipped:m,timer:g,isTimerActive:p,cardResults:f,progressStats:x,savedCards:v,onCardResult:y,onSaveCard:b,onFlipCard:w,onRefreshCards:j,onGetFreshCards:S,getAnimationDuration:_,isLoading:N}=e;return d.length&&u?(0,t.jsx)(s.Card,{className:"mb-8 bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-950/20 dark:to-indigo-950/20 border-blue-200 dark:border-blue-800",children:(0,t.jsx)(s.CardContent,{className:"p-8",children:(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("div",{className:"text-center",children:(0,t.jsxs)("div",{className:"flex items-center justify-center gap-4 mb-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(r,{className:"h-5 w-5 text-blue-600"}),(0,t.jsx)("span",{className:"text-lg font-medium text-blue-900 dark:text-blue-100",children:g>0?"".concat(g,"s"):m?"Review time!":""})]}),(0,t.jsx)(a.Button,{onClick:j,variant:"outline",size:"sm",className:"h-8 w-8 p-0",disabled:N,title:"Restart session",children:(0,t.jsx)(o.RefreshCw,{className:"h-4 w-4 ".concat(N?"animate-spin":"")})})]})}),(0,t.jsx)("div",{className:"flex justify-center",children:(0,t.jsx)(c.FlashcardComponent,{data:u,saved:v.has(u.id),onSave:b,onFlip:w,isFlipped:m,animationDuration:_()})}),(0,t.jsxs)("div",{className:"flex justify-center gap-4 md:gap-6",children:[(0,t.jsx)(a.Button,{onClick:()=>y("incorrect"),className:"w-16 h-16 rounded-full bg-red-100 hover:bg-red-200 border-0",variant:"outline",disabled:!m,children:(0,t.jsx)(n.X,{className:"h-8 w-8 text-red-600"})}),(0,t.jsx)(a.Button,{onClick:()=>y("unsure"),className:"w-16 h-16 rounded-full bg-yellow-100 hover:bg-yellow-200 border-0",variant:"outline",disabled:!m,title:"Unsure","aria-label":"Unsure",children:(0,t.jsx)(l.default,{className:"h-8 w-8 text-yellow-600"})}),(0,t.jsx)(a.Button,{onClick:()=>y("correct"),className:"w-16 h-16 rounded-full bg-green-100 hover:bg-green-200 border-0",variant:"outline",disabled:!m,children:(0,t.jsx)(i.Check,{className:"h-8 w-8 text-green-600"})})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsxs)("span",{className:"text-blue-700 dark:text-blue-300",children:["Card ",h+1," of ",d.length]}),(0,t.jsxs)("span",{className:"text-blue-700 dark:text-blue-300",children:["Correct: ",x.correct," | Incorrect:"," ",x.incorrect," | Unsure: ",x.unsure]})]}),(0,t.jsx)("div",{className:"grid grid-cols-10 gap-1",children:d.map((e,s)=>{let a="bg-gray-200";if(s<x.total){var r;let e=null==(r=f[s])?void 0:r.result;"correct"===e?a="bg-green-500":"incorrect"===e?a="bg-red-500":"unsure"===e&&(a="bg-yellow-500")}else s===h&&(a="bg-gray-300");return(0,t.jsx)("div",{className:"h-2 rounded ".concat(a)},s)})})]})]})})}):null}},170275,65776,e=>{"use strict";e.s(["useFlashcardReview",()=>c],170275);var t=e.i(271645),s=e.i(859016);e.s(["authSessionManager",()=>i],65776);var a=e.i(299749);class r{static getInstance(){return r.instance||(r.instance=new r),r.instance}setReviewSession(e){this.isReviewSession=e,console.log("ðŸ”„ AuthSessionManager: Review session status:",e)}setupVisibilityListener(){document.addEventListener("visibilitychange",()=>{"visible"===document.visibilityState?this.handleTabFocus():this.handleTabBlur()})}async handleTabFocus(){if(this.isReviewSession)return void console.log("ðŸš« AuthSessionManager: Skipping session refresh during review session");this.refreshTimeout&&clearTimeout(this.refreshTimeout),this.refreshTimeout=setTimeout(async()=>{await this.refreshSession()},2e3)}handleTabBlur(){this.refreshTimeout&&(clearTimeout(this.refreshTimeout),this.refreshTimeout=null)}async refreshSession(){try{let e=(0,s.createClient)(),{data:t,error:a}=await e.auth.getSession();a?console.error("âŒ Auth session refresh error:",a):console.log("âœ… Auth session refreshed successfully")}catch(e){console.error("âŒ Auth session refresh failed:",e)}}async forceRefresh(){if(this.isReviewSession)return void console.log("ðŸš« AuthSessionManager: Cannot force refresh during review session");await this.refreshSession()}constructor(){(0,a._)(this,"isReviewSession",!1),(0,a._)(this,"refreshTimeout",null),this.setupVisibilityListener()}}(0,a._)(r,"instance",void 0);let i=r.getInstance();var n=e.i(846696),l=e.i(204360),o=e.i(220849);let c=e=>{let{cards:a,onSessionComplete:r,enableTimer:c=!0}=e,{getReviewTimeSeconds:d}=(0,o.useDisplaySettings)(),u=d(),[h,m]=(0,t.useState)(0),[g,p]=(0,t.useState)(!1),[f,x]=(0,t.useState)(u),[v,y]=(0,t.useState)(!1),[b,w]=(0,t.useState)([]),[j,S]=(0,t.useState)(null),[_,N]=(0,t.useState)(new Set);(0,t.useEffect)(()=>(i.setReviewSession(!0),()=>{i.setReviewSession(!1)}),[]),(0,t.useEffect)(()=>{},[h,g,f,v,a.length,j]),(0,t.useEffect)(()=>{(async()=>{try{let{data:{user:e}}=await s.supabase.auth.getUser();if(!e)return;let{data:t,error:a}=await s.supabase.from("saved_flashcards").select("flashcard_id, flashcard_type, topic").eq("UserID",e.id);t&&N(new Set(t.map(e=>e.flashcard_id)))}catch(e){console.error("Error loading saved cards:",e)}})()},[]),(0,t.useEffect)(()=>{if(!c||!v||f<=0)return;let e=setInterval(()=>{x(e=>e-1)},1e3);return()=>{clearInterval(e)}},[c,v,f]),(0,t.useEffect)(()=>{c&&0===f&&v&&(p(!0),y(!1),(0,l.playFlipSound)())},[c,f,v]);let k=(0,t.useCallback)(()=>{p(!1),x(u),c&&y(!0),S(new Date)},[c,u,h]);(0,t.useEffect)(()=>{a.length>0&&h<a.length&&k()},[h,a.length,k]),(0,t.useEffect)(()=>{},[h,g,f,v,a.length]);let C=(0,t.useCallback)(e=>{if(!a[h])return void console.warn("âŒ [HOOK] No card at index:",h,{cardsLength:a.length,currentCardIndex:h,timestamp:new Date().toISOString()});let t=null!=j?j:new Date;j||S(t),"correct"===e?(0,l.playCorrectSound)():"incorrect"===e&&(0,l.playIncorrectSound)();let s=Date.now()-t.getTime(),i={cardId:a[h].id,result:e,timeSpent:s};w(e=>[...e,i]),h<a.length-1?m(e=>e+1):r&&r(),y(!1)},[a,h,j,r,g,f,v]),M=(0,t.useCallback)(async e=>{try{let{data:{user:t}}=await s.supabase.auth.getUser();if(!t)return;let a=new Set(_);a.has(e)?(a.delete(e),await s.supabase.from("saved_flashcards").delete().eq("UserID",t.id).eq("flashcard_id",e),n.toast.success("Card removed from saved!")):(a.add(e),await s.supabase.from("saved_flashcards").insert({UserID:t.id,flashcard_id:e}),n.toast.success("Card saved!")),N(a)}catch(e){console.error("Error saving card:",e),n.toast.error("Failed to save card")}},[_]),E=(0,t.useCallback)(()=>{p(e=>(e||((0,l.playFlipSound)(),y(!1)),!e))},[g,h,f,v]),T=(0,t.useCallback)(()=>{m(0),p(!1),x(u),y(!1),w([]),S(null)},[u]),D=(0,t.useCallback)(()=>{let e=b.filter(e=>"correct"===e.result).length,t=b.filter(e=>"incorrect"===e.result).length,s=b.filter(e=>"unsure"===e.result).length,r=b.length;return{correct:e,incorrect:t,unsure:s,total:r,remaining:a.length-r,accuracy:r>0?e/r*100:0}},[b,a.length]);return{currentCard:a[h]||null,currentCardIndex:h,isFlipped:g,timer:f,isTimerActive:v,cardResults:b,savedCards:_,startTime:j,handleCardResult:C,handleSaveCard:M,handleFlipCard:E,resetSession:T,getProgressStats:D,hasMoreCards:h<a.length-1,progress:a.length>0?(h+1)/a.length*100:0}}},225014,e=>{"use strict";e.s(["default",()=>C],225014);var t=e.i(843476),s=e.i(271645),a=e.i(618566),r=e.i(859016),i=e.i(87752),n=e.i(170275),l=e.i(859951),o=e.i(628574),c=e.i(326357),d=e.i(846696),u=e.i(65776),h=e.i(938266),m=e.i(166778),g=e.i(243970),p=e.i(475254);let f=(0,p.default)("trophy",[["path",{d:"M10 14.66v1.626a2 2 0 0 1-.976 1.696A5 5 0 0 0 7 21.978",key:"1n3hpd"}],["path",{d:"M14 14.66v1.626a2 2 0 0 0 .976 1.696A5 5 0 0 1 17 21.978",key:"rfe1zi"}],["path",{d:"M18 9h1.5a1 1 0 0 0 0-5H18",key:"7xy6bh"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M6 9a6 6 0 0 0 12 0V3a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1z",key:"1mhfuq"}],["path",{d:"M6 9H4.5a1 1 0 0 1 0-5H6",key:"tex48p"}]]);var x=e.i(620278),v=e.i(503116),y=e.i(575822),b=e.i(25652),w=e.i(16715);let j=(0,p.default)("chart-column",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);var S=e.i(270756),_=e.i(243553),N=e.i(522016);function k(e){var i;let{isOpen:n,onClose:c,sessionData:d}=e,u=(0,a.useRouter)(),[p,k]=(0,s.useState)(null),[C,M]=(0,s.useState)(0),[E,T]=(0,s.useState)(!1),[D,R]=(0,s.useState)(0);(0,s.useEffect)(()=>{n&&(O(),F(),I())},[n]);let O=async()=>{try{let{data:{user:e}}=await r.supabase.auth.getUser();if(!e)return;let{data:t}=await r.supabase.from("user_profiles").select("subscription_type, streak_days").eq("id",e.id).single();t&&(k(t),R(t.streak_days))}catch(e){console.error("Error fetching user data:",e)}},F=async()=>{try{let{data:{user:e}}=await r.supabase.auth.getUser();if(!e)return;let t=new Date().toISOString().split("T")[0],{count:s}=await r.supabase.from("review_sessions").select("*",{count:"exact"}).eq("user_id",e.id).eq("status","completed").gte("started_at","".concat(t,"T00:00:00.000Z")).lt("started_at","".concat(t,"T23:59:59.999Z"));M(s||0)}catch(e){console.error("Error fetching today's sessions:",e)}},I=async()=>{try{let{data:{user:e}}=await r.supabase.auth.getUser();if(!e)return;let t=new Date().toISOString().split("T")[0],s=new Date;s.setDate(s.getDate()-1);let a=s.toISOString().split("T")[0],{count:i}=await r.supabase.from("review_sessions").select("*",{count:"exact"}).eq("user_id",e.id).eq("status","completed").gte("started_at","".concat(t,"T00:00:00.000Z")).lt("started_at","".concat(t,"T23:59:59.999Z"));if(1===i){let{data:s}=await r.supabase.from("user_profiles").select("streak_days, last_login").eq("id",e.id).single();if(s){let i=s.streak_days||0,n=s.last_login?new Date(s.last_login).toISOString().split("T")[0]:null;n===a?(i+=1,T(!0)):n!==t&&(i=1,T(null!==n)),await r.supabase.from("user_profiles").update({streak_days:i,last_login:new Date().toISOString()}).eq("id",e.id),R(i)}}}catch(e){console.error("Error checking streak update:",e)}};return(0,t.jsx)(h.Dialog,{open:n,onOpenChange:()=>{c(),u.push("/flashcards/review")},children:(0,t.jsxs)(h.DialogContent,{className:"sm:max-w-md",children:[(0,t.jsx)(h.DialogHeader,{children:(0,t.jsxs)(h.DialogTitle,{className:"text-center text-2xl font-bold flex items-center justify-center gap-2",children:[(0,t.jsx)(f,{className:"h-6 w-6 text-yellow-500"}),"Session Complete!"]})}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsx)(o.Card,{children:(0,t.jsxs)(o.CardContent,{className:"p-4 text-center",children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:d.totalCards}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Cards Reviewed"})]})}),(0,t.jsx)(o.Card,{children:(0,t.jsxs)(o.CardContent,{className:"p-4 text-center",children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-green-600",children:d.correctAnswers}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Correct Answers"})]})})]}),(0,t.jsx)(o.Card,{children:(0,t.jsxs)(o.CardContent,{className:"p-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(x.Target,{className:"h-5 w-5 text-muted-foreground"}),(0,t.jsx)("span",{className:"font-medium",children:"Accuracy Rate"})]}),(0,t.jsxs)(m.Badge,{variant:(i=d.accuracyRate)>=80?"default":i>=60?"secondary":"destructive",children:[d.accuracyRate.toFixed(0),"%"]})]}),(0,t.jsx)(g.Progress,{value:d.accuracyRate,className:"h-2"})]})}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsx)(o.Card,{children:(0,t.jsxs)(o.CardContent,{className:"p-4 text-center",children:[(0,t.jsxs)("div",{className:"flex items-center justify-center gap-2 mb-2",children:[(0,t.jsx)(v.Clock,{className:"h-4 w-4 text-muted-foreground"}),(0,t.jsx)("span",{className:"text-sm font-medium",children:"Time Spent"})]}),(0,t.jsx)("div",{className:"text-lg font-bold",children:(e=>{let t=Math.floor(e/60),s=e%60;return t>0?"".concat(t,"m ").concat(s,"s"):"".concat(s,"s")})(d.timeSpent)})]})}),(0,t.jsx)(o.Card,{children:(0,t.jsxs)(o.CardContent,{className:"p-4 text-center",children:[(0,t.jsxs)("div",{className:"flex items-center justify-center gap-2 mb-2",children:[(0,t.jsx)(y.Coins,{className:"h-4 w-4 text-yellow-500"}),(0,t.jsx)("span",{className:"text-sm font-medium",children:"Coins Earned"})]}),(0,t.jsx)("div",{className:"text-lg font-bold text-yellow-600",children:d.coinsEarned})]})})]}),E&&(0,t.jsx)(o.Card,{className:"bg-gradient-to-r from-orange-50 to-red-50 dark:from-orange-950/20 dark:to-red-950/20 border-orange-200 dark:border-orange-800",children:(0,t.jsxs)(o.CardContent,{className:"p-4 text-center",children:[(0,t.jsxs)("div",{className:"flex items-center justify-center gap-2 mb-2",children:[(0,t.jsx)(b.TrendingUp,{className:"h-5 w-5 text-orange-600"}),(0,t.jsx)("span",{className:"font-medium text-orange-800 dark:text-orange-200",children:"Streak Updated!"})]}),(0,t.jsxs)("p",{className:"text-orange-700 dark:text-orange-300",children:["Your learning streak is now ",D," days!"]})]})}),(null==p?void 0:p.subscription_type)==="FREE"&&C>=3&&(0,t.jsx)(o.Card,{className:"bg-gradient-to-r from-amber-50 to-orange-50 dark:from-amber-950/20 dark:to-orange-950/20 border-amber-200 dark:border-amber-800",children:(0,t.jsxs)(o.CardContent,{className:"p-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)(S.Lock,{className:"h-4 w-4 text-amber-600"}),(0,t.jsx)("span",{className:"font-medium text-amber-800 dark:text-amber-200",children:"Daily Limit Reached"})]}),(0,t.jsxs)("p",{className:"text-sm text-amber-700 dark:text-amber-300 mb-3",children:["You've completed ",C,"/",3," free review sessions today. Upgrade to Plus for unlimited review!"]}),(0,t.jsx)(l.Button,{asChild:!0,size:"sm",className:"w-full",children:(0,t.jsxs)(N.default,{href:"/plans",children:[(0,t.jsx)(_.Crown,{className:"w-4 h-4 mr-2"}),"Upgrade to Plus"]})})]})}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)(l.Button,{onClick:()=>{c(),u.push("/flashcards/review")},className:"w-full",disabled:(null==p?void 0:p.subscription_type)==="FREE"&&C>=3,children:[(0,t.jsx)(w.RefreshCw,{className:"w-4 h-4 mr-2"}),"Start New Review Session"]}),(0,t.jsxs)(l.Button,{onClick:()=>{c(),u.push("/flashcards/statistics")},variant:"outline",className:"w-full",children:[(0,t.jsx)(j,{className:"w-4 h-4 mr-2"}),"View Detailed Statistics"]})]}),(0,t.jsx)("div",{className:"text-center p-4 bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-950/20 dark:to-indigo-950/20 rounded-lg",children:(0,t.jsx)("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:d.accuracyRate>=80?"ðŸŽ‰ Excellent work! You're mastering Vietnamese vocabulary!":d.accuracyRate>=60?"ðŸ‘ Good progress! Keep practicing to improve further!":"ðŸ’ª Every review makes you stronger! Keep going!"})})]})]})})}function C(){let h=(0,a.useRouter)(),m=(0,a.useSearchParams)(),g=(null==m?void 0:m.get("id"))||"",[p,f]=(0,s.useState)(!0),[x,v]=(0,s.useState)([]),[y,b]=(0,s.useState)(null),[w,j]=(0,s.useState)(null),[S,_]=(0,s.useState)(!1),[N,C]=(0,s.useState)(!1),[M,E]=(0,s.useState)(!1),[T,D]=(0,s.useState)({totalCards:0,correctAnswers:0,accuracyRate:0,coinsEarned:0,timeSpent:0});(0,s.useEffect)(()=>{u.authSessionManager.setReviewSession(!0);try{document.cookie="sidebar:state=false; path=/; max-age=".concat(3600);let e=e=>{("b"===e.key||"B"===e.key)&&(e.ctrlKey||e.metaKey)&&(e.preventDefault(),e.stopPropagation())};return window.addEventListener("keydown",e,{capture:!0}),()=>{window.removeEventListener("keydown",e,{capture:!0}),u.authSessionManager.setReviewSession(!1)}}catch(e){return()=>u.authSessionManager.setReviewSession(!1)}},[]),(0,s.useEffect)(()=>{(async()=>{try{if(!g){d.toast.error("Missing session id"),h.push("/flashcards/review");return}let{data:{user:t},error:s}=await r.supabase.auth.getUser();if(s||!t){d.toast.error("Please log in to continue"),h.push("/auth/login");return}j(t.id);let{data:a,error:i}=await r.supabase.from("review_sessions").select("*").eq("id",g).maybeSingle();if(i||!a){d.toast.error("Session not found"),h.push("/flashcards/review");return}b(a);let{data:n,error:l}=await r.supabase.from("review_session_cards").select("flashcard_id, card_order").eq("session_id",g).order("card_order",{ascending:!0});if(l)throw l;let o=(n||[]).map(e=>e.flashcard_id);if(!o.length){d.toast.error("No cards in this session"),h.push("/flashcards/review");return}let{flashcardAPI:c}=await e.A(163793),u=await c.getFlashcardsByIds(o);v(u)}catch(e){console.error(e),d.toast.error("Failed to load review session")}finally{f(!1)}})()},[h,g]);let{currentCard:R,currentCardIndex:O,isFlipped:F,timer:I,isTimerActive:A,cardResults:P,savedCards:q,handleCardResult:U,handleSaveCard:B,handleFlipCard:V,resetSession:z,getProgressStats:L}=(0,n.useFlashcardReview)({cards:x,enableTimer:!0});(0,s.useEffect)(()=>{x.length>0&&P.length===x.length&&(async()=>{try{let e=L();if(await r.supabase.from("review_sessions").update({status:"completed",completed_cards:e.total,correct_answers:e.correct,total_time_seconds:null,completed_at:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",g),w){let t=new Date().toISOString().slice(0,10),{data:s}=await r.supabase.from("review_session_cards").select("time_spent_seconds").eq("session_id",g),a=(s||[]).reduce((e,t)=>e+((null==t?void 0:t.time_spent_seconds)||0),0),i=Math.max(0,Math.round(a/60)),{data:n}=await r.supabase.from("flashcard_statistics").select("*").eq("user_id",w).eq("date",t).maybeSingle(),l=e.total,o=e.correct,c=e.total;if(n){let e=(n.flashcards_reviewed||0)+l,t=(n.correct_answers||0)+o,s=(n.total_questions||0)+c,a=(n.time_spent_minutes||0)+i;await r.supabase.from("flashcard_statistics").update({flashcards_reviewed:e,correct_answers:t,total_questions:s,accuracy_rate:s>0?t/s*100:0,time_spent_minutes:a,updated_at:new Date().toISOString()}).eq("id",n.id)}else await r.supabase.from("flashcard_statistics").insert({user_id:w,date:t,flashcards_reviewed:l,correct_answers:o,total_questions:c,accuracy_rate:c>0?o/c*100:0,time_spent_minutes:i});D({totalCards:e.total,correctAnswers:e.correct,accuracyRate:e.accuracy,coinsEarned:0,timeSpent:Math.max(0,(s||[]).reduce((e,t)=>e+((null==t?void 0:t.time_spent_seconds)||0),0))}),C(!0),E(!0)}d.toast.success("Session completed!")}catch(e){console.error(e)}})()},[P.length,x.length,L,g,w]);let K=(0,s.useCallback)(async(e,t,s)=>{if(!w||!g)return;await r.supabase.from("review_session_cards").update({result:t,time_spent_seconds:Math.max(1,Math.round(s/1e3)),reviewed_at:new Date().toISOString()}).eq("session_id",g).eq("flashcard_id",e);let{data:a}=await r.supabase.from("flashcard_srs_records").select("*").eq("user_id",w).eq("flashcard_id",e).limit(1),i=new Date;if(a&&a.length>0){let e=a[0],s="correct"===t,n=Math.max(1.3,Number(e.ease_factor||2.5)+(s?.1:-.2)),l=s?Number(e.repetition_number||0)+1:0,o=1;o=l<=1?1:2===l?6:Math.round((e.interval_days||6)*n);let c=new Date(i);c.setDate(c.getDate()+o),await r.supabase.from("flashcard_srs_records").update({ease_factor:n,repetition_number:l,interval_days:o,due_date:c.toISOString().slice(0,10),total_reviews:(e.total_reviews||0)+1,correct_reviews:(e.correct_reviews||0)+ +!!s,last_reviewed:i.toISOString(),updated_at:i.toISOString()}).eq("id",e.id)}else{let s="correct"===t,a=new Date(i);a.setDate(a.getDate()+1),await r.supabase.from("flashcard_srs_records").insert({user_id:w,flashcard_id:e,ease_factor:s?2.6:2.3,repetition_number:+!!s,interval_days:1,due_date:a.toISOString().slice(0,10),total_reviews:1,correct_reviews:+!!s,last_reviewed:i.toISOString(),updated_at:i.toISOString()})}},[g,w]),Y=(0,s.useCallback)(e=>{if(S||N)return;let t=x[O];O===x.length-1&&_(!0),U(e),(null==t?void 0:t.id)&&setTimeout(()=>{let s=P[P.length-1],a=s&&s.cardId===t.id?s.timeSpent:0;K(t.id,e,a).catch(()=>{})},50)},[O,x,U,K,P,S,N]),H=(0,s.useCallback)(async()=>{try{let e=L();await r.supabase.from("review_sessions").update({status:"abandoned",completed_cards:e.total,correct_answers:e.correct,updated_at:new Date().toISOString()}).eq("id",g),d.toast.success("Session exited"),h.push("/flashcards/review")}catch(e){console.error(e),h.push("/flashcards/review")}},[L,h,g]);if(p)return null;if(!x.length)return(0,t.jsxs)(o.Card,{children:[(0,t.jsx)(o.CardHeader,{children:(0,t.jsx)(o.CardTitle,{children:"No cards loaded"})}),(0,t.jsx)(o.CardContent,{children:(0,t.jsx)(l.Button,{onClick:()=>h.push("/flashcards/review"),children:"Back"})})]});let Q=L();return(0,t.jsxs)("div",{className:"container mx-auto py-6 px-4 max-w-4xl",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold",children:"Focused Review Session"}),(0,t.jsx)("div",{className:"flex gap-2",children:(0,t.jsx)(l.Button,{variant:"outline",onClick:H,children:"Quit"})})]}),(0,t.jsx)(i.ReviewSession,{practiceCards:x,currentCard:R,currentCardIndex:O,isFlipped:F,timer:I,isTimerActive:A,cardResults:P,progressStats:Q,savedCards:q,onCardResult:Y,onSaveCard:N||S?()=>{}:B,onFlipCard:N||S?()=>{}:V,onRefreshCards:()=>h.refresh(),onGetFreshCards:()=>h.refresh(),getAnimationDuration:()=>300,isLoading:S||N}),(0,t.jsx)(c.Separator,{className:"my-6"}),(0,t.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Session ID: ",g]}),(0,t.jsx)(k,{isOpen:M,onClose:()=>{E(!1),h.push("/flashcards/review")},sessionData:T})]})}},163793,e=>{e.v(t=>Promise.all(["static/chunks/27a124a44ae477cd.js"].map(t=>e.l(t))).then(()=>t(532671)))}]);