(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,89793,e=>{"use strict";e.s(["default",()=>$],89793);var a=e.i(843476),s=e.i(271645),t=e.i(522016),r=e.i(618566),l=e.i(859951),i=e.i(628574),n=e.i(326357),c=e.i(43454),o=e.i(507800),d=e.i(918878),h=e.i(846696),u=e.i(810980),m=e.i(107233),x=e.i(555436),f=e.i(475254);let p=(0,f.default)("funnel",[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]]),g=(0,f.default)("grid-3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]),v=(0,f.default)("list",[["path",{d:"M3 5h.01",key:"18ugdj"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 19h.01",key:"noohij"}],["path",{d:"M8 5h13",key:"1pao27"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 19h13",key:"m83p4d"}]]);var y=e.i(870273),j=e.i(243553),w=e.i(283086);e.i(247167);var N=e.i(657688),b=e.i(166778);let S=(0,f.default)("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);var C=e.i(503116),_=e.i(382373);let A=(0,f.default)("bookmark-x",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2Z",key:"169p4p"}],["path",{d:"m14.5 7.5-5 5",key:"3lb6iw"}],["path",{d:"m9.5 7.5 5 5",key:"ko136h"}]]);var k=e.i(727612),T=e.i(24708),F=e.i(263784);function P(e,a){return(0,F.formatDistance)(e,(0,T.constructNow)(e),a)}var M=e.i(204360),U=e.i(846932),D=e.i(859016);let I=(0,s.memo)(function(e){let{flashcards:t,viewMode:r,onUnsave:n,onToggleFavorite:c}=e,[o,d]=(0,s.useState)(null),[u,m]=(0,s.useState)(new Set);(0,s.useEffect)(()=>{},[]);let x=async e=>{let a=e.vietnamese||e.vietnamese_text||"";if(!a)return void h.toast.error("No text available for audio playback");d(e.id);try{if("APP"===e.flashcard_type){if(!e.flashcard_id)throw Error("Missing flashcard ID for APP flashcard");e.audio_url?await M.audioManager.playPronunciation(e.audio_url):h.toast.info("No audio available for this flashcard")}else{if("lesson"===e.source_type&&e.audio_url){let{data:a}=(0,D.createClient)().storage.from("lesson-materials").getPublicUrl(e.audio_url);if(null==a?void 0:a.publicUrl){let e=new Audio(a.publicUrl);await e.play(),e.onended=()=>{d(null)},e.onerror=()=>{d(null),h.toast.error("Failed to play audio")};return}}await f(e.id,a)}}catch(s){if(console.error("ğŸ’¥ Audio playback failed:",s),"CUSTOM"===e.flashcard_type)try{sessionStorage.setItem("audio-cache-errors","true")}catch(e){console.warn("Could not set error flag in sessionStorage:",e)}let a=s instanceof Error?s.message:"An unknown error occurred";h.toast.error("Failed to play audio: ".concat(a))}finally{d(null)}},f=async(e,a)=>{let s="audio:custom:".concat(e),t=null,r=!1;try{let a=localStorage.getItem(s);if(a){let l=JSON.parse(a);l.expiry&&l.base64&&l.expiry>Date.now()&&"string"==typeof l.base64&&l.base64.length>0?(t=l,console.log("âœ… Using cached audio from localStorage for custom flashcard:",e)):(localStorage.removeItem(s),console.log("ğŸ—‘ï¸ Invalid/expired audio cache removed for custom flashcard:",e),r=!0)}else r=!0}catch(e){console.warn("âš ï¸ Error reading from localStorage:",e);try{localStorage.removeItem(s)}catch(e){console.warn("âš ï¸ Could not clean up localStorage:",e)}r=!0}if(r||!t){console.log("ğŸ”Š Generating new audio via API route for custom flashcard:",e),console.log("ğŸ“ Vietnamese text to convert:",a),console.log("ğŸŒ Making request to TTS API route...");let r=await fetch("/api/flashcards/tts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:a})});if(console.log("ğŸ“¥ Response status:",r.status,r.statusText),!r.ok)throw console.error("âŒ TTS API error:",await r.json().catch(()=>({}))),Error("Failed to synthesize audio. Status: ".concat(r.status));let l=await r.json();if(console.log("ğŸ“Š TTS API response received"),!l.audioContent)throw console.error("âŒ No audioContent in response:",l),Error("No audio content in API response");let i=Date.now()+6048e5;t={base64:l.audioContent,expiry:i};try{localStorage.setItem(s,JSON.stringify(t)),console.log("ğŸ’¾ Audio data cached in localStorage for custom flashcard:",e)}catch(e){console.warn("âš ï¸ Failed to cache audio in localStorage:",e)}}if(null==t?void 0:t.base64){let l=0;for(;l<2;){let i=null;try{let s;if(console.log("ğŸµ Attempting to play audio (attempt ".concat(l+1,"/").concat(2,") for custom flashcard:"),e),!t.base64||"string"!=typeof t.base64)throw Error("Invalid base64 audio data");try{s=atob(t.base64)}catch(e){throw Error("Failed to decode base64 audio data: ".concat(e))}let r=Array(s.length);for(let e=0;e<s.length;e++)r[e]=s.charCodeAt(e);let n=new Uint8Array(r),c=new Blob([n],{type:"audio/mpeg"});if(console.log("ğŸ’¾ Blob created, size:",c.size,"bytes, type:",c.type),0===c.size)throw Error("Created blob is empty");i=URL.createObjectURL(c),console.log("ğŸ”— Audio URL created:",i.substring(0,50)+"...");let o=new Audio(i);await new Promise((e,s)=>{let t=!1,r=null,l=()=>{!t&&(t=!0,r&&clearTimeout(r),i&&URL.revokeObjectURL(i))},n=()=>{t||(l(),e())},c=e=>{t||(l(),s(e))};o.addEventListener("loadstart",()=>console.log("ğŸ”„ Audio loading started")),o.addEventListener("canplay",()=>console.log("âœ… Audio can start playing")),o.addEventListener("error",e=>{var a;console.error("âŒ Audio element error event:",e),console.error("âŒ Audio error details:",{error:o.error,networkState:o.networkState,readyState:o.readyState,src:o.src.substring(0,50)+"..."}),c(Error("Audio loading failed: ".concat((null==(a=o.error)?void 0:a.message)||"Media element error")))}),o.addEventListener("ended",()=>{console.log("ğŸ Audio playback completed successfully"),n()}),r=setTimeout(()=>{console.log("â° Audio playback timeout - assuming success"),n()},15e3),o.play().then(()=>{console.log("ğŸµ Successfully started playing audio for custom flashcard:",a)}).catch(e=>{console.error("âŒ Audio play() method failed:",e),c(Error("Audio play failed: ".concat(e.message||"Play method error")))})}),console.log("âœ… Audio playback completed successfully");return}catch(n){if(console.error("âŒ Audio playback error (attempt ".concat(l+1,"):"),n),i){try{URL.revokeObjectURL(i)}catch(e){console.warn("âš ï¸ Could not revoke blob URL:",e)}i=null}if(++l>=2){if(!r&&t){console.log("ğŸ”„ Cached audio failed, attempting to regenerate...");try{localStorage.removeItem(s)}catch(e){console.warn("âš ï¸ Could not remove cache:",e)}return await f(e,a)}throw Error("Audio playback failed after ".concat(2," attempts: ").concat(n instanceof Error?n.message:"Unknown error"))}await new Promise(e=>setTimeout(e,800))}}}else throw Error("Could not generate or retrieve audio data")},p=e=>{let a=e.vietnamese||e.vietnamese_text||"Unknown",s="CUSTOM"===e.flashcard_type?"delete":"unsave";n(e.id,a,s)},g=e=>{m(a=>{let s=new Set(a);return s.has(e)?s.delete(e):s.add(e),s})},v=e=>{if(!e)return[];if(Array.isArray(e))return e.filter(e=>"string"==typeof e&&e.trim());if("string"==typeof e){let a=e.trim();if(!a)return[];let s=a.match(/[A-Z][a-z]*/g);return s&&s.length>1?s:a.includes(",")?a.split(",").map(e=>e.trim()).filter(e=>e):a.includes(";")?a.split(";").map(e=>e.trim()).filter(e=>e):a.includes("/")?a.split("/").map(e=>e.trim()).filter(e=>e):a.includes(" ")?a.split(" ").map(e=>e.trim()).filter(e=>e):[a]}if("number"==typeof e)return[e.toString()];try{let a=String(e).trim();return a?[a]:[]}catch(e){return[]}};return"grid"===r?(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:t.map(e=>{var s;let t=e.vietnamese||e.vietnamese_text||"",r=(null==(s=e.english)?void 0:s.join(", "))||e.english_text||"",n=e.image_url||"/placeholder.svg",d="CUSTOM"===e.flashcard_type,h=u.has(e.id);return(0,a.jsx)("div",{style:{perspective:"1000px",minHeight:"450px"},children:(0,a.jsxs)(U.motion.div,{style:{position:"relative",transformStyle:"preserve-3d",width:"100%",height:"100%",minHeight:"450px"},transition:{duration:.6},animate:{rotateY:180*!!h},children:[(0,a.jsx)(U.motion.div,{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden"},children:(0,a.jsx)(i.Card,{className:"group hover:shadow-lg transition-all duration-200 cursor-pointer",style:{width:"100%",height:"100%"},onClick:()=>g(e.id),children:(0,a.jsxs)(i.CardContent,{className:"p-4 h-full flex flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)(b.Badge,{variant:"APP"===e.flashcard_type?"default":"secondary",className:"text-xs",children:"APP"===e.flashcard_type?"App":"My Card"}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(l.Button,{variant:"ghost",size:"sm",onClick:a=>{a.stopPropagation(),c(e.id)},className:"p-1 h-auto opacity-60 hover:opacity-100",children:e.is_favorite?(0,a.jsx)(y.Star,{className:"h-3 w-3 fill-yellow-400 text-yellow-400"}):(0,a.jsx)(y.Star,{className:"h-3 w-3"})}),(0,a.jsx)(l.Button,{variant:"ghost",size:"sm",onClick:a=>{a.stopPropagation(),p(e)},className:"p-1 h-auto opacity-60 hover:opacity-100 hover:text-red-600",title:d?"Delete flashcard":"Unsave flashcard",children:d?(0,a.jsx)(k.Trash2,{className:"h-3 w-3"}):(0,a.jsx)(A,{className:"h-3 w-3"})})]})]}),(0,a.jsx)("div",{className:"aspect-square rounded-lg overflow-hidden mb-3 bg-gray-100",children:(0,a.jsx)(N.default,{src:n,alt:t,width:300,height:300,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-200",loading:"lazy"})}),(0,a.jsxs)("div",{className:"space-y-2 flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900 truncate",children:t}),"APP"===e.flashcard_type&&e.pronunciation&&(0,a.jsxs)("p",{className:"text-xs text-gray-500 font-mono mt-0.5 truncate",children:["/",e.pronunciation,"/"]}),"CUSTOM"===e.flashcard_type&&e.ipa_pronunciation&&(0,a.jsxs)("p",{className:"text-xs text-gray-500 font-mono mt-0.5 truncate",children:["/",e.ipa_pronunciation,"/"]})]}),(0,a.jsx)(l.Button,{variant:"ghost",size:"sm",onClick:a=>{a.stopPropagation(),x(e)},disabled:o===e.id,className:"p-1 h-auto opacity-60 hover:opacity-100 ".concat(o===e.id?"animate-pulse text-blue-500":""),title:"Play pronunciation",children:(0,a.jsx)(_.Volume2,{className:"h-3 w-3"})})]}),e.topic&&(0,a.jsx)(b.Badge,{variant:"outline",className:"text-xs",children:e.topic}),(()=>{let s=v(e.word_type);return 0===s.length?null:1===s.length?(0,a.jsx)(b.Badge,{variant:"outline",className:"text-xs",children:s[0]}):(0,a.jsx)("div",{className:"flex flex-wrap gap-1",children:s.map((e,s)=>(0,a.jsx)(b.Badge,{variant:"outline",className:"text-xs",children:e},s))})})()]}),(0,a.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500 mt-3 pt-3 border-t",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(C.Clock,{className:"h-3 w-3"}),e.review_count," reviews"]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",suppressHydrationWarning:!0,children:[(0,a.jsx)(S,{className:"h-3 w-3"}),P(new Date(e.saved_at),{addSuffix:!0})]})]})]})})}),(0,a.jsx)(U.motion.div,{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden",transform:"rotateY(180deg)"},children:(0,a.jsx)(i.Card,{className:"group hover:shadow-lg transition-all duration-200 cursor-pointer",style:{width:"100%",height:"100%"},onClick:()=>g(e.id),children:(0,a.jsxs)(i.CardContent,{className:"p-4 h-full flex flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)(b.Badge,{variant:"APP"===e.flashcard_type?"default":"secondary",className:"text-xs",children:"APP"===e.flashcard_type?"App":"My Card"}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(l.Button,{variant:"ghost",size:"sm",onClick:a=>{a.stopPropagation(),c(e.id)},className:"p-1 h-auto opacity-60 hover:opacity-100",children:e.is_favorite?(0,a.jsx)(y.Star,{className:"h-3 w-3 fill-yellow-400 text-yellow-400"}):(0,a.jsx)(y.Star,{className:"h-3 w-3"})}),(0,a.jsx)(l.Button,{variant:"ghost",size:"sm",onClick:a=>{a.stopPropagation(),p(e)},className:"p-1 h-auto opacity-60 hover:opacity-100 hover:text-red-600",title:d?"Delete flashcard":"Unsave flashcard",children:d?(0,a.jsx)(k.Trash2,{className:"h-3 w-3"}):(0,a.jsx)(A,{className:"h-3 w-3"})})]})]}),(0,a.jsx)("div",{className:"space-y-2 flex-1 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-lg font-semibold text-gray-900 mb-4",children:r}),e.topic&&(0,a.jsx)(b.Badge,{variant:"outline",className:"text-xs mb-2",children:e.topic})]})}),(0,a.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500 mt-3 pt-3 border-t",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(C.Clock,{className:"h-3 w-3"}),e.review_count," reviews"]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",suppressHydrationWarning:!0,children:[(0,a.jsx)(S,{className:"h-3 w-3"}),P(new Date(e.saved_at),{addSuffix:!0})]})]})]})})})]})},e.id)})}):(0,a.jsx)("div",{className:"space-y-3",children:t.map(e=>{var s;let t=e.vietnamese||e.vietnamese_text||"",r=(null==(s=e.english)?void 0:s.join(", "))||e.english_text||"",n=e.image_url||"/placeholder.svg",d="CUSTOM"===e.flashcard_type,h=u.has(e.id);return(0,a.jsx)("div",{style:{perspective:"1000px",minHeight:"150px"},children:(0,a.jsxs)(U.motion.div,{style:{position:"relative",transformStyle:"preserve-3d",width:"100%",height:"100%",minHeight:"150px"},transition:{duration:.6},animate:{rotateX:180*!!h},children:[(0,a.jsx)(U.motion.div,{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden"},children:(0,a.jsx)(i.Card,{className:"group hover:shadow-md transition-all duration-200 cursor-pointer",style:{width:"100%",height:"100%"},onClick:()=>g(e.id),children:(0,a.jsx)(i.CardContent,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("div",{className:"w-16 h-16 rounded-lg overflow-hidden bg-gray-100 flex-shrink-0",children:(0,a.jsx)(N.default,{src:n,alt:t,width:64,height:64,className:"w-full h-full object-cover",loading:"lazy"})}),(0,a.jsx)("div",{className:"flex-1 min-w-0",children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-1",children:[(0,a.jsxs)("div",{className:"min-w-0",children:[(0,a.jsx)("h3",{className:"font-semibold text-lg text-gray-900 truncate",children:t}),"APP"===e.flashcard_type&&e.pronunciation&&(0,a.jsxs)("p",{className:"text-xs text-gray-500 font-mono mt-0.5 truncate",children:["/",e.pronunciation,"/"]}),"CUSTOM"===e.flashcard_type&&e.ipa_pronunciation&&(0,a.jsxs)("p",{className:"text-xs text-gray-500 font-mono mt-0.5 truncate",children:["/",e.ipa_pronunciation,"/"]})]}),(0,a.jsx)(l.Button,{variant:"ghost",size:"sm",onClick:a=>{a.stopPropagation(),x(e)},disabled:o===e.id,className:"p-1 h-auto opacity-60 hover:opacity-100 ".concat(o===e.id?"animate-pulse text-blue-500":""),title:"Play pronunciation",children:(0,a.jsx)(_.Volume2,{className:"h-4 w-4"})})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,a.jsx)(b.Badge,{variant:"APP"===e.flashcard_type?"default":"secondary",className:"text-xs",children:"APP"===e.flashcard_type?"App Card":"My Card"}),e.topic&&(0,a.jsx)(b.Badge,{variant:"outline",className:"text-xs",children:e.topic}),(()=>{let s=v(e.word_type);return 0===s.length?null:1===s.length?(0,a.jsx)(b.Badge,{variant:"outline",className:"text-xs",children:s[0]}):(0,a.jsx)("div",{className:"flex flex-wrap gap-1",children:s.map((e,s)=>(0,a.jsx)(b.Badge,{variant:"outline",className:"text-xs",children:e},s))})})()]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("div",{className:"text-right text-sm text-gray-500 mr-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(C.Clock,{className:"h-3 w-3"}),e.review_count," reviews"]}),(0,a.jsxs)("div",{className:"flex items-center gap-1 mt-1",suppressHydrationWarning:!0,children:[(0,a.jsx)(S,{className:"h-3 w-3"}),P(new Date(e.saved_at),{addSuffix:!0})]})]}),(0,a.jsx)(l.Button,{variant:"ghost",size:"sm",onClick:a=>{a.stopPropagation(),c(e.id)},className:"p-2",children:e.is_favorite?(0,a.jsx)(y.Star,{className:"h-4 w-4 fill-yellow-400 text-yellow-400"}):(0,a.jsx)(y.Star,{className:"h-4 w-4"})}),(0,a.jsx)(l.Button,{variant:"destructive",size:"sm",onClick:a=>{a.stopPropagation(),p(e)},className:"px-3",children:d?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(k.Trash2,{className:"h-4 w-4 mr-1"}),"Delete"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(A,{className:"h-4 w-4 mr-1"}),"Unsave"]})})]})]})})]})})})}),(0,a.jsx)(U.motion.div,{style:{position:"absolute",width:"100%",height:"100%",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden",transform:"rotateX(180deg)"},children:(0,a.jsx)(i.Card,{className:"group hover:shadow-md transition-all duration-200 cursor-pointer",style:{width:"100%",height:"100%"},onClick:()=>g(e.id),children:(0,a.jsx)(i.CardContent,{className:"p-4",children:(0,a.jsx)("div",{className:"flex items-center gap-4",children:(0,a.jsx)("div",{className:"flex-1 min-w-0",children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsx)("div",{className:"flex-1 min-w-0",children:(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("p",{className:"text-xl font-semibold text-gray-900 mb-4",children:r}),e.topic&&(0,a.jsx)(b.Badge,{variant:"outline",className:"text-xs",children:e.topic})]})}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("div",{className:"text-right text-sm text-gray-500 mr-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(C.Clock,{className:"h-3 w-3"}),e.review_count," reviews"]}),(0,a.jsxs)("div",{className:"flex items-center gap-1 mt-1",suppressHydrationWarning:!0,children:[(0,a.jsx)(S,{className:"h-3 w-3"}),P(new Date(e.saved_at),{addSuffix:!0})]})]}),(0,a.jsx)(l.Button,{variant:"ghost",size:"sm",onClick:a=>{a.stopPropagation(),c(e.id)},className:"p-2",children:e.is_favorite?(0,a.jsx)(y.Star,{className:"h-4 w-4 fill-yellow-400 text-yellow-400"}):(0,a.jsx)(y.Star,{className:"h-4 w-4"})}),(0,a.jsx)(l.Button,{variant:"destructive",size:"sm",onClick:a=>{a.stopPropagation(),p(e)},className:"px-3",children:d?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(k.Trash2,{className:"h-4 w-4 mr-1"}),"Delete"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(A,{className:"h-4 w-4 mr-1"}),"Unsave"]})})]})]})})})})})})]})},e.id)})})});var B=e.i(938266),E=e.i(800190),R=e.i(878894);function O(e){let{isOpen:t,onClose:r,onConfirm:i,flashcardText:n,actionType:c="unsave"}=e,[o,d]=(0,s.useState)(!1),h="delete"===c,u=h?(0,a.jsx)(k.Trash2,{className:"h-5 w-5 text-red-600"}):(0,a.jsx)(R.AlertTriangle,{className:"h-5 w-5 text-amber-600"});return(0,a.jsx)(B.Dialog,{open:t,onOpenChange:r,children:(0,a.jsxs)(B.DialogContent,{className:"sm:max-w-md",children:[(0,a.jsx)(B.DialogHeader,{children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"h-10 w-10 ".concat(h?"bg-red-100":"bg-amber-100"," rounded-full flex items-center justify-center"),children:u}),(0,a.jsxs)("div",{children:[(0,a.jsx)(B.DialogTitle,{className:"text-lg font-semibold",children:h?"Do you want to delete your custom flashcard?":"Do you want to unsave this flashcard?"}),(0,a.jsx)(B.DialogDescription,{className:"mt-1",children:h?'"'.concat(n,'" will be permanently deleted. This action cannot be undone.'):'"'.concat(n,'" will be removed from your saved flashcards.')})]})]})}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 mt-4",children:[(0,a.jsx)(E.Checkbox,{id:"dontShowAgain",checked:o,onCheckedChange:e=>d(e)}),(0,a.jsx)("label",{htmlFor:"dontShowAgain",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Don't show this again"})]}),(0,a.jsxs)(B.DialogFooter,{className:"flex gap-2 mt-6",children:[(0,a.jsx)(l.Button,{variant:"outline",onClick:()=>{r()},className:"flex-1",children:"No, Cancel"}),(0,a.jsx)(l.Button,{variant:"destructive",onClick:()=>{o&&sessionStorage.setItem("delete"===c?"hideDeleteModal":"hideUnsaveModal","true"),i(),r()},className:"flex-1",children:h?"Yes, Delete":"Yes, Unsave"})]})]})})}var L=e.i(174080),z=e.i(243970),H=e.i(37727),V=e.i(367240);function q(e){let{flashcardText:t,duration:r,onUndo:i,onComplete:n,onDismiss:c}=e,[o,d]=(0,s.useState)(0),[h,u]=(0,s.useState)(!0),m=(0,s.useRef)(null),x=(0,s.useRef)(null);(0,s.useEffect)(()=>{if(!h)return;m.current=performance.now();let e=a=>{if(!m.current)return;let s=(a-m.current)/1e3/r*100;if(s>=100){d(100),u(!1),n();return}d(s),x.current=requestAnimationFrame(e)};return x.current=requestAnimationFrame(e),()=>{x.current&&cancelAnimationFrame(x.current)}},[h,r,n]);let f=Math.max(0,r-o/100*r),p=(0,a.jsxs)("div",{className:"fixed bottom-6 right-6 z-50 pointer-events-auto bg-white border border-gray-200 rounded-lg shadow-lg p-4 min-w-[320px] max-w-md animate-in slide-in-from-bottom-5 fade-in duration-300",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900",children:t}),(0,a.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:f>0?(0,a.jsxs)(a.Fragment,{children:["Auto-deleting in ",Math.ceil(f)," second",1!==Math.ceil(f)?"s":""]}):"Deleted"})]}),c&&(0,a.jsx)(l.Button,{variant:"ghost",size:"sm",onClick:c,className:"p-1 h-auto",children:(0,a.jsx)(H.X,{className:"h-4 w-4"})})]}),f>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(z.Progress,{value:o,className:"h-1 mb-3"}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsxs)(l.Button,{variant:"outline",size:"sm",onClick:()=>{u(!1),i()},className:"text-xs px-3 py-1",children:[(0,a.jsx)(V.RotateCcw,{className:"h-3 w-3 mr-1"}),"Undo"]})})]})]});return(0,L.createPortal)(p,document.body)}async function W(e){try{let a=(0,D.createClient)(),{data:s,error:t}=await a.from("custom_flashcards").select("id, topic").eq("user_id",e).eq("status","ACTIVE");if(t)throw t;if(!s||0===s.length)return{success:!0,synced:0};let{data:r,error:l}=await a.from("saved_flashcards").select("flashcard_id").eq("UserID",e).eq("flashcard_type","CUSTOM");if(l)throw l;let i=new Set((r||[]).map(e=>e.flashcard_id)),n=s.filter(e=>!i.has("custom_".concat(e.id)));if(0===n.length)return{success:!0,synced:0};let c=n.map(a=>({UserID:e,flashcard_id:"custom_".concat(a.id),flashcard_type:"CUSTOM",topic:a.topic||null,saved_at:new Date().toISOString(),is_favorite:!1,review_count:0,tags:[]})),{error:o}=await a.from("saved_flashcards").insert(c);if(o)throw o;return{success:!0,synced:n.length}}catch(e){return console.error("Error syncing custom flashcards:",e),{success:!1,synced:0,error:e instanceof Error?e.message:"Unknown error"}}}var Y=e.i(95187),Z=(0,Y.createServerReference)("406d84cb44c4981a664e2476a59d980e60874605ab",Y.callServer,void 0,Y.findSourceMapURL,"deleteCustomFlashcard"),J=(0,Y.createServerReference)("40986aecbd86e0e666ca6f9c7e3044898795a258da",Y.callServer,void 0,Y.findSourceMapURL,"unsaveAppFlashcard"),X=e.i(978618);let K={APP_FLASHCARDS:25,CUSTOM_FLASHCARDS:10},G={APP_FLASHCARDS:100,CUSTOM_FLASHCARDS:25},Q={APP_FLASHCARDS:999999,CUSTOM_FLASHCARDS:999999};function $(e){let{initialData:f}=e,N=(0,r.useRouter)(),[b,S]=(0,s.useState)(f.savedFlashcards),[C]=(0,s.useState)(f.topics),[_,A]=(0,s.useState)(f.syncStatus),[k,T]=(0,s.useState)("grid"),[F,P]=(0,s.useState)(""),[M,U]=(0,s.useState)("all"),[B,E]=(0,s.useState)("date_desc"),[R,L]=(0,s.useState)("all"),[z,H]=(0,s.useState)(!1),[V,Y]=(0,s.useState)(null),[$,ee]=(0,s.useState)(!1),[ea,es]=(0,s.useState)(null);(0,s.useEffect)(()=>{console.log("ğŸ”„ [SavedFlashcards] Component mounted, checking for updates..."),N.refresh()},[N]),(0,s.useEffect)(()=>{let e=(0,D.createClient)();if(!e||"function"!=typeof e.channel)return void console.log("âš ï¸ [SavedFlashcards] Real-time subscriptions not available (Supabase not configured)");console.log("ğŸ”„ [SavedFlashcards] Setting up real-time subscriptions for user:",f.userId);let a=e.channel("custom_flashcards_changes").on("postgres_changes",{event:"INSERT",schema:"public",table:"custom_flashcards",filter:"user_id=eq.".concat(f.userId)},e=>{console.log("âœ¨ [SavedFlashcards] New custom flashcard detected:",e),h.toast.success("New flashcard added! Refreshing..."),N.refresh()}).subscribe(),s=e.channel("saved_flashcards_changes").on("postgres_changes",{event:"INSERT",schema:"public",table:"saved_flashcards",filter:"UserID=eq.".concat(f.userId)},e=>{var a;console.log("âœ¨ [SavedFlashcards] New saved flashcard detected:",e),(null==(a=e.new)?void 0:a.flashcard_type)==="CUSTOM"&&(h.toast.success("Flashcard synced! Refreshing..."),N.refresh())}).subscribe();return console.log("âœ… [SavedFlashcards] Real-time subscriptions active"),()=>{console.log("ğŸ§¹ [SavedFlashcards] Cleaning up real-time subscriptions"),"function"==typeof e.removeChannel&&(e.removeChannel(a),e.removeChannel(s))}},[f.userId,N]);let et=(e,a,s)=>{let t=b.find(a=>a.id===e);if(!t)return void console.error("âŒ Flashcard not found:",e);console.log("ğŸ—‘ï¸ Starting unsave countdown:",{flashcardId:e,flashcard:t,actionType:s}),S(a=>a.filter(a=>a.id!==e));let r=setTimeout(async()=>{console.log("â° Countdown complete, executing deletion:",s);try{if("delete"===s){let e=t.flashcard_id.replace("custom_","");console.log("ğŸ—‘ï¸ [Client] Calling deleteCustomFlashcard server action:",{savedFlashcardId:t.id,customFlashcardId:e,fullFlashcardId:t.flashcard_id});let a=await Z(e);if(!a.success)throw Error(a.error||"Failed to delete flashcard");console.log("âœ… [Client] Custom flashcard successfully deleted"),h.toast.success("Custom flashcard deleted successfully"),N.refresh()}else{console.log("ğŸ—‘ï¸ [Client] Calling unsaveAppFlashcard server action:",{savedFlashcardId:t.id,flashcardType:t.flashcard_type});let e=await J(t.id);if(!e.success)throw Error(e.error||"Failed to unsave flashcard");console.log("âœ… [Client] Flashcard successfully unsaved"),h.toast.success("Flashcard removed from your collection"),N.refresh()}}catch(a){console.error("âŒ [Client] Failed to ".concat(s," flashcard:"),a),S(e=>[...e,t]);let e=a instanceof Error?a.message:"An error occurred";h.toast.error("Failed to ".concat(s," flashcard: ").concat(e))}ee(!1),es(null)},5e3);es({flashcardId:e,originalFlashcard:t,timeoutId:r}),ee(!0)},er=async e=>{let a=b.find(a=>a.id===e);if(!a)return;let s=!a.is_favorite;console.log("â­ Toggling favorite:",{flashcardId:e,currentStatus:a.is_favorite,newStatus:s}),S(a=>a.map(a=>a.id===e?{...a,is_favorite:s}:a));try{let e=(0,D.createClient)(),{error:t}=await e.from("saved_flashcards").update({is_favorite:s}).eq("id",a.id).eq("UserID",f.userId);if(t)throw console.error("âŒ Favorite update error:",t),t;console.log("âœ… Favorite status updated successfully"),N.refresh()}catch(s){console.error("âŒ Failed to toggle favorite:",s),S(s=>s.map(s=>s.id===e?{...s,is_favorite:a.is_favorite}:s)),h.toast.error("Failed to update favorite status. Please try again.")}},el=async()=>{if((null==_?void 0:_.needsSync)&&0!==_.unsyncedCount)try{console.log("ğŸ”„ Syncing ".concat(_.unsyncedCount," unsynced flashcards..."));let e=await W(f.userId);e.success&&e.synced>0?(h.toast.success("Synchronized ".concat(e.synced," custom flashcard").concat(e.synced>1?"s":""," to your collection")),N.refresh()):e.success&&0===e.synced&&console.log("âœ… All custom flashcards are already synchronized")}catch(e){console.error("âŒ Error during sync:",e),h.toast.error("Failed to sync flashcards")}},ei=(0,s.useMemo)(()=>b.filter(e=>{var a;let s=e.vietnamese||e.vietnamese_text||"",t=(null==(a=e.english)?void 0:a.join(" "))||e.english_text||"",r=""===F.trim()||(0,X.searchVietnamese)(s,F)||t.toLowerCase().includes(F.toLowerCase()),l="all"===M||e.topic===M,i="all"===R||"app"===R&&"APP"===e.flashcard_type||"custom"===R&&"CUSTOM"===e.flashcard_type||"favorites"===R&&e.is_favorite;return r&&l&&i}),[b,F,M,R]),en=(0,s.useMemo)(()=>[...ei].sort((e,a)=>{switch(B){case"date_desc":return new Date(a.saved_at).getTime()-new Date(e.saved_at).getTime();case"date_asc":return new Date(e.saved_at).getTime()-new Date(a.saved_at).getTime();case"alpha_asc":let s=e.vietnamese||e.vietnamese_text||"",t=a.vietnamese||a.vietnamese_text||"";return s.localeCompare(t);case"alpha_desc":let r=e.vietnamese||e.vietnamese_text||"";return(a.vietnamese||a.vietnamese_text||"").localeCompare(r);default:return 0}}),[ei,B]),ec=(0,s.useMemo)(()=>b.filter(e=>"APP"===e.flashcard_type),[b]),eo=(0,s.useMemo)(()=>b.filter(e=>"CUSTOM"===e.flashcard_type),[b]),ed=(0,s.useMemo)(()=>b.filter(e=>e.is_favorite),[b]),eh="UNLIMITED"===f.userStats.subscription_type?Q:"PLUS"===f.userStats.subscription_type?G:K,eu=f.userStats.appFlashcards>=.8*eh.APP_FLASHCARDS||f.userStats.customFlashcards>=.8*eh.CUSTOM_FLASHCARDS;return(0,a.jsxs)("div",{className:"container mx-auto p-6 space-y-6",children:[(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsx)("div",{className:"flex items-center gap-4",children:(0,a.jsxs)("div",{children:[(0,a.jsxs)("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-2",children:[(0,a.jsx)(u.BookOpen,{className:"h-8 w-8 text-blue-600"}),"My Flashcards"]}),(0,a.jsx)("p",{className:"text-gray-600 mt-1",children:"Manage and review your saved flashcards"})]})})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsx)(i.Card,{children:(0,a.jsx)(i.CardContent,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"App Flashcards"}),(0,a.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:[f.userStats.appFlashcards,"/",999999===eh.APP_FLASHCARDS?"âˆ":eh.APP_FLASHCARDS]})]}),(0,a.jsx)("div",{className:"h-12 w-12 bg-blue-100 rounded-lg flex items-center justify-center",children:(0,a.jsx)(u.BookOpen,{className:"h-6 w-6 text-blue-600"})})]})})}),(0,a.jsx)(i.Card,{children:(0,a.jsx)(i.CardContent,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"My Flashcards"}),(0,a.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:[f.userStats.customFlashcards,"/",999999===eh.CUSTOM_FLASHCARDS?"âˆ":eh.CUSTOM_FLASHCARDS]})]}),(0,a.jsx)("div",{className:"h-12 w-12 bg-green-100 rounded-lg flex items-center justify-center",children:(0,a.jsx)(m.Plus,{className:"h-6 w-6 text-green-600"})})]})})})]}),"FREE"===f.userStats.subscription_type&&eu&&(0,a.jsx)(i.Card,{className:"border-amber-200 bg-gradient-to-r from-amber-50 to-orange-50",children:(0,a.jsx)(i.CardContent,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(j.Crown,{className:"h-8 w-8 text-amber-600"}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"font-semibold text-gray-900 flex items-center gap-2",children:[(0,a.jsx)(w.Sparkles,{className:"h-4 w-4 text-amber-600"}),"Upgrade to Plus"]}),(0,a.jsx)("p",{className:"text-sm text-gray-700",children:"You're approaching your save limit. Unlock unlimited flashcards!"})]})]}),(0,a.jsx)(t.default,{href:"/pricing",children:(0,a.jsx)(l.Button,{variant:"default",className:"bg-gradient-to-r from-amber-500 to-orange-600 text-white hover:from-amber-600 hover:to-orange-700",children:"View Plans"})})]})})}),_&&_.needsSync&&_.unsyncedCount>0&&(0,a.jsx)(i.Card,{className:"border-blue-200 bg-blue-50",children:(0,a.jsx)(i.CardContent,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{children:(0,a.jsxs)("p",{className:"text-sm font-medium text-blue-900",children:[_.unsyncedCount," custom flashcard",_.unsyncedCount>1?"s":""," need syncing"]})}),(0,a.jsx)(l.Button,{onClick:el,size:"sm",variant:"outline",children:"Sync Now"})]})})}),(0,a.jsx)(n.Separator,{}),(0,a.jsx)(i.Card,{children:(0,a.jsx)(i.CardContent,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,a.jsxs)("div",{className:"flex-1 relative",children:[(0,a.jsx)(x.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,a.jsx)(d.Input,{placeholder:"Search flashcards...",value:F,onChange:e=>P(e.target.value),className:"pl-10"})]}),(0,a.jsx)("div",{className:"w-full md:w-48",children:(0,a.jsxs)(o.Select,{value:M,onValueChange:U,children:[(0,a.jsx)(o.SelectTrigger,{className:"w-full",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(p,{className:"h-4 w-4"}),(0,a.jsx)(o.SelectValue,{placeholder:"All Topics"})]})}),(0,a.jsxs)(o.SelectContent,{children:[(0,a.jsx)(o.SelectItem,{value:"all",children:"All Topics"}),C.map(e=>(0,a.jsx)(o.SelectItem,{value:e.name,children:e.name},e.id))]})]})}),(0,a.jsx)("div",{className:"w-full md:w-56",children:(0,a.jsxs)(o.Select,{value:B,onValueChange:E,children:[(0,a.jsx)(o.SelectTrigger,{className:"w-full",children:(0,a.jsx)(o.SelectValue,{placeholder:"Date Added (Newest)"})}),(0,a.jsxs)(o.SelectContent,{children:[(0,a.jsx)(o.SelectItem,{value:"date_desc",children:"Date Added (Newest)"}),(0,a.jsx)(o.SelectItem,{value:"date_asc",children:"Date Added (Oldest)"}),(0,a.jsx)(o.SelectItem,{value:"alpha_asc",children:"Alphabetical (A-Z)"}),(0,a.jsx)(o.SelectItem,{value:"alpha_desc",children:"Alphabetical (Z-A)"})]})]})}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(l.Button,{variant:"list"===k?"default":"outline",size:"icon",onClick:()=>T("list"),children:(0,a.jsx)(v,{className:"h-4 w-4"})}),(0,a.jsx)(l.Button,{variant:"grid"===k?"default":"outline",size:"icon",onClick:()=>T("grid"),children:(0,a.jsx)(g,{className:"h-4 w-4"})})]})]})})}),(0,a.jsxs)(c.Tabs,{value:R,onValueChange:L,className:"w-full",children:[(0,a.jsxs)(c.TabsList,{className:"grid w-full grid-cols-4",children:[(0,a.jsxs)(c.TabsTrigger,{value:"all",children:["All (",b.length,")"]}),(0,a.jsxs)(c.TabsTrigger,{value:"app",children:["App Cards (",ec.length,")"]}),(0,a.jsxs)(c.TabsTrigger,{value:"custom",children:["My Cards (",eo.length,")"]}),(0,a.jsxs)(c.TabsTrigger,{value:"favorites",children:[(0,a.jsx)(y.Star,{className:"h-4 w-4 mr-1 fill-current"})," Favorites (",ed.length,")"]})]}),(0,a.jsx)(c.TabsContent,{value:R,className:"mt-6",children:0===en.length?(0,a.jsx)(i.Card,{children:(0,a.jsxs)(i.CardContent,{className:"p-12 text-center",children:[(0,a.jsx)(u.BookOpen,{className:"h-16 w-16 mx-auto text-gray-400 mb-4"}),(0,a.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No flashcards to display"}),(0,a.jsxs)("p",{className:"text-gray-600 mb-4",children:["Total in state: ",b.length,", Filtered: ",ei.length]}),(0,a.jsx)(t.default,{href:"/flashcards/create",children:(0,a.jsxs)(l.Button,{children:[(0,a.jsx)(m.Plus,{className:"h-4 w-4 mr-2"}),"Create Your First Flashcard"]})})]})}):(0,a.jsx)(I,{flashcards:en,viewMode:k,onUnsave:(e,a,s)=>{et(e,a,s)},onToggleFavorite:e=>{er(e)}})})]}),(0,a.jsx)(O,{isOpen:z,onClose:()=>H(!1),onConfirm:()=>{V&&et(V.flashcardId,V.flashcardText,V.actionType),H(!1),Y(null)},flashcardText:(null==V?void 0:V.flashcardText)||"",actionType:(null==V?void 0:V.actionType)||"unsave"}),$&&ea&&(0,a.jsx)(q,{flashcardText:ea.originalFlashcard.vietnamese||ea.originalFlashcard.vietnamese_text||"",onUndo:()=>{ea&&(clearTimeout(ea.timeoutId),S(e=>[...e,ea.originalFlashcard]),ee(!1),es(null),h.toast.success("Flashcard restored!"))},onComplete:()=>{ee(!1),es(null),h.toast.success("Flashcard removed from your collection")},onDismiss:()=>{ee(!1)},duration:5})]})}}]);